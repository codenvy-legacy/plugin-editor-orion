/*

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013,2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation
  Mihai Sucan (Mozilla Foundation) - fix for Bug#334583 Bug#348471 Bug#349485 Bug#350595 Bug#360726 Bug#361180 Bug#362835 Bug#362428 Bug#362286 Bug#354270 Bug#361474 Bug#363945 Bug#366312 Bug#370584

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: 
  Felipe Heidrich (IBM Corporation) - initial API and implementation
  Silenio Quarti (IBM Corporation) - initial API and implementation

 Copyright (c) 2009, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others. All rights reserved.
 This program and the accompanying materials are made available under the
 terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: 
 IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2010, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation

 Copyright (c) 2011, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2011, 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation 

 Copyright (c) 2010, 2012 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made
 available under the terms of the Eclipse Public License v1.0
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html).

 Contributors: IBM Corporation - initial API and implementation
               Alex Lakatos - fix for bug#369781

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2014 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors: IBM Corporation - initial API and implementation

 Copyright (c) 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details

 Copyright (c) 2011, 2013 IBM Corporation and others.
 All rights reserved. This program and the accompanying materials are made 
 available under the terms of the Eclipse Public License v1.0 
 (http://www.eclipse.org/legal/epl-v10.html), and the Eclipse Distribution 
 License v1.0 (http://www.eclipse.org/org/documents/edl-v10.html). 

 Contributors:
     IBM Corporation - initial API and implementation
*/
define("orion/editor/config",[],function(){return{languages:{}}});
define("orion/editor/shim",[],function(){Object.create||(Object.create=function(p,t){function r(){}r.prototype=p;var k=new r;if(t)for(var f in t)t.hasOwnProperty(f)&&(t[f].hasOwnProperty("value")?k[f]=t[f].value:k[f]=function(){if(0<arguments.length)return t[f].get();t[f].set(arguments)});return k});Object.keys||(Object.keys=function(p){var t=Object.prototype.hasOwnProperty,r=[],k;for(k in p)t.call(p,k)&&r.push(k);return r});Function.prototype.bind||(Function.prototype.bind=function(p){var t=this,
r=Array.prototype.slice.call(arguments,1);return r.length?function(){return arguments.length?t.apply(p,r.concat(Array.prototype.slice.call(arguments))):t.apply(p,r)}:function(){return arguments.length?t.apply(p,arguments):t.call(p)}});Array.isArray||(Array.isArray=function(p){return"[object Array]"===Object.prototype.toString.call(p)});Array.prototype.indexOf||(Array.prototype.indexOf=function(p){for(var t=0;t<this.length;t++)if(this[t]===p)return t;return-1});Array.prototype.forEach||(Array.prototype.forEach=
function(p){for(var t=0;t<this.length;t++)p(this[t],t)});Array.prototype.map||(Array.prototype.map=function(p){for(var t=Array(this.length),r=0;r<this.length;r++)t[r]=p(this[r]);return t});Array.prototype.reduce||(Array.prototype.reduce=function(p,t){var r,k=!1;1<arguments.length&&(r=t,k=!0);for(var f=0;this.length>f;++f)k?r=p(r,this[f],f,this):(r=this[f],k=!0);return r});String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});String.prototype.trimLeft||(String.prototype.trimLeft=
function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return{}});
(function(){function p(f,g,e,q,d,b){g[f]&&(e.push(f),(!0===g[f]||1===g[f])&&q.push(d+f+"/"+b))}function t(f,g,e,q,d){g=q+g+"/"+d;require._fileExists(f.toUrl(g+".js"))&&e.push(g)}function r(f,g,e){for(var q in g)g.hasOwnProperty(q)&&(!f.hasOwnProperty(q)||e)?f[q]=g[q]:"object"===typeof g[q]&&r(f[q],g[q],e)}var k=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("i18n",["module"],function(f){var g=f.config?f.config():{},g=g||{};return{version:"2.0.1+",load:function(e,f,d,b){b=b||{};b.locale&&(g.locale=
b.locale);var a=k.exec(e),c=a[1],m=a[4],n=a[5],h=m.split("-"),s=[],v={},x,w="";a[5]?(c=a[1],e=c+n):(n=a[4],m=g.locale,m||(m=g.locale="undefined"===typeof navigator?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),h=m.split("-"));if(b.isBuild){s.push(e);t(f,"root",s,c,n);for(x=0;x<h.length;x++)b=h[x],w+=(w?"-":"")+b,t(f,w,s,c,n);f(s,function(){d()})}else f([e],function(a){var b=[],m;p("root",a,b,s,c,n);for(x=0;x<h.length;x++)m=h[x],w+=(w?"-":"")+m,p(w,a,b,s,c,n);f(s,function(){var l,
u,h;for(l=b.length-1;-1<l&&b[l];l--){h=b[l];u=a[h];if(!0===u||1===u)u=f(c+h+"/"+n);r(v,u)}d(v)})})}}})})();define("orion/editor/i18n",{load:function(p,t,r,k){t.specified&&t.specified("orion/bootstrap")?t(["orion/i18n!"+p],function(f){r(f)}):t(["orion/editor/config"],function(f){r(f&&f.languages||{})})}});
define("orion/editor/nls/root/messages",{multipleAnnotations:"Multiple annotations:",line:"Line: ${0}",breakpoint:"Breakpoint",bookmark:"Bookmark",task:"Task",error:"Error",warning:"Warning",matchingSearch:"Matching Search",currentSearch:"Current Search",currentLine:"Current Line",matchingBracket:"Matching Bracket",currentBracket:"Current Bracket",lineUp:"Line Up",lineDown:"Line Down",lineStart:"Line Start",lineEnd:"Line End",charPrevious:"Previous Character",charNext:"Next Character",pageUp:"Page Up",
pageDown:"Page Down",scrollPageUp:"Scroll Page Up",scrollPageDown:"Scroll Page Down",scrollLineUp:"Scroll Line Up",scrollLineDown:"Scroll Line Down",wordPrevious:"Previous Word",wordNext:"Next Word",textStart:"Document Start",textEnd:"Document End",scrollTextStart:"Scroll Document Start",scrollTextEnd:"Scroll Document End",centerLine:"Center Line",selectLineUp:"Select Line Up",selectLineDown:"Select Line Down",selectWholeLineUp:" Select Whole Line Up",selectWholeLineDown:"Select Whole Line Down",
selectLineStart:"Select Line Start",selectLineEnd:"Select Line End",selectCharPrevious:"Select Previous Character",selectCharNext:"Select Next Character",selectPageUp:"Select Page Up",selectPageDown:"Select Page Down",selectWordPrevious:"Select Previous Word",selectWordNext:"Select Next Word",selectTextStart:"Select Document Start",selectTextEnd:"Select Document End",deletePrevious:"Delete Previous Character",deleteNext:"Delete Next Character",deleteWordPrevious:"Delete Previous Word",deleteWordNext:"Delete Next Word",
deleteLineStart:"Delete Line Start",deleteLineEnd:"Delete Line End",tab:"Insert Tab",enter:"Insert Line Delimiter",enterNoCursor:"Insert Line Delimiter",selectAll:"Select All",copy:"Copy",cut:"Cut",paste:"Paste",uppercase:"To Upper Case",lowercase:"To Lower Case",capitalize:"Capitalize",reversecase:"Reverse Case",toggleWrapMode:"Toggle Wrap Mode",toggleTabMode:"Toggle Tab Mode",toggleOverwriteMode:"Toggle Overwrite Mode",committerOnTime:"${0} on ${1}",emacs:"Emacs",exchangeMarkPoint:"Exchange Mark and Point",
setMarkCommand:"Set Mark",clearMark:"Clear Mark",digitArgument:"Digit Argument ${0}",negativeArgument:"Negative Argument",Comment:"Comment","Flat outline":"Flat outline",incrementalFindStr:"Incremental find: ${0}",incrementalFindStrNotFound:"Incremental find: ${0} (not found)",incrementalFindReverseStr:"Reverse Incremental find: ${0}",incrementalFindReverseStrNotFound:"Reverse Incremental find: ${0} (not found)",find:"Find...",undo:"Undo",redo:"Redo",cancelMode:"Cancel Current Mode",findNext:"Find Next Occurrence",
findPrevious:"Find Previous Occurrence",incrementalFind:"Incremental Find",incrementalFindReverse:"Incremental Find Reverse",indentLines:"Indent Lines",unindentLines:"Unindent Lines",moveLinesUp:"Move Lines Up",moveLinesDown:"Move Lines Down",copyLinesUp:"Copy Lines Up",copyLinesDown:"Copy Lines Down",deleteLines:"Delete Lines",gotoLine:"Goto Line...",gotoLinePrompty:"Goto Line:",nextAnnotation:"Next Annotation",prevAnnotation:"Previous Annotation",expand:"Expand",collapse:"Collapse",expandAll:"Expand All",
collapseAll:"Collapse All",lastEdit:"Last Edit Location",trimTrailingWhitespaces:"Trim Trailing Whitespaces",toggleLineComment:"Toggle Line Comment",addBlockComment:"Add Block Comment",removeBlockComment:"Remove Block Comment",linkedModeEntered:"Linked Mode entered",linkedModeExited:"Linked Mode exited",syntaxError:"Syntax Error",contentAssist:"Content Assist",lineColumn:"Line ${0} : Col ${1}",vi:"vi",vimove:"(Move)",viyank:"(Yank)",videlete:"(Delete)",vichange:"(Change)",viLeft:"${0} Left",viRight:"${0} Right",
viUp:"${0} Up",viDown:"${0} Down",viw:"${0} Next Word",vib:"${0} Beginning of Word",viW:"${0} Next Word (ws stop)",viB:"${0} Beginning of Word (ws stop)",vie:"${0} End of Word",viE:"${0} End of Word (ws stop)",vi$:"${0} End of the line","vi^_":"${0} First non-blank Char Current Line","vi+":"${0} First Char Next Line","vi-":"${0} First Char Previous Line","vi|":"${0} nth Column in Line",viH:"${0} Top of Page",viM:"${0} Middle of Page",viL:"${0} Bottom of Page","vi/":"${0} Search Forward","vi?":"${0} Search Backward",
vin:"${0} Next Search",viN:"${0} Previous Search",vif:"${0} Search Char Fwd",viF:"${0} Search Char Bckwd",vit:"${0} Search Before Char Fwd",viT:"${0} Search Before Char Bckwd","vi,":"${0} Repeat Reverse Char Search","vi;":"${0} Repeat Char Search",viG:"${0} Go to Line",viycd:"${0} Current Line",via:"Append After Cursor",viA:"Append to End of Line",vii:"Insert Before Cursor",viI:"Insert at Beginning of Line",viO:"Insert Line Above",vio:"Insert Line Below",viR:"Begin Overwriting Text",vis:"Substitute a Character",
viS:"Substitute Entire Line",viC:"Change Text Until Line End",vip:"Paste After Char or Line",viP:"Paste Before Char or Line",viStar:"Search Word Under Cursor",next:"Next",previous:"Previous",replace:"Replace",replaceAll:"Replace All",findWith:"Find With",replaceWith:"Replace With",caseInsensitive:"Aa",regex:"/.*/",wholeWord:"\\b",caseInsensitiveTooltip:"Toggle Case Insensitive",regexTooltip:"Toggle Regex",wholeWordTooltip:"Toggle Whole Word",closeTooltip:"Close",replacingAll:"Replacing all...",replacedMatches:"Replaced ${0} matches",
nothingReplaced:"Nothing replaced",notFound:"Not found"});define("orion/editor/nls/messages",["orion/editor/i18n!orion/editor/nls/messages","orion/editor/nls/root/messages"],function(p,t){var r={root:t},k;for(k in p)p.hasOwnProperty(k)&&"undefined"===typeof r[k]&&(r[k]=p[k]);return r});
define("orion/editor/eventTarget",[],function(){function p(){}p.addMixin=function(t){var r=p.prototype,k;for(k in r)r.hasOwnProperty(k)&&(t[k]=r[k])};p.prototype={addEventListener:function(p,r,k){this._eventTypes||(this._eventTypes={});var f=this._eventTypes[p];f||(f=this._eventTypes[p]={level:0,listeners:[]});f.listeners.push({listener:r,useCapture:k})},dispatchEvent:function(p){var r=p.type;this._dispatchEvent("pre"+r,p);this._dispatchEvent(r,p);this._dispatchEvent("post"+r,p)},_dispatchEvent:function(p,
r){var k=this._eventTypes?this._eventTypes[p]:null;if(k){var f=k.listeners;try{if(k.level++,f)for(var g=0,e=f.length;g<e;g++)if(f[g]){var q=f[g].listener;"function"===typeof q?q.call(this,r):q.handleEvent&&"function"===typeof q.handleEvent&&q.handleEvent(r)}}finally{if(k.level--,k.compact&&0===k.level){for(g=f.length-1;0<=g;g--)f[g]||f.splice(g,1);0===f.length&&delete this._eventTypes[p];k.compact=!1}}}},isListening:function(p){return!this._eventTypes?!1:void 0!==this._eventTypes[p]},removeEventListener:function(p,
r,k){if(this._eventTypes){var f=this._eventTypes[p];if(f){for(var g=f.listeners,e=0,q=g.length;e<q;e++){var d=g[e];if(d&&d.listener===r&&d.useCapture===k){0!==f.level?(g[e]=null,f.compact=!0):g.splice(e,1);break}}0===g.length&&delete this._eventTypes[p]}}}};return{EventTarget:p}});define("orion/regex",[],function(){return{escape:function(p){return p.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26")},parse:function(p){return(p=/^\s*\/(.+)\/([gim]{0,3})\s*$/.exec(p))?{pattern:p[1],flags:p[2]}:null}}});
define("orion/util",[],function(){var p=navigator.userAgent,t=-1!==p.indexOf("MSIE")||-1!==p.indexOf("Trident")?document.documentMode:void 0,r=parseFloat(p.split("Firefox/")[1]||p.split("Minefield/")[1])||void 0,k=-1!==p.indexOf("Opera")?parseFloat(p.split("Version/")[1]):void 0,f=parseFloat(p.split("Chrome/")[1])||void 0,g=-1!==p.indexOf("Safari")&&!f,e=parseFloat(p.split("WebKit/")[1])||void 0,q=-1!==p.indexOf("Android"),d=-1!==p.indexOf("iPad"),p=-1!==p.indexOf("iPhone"),b=d||p,a=-1!==navigator.platform.indexOf("Mac"),
c=-1!==navigator.platform.indexOf("Win"),m=-1!==navigator.platform.indexOf("Linux"),n="undefined"!==typeof document&&"ontouchstart"in document.createElement("input");return{formatMessage:function(a){var c=arguments;return a.replace(/\$\{([^\}]+)\}/g,function(a,h){return c[(h<<0)+1]})},createElement:function(a,c){return a.createElementNS?a.createElementNS("http://www.w3.org/1999/xhtml",c):a.createElement(c)},isIE:t,isFirefox:r,isOpera:k,isChrome:f,isSafari:g,isWebkit:e,isAndroid:q,isIPad:d,isIPhone:p,
isIOS:b,isMac:a,isWindows:c,isLinux:m,isTouch:n,platformDelimiter:c?"\r\n":"\n"}});
define("orion/editor/textModel",["orion/editor/eventTarget","orion/regex","orion/util"],function(p,t,r){function k(f,g){this._lastLineIndex=-1;this._text=[""];this._lineOffsets=[0];this.setText(f);this.setLineDelimiter(g)}k.prototype={destroy:function(){},find:function(f){1<this._text.length&&(this._text=[this._text.join("")]);var g=f.string,e=f.regex,q=g,d="",b=f.caseInsensitive;if(q)if(e){if(g=t.parse(q))q=g.pattern,d=g.flags}else q=g.replace(/([\\$\^*\/+?\.\(\)|{}\[\]])/g,"\\$\x26"),b&&(q=q.replace(/[iI\u0130\u0131]/g,
"[Ii\u0130\u0131]"));var a=null,c;if(q){var g=f.reverse,m=f.wrap,e=f.wholeWord,n=f.start||0;f=f.end;var h=null!==f&&void 0!==f;-1===d.indexOf("g")&&(d+="g");-1===d.indexOf("m")&&(d+="m");b&&-1===d.indexOf("i")&&(d+="i");e&&(q="\\b"+q+"\\b");var s=this._text[0],v,x,k=0;h&&(b=n<f?n:f,s=s.substring(b,n<f?f:n),k=b);var p=RegExp(q,d);g?c=function(){var a=null;for(p.lastIndex=0;;){x=p.lastIndex;v=p.exec(s);if(x===p.lastIndex)return null;if(v){if(!(v.index+k<n)){if(!m||a)break;n=s.length+k}a={start:v.index+
k,end:p.lastIndex+k}}else break}a&&(n=a.start);return a}:(h||(p.lastIndex=n),c=function(){for(;;){x=p.lastIndex;v=p.exec(s);if(x===p.lastIndex)break;if(v)return{start:v.index+k,end:p.lastIndex+k};if(!(0!==x&&m))break}return null});a=c()}return{next:function(){var h=a;h&&(a=c());return h},hasNext:function(){return null!==a}}},getCharCount:function(){for(var f=0,g=0;g<this._text.length;g++)f+=this._text[g].length;return f},getLine:function(f,g){var e=this.getLineCount();if(!(0<=f&&f<e))return null;
var q=this._lineOffsets[f];if(f+1<e){e=this.getText(q,this._lineOffsets[f+1]);if(g)return e;for(var q=e.length,d;10===(d=e.charCodeAt(q-1))||13===d;)q--;return e.substring(0,q)}return this.getText(q)},getLineAtOffset:function(f){var g=this.getCharCount();if(!(0<=f&&f<=g))return-1;var e=this.getLineCount();if(f===g)return e-1;var q,d,b=this._lastLineIndex;if(0<=b&&b<e&&(q=this._lineOffsets[b],d=b+1<e?this._lineOffsets[b+1]:g,q<=f&&f<d))return b;for(var a=e,c=-1;1<a-c;)if(b=Math.floor((a+c)/2),q=this._lineOffsets[b],
d=b+1<e?this._lineOffsets[b+1]:g,f<=q)a=b;else if(f<d){a=b;break}else c=b;return this._lastLineIndex=a},getLineCount:function(){return this._lineOffsets.length},getLineDelimiter:function(){return this._lineDelimiter},getLineEnd:function(f,g){var e=this.getLineCount();if(!(0<=f&&f<e))return-1;if(f+1<e){e=this._lineOffsets[f+1];if(g)return e;for(var q=this.getText(Math.max(this._lineOffsets[f],e-2),e),d=q.length,b;10===(b=q.charCodeAt(d-1))||13===b;)d--;return e-(q.length-d)}return this.getCharCount()},
getLineStart:function(f){return!(0<=f&&f<this.getLineCount())?-1:this._lineOffsets[f]},getText:function(f,g){void 0===f&&(f=0);void 0===g&&(g=this.getCharCount());if(f===g)return"";for(var e=0,q=0,d;q<this._text.length;){d=this._text[q].length;if(f<=e+d)break;e+=d;q++}for(var b=e,a=q;q<this._text.length;){d=this._text[q].length;if(g<=e+d)break;e+=d;q++}if(a===q)return this._text[a].substring(f-b,g-e);b=this._text[a].substring(f-b);e=this._text[q].substring(0,g-e);return b+this._text.slice(a+1,q).join("")+
e},onChanging:function(f){return this.dispatchEvent(f)},onChanged:function(f){return this.dispatchEvent(f)},setLineDelimiter:function(f,g){"auto"===f&&(f=void 0,1<this.getLineCount()&&(f=this.getText(this.getLineEnd(0),this.getLineEnd(0,!0))));this._lineDelimiter=f?f:r.platformDelimiter;if(g){var e=this.getLineCount();if(1<e){for(var q=Array(e),d=0;d<e;d++)q[d]=this.getLine(d);this.setText(q.join(this._lineDelimiter))}}},setText:function(f,g,e){void 0===f&&(f="");void 0===g&&(g=0);void 0===e&&(e=
this.getCharCount());if(!(g===e&&""===f)){for(var q=this.getLineAtOffset(g),d=this.getLineAtOffset(e),b=g,a=e-g,c=d-q,m=f.length,n=0,h=this.getLineCount(),s=0,v=0,x=0,k=[];;){-1!==s&&s<=x&&(s=f.indexOf("\r",x));-1!==v&&v<=x&&(v=f.indexOf("\n",x));if(-1===v&&-1===s)break;x=-1!==s&&-1!==v?s+1===v?v+1:(s<v?s:v)+1:-1!==s?s+1:v+1;k.push(g+x);n++}this.onChanging({type:"Changing",text:f,start:b,removedCharCount:a,addedCharCount:m,removedLineCount:c,addedLineCount:n});0===k.length&&(x=this.getLineStart(q),
d=d+1<h?this.getLineStart(d+1):this.getCharCount(),g!==x&&(f=this.getText(x,g)+f,g=x),e!==d&&(f+=this.getText(e,d),e=d));x=m-a;for(d=q+c+1;d<h;d++)this._lineOffsets[d]+=x;if(5E4>k.length)q=[q+1,c].concat(k),Array.prototype.splice.apply(this._lineOffsets,q);else{x=q+1;this._lineOffsets.splice(x,c);for(h=0;h<k.length;h+=5E4)q=[x,0].concat(k.slice(h,Math.min(k.length,h+5E4))),Array.prototype.splice.apply(this._lineOffsets,q),x+=5E4}for(x=h=0;x<this._text.length;){d=this._text[x].length;if(g<=h+d)break;
h+=d;x++}q=h;for(k=x;x<this._text.length;){d=this._text[x].length;if(e<=h+d)break;h+=d;x++}d=this._text[x];g=this._text[k].substring(0,g-q);e=d.substring(e-h);k=[k,x-k+1];g&&k.push(g);f&&k.push(f);e&&k.push(e);Array.prototype.splice.apply(this._text,k);0===this._text.length&&(this._text=[""]);this.onChanged({type:"Changed",start:b,removedCharCount:a,addedCharCount:m,removedLineCount:c,addedLineCount:n})}}};p.EventTarget.addMixin(k.prototype);return{TextModel:k}});
define("orion/keyBinding",["orion/util"],function(p){function t(k,f,g,e,q,d){this.type=d||"keydown";this.keyCode="string"===typeof k&&"keydown"===this.type?k.toUpperCase().charCodeAt(0):k;this.mod1=void 0!==f&&null!==f?f:!1;this.mod2=void 0!==g&&null!==g?g:!1;this.mod3=void 0!==e&&null!==e?e:!1;this.mod4=void 0!==q&&null!==q?q:!1}function r(k){this.keys=k}t.prototype={getKeys:function(){return[this]},match:function(k,f){if(void 0!==f){if(0!==f)return!1}else if(k instanceof Array){if(1<k.length)return!1;
k=k[0]}return k.type!==this.type?!1:this.keyCode===k.keyCode||this.keyCode===String.fromCharCode(p.isOpera?k.which:void 0!==k.charCode?k.charCode:k.keyCode)?this.mod1!==(p.isMac?k.metaKey:k.ctrlKey)||"keydown"===this.type&&this.mod2!==k.shiftKey||this.mod3!==k.altKey||p.isMac&&this.mod4!==k.ctrlKey?!1:!0:!1},equals:function(k){return!k||this.keyCode!==k.keyCode||this.mod1!==k.mod1||this.mod2!==k.mod2||this.mod3!==k.mod3||this.mod4!==k.mod4||this.type!==k.type?!1:!0}};r.prototype={getKeys:function(){return this.keys.slice(0)},
match:function(k,f){var g=this.keys;if(void 0!==f)return f>g.length?!1:g[f].match(k)?f===g.length-1?!0:f+1:!1;k instanceof Array||(k=[k]);if(k.length>g.length)return!1;var e;for(e=0;e<k.length;e++)if(!g[e].match(k[e]))return!1;return e===g.length?!0:e},equals:function(k){if(!k.keys||k.keys.length!==this.keys.length)return!1;for(var f=0;f<k.keys.length;f++)if(!k.keys[f].equals(this.keys[f]))return!1;return!0}};return{KeyBinding:t,KeyStroke:t,KeySequence:r}});
define("orion/editor/keyModes",["orion/keyBinding","orion/util"],function(p,t){function r(f){f&&(this._view=f,this._keyBindings=this.createKeyBindings(),this._keyBindingIndex=0)}function k(f){r.call(this,f)}r.prototype={createKeyBindings:function(){return[]},getKeyBindings:function(f){for(var g=[],e=this._keyBindings,q=0;q<e.length;q++)e[q].actionID===f&&g.push(e[q].keyBinding);return g},getView:function(){return this._view},isActive:function(){return-1!==this._view.getKeyModes().indexOf(this)},match:function(f){if("keydown"===
f.type)switch(f.keyCode){case 16:case 17:case 18:case 91:return}for(var g=this._keyBindingIndex,e=this._matchingKeyBindings||this._keyBindings,q=[],d=0;d<e.length;d++){var b=e[d],a=b.keyBinding.match(f,g);if(!0===a)return this._keyBindingIndex=0,this._matchingKeyBindings=null,b.actionID;"number"===typeof a&&q.push(b)}if(0===q.length)this._keyBindingIndex=0,this._matchingKeyBindings=null;else return this._keyBindingIndex++,this._matchingKeyBindings=q,"noop"},setKeyBinding:function(f,g){for(var e=this._keyBindings,
q=0;q<e.length;q++){var d=e[q];if(d.keyBinding.equals(f)){g?d.actionID=g:d.predefined?d.actionID="noop":e.splice(q,1);return}}g&&e.push({keyBinding:f,actionID:g})},setView:function(f){this._view=f}};k.prototype=new r;k.prototype.createKeyBindings=function(){var f=p.KeyBinding,g=[];g.push({actionID:"lineUp",keyBinding:new f(38),predefined:!0});g.push({actionID:"lineDown",keyBinding:new f(40),predefined:!0});g.push({actionID:"charPrevious",keyBinding:new f(37),predefined:!0});g.push({actionID:"charNext",
keyBinding:new f(39),predefined:!0});t.isMac?(g.push({actionID:"scrollPageUp",keyBinding:new f(33),predefined:!0}),g.push({actionID:"scrollPageDown",keyBinding:new f(34),predefined:!0}),g.push({actionID:"pageUp",keyBinding:new f(33,null,null,!0),predefined:!0}),g.push({actionID:"pageDown",keyBinding:new f(34,null,null,!0),predefined:!0}),g.push({actionID:"lineStart",keyBinding:new f(37,!0),predefined:!0}),g.push({actionID:"lineEnd",keyBinding:new f(39,!0),predefined:!0}),g.push({actionID:"wordPrevious",
keyBinding:new f(37,null,null,!0),predefined:!0}),g.push({actionID:"wordNext",keyBinding:new f(39,null,null,!0),predefined:!0}),g.push({actionID:"scrollTextStart",keyBinding:new f(36),predefined:!0}),g.push({actionID:"scrollTextEnd",keyBinding:new f(35),predefined:!0}),g.push({actionID:"textStart",keyBinding:new f(38,!0),predefined:!0}),g.push({actionID:"textEnd",keyBinding:new f(40,!0),predefined:!0}),g.push({actionID:"scrollPageUp",keyBinding:new f(38,null,null,null,!0),predefined:!0}),g.push({actionID:"scrollPageDown",
keyBinding:new f(40,null,null,null,!0),predefined:!0}),g.push({actionID:"lineStart",keyBinding:new f(37,null,null,null,!0),predefined:!0}),g.push({actionID:"lineEnd",keyBinding:new f(39,null,null,null,!0),predefined:!0}),g.push({actionID:"lineStart",keyBinding:new f(38,null,null,!0),predefined:!0}),g.push({actionID:"lineEnd",keyBinding:new f(40,null,null,!0),predefined:!0})):(g.push({actionID:"pageUp",keyBinding:new f(33),predefined:!0}),g.push({actionID:"pageDown",keyBinding:new f(34),predefined:!0}),
g.push({actionID:"lineStart",keyBinding:new f(36),predefined:!0}),g.push({actionID:"lineEnd",keyBinding:new f(35),predefined:!0}),g.push({actionID:"wordPrevious",keyBinding:new f(37,!0),predefined:!0}),g.push({actionID:"wordNext",keyBinding:new f(39,!0),predefined:!0}),g.push({actionID:"textStart",keyBinding:new f(36,!0),predefined:!0}),g.push({actionID:"textEnd",keyBinding:new f(35,!0),predefined:!0}));t.isFirefox&&t.isLinux&&(g.push({actionID:"lineUp",keyBinding:new f(38,!0),predefined:!0}),g.push({actionID:"lineDown",
keyBinding:new f(40,!0),predefined:!0}));t.isWindows&&(g.push({actionID:"scrollLineUp",keyBinding:new f(38,!0),predefined:!0}),g.push({actionID:"scrollLineDown",keyBinding:new f(40,!0),predefined:!0}));g.push({actionID:"selectLineUp",keyBinding:new f(38,null,!0),predefined:!0});g.push({actionID:"selectLineDown",keyBinding:new f(40,null,!0),predefined:!0});g.push({actionID:"selectCharPrevious",keyBinding:new f(37,null,!0),predefined:!0});g.push({actionID:"selectCharNext",keyBinding:new f(39,null,!0),
predefined:!0});g.push({actionID:"selectPageUp",keyBinding:new f(33,null,!0),predefined:!0});g.push({actionID:"selectPageDown",keyBinding:new f(34,null,!0),predefined:!0});t.isMac?(g.push({actionID:"selectLineStart",keyBinding:new f(37,!0,!0),predefined:!0}),g.push({actionID:"selectLineEnd",keyBinding:new f(39,!0,!0),predefined:!0}),g.push({actionID:"selectWordPrevious",keyBinding:new f(37,null,!0,!0),predefined:!0}),g.push({actionID:"selectWordNext",keyBinding:new f(39,null,!0,!0),predefined:!0}),
g.push({actionID:"selectTextStart",keyBinding:new f(36,null,!0),predefined:!0}),g.push({actionID:"selectTextEnd",keyBinding:new f(35,null,!0),predefined:!0}),g.push({actionID:"selectTextStart",keyBinding:new f(38,!0,!0),predefined:!0}),g.push({actionID:"selectTextEnd",keyBinding:new f(40,!0,!0),predefined:!0}),g.push({actionID:"selectLineStart",keyBinding:new f(37,null,!0,null,!0),predefined:!0}),g.push({actionID:"selectLineEnd",keyBinding:new f(39,null,!0,null,!0),predefined:!0}),g.push({actionID:"selectLineStart",
keyBinding:new f(38,null,!0,!0),predefined:!0}),g.push({actionID:"selectLineEnd",keyBinding:new f(40,null,!0,!0),predefined:!0})):(t.isLinux&&(g.push({actionID:"selectWholeLineUp",keyBinding:new f(38,!0,!0),predefined:!0}),g.push({actionID:"selectWholeLineDown",keyBinding:new f(40,!0,!0),predefined:!0})),g.push({actionID:"selectLineStart",keyBinding:new f(36,null,!0),predefined:!0}),g.push({actionID:"selectLineEnd",keyBinding:new f(35,null,!0),predefined:!0}),g.push({actionID:"selectWordPrevious",
keyBinding:new f(37,!0,!0),predefined:!0}),g.push({actionID:"selectWordNext",keyBinding:new f(39,!0,!0),predefined:!0}),g.push({actionID:"selectTextStart",keyBinding:new f(36,!0,!0),predefined:!0}),g.push({actionID:"selectTextEnd",keyBinding:new f(35,!0,!0),predefined:!0}));g.push({actionID:"undo",keyBinding:new p.KeyBinding("z",!0),predefined:!0});t.isMac?g.push({actionID:"redo",keyBinding:new p.KeyBinding("z",!0,!0),predefined:!0}):g.push({actionID:"redo",keyBinding:new p.KeyBinding("y",!0),predefined:!0});
g.push({actionID:"deletePrevious",keyBinding:new f(8),predefined:!0});g.push({actionID:"deletePrevious",keyBinding:new f(8,null,!0),predefined:!0});g.push({actionID:"deleteNext",keyBinding:new f(46),predefined:!0});g.push({actionID:"deleteWordPrevious",keyBinding:new f(8,!0),predefined:!0});g.push({actionID:"deleteWordPrevious",keyBinding:new f(8,!0,!0),predefined:!0});g.push({actionID:"deleteWordNext",keyBinding:new f(46,!0),predefined:!0});g.push({actionID:"tab",keyBinding:new f(9),predefined:!0});
g.push({actionID:"shiftTab",keyBinding:new f(9,null,!0),predefined:!0});g.push({actionID:"enter",keyBinding:new f(13),predefined:!0});g.push({actionID:"enter",keyBinding:new f(13,null,!0),predefined:!0});g.push({actionID:"selectAll",keyBinding:new f("a",!0),predefined:!0});g.push({actionID:"toggleTabMode",keyBinding:new f("m",!0),predefined:!0});t.isMac&&(g.push({actionID:"deleteNext",keyBinding:new f(46,null,!0),predefined:!0}),g.push({actionID:"deleteWordPrevious",keyBinding:new f(8,null,null,!0),
predefined:!0}),g.push({actionID:"deleteWordNext",keyBinding:new f(46,null,null,!0),predefined:!0}));g.push({actionID:"toggleWrapMode",keyBinding:new p.KeyBinding("w",!0,!1,!0)});g.push({actionID:"toggleOverwriteMode",keyBinding:new p.KeyBinding(45)});if(!t.isFirefox){var e=t.isMac&&t.isChrome;g.push({actionID:"noop",keyBinding:new f("u",!e,!1,!1,e),predefined:!0});g.push({actionID:"noop",keyBinding:new f("i",!e,!1,!1,e),predefined:!0});g.push({actionID:"noop",keyBinding:new f("b",!e,!1,!1,e),predefined:!0})}t.isFirefox&&
(g.push({actionID:"copy",keyBinding:new f(45,!0),predefined:!0}),g.push({actionID:"paste",keyBinding:new f(45,null,!0),predefined:!0}),g.push({actionID:"cut",keyBinding:new f(46,null,!0),predefined:!0}));t.isMac&&(g.push({actionID:"lineStart",keyBinding:new f("a",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"lineEnd",keyBinding:new f("e",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"lineUp",keyBinding:new f("p",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"lineDown",keyBinding:new f("n",!1,!1,
!1,!0),predefined:!0}),g.push({actionID:"charPrevious",keyBinding:new f("b",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"charNext",keyBinding:new f("f",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"deletePrevious",keyBinding:new f("h",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"deleteNext",keyBinding:new f("d",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"deleteLineEnd",keyBinding:new f("k",!1,!1,!1,!0),predefined:!0}),t.isFirefox?(g.push({actionID:"scrollPageDown",keyBinding:new f("v",!1,
!1,!1,!0),predefined:!0}),g.push({actionID:"deleteLineStart",keyBinding:new f("u",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"deleteWordPrevious",keyBinding:new f("w",!1,!1,!1,!0),predefined:!0})):(g.push({actionID:"pageDown",keyBinding:new f("v",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"centerLine",keyBinding:new f("l",!1,!1,!1,!0),predefined:!0}),g.push({actionID:"enterNoCursor",keyBinding:new f("o",!1,!1,!1,!0),predefined:!0})));return g};return{KeyMode:r,DefaultKeyMode:k}});
define("orion/editor/textTheme",["require","orion/editor/eventTarget","orion/util"],function(p,t,r){function k(f){f=f||{};this._document=f.document||document}var f={};k.getTheme=function(g){g=g||"default";var e=f[g];e||(e=f[g]=new k);return e};k.prototype={getThemeClass:function(){return this._themeClass},setThemeClass:function(f,e){var q=this,d=q._themeClass;q._themeClass=f;this._load(f,e,function(){q.onThemeChanged({type:"ThemeChanged",oldValue:d,newValue:q.getThemeClass()})})},onThemeChanged:function(f){return this.dispatchEvent(f)},
buildStyleSheet:function(f,e){var q=function(a){return a.replace(this._capitalRegEx,function(a){return"-"+a}.bind(this)).toLowerCase()}.bind(this),d=function(a,c,b,n,h){var e=[];Object.keys(a).forEach(function(f){var g=a[f];"string"===typeof g?e.push("\t"+q(f)+": "+g+";"):d(g,b===f?c:c+(n?" .":".")+f,b,!1,h)});e.length&&(h.push(c+(n?".textview":"")+" {"),h.push.apply(h,e),h.push("}"))},b=[""];d(e.styles,"."+f,e.className,!0,b);return b.join("\n")},_createStyle:function(f,e,q,d){var b=this._document;
f="orion-theme-"+f;var a=b.getElementById(f);if(a){if(d||a.firstChild.data===e)return;a.removeChild(a.firstChild);a.appendChild(b.createTextNode(e))}else d?(a=r.createElement(b,"link"),a.rel="stylesheet",a.type="text/css",a.href=e,a.addEventListener("load",function(){q()})):(a=r.createElement(b,"style"),a.appendChild(b.createTextNode(e))),a.id=f,(b.getElementsByTagName("head")[0]||b.documentElement).appendChild(a);d||q()},_load:function(f,e,q){if(f)if("string"===typeof e)this._createStyle(f,e,q);
else if(e=e.href,".css"!==e.substring(e.length-4)&&(e+=".css"),/^\//.test(e)||/[a-zA-Z0-9]+:\/\//i.test(e)||!p.toUrl)this._createStyle(f,e,q,!0);else{var d=this;p(["text!"+e],function(b){d._createStyle(f,b,q,!1)})}else q()},_capitalRegEx:/[A-Z]/g};t.EventTarget.addMixin(k.prototype);return{TextTheme:k}});
define("orion/editor/util",[],function(){return{contains:function(p,t){if(!t)return!1;if(!p.compareDocumentPosition){for(var r=t;r;){if(p===r)return!0;r=r.parentNode}return!1}return p===t||0!==(p.compareDocumentPosition(t)&16)},getNodeStyle:function(p,t,r){var k;if(p&&(k=p.style[t],!k))if(p.currentStyle){for(k=0;-1!==(k=t.indexOf("-",k));)t=t.substring(0,k)+t.substring(k+1,k+2).toUpperCase()+t.substring(k+2);k=p.currentStyle[t]}else k=(p=p.ownerDocument.defaultView.getComputedStyle(p,null))?p.getPropertyValue(t):
null;return k||r},addEventListener:function(p,t,r,k){"function"===typeof p.addEventListener?p.addEventListener(t,r,!0===k):p.attachEvent("on"+t,r)},removeEventListener:function(p,t,r,k){"function"===typeof p.removeEventListener?p.removeEventListener(t,r,!0===k):p.detachEvent("on"+t,r)},Animation:function(){function p(p){this.options=p}p.prototype.play=function(){var p="number"===typeof this.options.duration?this.options.duration:350,r=this.options.easing||this.defaultEasing,k=this.options.onAnimate||
function(){},f=this.options.curve[0],g=this.options.curve[1],e=g-f,q=-1,d,b=this;this.interval=this.options.window.setInterval(function(){q=-1===q?(new Date).getTime():q;var a=((new Date).getTime()-q)/p;1>a?(a=r(a),d=f+a*e,k(d)):(k(g),b.stop())},"number"===typeof this.options.rate?this.options.rate:20)};p.prototype.stop=function(){this.options.window.clearInterval(this.interval);(this.options.onEnd||function(){})()};p.prototype.defaultEasing=function(p){return Math.sin(p*(Math.PI/2))};return p}()}});
define("orion/editor/textView","i18n!orion/editor/nls/messages orion/editor/textModel orion/editor/keyModes orion/editor/eventTarget orion/editor/textTheme orion/editor/util orion/util".split(" "),function(p,t,r,k,f,g,e){function q(l,u,a){if(a){u.className="";a=u.attributes;for(var c=a.length;0<c--;)(!e.isIE||9<=e.isIE||9>e.isIE&&a[c].specified)&&u.removeAttribute(a[c].name)}if(l){l.styleClass&&(u.className=l.styleClass);if(a=l.style)for(var h in a)a.hasOwnProperty(h)&&(u.style[h]=a[h]);if(l=l.attributes)for(var b in l)l.hasOwnProperty(b)&&
u.setAttribute(b,l[b])}}function d(l){return l instanceof Array?l.slice(0):l}function b(l,u){if(!l)return u;if(!u)return l;for(var a in u)u.hasOwnProperty(a)&&(l.hasOwnProperty(a)||(l[a]=u[a]));return l}function a(l,u){if(l===u)return!0;if(l&&!u||!l&&u||l&&l.constructor===String||u&&u.constructor===String)return!1;if(l instanceof Array||u instanceof Array){if(!(l instanceof Array&&u instanceof Array)||l.length!==u.length)return!1;for(var c=0;c<l.length;c++)if(!a(l[c],u[c]))return!1;return!0}if(!(l instanceof
Object)||!(u instanceof Object))return!1;for(c in l)if(l.hasOwnProperty(c)&&(!u.hasOwnProperty(c)||!a(l[c],u[c])))return!1;for(c in u)if(!l.hasOwnProperty(c))return!1;return!0}function c(l,u,a){for(var c=0,h=0,b=0,n=l.length;b<n;){-1!==c&&c<=b&&(c=l.indexOf("\r",b));-1!==h&&h<=b&&(h=l.indexOf("\n",b));var m=b,e;if(-1===h&&-1===c){u(l.substring(b));break}-1!==c&&-1!==h?c+1===h?(e=c,b=h+1):(e=c<h?c:h,b=(c<h?c:h)+1):-1!==c?(e=c,b=c+1):(e=h,b=h+1);u(l.substring(m,e));a()}}function m(l){var u,a,c,h,b=
l.ownerDocument.defaultView||l.ownerDocument.parentWindow;b.getComputedStyle?(l=b.getComputedStyle(l,null),u=l.getPropertyValue("padding-left"),a=l.getPropertyValue("padding-top"),c=l.getPropertyValue("padding-right"),h=l.getPropertyValue("padding-bottom")):l.currentStyle&&(u=l.currentStyle.paddingLeft,a=l.currentStyle.paddingTop,c=l.currentStyle.paddingRight,h=l.currentStyle.paddingBottom);return{left:parseInt(u,10)||0,top:parseInt(a,10)||0,right:parseInt(c,10)||0,bottom:parseInt(h,10)||0}}function n(l){var u,
a,c,h,b=l._trim;if(!b){var b=m(l),n=l.ownerDocument.defaultView||l.ownerDocument.parentWindow;n.getComputedStyle?(h=n.getComputedStyle(l,null),u=h.getPropertyValue("border-left-width"),a=h.getPropertyValue("border-top-width"),c=h.getPropertyValue("border-right-width"),h=h.getPropertyValue("border-bottom-width")):l.currentStyle&&(u=l.currentStyle.borderLeftWidth,a=l.currentStyle.borderTopWidth,c=l.currentStyle.borderRightWidth,h=l.currentStyle.borderBottomWidth);u=parseInt(u,10)||0;a=parseInt(a,10)||
0;c=parseInt(c,10)||0;h=parseInt(h,10)||0;b.left+=u;b.top+=a;b.right+=c;b.bottom+=h;l._trim=b}return b}function h(l,u,a,c){function h(u){if(u.animationName===n){var a=u.target;"function"===typeof a.__DOMReady&&(l.defaultView||l.parentWindow).setTimeout(function(){a.__DOMReady()},0)}}function b(l,u){for(var a=["","-webkit-","-moz-","-ms-","-o-"],c="",h="body ."+l+" {\n",n=0;n<a.length;n++)c+="@"+a[n]+"keyframes "+u+" {\nfrom { opacity: 0.99; }\nto { opacity: 1; }\n}\n",h+=a[n]+"animation-duration: 0.001s;\n"+
a[n]+"animation-name: "+u+";\n";return c+(h+"}")}a="_"+a+"DOMReady";u.className=u.className?u.className+" "+a:a;u.__DOMReady=c;c=a+"Style";if(!l.getElementById(c)){var n=a+"Animation";y(l,"animationstart",h,!1);y(l,"MSAnimationStart",h,!1);y(l,"webkitAnimationStart",h,!1);u=l.createElement("style");u.id=c;c=l.getElementsByTagName("head")[0]||l.documentElement;u.appendChild(l.createTextNode(b(a,n)));c.insertBefore(u,c.firstChild)}}function s(l,u,a){this.start=l;this.end=u;this.caret=a}function v(l){this.left=
l.left;this.top=l.top;this.right=l.right;this.bottom=l.bottom}function x(l,u,a){this.view=l;this.lineIndex=u;this._lineDiv=a}function w(l){this._init(l||{})}var y=g.addEventListener,z=g.removeEventListener,C=g.Animation;s.prototype={clone:function(){return new s(this.start,this.end,this.caret)},collapse:function(){this.caret?this.end=this.start:this.start=this.end},extend:function(l){this.caret?this.start=l:this.end=l;this.start>this.end&&(l=this.start,this.start=this.end,this.end=l,this.caret=!this.caret)},
setCaret:function(l){this.end=this.start=l;this.caret=!1},getCaret:function(){return this.caret?this.start:this.end},toString:function(){return"start\x3d"+this.start+" end\x3d"+this.end+(this.caret?" caret is at start":" caret is at end")},isEmpty:function(){return this.start===this.end},equals:function(l){return this.caret===l.caret&&this.start===l.start&&this.end===l.end}};v.prototype={toString:function(){return"{l\x3d"+this.left+", t\x3d"+this.top+", r\x3d"+this.right+", b\x3d"+this.bottom+"}"}};
x.prototype={create:function(l,u){if(!this._lineDiv){var a=this._lineDiv=this._createLine(l,u,this.lineIndex);a._line=this;return a}},_createLine:function(l,u,c){var h=this.view,b=h._model,n=b.getLine(c),m=b.getLineStart(c),d={type:"LineStyle",textView:h,lineIndex:c,lineText:n,lineStart:m};h.onLineStyle(d);var s=l.ownerDocument,b=u||e.createElement(s,"div");if(!u||!a(u.viewStyle,d.style))q(d.style,b,u),u&&(u._trim=null),b.viewStyle=d.style,b.setAttribute("role","presentation");b.lineIndex=c;if(u&&
b.viewLineText===n&&a(d.ranges,b.viewRanges))return b;b.viewRanges=d.ranges;b.viewLineText=n;c=[];this._createRanges(d.ranges,n,0,n.length,m,{tabOffset:0,ranges:c});d=" ";!h._fullSelection&&9>e.isIE&&(d="\ufeff");h={text:d,style:h._metrics.largestFontStyle,ignoreChars:1};0===c.length||!c[c.length-1].style||"div"!==c[c.length-1].style.tagName?c.push(h):c.splice(c.length-1,0,h);var f,g,v,k=d=0;if(e.isFirefox&&2E3<n.length){u&&(b.innerHTML="",u.lineWidth=void 0);u=s.createDocumentFragment();for(n=0;n<
c.length;n++)h=c[n],m=h.text,f=h.style,f=this._createSpan(b,m,f,h.ignoreChars),u.appendChild(f);b.appendChild(u)}else{var x,w;if(u){if(g=u.modelChangedEvent)0===g.removedLineCount&&0===g.addedLineCount?(w=g.start-m,x=g.addedCharCount-g.removedCharCount):w=-1,u.modelChangedEvent=void 0;g=u.firstChild}for(n=0;n<c.length;n++){h=c[n];m=h.text;d+=m.length;f=h.style;if(g)if(v=g.firstChild.data,s=g.viewStyle,v===m&&a(f,s)){k+=v.length;g._rectsCache=void 0;f=g=g.nextSibling;continue}else for(;g;){if(-1!==
w){s=d;s>=w&&(s-=x);v=(v=g.firstChild.data)?v.length:0;if(k+v>s)break;k+=v}s=g.nextSibling;b.removeChild(g);g=s}f=this._createSpan(b,m,f,h.ignoreChars);g?b.insertBefore(f,g):b.appendChild(f);u&&(u.lineWidth=void 0)}if(u)for(x=f?f.nextSibling:null;x;)s=x.nextSibling,u.removeChild(x),x=s}b.parentNode||l.appendChild(b);return b},_createRanges:function(l,u,c,h,b,n){if(!(c>h)){if(l)for(var m=0;m<l.length;m++){var e=l[m];if(!(e.end<b+c)){var d=Math.max(b+c,e.start)-b;if(d>h)break;var s=Math.min(b+h,e.end)-
b;if(d<=s){d=Math.max(c,d);s=Math.min(h,s);c<d&&this._createRange(u,c,d,null,n);if(!e.style||!e.style.unmergeable)for(;m+1<l.length&&l[m+1].start-b===s&&a(e.style,l[m+1].style);)e=l[m+1],s=Math.min(b+h,e.end)-b,m++;this._createRange(u,d,s,e.style,n);c=s}}}c<h&&this._createRange(u,c,h,null,n)}},_createRange:function(l,u,a,c,h){if(!(u>a)){var b=this.view._customTabSize;if(b&&8!==b)for(var n=l.indexOf("\t",u);-1!==n&&n<a;){u<n&&(u={text:l.substring(u,n),style:c},h.ranges.push(u),h.tabOffset+=u.text.length);
u=b-h.tabOffset%b;if(0<u){for(var m="\u00a0",e=1;e<u;e++)m+=" ";u={text:m,style:c,ignoreChars:u-1};h.ranges.push(u);h.tabOffset+=u.text.length}u=n+1;if(u===a)return;n=l.indexOf("\t",u)}u<=a&&(u={text:l.substring(u,a),style:c},h.ranges.push(u),h.tabOffset+=u.text.length)}},_createSpan:function(l,u,a,c){var h=this.view,b="span";a&&a.tagName&&(b=a.tagName.toLowerCase());var n="a"===b;n&&(this.hasLink=!0);n&&!h._linksVisible&&(b="span");n=l.ownerDocument;l=e.createElement(l.ownerDocument,b);l.appendChild(n.createTextNode(a&&
a.text?a.text:u));a&&a.html?(l.innerHTML=a.html,l.ignore=!0):a&&a.node&&(l.appendChild(a.node),l.ignore=!0);q(a,l);if("a"===b){var m=h._getWindow();y(l,"click",function(l){return h._handleLinkClick(l?l:m.event)},!1)}l.viewStyle=a;c&&(l.ignoreChars=c);return l},_ensureCreated:function(){return this._lineDiv?this._lineDiv:this._createdDiv=this.create(this.view._clientDiv,null)},getBoundingClientRect:function(l,a){var c=this._ensureCreated(),h=this.view;if(void 0===l)return this._getLineBoundingClientRect(c,
!0);var b=h._model,n=c.ownerDocument,m=this.lineIndex,d=null;if(l<b.getLineEnd(m)){var s=b.getLineStart(m);this.forEach(function(a){var u=a.firstChild,b=this._nodeLength(a);if(s+b>l){var m=l-s;if(1===u.length)d=new v(a.getBoundingClientRect());else if(h._isRangeRects)b=n.createRange(),b.setStart(u,m),b.setEnd(u,m+1),d=new v(b.getBoundingClientRect());else if(e.isIE)b=n.body.createTextRange(),b.moveToElementText(a),b.collapse(),(u=0===m&&8===e.isIE)&&(m=1),b.moveEnd("character",m+1),b.moveStart("character",
m),d=new v(b.getBoundingClientRect()),u&&(d.left=a.getClientRects()[0].left);else{var f=u.data;a.removeChild(u);a.appendChild(n.createTextNode(f.substring(0,m)));var g=e.createElement(n,"span");g.appendChild(n.createTextNode(f.substring(m,m+1)));a.appendChild(g);a.appendChild(n.createTextNode(f.substring(m+1)));d=new v(g.getBoundingClientRect());a.innerHTML="";a.appendChild(u);this._createdDiv||(a=h._getSelection(),(s<=a.start&&a.start<s+b||s<=a.end&&a.end<s+b)&&h._updateDOMSelection())}e.isIE&&(m=
c.ownerDocument.defaultView||c.ownerDocument.parentWindow,a=m.screen.logicalXDPI/m.screen.deviceXDPI,m=m.screen.logicalYDPI/m.screen.deviceYDPI,d.left*=a,d.right*=a,d.top*=m,d.bottom*=m);return!1}s+=b;return!0})}b=this.getBoundingClientRect();d||(h._wrapMode?(m=this.getClientRects(),d=m[m.length-1],d.left=d.right,d.left+=b.left,d.top+=b.top,d.right+=b.left,d.bottom+=b.top):(d=new v(b),d.left=d.right));if(a||void 0===a)d.left-=b.left,d.top-=b.top,d.right-=b.left,d.bottom-=b.top;return d},forEach:function(l){for(var a=
this._ensureCreated().firstChild;a;){var c=a.nextSibling;if(!a.ignore&&!l.call(this,a))break;a=c}},_getClientRects:function(l,a){var c,h,b,n;if(!l._rectsCache){c=l.getClientRects();h=Array(c.length);for(n=0;n<c.length;n++)b=h[n]=new v(c[n]),b.left-=a.left,b.top-=a.top,b.right-=a.left,b.bottom-=a.top;l._rectsCache=h}c=l._rectsCache;h=[c.length];for(n=0;n<c.length;n++)h[n]=new v(c[n]);return h},getClientRects:function(l){if(!this.view._wrapMode)return[this.getBoundingClientRect()];var a=[],c=this._ensureCreated().getBoundingClientRect();
this.forEach(function(l){l=this._getClientRects(l,c);for(var h=0;h<l.length;h++){var b=l[h],n,m;if(b.top!==b.bottom){var d=b.top+(b.bottom-b.top)/2;for(n=0;n<a.length&&!(m=a[n],m.top<=d&&d<m.bottom);n++);n===a.length?a.push(b):(b.left<m.left&&(m.left=b.left),b.top<m.top&&(m.top=b.top),b.right>m.right&&(m.right=b.right),b.bottom>m.bottom&&(m.bottom=b.bottom))}}return!0});return void 0!==l?a[l]:a},_getLineBoundingClientRect:function(l,a){var c=new v(l.getBoundingClientRect());if(!this.view._wrapMode){c.right=
c.left;for(var b=l.lastChild;b&&b.ignoreChars===b.firstChild.length;)b=b.previousSibling;b&&(b=b.getBoundingClientRect(),c.right=b.right+n(l).right)}a&&(b=n(l),c.left+=b.left,c.right-=b.right);return c},getLineCount:function(){return!this.view._wrapMode?1:this.getClientRects().length},getLineIndex:function(l){if(!this.view._wrapMode)return 0;var a=this.getClientRects();l=this.getBoundingClientRect(l);l=l.top+(l.bottom-l.top)/2;for(var c=0;c<a.length;c++)if(a[c].top<=l&&l<a[c].bottom)return c;return a.length-
1},getLineStart:function(l){if(!this.view._wrapMode||0===l)return this.view._model.getLineStart(this.lineIndex);var a=this.getClientRects();return this.getOffset(a[l].left+1,a[l].top+1)},_nodeLength:function(l){if(!l||l.ignore)return 0;var a=l.firstChild.length;l.ignoreChars&&(a-=l.ignoreChars);return a},getModelOffset:function(l,a){if(!l)return 0;var c=0;this.forEach(function(b){var h=b.firstChild;if(h===l)return b.ignoreChars&&(c-=b.ignoreChars),c+=a,!1;b.ignoreChars&&(c-=b.ignoreChars);c+=h.data.length;
return!0});return Math.max(0,c)+this.view._model.getLineStart(this.lineIndex)},getNodeOffset:function(l){var a=0,c,b,h=this.view._model,n=h.getLineStart(this.lineIndex),m=l-n,d=h.getLineEnd(this.lineIndex)-n;this.forEach(function(l){var h=l.firstChild,n=this._nodeLength(l);if(n+a>m||a+n>=d)return c=h,b=m-a,l.ignoreChars&&(0<n&&b===n)&&(b+=l.ignoreChars),!1;a+=n;return!0});return{node:c,offset:b}},getText:function(l){var a="",c=0;this.forEach(function(b){var h;if(b.ignoreChars){h=b.lastChild;for(var n=
0,m=[],d=-1;h;){var e=h.data;if(e)for(var s=e.length-1;0<=s;s--){var f=e.substring(s,s+1);n<b.ignoreChars&&(" "===f||"\ufeff"===f)?n++:m.push("\u00a0"===f?"\t":f)}l===h&&(d=m.length);h=h.previousSibling}m=m.reverse().join("");-1!==d&&(c=a.length+m.length-d);a+=m}else for(h=b.firstChild;h;)l===h&&(c=a.length),a+=h.data,h=h.nextSibling;return!0});return{text:a,offset:c}},getOffset:function(l,a){function c(b,s,B){var q=b.firstChild,k=v._nodeLength(b),x=f.ownerDocument,A=x.defaultView||x.parentWindow,
w=e.isIE?A.screen.logicalXDPI/A.screen.deviceXDPI:1,p=e.isIE?A.screen.logicalYDPI/A.screen.deviceYDPI:1,y,r,z,A=B.left+g.left,t,C;if(e.isIE||h._isRangeRects){for(var x=h._isRangeRects?x.createRange():x.body.createTextRange(),O=k,G=-1;1<O-G;){var L=Math.floor((O+G)/2);B=G+1;y=L===k-1&&b.ignoreChars?q.length:L+1;t=0===B&&8===e.isIE;h._isRangeRects?(x.setStart(q,B),x.setEnd(q,y)):(t&&(B=1),x.moveToElementText(b),x.move("character",B),x.moveEnd("character",y-B));C=x.getClientRects();for(var R=!1,N=0;N<
C.length;N++)if(B=C[N],y=(t?A:B.left)*w-g.left,z=B.right*w-g.left,r=B.top*p-g.top,B=B.bottom*p-g.top,y<=l&&l<z&&(!h._wrapMode||r<=a&&a<B)){R=!0;break}R?O=L:G=L}s+=O;B=O;y=O===k-1&&b.ignoreChars?q.length:Math.min(O+1,q.length);h._isRangeRects?(x.setStart(q,B),x.setEnd(q,y)):(x.moveToElementText(b),x.move("character",B),x.moveEnd("character",y-B));C=x.getClientRects();k=!1;0<C.length&&(B=C[0],y=(t?A:B.left)*w-g.left,z=B.right*w-g.left,k=l>y+(z-y)/2);b=s-d;q=n.getLine(m);w=q.charCodeAt(b);55296<=w&&
56319>=w&&k?b<q.length&&(w=q.charCodeAt(b+1),56320<=w&&57343>=w&&(s+=1)):56320<=w&&(57343>=w&&!k)&&0<b&&(w=q.charCodeAt(b-1),55296<=w&&56319>=w&&(s-=1));k&&s++}else{w=[];for(t=0;t<k;t++)w.push("\x3cspan\x3e"),t===k-1?w.push(q.data.substring(t)):w.push(q.data.substring(t,t+1)),w.push("\x3c/span\x3e");b.innerHTML=w.join("");for(w=b.firstChild;w;){B=w.getBoundingClientRect();y=B.left-g.left;z=B.right-g.left;if(y<=l&&l<z){l>y+(z-y)/2&&s++;break}s++;w=w.nextSibling}v._createdDiv||(b.innerHTML="",b.appendChild(q),
b=h._getSelection(),(s<=b.start&&b.start<s+k||s<=b.end&&b.end<s+k)&&h._updateDOMSelection())}return s}function b(c){if(c.ignore)return null;c=v._getClientRects(c,g);for(var n=0;n<c.length;n++){var m=c[n];if(m.left<=l&&l<m.right&&(!h._wrapMode||m.top<=a&&a<m.bottom))return m}return null}var h=this.view,n=h._model,m=this.lineIndex,d=n.getLineStart(m),s=n.getLineEnd(m);if(d===s)return d;var f=this._ensureCreated(),g=this.getBoundingClientRect(),v=this,q,k;if(h._wrapMode){q=this.getClientRects();a<q[0].top&&
(a=q[0].top);for(var x=0;x<q.length&&!(k=q[x],k.top<=a&&a<k.bottom);x++);l<k.left&&(l=k.left);l>k.right&&(l=k.right-1)}else 0>l&&(l=0),l>g.right-g.left&&(l=g.right-g.left);var w,p;if(this._lastHitChild&&this._lastHitChild.parentNode){if(w=this._lastHitOffset,p=this._lastHitChild,k=b(p),!k){q=w;for(var x=w+this._nodeLength(p),y=p.previousSibling,r=p.nextSibling;y||r;){if(y){q-=this._nodeLength(y);if(k=b(y)){p=y;w=q;break}y=y.previousSibling}if(r){if(k=b(r)){p=r;w=x;break}x+=this._nodeLength(r);r=r.nextSibling}}}}else w=
d,this.forEach(function(l){p=l;if(k=b(p))return!1;w+=this._nodeLength(p);return!0});p&&k&&(this._lastHitChild=p,this._lastHitOffset=w,w=c(p,w,k));return Math.min(s,Math.max(d,w))},getNextOffset:function(l,a){if("line"===a.unit){var c=this.view._model,b=c.getLineAtOffset(l);if(0<a.count)return a.count--,c.getLineEnd(b);a.count++;return c.getLineStart(b)}return"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit?this._getNextOffset_W3C(l,a):e.isIE?this._getNextOffset_IE(l,a):this._getNextOffset_W3C(l,
a)},_getNextOffset_W3C:function(l,a){function c(l){return 33<=l&&47>=l||58<=l&&64>=l||91<=l&&94>=l||96===l||123<=l&&126>=l}function b(l){return 32===l||9===l}var h=this.view._model,n=h.getLineAtOffset(l),m=h.getLine(n),d=h.getLineStart(n),h=h.getLineEnd(n),n=m.length,e=l-d,s,f=0>a.count?-1:1;if("word"===a.unit||"wordend"===a.unit||"wordWS"===a.unit||"wordendWS"===a.unit)for(var g,v,q;0!==a.count;){if(0<a.count){if(e===n)return h;s=m.charCodeAt(e);g=c(s);v=!g&&!b(s);for(e++;e<n;){s=m.charCodeAt(e);
if("wordWS"!==a.unit&&"wordendWS"!==a.unit){q=c(s);if("wordend"===a.unit){if(!q&&g)break}else if(q&&!g)break;s=!q&&!b(s)}else s=!b(s);if("wordend"===a.unit||"wordendWS"===a.unit){if(!s&&v)break}else if(s&&!v)break;v=s;g=q;e++}}else{if(0===e)return d;e--;s=m.charCodeAt(e);g=c(s);for(v=!g&&!b(s);0<e;){s=m.charCodeAt(e-1);if("wordWS"!==a.unit&&"wordendWS"!==a.unit){q=c(s);if("wordend"===a.unit){if(q&&!g)break}else if(!q&&g)break;s=!q&&!b(s)}else s=!b(s);if("wordend"===a.unit||"wordendWS"===a.unit){if(s&&
!v)break}else if(!s&&v)break;v=s;g=q;e--}}a.count-=f}else for(;0!==a.count&&0<=e+f&&e+f<=n;)e+=f,s=m.charCodeAt(e),56320<=s&&57343>=s&&0<e&&(s=m.charCodeAt(e-1),55296<=s&&56319>=s&&(e+=f)),a.count-=f;return d+e},_getNextOffset_IE:function(l,a){var c=this._ensureCreated(),b=this.view._model,h=this.lineIndex,n=0,m;m=b.getLineStart(h);var d=b.getLine(h),e=b.getLineStart(h),s=c.ownerDocument,f=0>a.count?-1:1;if(l===b.getLineEnd(h)){for(c=c.lastChild;c&&c.ignoreChars===c.firstChild.length;)c=c.previousSibling;
if(!c)return m;n=s.body.createTextRange();n.moveToElementText(c);m=n.text.length;n.moveEnd(a.unit,f);n=l+n.text.length-m}else if(l===m&&0>a.count)n=m;else for(c=c.firstChild;c;){b=this._nodeLength(c);if(m+b>l){n=s.body.createTextRange();if(l===m&&0>a.count){for(m=c.previousSibling;m&&(!m.firstChild||!m.firstChild.length);)m=m.previousSibling;n.moveToElementText(m?m:c.previousSibling)}else n.moveToElementText(c),n.collapse(),n.moveEnd("character",l-m);m=n.text.length;n.moveEnd(a.unit,f);n=l+n.text.length-
m;break}m=b+m;c=c.nextSibling}m=n-e;n=d.charCodeAt(m);56320<=n&&57343>=n&&0<m&&(n=d.charCodeAt(m-1),55296<=n&&56319>=n&&(m+=f));a.count-=f;return m+e},updateLinks:function(){var l=this._ensureCreated();if(this.hasLink){var a=this;this.forEach(function(c){var b=c.viewStyle;b&&(b.tagName&&"a"===b.tagName.toLowerCase())&&l.replaceChild(a._createSpan(l,c.firstChild.data,b),c);return!0})}},destroy:function(){var l=this._createdDiv;l&&(l.parentNode.removeChild(l),this._createdDiv=null)}};w.prototype={addKeyMode:function(l,
a){var c=this._keyModes;void 0!==a?c.splice(a,0,l):c.push(l);l._modeAdded&&l._modeAdded()},addRuler:function(l,a){var c=this._rulers;if(void 0!==a){var b,h;for(h=b=0;b<c.length&&h<a;b++)l.getLocation()===c[b].getLocation()&&h++;c.splice(h,0,l);a=h}else c.push(l);this._createRuler(l,a);l.setView(this);this._update()},computeSize:function(){var l=0,a=0,c=this._model,b=this._clientDiv;if(!b)return{width:l,height:a};var h=b.style.width;e.isWebkit&&(b.style.width="0x7fffffffpx");for(var c=c.getLineCount(),
n=0;n<c;n++){var m=this._getLine(n),d=m.getBoundingClientRect(),l=Math.max(l,d.right-d.left),a=a+(d.bottom-d.top);m.destroy()}e.isWebkit&&(b.style.width=h);b=this._getViewPadding();l+=b.right+b.left+this._metrics.scrollWidth;a+=b.bottom+b.top+this._metrics.scrollWidth;return{width:l,height:a}},convert:function(l,a,c){if(!this._clientDiv)return l;var b=this._getScroll(),h=this._getViewPadding(),n=this._viewDiv.getBoundingClientRect();"document"===a&&(void 0!==l.x&&(l.x+=-b.x+n.left+h.left),void 0!==
l.y&&(l.y+=-b.y+n.top+h.top));"document"===c&&(void 0!==l.x&&(l.x+=b.x-n.left-h.left),void 0!==l.y&&(l.y+=b.y-n.top-h.top));return l},destroy:function(){for(var l=0;l<this._rulers.length;l++)this._rulers[l].setView(null);this.rulers=null;this._destroyView();this.onDestroy({type:"Destroy"});this._parent=null;this._model&&this._model.destroy&&this._model.destroy();this._actions=this._keyModes=this._doubleClickSelection=this._selection=this._theme=this._model=null},focus:function(){this._clientDiv&&
(this._updateDOMSelection(),this._clientDiv.focus(),this._updateDOMSelection())},hasFocus:function(){return this._hasFocus},getActionDescription:function(l){if(l=this._actions[l])return l.actionDescription},getActions:function(l){var a=[],c=this._actions,b;for(b in c)c.hasOwnProperty(b)&&(l||!c[b].defaultHandler)&&a.push(b);return a},getBottomIndex:function(l){return!this._clientDiv?0:this._getBottomIndex(l)},getBottomPixel:function(){return!this._clientDiv?0:this._getScroll().y+this._getClientHeight()},
getCaretOffset:function(){return this._getSelection().getCaret()},getClientArea:function(){if(!this._clientDiv)return{x:0,y:0,width:0,height:0};var l=this._getScroll();return{x:l.x,y:l.y,width:this._getClientWidth(),height:this._getClientHeight()}},getHorizontalPixel:function(){return!this._clientDiv?0:this._getScroll().x},getKeyBindings:function(l){for(var a=[],c=this._keyModes,b=0;b<c.length;b++)a=a.concat(c[b].getKeyBindings(l));return a},getKeyModes:function(){return this._keyModes.slice(0)},
getLineHeight:function(l){return!this._clientDiv?0:this._getLineHeight(l)},getLineIndex:function(l){return!this._clientDiv?0:this._getLineIndex(l)},getLinePixel:function(l){return!this._clientDiv?0:this._getLinePixel(l)},getLocationAtOffset:function(l){if(!this._clientDiv)return{x:0,y:0};var a=this._model;l=Math.min(Math.max(0,l),a.getCharCount());var a=a.getLineAtOffset(l),c=this._getLine(a);l=c.getBoundingClientRect(l);c.destroy();c=l.left;a=this._getLinePixel(a)+l.top;return{x:c,y:a}},getNextOffset:function(l,
a){var c=new s(l,l,!1);this._doMove(a,c);return c.getCaret()},getOptions:function(){var l;if(0===arguments.length)l=this._defaultOptions();else if(1===arguments.length){if(l=arguments[0],"string"===typeof l)return d(this["_"+l])}else{l={};for(var a in arguments)arguments.hasOwnProperty(a)&&(l[arguments[a]]=void 0)}for(var c in l)l.hasOwnProperty(c)&&(l[c]=d(this["_"+c]));return l},getModel:function(){return this._model},getOffsetAtLocation:function(l,a){if(!this._clientDiv)return 0;var c=this._getLineIndex(a),
b=this._getLine(c),c=b.getOffset(l,a-this._getLinePixel(c));b.destroy();return c},getLineAtOffset:function(l){return this.getModel().getLineAtOffset(l)},getLineStart:function(l){this.getModel().getLineStart(l)},getRulers:function(){return this._rulers.slice(0)},getSelection:function(){var l=this._getSelection();return{start:l.start,end:l.end}},getText:function(l,a){return this._model.getText(l,a)},getTopIndex:function(l){return!this._clientDiv?0:this._getTopIndex(l)},getTopPixel:function(){return!this._clientDiv?
0:this._getScroll().y},invokeAction:function(l,a,c){if(this._clientDiv){if(l=this._actions[l]){if(!a&&l.handler&&l.handler(c))return!0;if(l.defaultHandler)return"boolean"===typeof l.defaultHandler(c)}return!1}},isDestroyed:function(){return!this._clientDiv},onContextMenu:function(l){return this.dispatchEvent(l)},onDragStart:function(l){return this.dispatchEvent(l)},onDrag:function(l){return this.dispatchEvent(l)},onDragEnd:function(l){return this.dispatchEvent(l)},onDragEnter:function(l){return this.dispatchEvent(l)},
onDragOver:function(l){return this.dispatchEvent(l)},onDragLeave:function(l){return this.dispatchEvent(l)},onDrop:function(l){return this.dispatchEvent(l)},onDestroy:function(l){return this.dispatchEvent(l)},onLineStyle:function(l){return this.dispatchEvent(l)},onKeyDown:function(l){return this.dispatchEvent(l)},onKeyPress:function(l){return this.dispatchEvent(l)},onKeyUp:function(l){return this.dispatchEvent(l)},onModelChanged:function(l){return this.dispatchEvent(l)},onModelChanging:function(l){return this.dispatchEvent(l)},
onModify:function(l){return this.dispatchEvent(l)},onMouseDown:function(l){return this.dispatchEvent(l)},onMouseUp:function(l){return this.dispatchEvent(l)},onMouseMove:function(l){return this.dispatchEvent(l)},onMouseOver:function(l){return this.dispatchEvent(l)},onMouseOut:function(l){return this.dispatchEvent(l)},onTouchStart:function(l){return this.dispatchEvent(l)},onTouchMove:function(l){return this.dispatchEvent(l)},onTouchEnd:function(l){return this.dispatchEvent(l)},onOptions:function(l){return this.dispatchEvent(l)},
onSelection:function(l){return this.dispatchEvent(l)},onScroll:function(l){return this.dispatchEvent(l)},onVerify:function(l){return this.dispatchEvent(l)},onFocus:function(l){return this.dispatchEvent(l)},onBlur:function(l){return this.dispatchEvent(l)},redraw:function(){if(!(0<this._redrawCount)){var l=this._model.getLineCount();this.redrawRulers(0,l);this.redrawLines(0,l)}},redrawRulers:function(l,a){if(!(0<this._redrawCount))for(var c=this.getRulers(),b=0;b<c.length;b++)this.redrawLines(l,a,c[b])},
redrawLines:function(l,a,c){if(!(0<this._redrawCount)&&(void 0===l&&(l=0),void 0===a&&(a=this._model.getLineCount()),l!==a)){var b=this._clientDiv;if(b){if(c)for(b=this._getRulerParent(c).firstChild;b&&b._ruler!==c;)b=b.nextSibling;c?b.rulerChanged=!0:this._lineHeight&&this._resetLineHeight(l,a);if(!c||"page"===c.getOverview())for(b=b.firstChild;b;){var h=b.lineIndex;l<=h&&h<a&&(b.lineChanged=!0);b=b.nextSibling}!c&&(!this._wrapMode&&l<=this._maxLineIndex&&this._maxLineIndex<a)&&(this._checkMaxLineIndex=
this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this.dispatchEvent({type:"Redraw",startLine:l,endLine:a,ruler:c});this._queueUpdate()}}},redrawRange:function(l,a){if(!(0<this._redrawCount)){var c=this._model;void 0===l&&(l=0);void 0===a&&(a=c.getCharCount());var b=c.getLineAtOffset(l),c=c.getLineAtOffset(Math.max(l,a-1))+1;this.redrawLines(b,c)}},removeKeyMode:function(l){for(var a=this._keyModes,c=0;c<a.length;c++)if(a[c]===l){a.splice(c,1);break}l._modeRemoved&&l._modeRemoved()},
removeRuler:function(l){for(var a=this._rulers,c=0;c<a.length;c++)if(a[c]===l){a.splice(c,1);l.setView(null);this._destroyRuler(l);this._update();break}},resize:function(){this._clientDiv&&this._handleResize(null)},setAction:function(l,a,c){if(l){var b=this._actions,h=b[l];h||(h=b[l]={});h.handler=a;void 0!==c&&(h.actionDescription=c)}},setKeyBinding:function(l,a){this._keyModes[0].setKeyBinding(l,a)},setCaretOffset:function(l,a,c){var b=this._model.getCharCount();l=Math.max(0,Math.min(l,b));l=new s(l,
l,!1);this._setSelection(l,void 0===a||a,!0,c)},setHorizontalPixel:function(l){this._clientDiv&&(l=Math.max(0,l),this._scrollView(l-this._getScroll().x,0))},setRedraw:function(l){l?0===--this._redrawCount&&this.redraw():this._redrawCount++},setModel:function(l){if(l!==this._model){l=l||new t.TextModel;this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);var a=this._model.getLineCount(),c=this._model.getCharCount(),
b=l.getLineCount(),h=l.getCharCount(),n={type:"ModelChanging",text:l.getText(),start:0,removedCharCount:c,addedCharCount:h,removedLineCount:a,addedLineCount:b};this.onModelChanging(n);this._model=l;n={type:"ModelChanged",start:0,removedCharCount:c,addedCharCount:h,removedLineCount:a,addedLineCount:b};this.onModelChanged(n);this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._reset();this._update()}},
setOptions:function(l){var c=this._defaultOptions(),b;for(b in l)if(l.hasOwnProperty(b)){var h=l[b];if(!a(this["_"+b],h)){var n=c[b]?c[b].update:null;n?n.call(this,h):this["_"+b]=d(h)}}this.onOptions({type:"Options",options:l})},setSelection:function(l,a,c,b){var h=l>a;if(h){var n=l;l=a;a=n}n=this._model.getCharCount();l=Math.max(0,Math.min(l,n));a=Math.max(0,Math.min(a,n));l=new s(l,a,h);this._setSelection(l,void 0===c||c,!0,b)},setText:function(l,a,c){var b=void 0===a&&void 0===c;void 0===a&&(a=
0);void 0===c&&(c=this._model.getCharCount());b&&(this._variableLineHeight=!1);this._modifyContent({text:l,start:a,end:c,_code:!0},!b);b&&(this._columnX=-1,this._setSelection(new s(0,0,!1),!0),13>e.isFirefox&&this._fixCaret())},setTopIndex:function(l,a){this._clientDiv&&this._scrollViewAnimated(0,this._getLinePixel(Math.max(0,l))-this._getScroll().y,a)},setTopPixel:function(l,a){this._clientDiv&&this._scrollViewAnimated(0,Math.max(0,l)-this._getScroll().y,a)},showSelection:function(l,a){return this._showCaret(l?
!1:!0,a,l)},update:function(l,a){this._clientDiv&&((l||this._metrics.invalid)&&this._updateStyle(),void 0===a||a?this._update():this._queueUpdate())},_handleRootMouseDown:function(l){this._cancelCheckSelection();if(!this._ignoreEvent(l)){13>e.isFirefox&&1===l.which&&(this._clientDiv.contentEditable=!1,this._ignoreBlur=(this._overlayDiv||this._clientDiv).draggable=!0);var a=this._overlayDiv||this._clientDiv;9>e.isIE&&(a=this._viewDiv);for(var c=l.target?l.target:l.srcElement;c;){if(a===c||c.className&&
-1!==c.className.indexOf("textViewFind"))return;c=c.parentNode}l.preventDefault&&l.preventDefault();l.stopPropagation&&l.stopPropagation();if(!this._isW3CEvents){var b=this;this._getWindow().setTimeout(function(){b._clientDiv.focus()},0)}}},_handleRootMouseUp:function(l){this._ignoreEvent(l)||(13>e.isFirefox&&1===l.which&&(this._clientDiv.contentEditable=!0,(this._overlayDiv||this._clientDiv).draggable=!1),e.isFirefox&&1===l.which&&(this._fixCaret(),this._ignoreBlur=!1))},_handleBlur:function(){this._cancelCheckSelection();
if(!this._ignoreBlur){this._commitIME();this._hasFocus=!1;if(9>e.isIE&&!this._getSelection().isEmpty()){var l=this._rootDiv,a=e.createElement(l.ownerDocument,"div");l.appendChild(a);l.removeChild(a)}this._cursorDiv&&(this._cursorDiv.style.display="none");if(this._selDiv1)if(this._selDiv1.style.background="lightgray",this._selDiv2.style.background="lightgray",this._selDiv3.style.background="lightgray",l=this._getWindow(),a=this._selDiv1.ownerDocument,l.getSelection){a=l.getSelection();for(l=a.anchorNode;l;){if(l===
this._clientDiv){0<a.rangeCount&&a.removeAllRanges();break}l=l.parentNode}}else if(a.selection){this._ignoreSelect=!1;for(l=a.selection.createRange().parentElement();l;){if(l===this._clientDiv){a.selection.empty();break}l=l.parentNode}this._ignoreSelect=!0}if(!this._ignoreFocus)this.onBlur({type:"Blur"})}},_handleCompositionStart:function(l){this._ignoreEvent(l)||(this._startIME(),this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null))},_handleCompositionEnd:function(l){this._ignoreEvent(l)||
this._commitIME(l.data)},_handleContextMenu:function(l){if(!this._ignoreEvent(l)){e.isIE&&3===this._lastMouseButton&&this._updateDOMSelection();var a=!1;this.isListening("ContextMenu")?(a=this._createMouseEvent("ContextMenu",l),a.screenX=l.screenX,a.screenY=l.screenY,this.onContextMenu(a),a=a.defaultPrevented):e.isMac&&(e.isFirefox&&0===l.button)&&(a=!0);if(a)return l.preventDefault&&l.preventDefault(),!1;this._contextMenuOpen=!0;e.isFirefox&&(this._checkSelectionChange=!0,this._pollSelectionChange(!0))}},
_handleCopy:function(l){this._cancelCheckSelection();if(!this._ignoreEvent(l)&&!this._ignoreCopy&&this._doCopy(l))return l.preventDefault&&l.preventDefault(),!1},_handleCut:function(l){this._cancelCheckSelection();if(!this._ignoreEvent(l)&&this._doCut(l))return l.preventDefault&&l.preventDefault(),!1},_handleDataModified:function(l){this._ignoreEvent(l)||this._startIME()},_handleDblclick:function(l){this._ignoreEvent(l)||(this._lastMouseTime=l.timeStamp?l.timeStamp:(new Date).getTime(),2!==this._clickCount&&
(this._clickCount=2,this._handleMouse(l)))},_handleDragStart:function(l){if(!this._ignoreEvent(l)){if(13>e.isFirefox){var a=this;this._getWindow().setTimeout(function(){a._clientDiv.contentEditable=!0;a._clientDiv.draggable=!1;a._ignoreBlur=!1},0)}if(this.isListening("DragStart")&&-1!==this._dragOffset)this._isMouseDown=!1,this.onDragStart(this._createMouseEvent("DragStart",l)),this._dragOffset=-1;else return l.preventDefault&&l.preventDefault(),!1}},_handleDrag:function(l){if(!this._ignoreEvent(l)&&
this.isListening("Drag"))this.onDrag(this._createMouseEvent("Drag",l))},_handleDragEnd:function(l){if(!this._ignoreEvent(l)){this._dropTarget=!1;this._dragOffset=-1;if(this.isListening("DragEnd"))this.onDragEnd(this._createMouseEvent("DragEnd",l));13>e.isFirefox&&(this._fixCaret(),"none"===l.dataTransfer.dropEffect&&!l.dataTransfer.mozUserCancelled&&this._fixCaret())}},_handleDragEnter:function(l){if(!this._ignoreEvent(l)){var a=!0;this._dropTarget=!0;this.isListening("DragEnter")&&(a=!1,this.onDragEnter(this._createMouseEvent("DragEnter",
l)));if(e.isWebkit||a)return l.preventDefault&&l.preventDefault(),!1}},_handleDragOver:function(l){if(!this._ignoreEvent(l)){var a=!0;this.isListening("DragOver")&&(a=!1,this.onDragOver(this._createMouseEvent("DragOver",l)));if(e.isWebkit||a)return a&&(l.dataTransfer.dropEffect="none"),l.preventDefault&&l.preventDefault(),!1}},_handleDragLeave:function(l){if(!this._ignoreEvent(l)&&(this._dropTarget=!1,this.isListening("DragLeave")))this.onDragLeave(this._createMouseEvent("DragLeave",l))},_handleDrop:function(l){if(!this._ignoreEvent(l)){this._dropTarget=
!1;if(this.isListening("Drop"))this.onDrop(this._createMouseEvent("Drop",l));l.preventDefault&&l.preventDefault();return!1}},_handleFocus:function(){this._hasFocus=!0;e.isIOS&&void 0!==this._lastTouchOffset?(this.setCaretOffset(this._lastTouchOffset,!0),this._lastTouchOffset=void 0):this._updateDOMSelection();this._cursorDiv&&(this._cursorDiv.style.display="block");if(this._selDiv1){var l=this._highlightRGB;this._selDiv1.style.background=l;this._selDiv2.style.background=l;this._selDiv3.style.background=
l}if(!this._ignoreFocus)this.onFocus({type:"Focus"})},_handleKeyDown:function(l){this._cancelCheckSelection();if(!this._ignoreEvent(l)){if(this.isListening("KeyDown")){var a=this._createKeyEvent("KeyDown",l);this.onKeyDown(a);if(a.defaultPrevented){e.isFirefox&&(this._keyDownPrevented=!0);l.preventDefault();return}}a=!1;switch(l.keyCode){case 16:case 17:case 18:case 91:a=!0;break;default:this._setLinksVisible(!1)}if(229===l.keyCode){if(this._readonly)return l.preventDefault&&l.preventDefault(),!1;
a=!0;e.isSafari&&e.isMac&&l.ctrlKey&&(a=!1,l.keyCode=129);a&&this._startIME()}else a||this._commitIME();if((e.isMac||e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)return this._keyDownEvent=l,!0;if(this._doAction(l))return l.preventDefault?(l.preventDefault(),l.stopPropagation()):(l.cancelBubble=!0,l.returnValue=!1,l.keyCode=0),!1}},_handleKeyPress:function(l){if(!this._ignoreEvent(l))if(this._keyDownPrevented)l.preventDefault&&(l.preventDefault(),l.stopPropagation()),this._keyDownPrevented=void 0;else{if(e.isMac&&
e.isWebkit&&(63232<=l.keyCode&&63487>=l.keyCode||13===l.keyCode||8===l.keyCode)||((e.isMac||e.isLinux)&&4>e.isFirefox||12.16>e.isOpera)&&this._doAction(this._keyDownEvent))return l.preventDefault&&l.preventDefault(),!1;var a=e.isMac?l.metaKey:l.ctrlKey;if(void 0!==l.charCode&&a)switch(l.charCode){case 99:case 118:case 120:return!0}if(this.isListening("KeyPress")&&(a=this._createKeyEvent("KeyPress",l),this.onKeyPress(a),a.defaultPrevented)){l.preventDefault();return}if(this._doAction(l))return l.preventDefault?
(l.preventDefault(),l.stopPropagation()):(l.cancelBubble=!0,l.returnValue=!1,l.keyCode=0),!1;a=!1;if(e.isMac){if(l.ctrlKey||l.metaKey)a=!0}else if(e.isFirefox){if(l.ctrlKey||l.altKey)a=!0}else l.ctrlKey^l.altKey&&(a=!0);if(!a&&(a=e.isOpera?l.which:void 0!==l.charCode?l.charCode:l.keyCode,31<a))return this._doContent(String.fromCharCode(a)),l.preventDefault&&l.preventDefault(),!1}},_handleDocKeyUp:function(l){(e.isMac?l.metaKey:l.ctrlKey)||this._setLinksVisible(!1)},_handleKeyUp:function(l){if(!this._ignoreEvent(l)){if(this.isListening("KeyUp")){var a=
this._createKeyEvent("KeyUp",l);this.onKeyUp(a);if(a.defaultPrevented){l.preventDefault();return}}this._handleDocKeyUp(l);13===l.keyCode&&this._commitIME()}},_handleLinkClick:function(l){if(!(e.isMac?l.metaKey:l.ctrlKey))return l.preventDefault&&l.preventDefault(),!1},_handleMouse:function(l){var a=this._getWindow(),c=!0,b=a;if(e.isIE||e.isFirefox&&!this._overlayDiv)b=this._clientDiv;if(this._overlayDiv){this._hasFocus&&(this._ignoreFocus=!0);var h=this;a.setTimeout(function(){h.focus();h._ignoreFocus=
!1},0)}1===this._clickCount?(c=this._setSelectionTo(l.clientX,l.clientY,l.shiftKey,(!e.isOpera||12.16<=e.isOpera)&&this._hasFocus&&this.isListening("DragStart")))&&this._setGrab(b):(this._isW3CEvents&&this._setGrab(b),this._doubleClickSelection=null,this._setSelectionTo(l.clientX,l.clientY,l.shiftKey),this._doubleClickSelection=this._getSelection());return c},_handleMouseDown:function(l){if(!this._ignoreEvent(l)){if(this._linksVisible)if("A"!==(l.target||l.srcElement).tagName)this._setLinksVisible(!1);
else return;this._commitIME();var a=l.which;a||(4===l.button&&(a=2),2===l.button&&(a=3),1===l.button&&(a=1));var c=2!==a&&l.timeStamp?l.timeStamp:(new Date).getTime(),b=c-this._lastMouseTime,h=Math.abs(this._lastMouseX-l.clientX),n=Math.abs(this._lastMouseY-l.clientY),m=this._lastMouseButton===a;this._lastMouseX=l.clientX;this._lastMouseY=l.clientY;this._lastMouseTime=c;this._lastMouseButton=a;1===a&&(this._isMouseDown=!0,m&&b<=this._clickTime&&h<=this._clickDist&&n<=this._clickDist?this._clickCount++:
this._clickCount=1);if(this.isListening("MouseDown")&&(c=this._createMouseEvent("MouseDown",l),this.onMouseDown(c),c.defaultPrevented)){l.preventDefault();return}if(1===a&&this._handleMouse(l)&&(9<=e.isIE||e.isOpera||e.isChrome||e.isSafari||e.isFirefox&&!this._overlayDiv))this._hasFocus||this.focus(),l.preventDefault();e.isFirefox&&3===this._lastMouseButton&&this._updateDOMSelection()}},_handleMouseOver:function(l){if(!this._ignoreEvent(l)&&!this._animation&&this.isListening("MouseOver"))this.onMouseOver(this._createMouseEvent("MouseOver",
l))},_handleMouseOut:function(l){if(!this._ignoreEvent(l)&&!this._animation&&this.isListening("MouseOut"))this.onMouseOut(this._createMouseEvent("MouseOut",l))},_handleMouseMove:function(l){if(!this._animation){var a=this._isClientDiv(l);if(this.isListening("MouseMove")&&(a||this._isMouseDown)){var c=this._createMouseEvent("MouseMove",l);this.onMouseMove(c);if(c.defaultPrevented){l.preventDefault();return}}if(!this._dropTarget){c=this._linksVisible||this._lastMouseMoveX!==l.clientX||this._lastMouseMoveY!==
l.clientY;this._lastMouseMoveX=l.clientX;this._lastMouseMoveY=l.clientY;this._setLinksVisible(c&&!this._isMouseDown&&(e.isMac?l.metaKey:l.ctrlKey));this._checkOverlayScroll();if(!this._isW3CEvents){if(0===l.button)return this._setGrab(null),!0;if(!this._isMouseDown&&1===l.button&&0!==(this._clickCount&1)&&a)return this._clickCount=2,this._handleMouse(l,this._clickCount)}if(this._isMouseDown&&-1===this._dragOffset){a=l.clientX;l=l.clientY;var b=this._getViewPadding(),h=this._viewDiv.getBoundingClientRect(),
n=this._getClientWidth(),m=this._getClientHeight(),c=h.left+b.left,d=h.top+b.top,n=h.left+b.left+n,b=h.top+b.top+m;l<d?this._doAutoScroll("up",a,l-d):l>b?this._doAutoScroll("down",a,l-b):a<c&&!this._wrapMode?this._doAutoScroll("left",a-c,l):a>n&&!this._wrapMode?this._doAutoScroll("right",a-n,l):(this._endAutoScroll(),this._setSelectionTo(a,l,!0))}}}},_isClientDiv:function(l){var a=this._overlayDiv||this._clientDiv;for(l=l.target?l.target:l.srcElement;l;){if(a===l)return!0;l=l.parentNode}return!1},
_createKeyEvent:function(l,a){return{type:l,event:a,preventDefault:function(){this.defaultPrevented=!0}}},_createMouseEvent:function(l,a){var c=this.convert({x:a.clientX,y:a.clientY},"page","document");return{type:l,event:a,clickCount:this._clickCount,x:c.x,y:c.y,preventDefault:function(){this.defaultPrevented=!0}}},_createTouchEvent:function(l,a){var c=a.touches.length?this.convert({x:a.touches[0].clientX,y:a.touches[0].clientY},"page","document"):{};return{type:l,event:a,touchCount:a.touches.length,
x:c.x,y:c.y,preventDefault:function(){this.defaultPrevented=!0}}},_handleMouseUp:function(l){var a=l.which?0===l.button:1===l.button;if(this.isListening("MouseUp")&&(this._isClientDiv(l)||a&&this._isMouseDown)){var c=this._createMouseEvent("MouseUp",l);this.onMouseUp(c);if(c.defaultPrevented){l.preventDefault();this._isMouseDown=!1;return}}this._linksVisible||(a&&this._isMouseDown&&(-1!==this._dragOffset&&(c=this._getSelection(),c.extend(this._dragOffset),c.collapse(),this._setSelection(c,!0,!0),
this._dragOffset=-1),this._isMouseDown=!1,this._endAutoScroll(),this._isW3CEvents&&this._setGrab(null)),a&&e.isFirefox&&(this._updateDOMSelection(),l.preventDefault()))},_handleMouseWheel:function(l){if(!this._noScroll){var a=this._getLineHeight(),c=0,b=0;e.isIE||e.isOpera?b=-l.wheelDelta/40*a:e.isFirefox?"wheel"===l.type?l.deltaMode?(c=Math.max(-256,Math.min(256,l.deltaX))*a,b=Math.max(-256,Math.min(256,l.deltaY))*a):(c=l.deltaX,b=l.deltaY):(a=e.isMac?3*l.detail:Math.max(-256,Math.min(256,l.detail))*
a,l.axis===l.HORIZONTAL_AXIS?c=a:b=a):e.isMac?(b=l.timeStamp-this._wheelTimeStamp,this._wheelTimeStamp=l.timeStamp,c=0!==l.wheelDeltaX%120?1:40>b?40/(40-b):40,b=0!==l.wheelDeltaY%120?1:40>b?40/(40-b):40,c=Math.ceil(-l.wheelDeltaX/c),-1<c&&0>c&&(c=-1),0<c&&1>c&&(c=1),b=Math.ceil(-l.wheelDeltaY/b),-1<b&&0>b&&(b=-1),0<b&&1>b&&(b=1)):(c=-l.wheelDeltaX,b=8*(-l.wheelDeltaY/120)*a);if(e.isSafari||e.isChrome&&e.isMac){for(a=l.target;a&&void 0===a.lineIndex;)a=a.parentNode;this._mouseWheelLine=a}a=this._getScroll();
this._scrollView(c,b);c=this._getScroll();if(a.x!==c.x||a.y!==c.y)return l.preventDefault&&l.preventDefault(),!1}},_handlePaste:function(a){this._cancelCheckSelection();if(!this._ignoreEvent(a)&&!this._ignorePaste&&this._doPaste(a)){if(e.isIE){var c=this;this._ignoreFocus=!0;this._getWindow().setTimeout(function(){c._updateDOMSelection();c._ignoreFocus=!1},0)}a.preventDefault&&a.preventDefault();return!1}},_handleResize:function(){var l=this._rootDiv.clientWidth,c=this._rootDiv.clientHeight;if(this._rootWidth!==
l||this._rootHeight!==c)this._rootWidth!==l&&this._wrapMode&&this._resetLineHeight(),this._rootWidth=l,this._rootHeight=c,l=9>e.isIE,c=this._calculateMetrics(),a(c,this._metrics)||(this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight()),this._metrics=c,l=!0),l?this._queueUpdate():this._update(),this.dispatchEvent({type:"Resize"})},_handleRulerEvent:function(a){for(var c=a.target?a.target:a.srcElement,b=c.lineIndex;c&&!c._ruler;)void 0===b&&void 0!==c.lineIndex&&(b=c.lineIndex),
c=c.parentNode;var h=c?c._ruler:null;if(void 0===b&&h&&"document"===h.getOverview()){var b=this._getClientHeight(),n=this._model.getLineCount(),m=this._getViewPadding(),d=this._viewDiv.getBoundingClientRect(),b=Math.floor((a.clientY-d.top-this._metrics.scrollWidth)*n/(b+m.top+m.bottom-2*this._metrics.scrollWidth));0<=b&&b<n||(b=void 0)}if(h)switch(a.type){case "click":if(h.onClick)h.onClick(b,a);break;case "dblclick":if(h.onDblClick)h.onDblClick(b,a);break;case "mousemove":if(h.onMouseMove)h.onMouseMove(b,
a);break;case "mouseover":if(h.onMouseOver)h.onMouseOver(b,a);break;case "mouseout":if(h.onMouseOut){for(n=a.relatedTarget;n&&n!==this._rootDiv;){if(n===c)return;n=n.parentNode}h.onMouseOut(b,a)}}},_handleScroll:function(){this._lastScrollTime=(new Date).getTime();var a=this._getScroll(!1),c=this._hScroll,b=this._vScroll;if(c!==a.x||b!==a.y)this._hScroll=a.x,this._vScroll=a.y,this._commitIME(),this._update(b===a.y),this.onScroll({type:"Scroll",oldValue:{x:c,y:b},newValue:a})},_handleSelectStart:function(a){var c=
this._contextMenuOpen;this._contextMenuOpen=!1;if(c)this._checkSelectionChange=!0;else if(this._ignoreSelect)return a&&a.preventDefault&&a.preventDefault(),!1},_getModelOffset:function(a,c){if(a){var b;b="DIV"===a.tagName?a:a.parentNode.parentNode;return!b._line?0:b._line.getModelOffset(a,c)}},_updateSelectionFromDOM:function(){if(!e.isIOS&&!e.isAndroid&&!this._checkSelectionChange)return!1;var a=this._getWindow().getSelection(),c=this._getModelOffset(a.anchorNode,a.anchorOffset),b=this._getModelOffset(a.focusNode,
a.focusOffset),h=this._getSelection();if(void 0===c||void 0===b||h.start===c&&h.end===b)return!1;if(this._checkSelectionChange){var h=this._getLineNext(),n=this._getLinePrevious();if(a.anchorNode===h.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===n.firstChild.firstChild&&0===a.focusOffset)return!1;if(a.anchorNode===h.firstChild.firstChild&&0===a.anchorOffset&&a.focusNode===n.lastChild.firstChild||a.anchorNode===this._clientDiv&&a.focusNode===this._clientDiv)c=0,b=this.getModel().getCharCount()}this._setSelection(new s(c,
b),!1,!1);this._checkSelectionChange=!1;return!0},_cancelCheckSelection:function(){this._checkSelectionChange&&(this._checkSelectionChange=!1,this._cancelPollSelectionChange())},_cancelPollSelectionChange:function(){this._selPollTimer&&(this._getWindow().clearTimeout(this._selPollTimer),this._selPollTimer=null)},_pollSelectionChange:function(a){var c=this,b=this._getWindow();this._cancelPollSelectionChange();this._selPollTimer=b.setTimeout(function(){c._selPollTimer=null;c._clientDiv&&!c._updateSelectionFromDOM()&&
a&&c._pollSelectionChange(a)},100)},_handleSelectionChange:function(){-1===this._imeOffset&&(e.isAndroid?this._pollSelectionChange():this._updateSelectionFromDOM())},_handleTextInput:function(a){if(!this._ignoreEvent(a)){this._imeOffset=-1;var c=this._getWindow().getSelection();if(c.anchorNode!==this._anchorNode||c.focusNode!==this._focusNode||c.anchorOffset!==this._anchorOffset||c.focusOffset!==this._focusOffset){for(var b=c.anchorNode;b&&void 0===b.lineIndex;)b=b.parentNode;if(b){var h=this._model,
n=b.lineIndex,m=h.getLine(n),d=m,s=0,h=h.getLineStart(n);0<c.rangeCount&&(c.getRangeAt(0).deleteContents(),n=b.ownerDocument.createTextNode(a.data),c.getRangeAt(0).insertNode(n),s=this._getDOMText(b,n),d=s.text,s=s.offset,n.parentNode.removeChild(n));b.lineRemoved=!0;for(b=0;m.charCodeAt(b)===d.charCodeAt(b)&&b<s;)b++;c=m.length-1;for(n=d.length-m.length;m.charCodeAt(c)===d.charCodeAt(c+n)&&c+n>=s+a.data.length;)c--;c++;m=d.substring(b,c+n);this._ignoreQueueUpdate=e.isSafari;this._modifyContent({text:m,
start:b+h,end:c+h,_ignoreDOMSelection:!0,_ignoreDOMSelection1:e.isChrome},!0);this._ignoreQueueUpdate=!1}}else this._doContent(a.data);a.preventDefault()}},_handleTouchStart:function(a){if(this.isListening("TouchStart")){var c=this._createTouchEvent("TouchStart",a);this.onTouchStart(c);if(c.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}this._commitIME();c=this._getWindow();this._touchScrollTimer&&(this._vScrollDiv.style.display="none",this._hScrollDiv.style.display="none",c.clearInterval(this._touchScrollTimer),
this._touchScrollTimer=null);var b=a.touches;if(1===b.length){var b=b[0],h=b.clientX,n=b.clientY;this._touchStartX=h;this._touchStartY=n;if(e.isAndroid&&(n<b.pageY-c.pageYOffset||h<b.pageX-c.pageXOffset))h=b.pageX-c.pageXOffset,n=b.pageY-c.pageYOffset;c=this.convert({x:h,y:n},"page","document");this._lastTouchOffset=this.getOffsetAtLocation(c.x,c.y);this._touchStartTime=a.timeStamp;this._touching=!0}},_handleTouchMove:function(a){if(this.isListening("TouchMove")){var c=this._createTouchEvent("TouchMove",
a);this.onTouchMove(c);if(c.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}c=a.touches;if(1===c.length){c=c[0];this._touchCurrentX=c.clientX;this._touchCurrentY=c.clientY;if(!this._touchScrollTimer&&200>a.timeStamp-this._touchStartTime){this._vScrollDiv.style.display="block";this._wrapMode||(this._hScrollDiv.style.display="block");var b=this,h=this._getWindow();this._touchScrollTimer=h.setInterval(function(){var a=0,l=0;if(b._touching)a=b._touchStartX-b._touchCurrentX,l=b._touchStartY-
b._touchCurrentY,b._touchSpeedX=a/10,b._touchSpeedY=l/10,b._touchStartX=b._touchCurrentX,b._touchStartY=b._touchCurrentY;else{if(0.1>Math.abs(b._touchSpeedX)&&0.1>Math.abs(b._touchSpeedY)){b._vScrollDiv.style.display="none";b._hScrollDiv.style.display="none";h.clearInterval(b._touchScrollTimer);b._touchScrollTimer=null;return}a=10*b._touchSpeedX;l=10*b._touchSpeedY;b._touchSpeedX*=0.95;b._touchSpeedY*=0.95}b._scrollView(a,l)},10)}this._touchScrollTimer&&a.preventDefault()}},_handleTouchEnd:function(a){if(this.isListening("TouchEnd")){var c=
this._createTouchEvent("TouchEnd",a);this.onTouchEnd(c);if(c.defaultPrevented){a.preventDefault();return}if(this._noScroll)return}0===a.touches.length&&(this._touching=!1)},_doAction:function(a){var c,b,h=this._keyModes;for(b=h.length-1;0<=b;b--)if(c=h[b],"function"===typeof c.match&&(c=c.match(a),void 0!==c))return this.invokeAction(c);return!1},_doMove:function(a,c){var b=this._model,h=c.getCaret(),n=b.getLineAtOffset(h);a.count||(a.count=1);for(;0!==a.count;){var m=b.getLineStart(n);if(0>a.count&&
h===m)if(0<n)"character"===a.unit&&a.count++,n--,c.extend(b.getLineEnd(n));else break;else if(0<a.count&&h===b.getLineEnd(n))if(n+1<b.getLineCount())"character"===a.unit&&a.count--,n++,c.extend(b.getLineStart(n));else break;else{var d=!1;a.expandTab&&("character"===a.unit&&0===(h-m)%this._tabSize)&&(m=b.getText(m,h),d=!/[^ ]/.test(m));d?(c.extend(h-this._tabSize),a.count+=0>a.count?1:-1):(m=this._getLine(n),c.extend(m.getNextOffset(h,a)),m.destroy())}h=c.getCaret()}return c},_doBackspace:function(a){var c=
this._getSelection();c.isEmpty()&&(a.count||(a.count=1),a.count*=-1,a.expandTab=this._expandTab,this._doMove(a,c));this._modifyContent({text:"",start:c.start,end:c.end},!0);return!0},_doCase:function(a){var c=this._getSelection();this._doMove(a,c);var b=this.getText(c.start,c.end);this._setSelection(c,!0);switch(a.type){case "lower":b=b.toLowerCase();break;case "capitalize":b=b.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()});break;case "reverse":a="";for(c=0;c<b.length;c++){var h=b[c],
n=h.toLowerCase(),h=n!==h?n:h.toUpperCase();a+=h}b=a;break;default:b=b.toUpperCase()}this._doContent(b);return!0},_doContent:function(a){var c=this._getSelection();if(this._overwriteMode&&c.isEmpty()){var b=this._model,h=b.getLineAtOffset(c.end);c.end<b.getLineEnd(h)&&(b=this._getLine(h),c.extend(b.getNextOffset(c.getCaret(),{unit:"character",count:1})),b.destroy())}return this._modifyContent({text:a,start:c.start,end:c.end,_ignoreDOMSelection:!0},!0)},_doCopy:function(a){var c=this._getSelection();
return!c.isEmpty()?(c=this._getBaseText(c.start,c.end),this._setClipboardText(c,a)):!0},_doCursorNext:function(a){var c=this._getSelection();!c.isEmpty()&&!a.select?c.start=c.end:this._doMove(a,c);a.select||c.collapse();this._setSelection(c,!0);return!0},_doCursorPrevious:function(a){var c=this._getSelection();!c.isEmpty()&&!a.select?c.end=c.start:(a.count||(a.count=1),a.count*=-1,this._doMove(a,c));a.select||c.collapse();this._setSelection(c,!0);return!0},_doCut:function(a){var c=this._getSelection();
return!c.isEmpty()?(c=this._getBaseText(c.start,c.end),this._doContent(""),this._setClipboardText(c,a)):!0},_doDelete:function(a){var c=this._getSelection();c.isEmpty()&&this._doMove(a,c);this._modifyContent({text:"",start:c.start,end:c.end},!0);return!0},_doEnd:function(a){var c=this._getSelection(),b=this._model,h;if(a.ctrl)c.extend(b.getCharCount()),h=function(){};else{var n=c.getCaret(),m=b.getLineAtOffset(n);if(this._wrapMode){var d=this._getLine(m),n=d.getLineIndex(n),n=n===d.getLineCount()-
1?b.getLineEnd(m):d.getLineStart(n+1)-1;d.destroy()}else a.count&&0<a.count&&(m=Math.min(m+a.count-1,b.getLineCount()-1)),n=b.getLineEnd(m);c.extend(n)}a.select||c.collapse();this._setSelection(c,!0,!0,h);return!0},_doEnter:function(a){if(this._singleMode)return!0;var c=this._model,b=this._getSelection();this._doContent(c.getLineDelimiter());a&&a.noCursor&&(b.end=b.start,this._setSelection(b,!0));return!0},_doHome:function(a){var c=this._getSelection(),b=this._model,h;if(a.ctrl)c.extend(0),h=function(){};
else{var n=c.getCaret(),m=b.getLineAtOffset(n);this._wrapMode?(b=this._getLine(m),n=b.getLineIndex(n),n=b.getLineStart(n),b.destroy()):n=b.getLineStart(m);c.extend(n)}a.select||c.collapse();this._setSelection(c,!0,!0,h);return!0},_doLineDown:function(a){var c=this._model,b=this._getSelection(),h=b.getCaret(),n=c.getLineAtOffset(h),m=this._getLine(n),d=this._columnX,s=1,f=!1;if(-1===d||a.wholeLine||a.select&&e.isIE)d=a.wholeLine?c.getLineEnd(n+1):h,d=m.getBoundingClientRect(d).left;(h=m.getLineIndex(h))<
m.getLineCount()-1?s=m.getClientRects(h+1).top+1:(h=c.getLineCount()-1,f=n===h,a.count&&0<a.count?n=Math.min(n+a.count,h):n++);h=!1;if(f){if(a.select||e.isMac||e.isLinux)b.extend(c.getCharCount()),h=!0}else m.lineIndex!==n&&(m.destroy(),m=this._getLine(n)),b.extend(m.getOffset(d,s)),h=!0;h&&(a.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=d;m.destroy();return!0},_doLineUp:function(a){var c=this._model,b=this._getSelection(),h=b.getCaret(),n=c.getLineAtOffset(h),m=this._getLine(n),
d=this._columnX,s=!1,f;if(-1===d||a.wholeLine||a.select&&e.isIE)d=a.wholeLine?c.getLineStart(n-1):h,d=m.getBoundingClientRect(d).left;0<(h=m.getLineIndex(h))?f=m.getClientRects(h-1).top+1:(s=0===n,s||(a.count&&0<a.count?n=Math.max(n-a.count,0):n--,f=this._getLineHeight(n)-1));h=!1;if(s){if(a.select||e.isMac||e.isLinux)b.extend(0),h=!0}else m.lineIndex!==n&&(m.destroy(),m=this._getLine(n)),b.extend(m.getOffset(d,f)),h=!0;h&&(a.select||b.collapse(),this._setSelection(b,!0,!0));this._columnX=d;m.destroy();
return!0},_doNoop:function(){return!0},_doPageDown:function(a){var c=this,b=this._model,h=this._getSelection(),n=h.getCaret(),m=b.getLineAtOffset(n),d=b.getLineCount(),s=this._getScroll(),b=this._getClientHeight(),f,g;if(this._lineHeight){f=this._columnX;s=this._getBoundsAtOffset(n);if(-1===f||a.select&&e.isIE)f=s.left;n=this._getLineIndex(s.top+b);g=this._getLine(n);m=this._getLinePixel(n);n=g.getOffset(f,s.top+b-m);b=g.getBoundingClientRect(n);g.destroy();h.extend(n);a.select||h.collapse();this._setSelection(h,
!0,!0,function(){c._columnX=f},b.top+m-s.top);return!0}if(m<d-1){var v=this._getLineHeight(),q=Math.min(d-m-1,Math.floor(b/v)),q=Math.max(1,q);f=this._columnX;if(-1===f||a.select&&e.isIE)g=this._getLine(m),f=g.getBoundingClientRect(n).left,g.destroy();g=this._getLine(m+q);h.extend(g.getOffset(f,0));g.destroy();a.select||h.collapse();a=d*v;n=s.y+q*v;n+b>a&&(n=a-b);this._setSelection(h,!0,!0,function(){c._columnX=f},n-s.y)}return!0},_doPageUp:function(a){var c=this,b=this._model,h=this._getSelection(),
n=h.getCaret(),m=b.getLineAtOffset(n),d=this._getScroll(),s=this._getClientHeight(),f;if(this._lineHeight){f=this._columnX;d=this._getBoundsAtOffset(n);if(-1===f||a.select&&e.isIE)f=d.left;n=this._getLineIndex(d.bottom-s);b=this._getLine(n);m=this._getLinePixel(n);n=b.getOffset(f,d.bottom-s-m);s=b.getBoundingClientRect(n);b.destroy();h.extend(n);a.select||h.collapse();this._setSelection(h,!0,!0,function(){c._columnX=f},s.top+m-d.top);return!0}if(0<m){var g=this._getLineHeight(),s=Math.max(1,Math.min(m,
Math.floor(s/g)));f=this._columnX;if(-1===f||a.select&&e.isIE)b=this._getLine(m),f=b.getBoundingClientRect(n).left,b.destroy();b=this._getLine(m-s);h.extend(b.getOffset(f,this._getLineHeight(m-s)-1));b.destroy();a.select||h.collapse();a=Math.max(0,d.y-s*g);this._setSelection(h,!0,!0,function(){c._columnX=f},a-d.y)}return!0},_doPaste:function(a){var c=this;return null!==this._getClipboardText(a,function(a){a&&(e.isLinux&&2===c._lastMouseButton&&(new Date).getTime()-c._lastMouseTime<=c._clickTime&&
c._setSelectionTo(c._lastMouseX,c._lastMouseY),c._doContent(a))})},_doScroll:function(a){var c=a.type,b=this._model,h=b.getLineCount();a=this._getClientHeight();var n=this._getLineHeight(),h=this._lineHeight?this._scrollHeight:h*n,m=this._getScroll().y,d;switch(c){case "textStart":d=0;break;case "textEnd":d=h-a;break;case "pageDown":d=m+a;break;case "pageUp":d=m-a;break;case "lineDown":d=m+n;break;case "lineUp":d=m-n;break;case "centerLine":c=this._getSelection(),d=b.getLineAtOffset(c.start),b=(b.getLineAtOffset(c.end)-
d+1)*n,d=d*n-a/2+b/2}void 0!==d&&(d=Math.min(Math.max(0,d),h-a),this._scrollViewAnimated(0,d-m,function(){}));return!0},_doSelectAll:function(){var a=this._model,c=this._getSelection();c.setCaret(0);c.extend(a.getCharCount());this._setSelection(c,!1);return!0},_doTab:function(){if(this._tabMode&&!this._readonly){var a="\t";if(this._expandTab)var c=this._model,a=this._getSelection().getCaret(),b=c.getLineAtOffset(a),c=c.getLineStart(b),a=Array(this._tabSize-(a-c)%this._tabSize+1).join(" ");this._doContent(a);
return!0}},_doShiftTab:function(){if(this._tabMode&&!this._readonly)return!0},_doOverwriteMode:function(){if(!this._readonly)return this.setOptions({overwriteMode:!this.getOptions("overwriteMode")}),!0},_doTabMode:function(){this._tabMode=!this._tabMode;return!0},_doWrapMode:function(){this.setOptions({wrapMode:!this.getOptions("wrapMode")});return!0},_autoScroll:function(){var a=this._model,c=this._getSelection(),b=this.convert({x:this._autoScrollX,y:this._autoScrollY},"page","document"),h=c.getCaret(),
n=a.getLineCount(),m=a.getLineAtOffset(h),d;if("up"===this._autoScrollDir||"down"===this._autoScrollDir)h=this._autoScrollY/this._getLineHeight(),h=0>h?Math.floor(h):Math.ceil(h),d=Math.max(0,Math.min(n-1,m+h));else if("left"===this._autoScrollDir||"right"===this._autoScrollDir)d=this._getLineIndex(b.y),m=this._getLine(m),b.x+=m.getBoundingClientRect(h,!1).left,m.destroy();0===d&&(e.isMac||e.isLinux)?c.extend(0):d===n-1&&(e.isMac||e.isLinux)?c.extend(a.getCharCount()):(m=this._getLine(d),c.extend(m.getOffset(b.x,
b.y-this._getLinePixel(d))),m.destroy());this._setSelection(c,!0)},_autoScrollTimer:function(){this._autoScroll();var a=this;this._autoScrollTimerID=this._getWindow().setTimeout(function(){a._autoScrollTimer()},this._AUTO_SCROLL_RATE)},_calculateLineHeightTimer:function(a){if(this._lineHeight&&!this._calculateLHTimer){var c=this._model.getLineCount(),b=0;if(a){a=0;for(var h=(new Date).getTime(),n=0;b<c&&!(this._lineHeight[b]||(a++,n||(n=b),this._lineHeight[b]=this._calculateLineHeight(b)),b++,100<
(new Date).getTime()-h););this.redrawRulers(0,c);this._queueUpdate()}a=this._getWindow();if(b!==c){var m=this;this._calculateLHTimer=a.setTimeout(function(){m._calculateLHTimer=null;m._calculateLineHeightTimer(!0)},0)}else this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=void 0)}},_calculateLineHeight:function(a){a=this._getLine(a);var c=a.getBoundingClientRect();a.destroy();return Math.max(1,c.bottom-c.top)},_calculateMetrics:function(){var a=this._clientDiv,
c=a.ownerDocument,b=e.createElement(c,"div");b.style.lineHeight="normal";var h={type:"LineStyle",textView:this,0:0,lineText:this._model.getLine(0),lineStart:0};this.onLineStyle(h);q(h.style,b);b.style.position="fixed";b.style.left="-1000px";var d=e.createElement(c,"span");d.appendChild(c.createTextNode(" "));b.appendChild(d);var s=e.createElement(c,"span");s.style.fontStyle="italic";s.appendChild(c.createTextNode(" "));b.appendChild(s);var f=e.createElement(c,"span");f.style.fontWeight="bold";f.appendChild(c.createTextNode(" "));
b.appendChild(f);h=e.createElement(c,"span");h.style.fontWeight="bold";h.style.fontStyle="italic";h.appendChild(c.createTextNode(" "));b.appendChild(h);a.appendChild(b);var g=b.getBoundingClientRect(),d=d.getBoundingClientRect(),s=s.getBoundingClientRect(),f=f.getBoundingClientRect(),h=h.getBoundingClientRect(),d=d.bottom-d.top,s=s.bottom-s.top,f=f.bottom-f.top,v=h.bottom-h.top,k=0,h=0>=g.bottom-g.top,g=Math.max(1,g.bottom-g.top);s>d&&(k=1);f>s&&(k=2);v>f&&(k=3);var x;0!==k&&(x={style:{}},0!==(k&
1)&&(x.style.fontStyle="italic"),0!==(k&2)&&(x.style.fontWeight="bold"));d=n(b);a.removeChild(b);k=m(this._viewDiv);b=e.createElement(c,"div");b.style.position="fixed";b.style.left="-1000px";b.style.paddingLeft=k.left+"px";b.style.paddingTop=k.top+"px";b.style.paddingRight=k.right+"px";b.style.paddingBottom=k.bottom+"px";b.style.width="100px";b.style.height="100px";k=e.createElement(c,"div");k.style.width="100%";k.style.height="100%";b.appendChild(k);a.appendChild(b);s=b.getBoundingClientRect();f=
k.getBoundingClientRect();v=0;!this._singleMode&&!this._noScroll&&(b.style.overflow="hidden",k.style.height="200px",v=b.clientWidth,b.style.overflow="scroll",v-=b.clientWidth);a.removeChild(b);var k={left:f.left-s.left,top:f.top-s.top,right:s.right-f.right,bottom:s.bottom-f.bottom},w=0,p=f=0;if(!h){b=e.createElement(c,"div");b.style.position="fixed";b.style.left="-1000px";a.appendChild(b);b.innerHTML=Array(2).join("a");s=b.getBoundingClientRect();p=Math.ceil(s.right-s.left);if(this._wrapOffset||this._marginOffset)b.innerHTML=
Array(this._wrapOffset+1+(e.isWebkit?0:1)).join(" "),s=b.getBoundingClientRect(),w=Math.ceil(s.right-s.left),b.innerHTML=Array(this._marginOffset+1).join(" "),f=b.getBoundingClientRect(),f=Math.ceil(f.right-f.left);a.removeChild(b)}return{lineHeight:g,largestFontStyle:x,lineTrim:d,viewPadding:k,scrollWidth:v,wrapWidth:w,marginWidth:f,charWidth:p,invalid:h}},_cancelAnimation:function(){this._animation&&(this._animation.stop(),this._animation=null)},_clearSelection:function(a){var c=this._getSelection();
if(c.isEmpty())return!1;"next"===a?c.start=c.end:c.end=c.start;this._setSelection(c,!0);return!0},_commitIME:function(a){if(-1!==this._imeOffset){var c=this._model,b=c.getLineAtOffset(this._imeOffset),h=c.getLineStart(b),n=this._getLineNode(b);if(!a){this._scrollDiv.focus();this._clientDiv.focus();var m=this._getDOMText(n).text,c=c.getLine(b),h=this._imeOffset-h,c=h+m.length-c.length;h!==c&&(a=m.substring(h,c))}a&&(!this._doContent(a)&&!e.isWebkit)&&(n.lineRemoved=!0,this._queueUpdate());this._imeOffset=
-1}},_createActions:function(){this.addKeyMode(new r.DefaultKeyMode(this));var a=this;this._actions={noop:{defaultHandler:function(){return a._doNoop()}},lineUp:{defaultHandler:function(c){return a._doLineUp(b(c,{select:!1}))},actionDescription:{name:p.lineUp}},lineDown:{defaultHandler:function(c){return a._doLineDown(b(c,{select:!1}))},actionDescription:{name:p.lineDown}},lineStart:{defaultHandler:function(c){return a._doHome(b(c,{select:!1,ctrl:!1}))},actionDescription:{name:p.lineStart}},lineEnd:{defaultHandler:function(c){return a._doEnd(b(c,
{select:!1,ctrl:!1}))},actionDescription:{name:p.lineEnd}},charPrevious:{defaultHandler:function(c){return a._doCursorPrevious(b(c,{select:!1,unit:"character"}))},actionDescription:{name:p.charPrevious}},charNext:{defaultHandler:function(c){return a._doCursorNext(b(c,{select:!1,unit:"character"}))},actionDescription:{name:p.charNext}},pageUp:{defaultHandler:function(c){return a._doPageUp(b(c,{select:!1}))},actionDescription:{name:p.pageUp}},pageDown:{defaultHandler:function(c){return a._doPageDown(b(c,
{select:!1}))},actionDescription:{name:p.pageDown}},scrollPageUp:{defaultHandler:function(c){return a._doScroll(b(c,{type:"pageUp"}))},actionDescription:{name:p.scrollPageUp}},scrollPageDown:{defaultHandler:function(c){return a._doScroll(b(c,{type:"pageDown"}))},actionDescription:{name:p.scrollPageDown}},scrollLineUp:{defaultHandler:function(c){return a._doScroll(b(c,{type:"lineUp"}))},actionDescription:{name:p.scrollLineUp}},scrollLineDown:{defaultHandler:function(c){return a._doScroll(b(c,{type:"lineDown"}))},
actionDescription:{name:p.scrollLineDown}},wordPrevious:{defaultHandler:function(c){return a._doCursorPrevious(b(c,{select:!1,unit:"word"}))},actionDescription:{name:p.wordPrevious}},wordNext:{defaultHandler:function(c){return a._doCursorNext(b(c,{select:!1,unit:"word"}))},actionDescription:{name:p.wordNext}},textStart:{defaultHandler:function(c){return a._doHome(b(c,{select:!1,ctrl:!0}))},actionDescription:{name:p.textStart}},textEnd:{defaultHandler:function(c){return a._doEnd(b(c,{select:!1,ctrl:!0}))},
actionDescription:{name:p.textEnd}},scrollTextStart:{defaultHandler:function(c){return a._doScroll(b(c,{type:"textStart"}))},actionDescription:{name:p.scrollTextStart}},scrollTextEnd:{defaultHandler:function(c){return a._doScroll(b(c,{type:"textEnd"}))},actionDescription:{name:p.scrollTextEnd}},centerLine:{defaultHandler:function(c){return a._doScroll(b(c,{type:"centerLine"}))},actionDescription:{name:p.centerLine}},selectLineUp:{defaultHandler:function(c){return a._doLineUp(b(c,{select:!0}))},actionDescription:{name:p.selectLineUp}},
selectLineDown:{defaultHandler:function(c){return a._doLineDown(b(c,{select:!0}))},actionDescription:{name:p.selectLineDown}},selectWholeLineUp:{defaultHandler:function(c){return a._doLineUp(b(c,{select:!0,wholeLine:!0}))},actionDescription:{name:p.selectWholeLineUp}},selectWholeLineDown:{defaultHandler:function(c){return a._doLineDown(b(c,{select:!0,wholeLine:!0}))},actionDescription:{name:p.selectWholeLineDown}},selectLineStart:{defaultHandler:function(c){return a._doHome(b(c,{select:!0,ctrl:!1}))},
actionDescription:{name:p.selectLineStart}},selectLineEnd:{defaultHandler:function(c){return a._doEnd(b(c,{select:!0,ctrl:!1}))},actionDescription:{name:p.selectLineEnd}},selectCharPrevious:{defaultHandler:function(c){return a._doCursorPrevious(b(c,{select:!0,unit:"character"}))},actionDescription:{name:p.selectCharPrevious}},selectCharNext:{defaultHandler:function(c){return a._doCursorNext(b(c,{select:!0,unit:"character"}))},actionDescription:{name:p.selectCharNext}},selectPageUp:{defaultHandler:function(c){return a._doPageUp(b(c,
{select:!0}))},actionDescription:{name:p.selectPageUp}},selectPageDown:{defaultHandler:function(c){return a._doPageDown(b(c,{select:!0}))},actionDescription:{name:p.selectPageDown}},selectWordPrevious:{defaultHandler:function(c){return a._doCursorPrevious(b(c,{select:!0,unit:"word"}))},actionDescription:{name:p.selectWordPrevious}},selectWordNext:{defaultHandler:function(c){return a._doCursorNext(b(c,{select:!0,unit:"word"}))},actionDescription:{name:p.selectWordNext}},selectTextStart:{defaultHandler:function(c){return a._doHome(b(c,
{select:!0,ctrl:!0}))},actionDescription:{name:p.selectTextStart}},selectTextEnd:{defaultHandler:function(c){return a._doEnd(b(c,{select:!0,ctrl:!0}))},actionDescription:{name:p.selectTextEnd}},deletePrevious:{defaultHandler:function(c){return a._doBackspace(b(c,{unit:"character"}))},actionDescription:{name:p.deletePrevious}},deleteNext:{defaultHandler:function(c){return a._doDelete(b(c,{unit:"character"}))},actionDescription:{name:p.deleteNext}},deleteWordPrevious:{defaultHandler:function(c){return a._doBackspace(b(c,
{unit:"word"}))},actionDescription:{name:p.deleteWordPrevious}},deleteWordNext:{defaultHandler:function(c){return a._doDelete(b(c,{unit:"word"}))},actionDescription:{name:p.deleteWordNext}},deleteLineStart:{defaultHandler:function(c){return a._doBackspace(b(c,{unit:"line"}))},actionDescription:{name:p.deleteLineStart}},deleteLineEnd:{defaultHandler:function(c){return a._doDelete(b(c,{unit:"line"}))},actionDescription:{name:p.deleteLineEnd}},tab:{defaultHandler:function(c){return a._doTab(b(c,{}))},
actionDescription:{name:p.tab}},shiftTab:{defaultHandler:function(c){return a._doShiftTab(b(c,{}))},actionDescription:{name:p.shiftTab}},enter:{defaultHandler:function(c){return a._doEnter(b(c,{}))},actionDescription:{name:p.enter}},enterNoCursor:{defaultHandler:function(c){return a._doEnter(b(c,{noCursor:!0}))},actionDescription:{name:p.enterNoCursor}},selectAll:{defaultHandler:function(c){return a._doSelectAll(b(c,{}))},actionDescription:{name:p.selectAll}},copy:{defaultHandler:function(c){return a._doCopy(b(c,
{}))},actionDescription:{name:p.copy}},cut:{defaultHandler:function(c){return a._doCut(b(c,{}))},actionDescription:{name:p.cut}},paste:{defaultHandler:function(c){return a._doPaste(b(c,{}))},actionDescription:{name:p.paste}},uppercase:{defaultHandler:function(c){return a._doCase(b(c,{type:"upper"}))},actionDescription:{name:p.uppercase}},lowercase:{defaultHandler:function(c){return a._doCase(b(c,{type:"lower"}))},actionDescription:{name:p.lowercase}},capitalize:{defaultHandler:function(c){return a._doCase(b(c,
{unit:"word",type:"capitalize"}))},actionDescription:{name:p.capitalize}},reversecase:{defaultHandler:function(c){return a._doCase(b(c,{type:"reverse"}))},actionDescription:{name:p.reversecase}},toggleOverwriteMode:{defaultHandler:function(c){return a._doOverwriteMode(b(c,{}))},actionDescription:{name:p.toggleOverwriteMode}},toggleTabMode:{defaultHandler:function(c){return a._doTabMode(b(c,{}))},actionDescription:{name:p.toggleTabMode}},toggleWrapMode:{defaultHandler:function(c){return a._doWrapMode(b(c,
{}))},actionDescription:{name:p.toggleWrapMode}}}},_createRulerParent:function(a,c){var b=e.createElement(a,"div");b.className=c;b.tabIndex=-1;b.style.overflow="hidden";b.style.MozUserSelect="none";b.style.WebkitUserSelect="none";b.style.position="absolute";b.style.top="0px";b.style.bottom="0px";b.style.cursor="default";b.style.display="none";b.setAttribute("aria-hidden","true");this._rootDiv.appendChild(b);return b},_createRuler:function(a,c){if(this._clientDiv){var b=this._getRulerParent(a);if(b){if(b!==
this._marginDiv||this._marginOffset)b.style.display="block";b.rulerWidth=void 0;var h=e.createElement(b.ownerDocument,"div");h._ruler=a;a.node=h;h.rulerChanged=!0;h.style.position="relative";h.style.cssFloat="left";h.style.styleFloat="left";h.style.outline="none";if(void 0===c||0>c||c>=b.children.length)b.appendChild(h);else{for(var n=b.firstChild;n&&0<c--;)n=n.nextSibling;b.insertBefore(h,n)}}}},_createView:function(){function a(){d._rootDiv&&(d.update(!0),d._metrics.invalid&&d._getWindow().setTimeout(function(){a()},
100))}if(!this._clientDiv){for(var c=this._parent;c.hasChildNodes();)c.removeChild(c.lastChild);var b=c.ownerDocument,n=e.createElement(b,"div");this._rootDiv=n;n.tabIndex=-1;n.style.position="relative";n.style.overflow="hidden";n.style.width="100%";n.style.height="100%";n.style.overflow="hidden";n.style.WebkitTextSizeAdjust="100%";n.setAttribute("role","application");c.appendChild(n);this._leftDiv=this._createRulerParent(b,"textviewLeftRuler");c=e.createElement(b,"div");c.className="textviewScroll";
this._viewDiv=c;c.tabIndex=-1;c.style.position="absolute";c.style.top="0px";c.style.bottom="0px";c.style.borderWidth="0px";c.style.margin="0px";c.style.outline="none";c.style.background="transparent";n.appendChild(c);var m=this._createRulerParent(b,"textviewRightRuler");this._rightDiv=m;m.style.right="0px";this._innerRightDiv=m=this._createRulerParent(b,"textviewInnerRightRuler");m.style.zIndex="1";this._scrollDiv=m=e.createElement(b,"div");m.style.margin="0px";m.style.borderWidth="0px";m.style.padding=
"0px";c.appendChild(m);(this._marginDiv=this._createRulerParent(b,"textviewMarginRuler")).style.zIndex="4";!e.isIE&&!e.isIOS&&(this._clipDiv=c=e.createElement(b,"div"),c.style.position="absolute",c.style.overflow="hidden",c.style.margin="0px",c.style.borderWidth="0px",c.style.padding="0px",c.style.background="transparent",n.appendChild(c),this._clipScrollDiv=m=e.createElement(b,"div"),m.style.position="absolute",m.style.height="1px",m.style.top="-1000px",m.style.background="transparent",c.appendChild(m));
this._setFullSelection(this._fullSelection,!0);c=e.createElement(b,"div");c.className="textviewContent";this._clientDiv=c;c.tabIndex=0;c.style.position="absolute";c.style.borderWidth="0px";c.style.margin="0px";c.style.padding="0px";c.style.outline="none";c.style.zIndex="1";c.style.WebkitUserSelect="text";c.setAttribute("spellcheck","false");if(e.isIOS||e.isAndroid)c.style.WebkitTapHighlightColor="transparent";(this._clipDiv||n).appendChild(c);if(e.isIOS||e.isAndroid)this._vScrollDiv=m=e.createElement(b,
"div"),m.style.position="absolute",m.style.borderWidth="1px",m.style.borderColor="white",m.style.borderStyle="solid",m.style.borderRadius="4px",m.style.backgroundColor="black",m.style.opacity="0.5",m.style.margin="0px",m.style.padding="0px",m.style.outline="none",m.style.zIndex="3",m.style.width="8px",m.style.display="none",n.appendChild(m),this._hScrollDiv=m=e.createElement(b,"div"),m.style.position="absolute",m.style.borderWidth="1px",m.style.borderColor="white",m.style.borderStyle="solid",m.style.borderRadius=
"4px",m.style.backgroundColor="black",m.style.opacity="0.5",m.style.margin="0px",m.style.padding="0px",m.style.outline="none",m.style.zIndex="3",m.style.height="8px",m.style.display="none",n.appendChild(m);e.isFirefox&&!c.setCapture&&(this._overlayDiv=m=e.createElement(b,"div"),m.style.position=c.style.position,m.style.borderWidth=c.style.borderWidth,m.style.margin=c.style.margin,m.style.padding=c.style.padding,m.style.cursor="text",m.style.zIndex="2",(this._clipDiv||n).appendChild(m));c.contentEditable=
"true";c.setAttribute("role","textbox");c.setAttribute("aria-multiline","true");this._setWrapMode(this._wrapMode,!0);this._setReadOnly(this._readonly);this._setThemeClass(this._themeClass,!0);this._setTabSize(this._tabSize,!0);this._setMarginOffset(this._marginOffset,!0);this._hookEvents();c=this._rulers;for(m=0;m<c.length;m++)this._createRuler(c[m]);this._update();var d=this;h(b,n,"textview",a)}},_defaultOptions:function(){return{parent:{value:void 0,update:null},model:{value:void 0,update:this.setModel},
scrollAnimation:{value:0,update:null},readonly:{value:!1,update:this._setReadOnly},fullSelection:{value:!0,update:this._setFullSelection},tabMode:{value:!0,update:null},tabSize:{value:8,update:this._setTabSize},expandTab:{value:!1,update:null},singleMode:{value:!1,update:this._setSingleMode},noScroll:{value:!1,update:this._setNoScroll},overwriteMode:{value:!1,update:this._setOverwriteMode},blockCursorVisible:{value:!1,update:this._setBlockCursor},marginOffset:{value:0,update:this._setMarginOffset},
wrapOffset:{value:0,update:this._setWrapOffset},wrapMode:{value:!1,update:this._setWrapMode},wrappable:{value:!1,update:null},theme:{value:f.TextTheme.getTheme(),update:this._setTheme},themeClass:{value:void 0,update:this._setThemeClass}}},_destroyRuler:function(a){var c=this._getRulerParent(a);if(c)for(var b=c.firstChild;b;){if(b._ruler===a){b._ruler=void 0;c.removeChild(b);if(0===c.children.length&&(c!==this._marginDiv||!this._marginOffset))c.style.display="none";c.rulerWidth=void 0;break}b=b.nextSibling}},
_destroyView:function(){if(this._clientDiv){this._setGrab(null);this._unhookEvents();var a=this._getWindow();this._autoScrollTimerID&&(a.clearTimeout(this._autoScrollTimerID),this._autoScrollTimerID=null);this._updateTimer&&(a.clearTimeout(this._updateTimer),this._updateTimer=null);this._calculateLHTimer&&(a.clearTimeout(this._calculateLHTimer),this._calculateLHTimer=null);a=this._rootDiv;a.parentNode.removeChild(a);this._hScrollDiv=this._vScrollDiv=this._cursorDiv=this._marginDiv=this._innerRightDiv=
this._rightDiv=this._leftDiv=this._overlayDiv=this._clientDiv=this._clipScrollDiv=this._clipDiv=this._viewDiv=this._scrollDiv=this._rootDiv=this._clipboardDiv=this._selDiv3=this._selDiv2=this._selDiv1=null}},_doAutoScroll:function(a,c,b){this._autoScrollDir=a;this._autoScrollX=c;this._autoScrollY=b;this._autoScrollTimerID||this._autoScrollTimer()},_endAutoScroll:function(){this._autoScrollTimerID&&this._getWindow().clearTimeout(this._autoScrollTimerID);this._autoScrollTimerID=this._autoScrollDir=
void 0},_fixCaret:function(){var a=this._clientDiv;if(a){var c=this._hasFocus;this._ignoreFocus=!0;c&&a.blur();a.contentEditable=!1;a.contentEditable=!0;c&&a.focus();this._ignoreFocus=!1}},_getBaseText:function(a,c){var b=this._model;b.getBaseModel&&(a=b.mapOffset(a),c=b.mapOffset(c),b=b.getBaseModel());return b.getText(a,c)},_getBottomIndex:function(a){var c=this._bottomChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=c.getBoundingClientRect();var b=this._clientDiv.getBoundingClientRect();
a.bottom>b.bottom&&(c=this._getLinePrevious(c)||c)}return c.lineIndex},_getBoundsAtOffset:function(a){var c=this._getLine(this._model.getLineAtOffset(a));a=c.getBoundingClientRect(a);var b=this._getLinePixel(c.lineIndex);a.top+=b;a.bottom+=b;c.destroy();return a},_getClientHeight:function(){var a=this._getViewPadding();return Math.max(0,this._viewDiv.clientHeight-a.top-a.bottom)},_getInnerRightWidth:function(){var a=this._innerRightDiv.rulerWidth;void 0===a&&(a=this._innerRightDiv.getBoundingClientRect(),
this._innerRightDiv.rulerWidth=a=a.right-a.left);return a},_getClientWidth:function(){var a=this._getViewPadding(),c=this._getInnerRightWidth();return Math.max(0,this._viewDiv.clientWidth-a.left-a.right-c)},_getClipboardText:function(a,b){var h=this._singleMode?"":this._model.getLineDelimiter(),n,m,d=this._getWindow(),s=d.clipboardData;!s&&a&&(s=a.clipboardData);if(s)return n=[],m=s.getData(e.isIE?"Text":"text/plain"),c(m,function(a){n.push(a)},function(){n.push(h)}),m=n.join(""),b&&b(m),m;if(e.isFirefox){this._ignoreFocus=
!0;var f=this._clipboardDiv,s=this._rootDiv.ownerDocument;f||(this._clipboardDiv=f=e.createElement(s,"div"),f.style.position="fixed",f.style.whiteSpace="pre",f.style.left="-1000px",this._rootDiv.appendChild(f));f.innerHTML="\x3cpre contenteditable\x3d''\x3e\x3c/pre\x3e";f.firstChild.focus();var g=this,v=function(){var a=g._getTextFromElement(f);f.innerHTML="";n=[];c(a,function(a){n.push(a)},function(){n.push(h)});return n.join("")},q=!1;this._ignorePaste=!0;if(!e.isLinux||2!==this._lastMouseButton)try{q=
s.execCommand("paste",!1,null)}catch(k){q=1<f.childNodes.length||f.firstChild&&0<f.firstChild.childNodes.length}this._ignorePaste=!1;if(!q){if(a)return d.setTimeout(function(){g.focus();(m=v())&&b&&b(m);g._ignoreFocus=!1},0),null;this.focus();this._ignoreFocus=!1;return""}this.focus();this._ignoreFocus=!1;(m=v())&&b&&b(m);return m}return""},_getDOMText:function(a,c){return a._line.getText(c)},_getTextFromElement:function(a){var c=a.ownerDocument,b=c.defaultView;if(!b.getSelection)return a.innerText||
a.textContent;c=c.createRange();c.selectNode(a);a=b.getSelection();var b=[],h;for(h=0;h<a.rangeCount;h++)b.push(a.getRangeAt(h));this._ignoreSelect=!0;a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(h=0;h<b.length;h++)a.addRange(b[h]);this._ignoreSelect=!1;return c},_getViewPadding:function(){return this._metrics.viewPadding},_getLine:function(a){var c=this._getLineNode(a);return c&&!c.lineChanged&&!c.lineRemoved?c._line:new x(this,a)},_getLineHeight:function(a,c){if(void 0!==
a&&this._lineHeight){var b=this._lineHeight[a];if(b)return b;if(c||void 0===c)return this._lineHeight[a]=this._calculateLineHeight(a)}return this._metrics.lineHeight},_getLineNode:function(a){for(var c=this._clientDiv.firstChild;c;){if(a===c.lineIndex)return c;c=c.nextSibling}},_getLineNext:function(a){for(a=a?a.nextSibling:this._clientDiv.firstChild;a&&(-1===a.lineIndex||!a._line);)a=a.nextSibling;return a},_getLinePrevious:function(a){for(a=a?a.previousSibling:this._clientDiv.lastChild;a&&(-1===
a.lineIndex||!a._line);)a=a.previousSibling;return a},_getLinePixel:function(a){a=Math.min(Math.max(0,a),this._model.getLineCount());if(this._lineHeight){var c=this._getTopIndex(),b=-this._topIndexY+this._getScroll().y;if(a>c)for(;c<a;c++)b+=this._getLineHeight(c);else for(c-=1;c>=a;c--)b-=this._getLineHeight(c);return b}return this._getLineHeight()*a},_getLineIndex:function(a){var c,b=0,h=this._model.getLineCount();if(this._lineHeight){var b=this._getTopIndex(),n=-this._topIndexY+this._getScroll().y;
if(a!==n)if(a<n)for(;a<n&&0<b;)a+=this._getLineHeight(--b);else for(c=this._getLineHeight(b);a-c>=n&&b<h-1;)a-=c,c=this._getLineHeight(++b)}else c=this._getLineHeight(),b=Math.floor(a/c);return Math.max(0,Math.min(h-1,b))},_getRulerParent:function(a){switch(a.getLocation()){case "left":return this._leftDiv;case "right":return this._rightDiv;case "innerRight":return this._innerRightDiv;case "margin":return this._marginDiv}return null},_getScroll:function(a){(void 0===a||a)&&this._cancelAnimation();
a=this._viewDiv;return{x:a.scrollLeft,y:a.scrollTop}},_getSelection:function(){return this._selection.clone()},_getTopIndex:function(a){var c=this._topChild;if(a&&this._getClientHeight()>this._getLineHeight()){a=c.getBoundingClientRect();var b=this._getViewPadding(),h=this._viewDiv.getBoundingClientRect();a.top<h.top+b.top&&(c=this._getLineNext(c)||c)}return c.lineIndex},_hookEvents:function(){var a=this;this._modelListener={onChanging:function(c){a._onModelChanging(c)},onChanged:function(c){a._onModelChanged(c)}};
this._model.addEventListener("preChanging",this._modelListener.onChanging);this._model.addEventListener("postChanged",this._modelListener.onChanged);this._themeListener={onChanged:function(){a._setThemeClass(a._themeClass)}};this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);var c=this._handlers=[],b=this._clientDiv,h=this._viewDiv,n=this._rootDiv,m=this._overlayDiv||b,d=b.ownerDocument,s=this._getWindow(),f=e.isIE?d:s;c.push({target:s,type:"resize",handler:function(c){return a._handleResize(c?
c:s.event)}});c.push({target:b,type:"blur",handler:function(c){return a._handleBlur(c?c:s.event)}});c.push({target:b,type:"focus",handler:function(c){return a._handleFocus(c?c:s.event)}});c.push({target:h,type:"focus",handler:function(){b.focus()}});c.push({target:h,type:"scroll",handler:function(c){return a._handleScroll(c?c:s.event)}});c.push({target:b,type:"textInput",handler:function(c){return a._handleTextInput(c?c:s.event)}});c.push({target:b,type:"keydown",handler:function(c){return a._handleKeyDown(c?
c:s.event)}});c.push({target:b,type:"keypress",handler:function(c){return a._handleKeyPress(c?c:s.event)}});c.push({target:b,type:"keyup",handler:function(c){return a._handleKeyUp(c?c:s.event)}});e.isIE&&c.push({target:d,type:"keyup",handler:function(c){return a._handleDocKeyUp(c?c:s.event)}});c.push({target:b,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:s.event)}});c.push({target:b,type:"copy",handler:function(c){return a._handleCopy(c?c:s.event)}});c.push({target:b,type:"cut",
handler:function(c){return a._handleCut(c?c:s.event)}});c.push({target:b,type:"paste",handler:function(c){return a._handlePaste(c?c:s.event)}});c.push({target:d,type:"selectionchange",handler:function(c){return a._handleSelectionChange(c?c:s.event)}});if(e.isIOS||e.isAndroid)c.push({target:b,type:"touchstart",handler:function(c){return a._handleTouchStart(c?c:s.event)}}),c.push({target:b,type:"touchmove",handler:function(c){return a._handleTouchMove(c?c:s.event)}}),c.push({target:b,type:"touchend",
handler:function(c){return a._handleTouchEnd(c?c:s.event)}});else{c.push({target:b,type:"selectstart",handler:function(c){return a._handleSelectStart(c?c:s.event)}});c.push({target:b,type:"mousedown",handler:function(c){return a._handleMouseDown(c?c:s.event)}});c.push({target:b,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:s.event)}});c.push({target:b,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:s.event)}});c.push({target:f,type:"mouseup",handler:function(c){return a._handleMouseUp(c?
c:s.event)}});c.push({target:f,type:"mousemove",handler:function(c){return a._handleMouseMove(c?c:s.event)}});c.push({target:n,type:"mousedown",handler:function(c){return a._handleRootMouseDown(c?c:s.event)}});c.push({target:n,type:"mouseup",handler:function(c){return a._handleRootMouseUp(c?c:s.event)}});c.push({target:m,type:"dragstart",handler:function(c){return a._handleDragStart(c?c:s.event)}});c.push({target:m,type:"drag",handler:function(c){return a._handleDrag(c?c:s.event)}});c.push({target:m,
type:"dragend",handler:function(c){return a._handleDragEnd(c?c:s.event)}});c.push({target:m,type:"dragenter",handler:function(c){return a._handleDragEnter(c?c:s.event)}});c.push({target:m,type:"dragover",handler:function(c){return a._handleDragOver(c?c:s.event)}});c.push({target:m,type:"dragleave",handler:function(c){return a._handleDragLeave(c?c:s.event)}});c.push({target:m,type:"drop",handler:function(c){return a._handleDrop(c?c:s.event)}});c.push({target:this._clientDiv,type:26<e.isFirefox?"wheel":
e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:s.event)}});this._clipDiv&&c.push({target:this._clipDiv,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(c){return a._handleMouseWheel(c?c:s.event)}});if(e.isFirefox&&(!e.isWindows||15<=e.isFirefox))(h=s.MutationObserver||s.MozMutationObserver)?(this._mutationObserver=new h(function(c){a._handleDataModified(c)}),this._mutationObserver.observe(b,{subtree:!0,characterData:!0})):
c.push({target:this._clientDiv,type:"DOMCharacterDataModified",handler:function(c){return a._handleDataModified(c?c:s.event)}});if(e.isFirefox&&(!e.isWindows||15<=e.isFirefox)||e.isIE)c.push({target:this._clientDiv,type:"compositionstart",handler:function(c){return a._handleCompositionStart(c?c:s.event)}}),c.push({target:this._clientDiv,type:"compositionend",handler:function(c){return a._handleCompositionEnd(c?c:s.event)}});this._overlayDiv&&(c.push({target:this._overlayDiv,type:"mousedown",handler:function(c){return a._handleMouseDown(c?
c:s.event)}}),c.push({target:this._overlayDiv,type:"mouseover",handler:function(c){return a._handleMouseOver(c?c:s.event)}}),c.push({target:this._overlayDiv,type:"mouseout",handler:function(c){return a._handleMouseOut(c?c:s.event)}}),c.push({target:this._overlayDiv,type:"contextmenu",handler:function(c){return a._handleContextMenu(c?c:s.event)}}));this._isW3CEvents||c.push({target:this._clientDiv,type:"dblclick",handler:function(c){return a._handleDblclick(c?c:s.event)}})}this._hookRulerEvents(this._leftDiv,
c);this._hookRulerEvents(this._rightDiv,c);this._hookRulerEvents(this._innerRightDiv,c);this._hookRulerEvents(this._marginDiv,c);for(h=0;h<c.length;h++)n=c[h],y(n.target,n.type,n.handler,n.capture)},_hookRulerEvents:function(a,c){if(a){var b=this,h=this._getWindow();e.isIE&&c.push({target:a,type:"selectstart",handler:function(){return!1}});c.push({target:a,type:26<e.isFirefox?"wheel":e.isFirefox?"DOMMouseScroll":"mousewheel",handler:function(a){return b._handleMouseWheel(a?a:h.event)}});c.push({target:a,
type:"click",handler:function(a){b._handleRulerEvent(a?a:h.event)}});c.push({target:a,type:"dblclick",handler:function(a){b._handleRulerEvent(a?a:h.event)}});c.push({target:a,type:"mousemove",handler:function(a){b._handleRulerEvent(a?a:h.event)}});c.push({target:a,type:"mouseover",handler:function(a){b._handleRulerEvent(a?a:h.event)}});c.push({target:a,type:"mouseout",handler:function(a){b._handleRulerEvent(a?a:h.event)}})}},_getWindow:function(){return this._parent.ownerDocument.defaultView||this._parent.ownerDocument.parentWindow},
_ignoreEvent:function(a){for(a=a.target;a&&a!==this._clientDiv;){if(a.ignore)return!0;a=a.parentNode}return!1},_init:function(a){var c=a.parent;"string"===typeof c&&(c=(a.document||document).getElementById(c));if(!c)throw Error("no parent");a.parent=c;a.model=a.model||new t.TextModel;var b=this._defaultOptions(),h;for(h in b)b.hasOwnProperty(h)&&(this["_"+h]=void 0!==a[h]?a[h]:b[h].value);this._keyModes=[];this._rulers=[];this._selection=new s(0,0,!1);this._linksVisible=!1;this._maxLineWidth=this._redrawCount=
0;this._maxLineIndex=-1;this._ignoreSelect=!0;this._hasFocus=this._ignoreFocus=!1;this._dragOffset=this._columnX=-1;this._isRangeRects=(!e.isIE||9<=e.isIE)&&"function"===typeof c.ownerDocument.createRange().getBoundingClientRect;this._isW3CEvents=c.addEventListener;this._autoScrollTimerID=this._autoScrollY=this._autoScrollX=null;this._AUTO_SCROLL_RATE=50;this._mouseUpClosure=this._moseMoveClosure=this._grabControl=null;this._clickCount=this._lastMouseTime=this._lastMouseY=this._lastMouseX=0;this._clickTime=
250;this._clickDist=5;this._isMouseDown=!1;this._doubleClickSelection=null;this._vScroll=this._hScroll=0;this._imeOffset=-1;this._createActions();this._createView()},_checkOverlayScroll:function(){if(e.isMac&&e.isWebkit&&!this._metrics.invalid&&0===this._metrics.scrollWidth){var a=this._viewDiv,c=this._isOverOverlayScroll();a.style.pointerEvents=c.vertical||c.horizontal?"":"none"}},_isOverOverlayScroll:function(){if(!(200>(new Date).getTime()-this._lastScrollTime))return{};var a=this._viewDiv.getBoundingClientRect(),
c=this._lastMouseMoveX,b=this._lastMouseMoveY;return{vertical:a.top<=b&&b<a.bottom&&a.right-15<=c&&c<a.right,horizontal:a.bottom-15<=b&&b<a.bottom&&a.left<=c&&c<a.right}},_modifyContent:function(a,c){if(this._readonly&&!a._code)return!1;a.type="Verify";this.onVerify(a);if(null===a.text||void 0===a.text)return!1;var b=this._model;try{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!0),b.setText(a.text,a.start,a.end)}finally{a._ignoreDOMSelection&&(this._ignoreDOMSelection=!1)}if(c){b=this._getSelection();
b.setCaret(a.start+a.text.length);try{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!0),this._setSelection(b,!0)}finally{a._ignoreDOMSelection1&&(this._ignoreDOMSelection=!1)}}this.onModify({type:"Modify"});return!0},_onModelChanged:function(a){a.type="ModelChanged";this.onModelChanged(a);a.type="Changed";var c=a.start,b=a.addedCharCount,h=a.removedCharCount,n=a.addedLineCount,m=a.removedLineCount,d=this._getSelection();d.end>c&&(d.end>c&&d.start<c+h?d.setCaret(c+b):(d.start+=b-h,d.end+=b-h),
this._setSelection(d,!1,!1));c=this._model.getLineAtOffset(c);for(b=this._getLineNext();b;)h=b.lineIndex,c<=h&&h<=c+m&&(c===h&&!b.modelChangedEvent&&!b.lineRemoved?(b.modelChangedEvent=a,b.lineChanged=!0):(b.lineRemoved=!0,b.lineChanged=!1,b.modelChangedEvent=null)),h>c+m&&(b.lineIndex=h+n-m,b._line.lineIndex=b.lineIndex),b=this._getLineNext(b);this._lineHeight&&(a=[c,m].concat(Array(n)),Array.prototype.splice.apply(this._lineHeight,a));!this._wrapMode&&(c<=this._maxLineIndex&&this._maxLineIndex<=
c+m)&&(this._checkMaxLineIndex=this._maxLineIndex,this._maxLineIndex=-1,this._maxLineWidth=0);this._update()},_onModelChanging:function(a){a.type="ModelChanging";this.onModelChanging(a);a.type="Changing"},_queueUpdate:function(){if(!this._updateTimer&&!this._ignoreQueueUpdate){var a=this;this._updateTimer=this._getWindow().setTimeout(function(){a._updateTimer=null;a._update()},0)}},_resetLineHeight:function(a,c){if(this._wrapMode||this._variableLineHeight){if(void 0!==a&&void 0!==c)for(var b=a;b<
c;b++)this._lineHeight[b]=void 0;else b=this._model.getLineCount(),this._lineHeight=Array(b);this._calculateLineHeightTimer()}else this._lineHeight=null},_resetLineWidth:function(){var a=this._clientDiv;if(a)for(a=a.firstChild;a;)a.lineWidth=void 0,a=a.nextSibling},_reset:function(){this._maxLineIndex=-1;this._maxLineWidth=0;this._columnX=-1;this._bottomChild=this._topChild=null;this._topIndexY=0;this._variableLineHeight=!1;this._resetLineHeight();this._setSelection(new s(0,0,!1),!1,!1);this._viewDiv&&
(this._viewDiv.scrollLeft=0,this._viewDiv.scrollTop=0);var a=this._clientDiv;if(a){for(a=a.firstChild;a;)a.lineRemoved=!0,a=a.nextSibling;13>e.isFirefox&&this._fixCaret()}},_scrollViewAnimated:function(a,c,b){var h=this._getWindow();if(b&&this._scrollAnimation){var n=this;this._animation=new C({window:h,duration:this._scrollAnimation,curve:[c,0],onAnimate:function(a){a=c-Math.floor(a);n._scrollView(0,a);c-=a},onEnd:function(){n._animation=null;n._scrollView(a,c);b&&h.setTimeout(b,0)}});this._animation.play()}else this._scrollView(a,
c),b&&h.setTimeout(b,0)},_scrollView:function(a,c){this._ensureCaretVisible=!1;var b=this._viewDiv;a&&(b.scrollLeft+=a);c&&(b.scrollTop+=c)},_setClipboardText:function(a,b){var h,n=this._getWindow(),m=n.clipboardData;!m&&b&&(m=b.clipboardData);if(m&&(h=[],c(a,function(a){h.push(a)},function(){h.push(e.platformDelimiter)}),m.setData(e.isIE?"Text":"text/plain",h.join(""))||21<e.isFirefox))return!0;var d=this._parent.ownerDocument,s=e.createElement(d,"pre");s.style.position="fixed";s.style.left="-1000px";
c(a,function(a){s.appendChild(d.createTextNode(a))},function(){s.appendChild(e.createElement(d,"br"))});s.appendChild(d.createTextNode(" "));this._clientDiv.appendChild(s);m=d.createRange();m.setStart(s.firstChild,0);m.setEndBefore(s.lastChild);var f=n.getSelection();0<f.rangeCount&&f.removeAllRanges();f.addRange(m);var g=this,m=function(){s&&s.parentNode===g._clientDiv&&g._clientDiv.removeChild(s);g._updateDOMSelection()},f=!1;this._ignoreCopy=!0;try{f=d.execCommand("copy",!1,null)}catch(v){}this._ignoreCopy=
!1;if(!f&&b)return n.setTimeout(m,0),!1;m();return!0},_setDOMSelection:function(a,c,b,h,n){this._setDOMFullSelection(a,c,b,h);a=a._line.getNodeOffset(c);b=b._line.getNodeOffset(h);h=this._getWindow();c=this._parent.ownerDocument;if(h.getSelection){var m=h.getSelection();h=c.createRange();h.setStart(a.node,a.offset);h.setEnd(b.node,b.offset);if(this._hasFocus&&(m.anchorNode!==a.node||m.anchorOffset!==a.offset||m.focusNode!==b.node||m.focusOffset!==b.offset||m.anchorNode!==b.node||m.anchorOffset!==
b.offset||m.focusNode!==a.node||m.focusOffset!==a.offset))this._anchorNode=a.node,this._anchorOffset=a.offset,this._focusNode=b.node,this._focusOffset=b.offset,this._ignoreSelect=!1,0<m.rangeCount&&m.removeAllRanges(),m.addRange(h),this._ignoreSelect=!0;this._cursorDiv&&(h=c.createRange(),n?(h.setStart(a.node,a.offset),h.setEnd(a.node,a.offset)):(h.setStart(b.node,b.offset),h.setEnd(b.node,b.offset)),n=h.getClientRects()[0],a=this._cursorDiv.parentNode,b=a.getBoundingClientRect(),n&&b&&(this._cursorDiv.style.top=
n.top-b.top+a.scrollTop+"px",this._cursorDiv.style.left=n.left-b.left+a.scrollLeft+"px"))}else c.selection&&this._hasFocus&&(n=c.body,h=e.createElement(c,"div"),n.appendChild(h),n.removeChild(h),h=n.createTextRange(),h.moveToElementText(a.node.parentNode),h.moveStart("character",a.offset),n=n.createTextRange(),n.moveToElementText(b.node.parentNode),n.moveStart("character",b.offset),h.setEndPoint("EndToStart",n),this._ignoreSelect=!1,h.select(),this._ignoreSelect=!0)},_setDOMFullSelection:function(a,
c,b,h){if(this._selDiv1){var n=this._selDiv1;n.style.width="0px";n.style.height="0px";n=this._selDiv2;n.style.width="0px";n.style.height="0px";n=this._selDiv3;n.style.width="0px";n.style.height="0px";if(!(a===b&&c===h)){var m=this._getViewPadding(),d=this._clientDiv.getBoundingClientRect(),s=this._viewDiv.getBoundingClientRect(),n=s.left+m.left,e=d.right,m=s.top+m.top,f=d.bottom,s=d=0;this._clipDiv?(s=this._clipDiv.getBoundingClientRect(),d=s.left-this._clipDiv.scrollLeft):(s=this._rootDiv.getBoundingClientRect(),
d=s.left);s=s.top;this._ignoreDOMSelection=!0;var g=(new x(this,a.lineIndex,a)).getBoundingClientRect(c,!1),v=g.left;c=(new x(this,b.lineIndex,b)).getBoundingClientRect(h,!1);var q=c.left;this._ignoreDOMSelection=!1;var k=this._selDiv1,v=Math.min(e,Math.max(n,v)),w=Math.min(f,Math.max(m,g.top)),p=e;h=Math.min(f,Math.max(m,g.bottom));k.style.left=v-d+"px";k.style.top=w-s+"px";k.style.width=Math.max(0,p-v)+"px";k.style.height=Math.max(0,h-w)+"px";a.lineIndex===b.lineIndex?(p=Math.min(q,e),k.style.width=
Math.max(0,p-v)+"px"):(g=Math.min(f,Math.max(m,c.top)),q=Math.min(e,Math.max(n,q)),m=Math.min(f,Math.max(m,c.bottom)),f=this._selDiv3,f.style.left=n-d+"px",f.style.top=g-s+"px",f.style.width=Math.max(0,q-n)+"px",f.style.height=Math.max(0,m-g)+"px",1<Math.abs(a.lineIndex-b.lineIndex)&&(a=this._selDiv2,a.style.left=n-d+"px",a.style.top=h-s+"px",a.style.width=Math.max(0,e-n)+"px",a.style.height=Math.max(0,g-h)+"px"))}}},_setGrab:function(a){a!==this._grabControl&&(a?(a.setCapture&&a.setCapture(),this._grabControl=
a):(this._grabControl.releaseCapture&&this._grabControl.releaseCapture(),this._grabControl=null))},_setLinksVisible:function(a){if(this._linksVisible!==a){this._linksVisible=a;e.isIE&&a&&(this._hadFocus=this._hasFocus);var c=this._clientDiv;c.contentEditable=!a;this._hadFocus&&!a&&c.focus();this._overlayDiv&&(this._overlayDiv.style.zIndex=a?"-1":"1");for(a=this._getLineNext();a;)a._line.updateLinks(),a=this._getLineNext(a);this._updateDOMSelection()}},_setSelection:function(a,c,b,h,n){if(a){this._columnX=
-1;void 0===b&&(b=!0);var m=this._selection;this._selection=a;!1!==c&&this._showCaret(!1,h,c,n);b&&this._updateDOMSelection();if(!m.equals(a))this.onSelection({type:"Selection",oldValue:{start:m.start,end:m.end},newValue:{start:a.start,end:a.end}})}},_setSelectionTo:function(a,c,b,h){var n=this._model,m=this._getSelection();c=this.convert({x:a,y:c},"page","document");a=this._getLineIndex(c.y);if(1===this._clickCount){n=this._getLine(a);a=n.getOffset(c.x,c.y-this._getLinePixel(a));n.destroy();if(h&&
!b&&m.start<=a&&a<m.end)return this._dragOffset=a,!1;m.extend(a);b||m.collapse()}else 0===(this._clickCount&1)?(n=this._getLine(a),a=n.getOffset(c.x,c.y-this._getLinePixel(a)),this._doubleClickSelection?a>=this._doubleClickSelection.start?(b=this._doubleClickSelection.start,h=n.getNextOffset(a,{unit:"wordend",count:1})):(b=n.getNextOffset(a,{unit:"word",count:-1}),h=this._doubleClickSelection.end):(b=n.getNextOffset(a,{unit:"word",count:-1}),h=n.getNextOffset(b,{unit:"wordend",count:1})),n.destroy()):
this._doubleClickSelection?(h=n.getLineAtOffset(this._doubleClickSelection.start),a>=h?(b=n.getLineStart(h),h=n.getLineEnd(a)):(b=n.getLineStart(a),h=n.getLineEnd(h))):(b=n.getLineStart(a),h=n.getLineEnd(a)),m.setCaret(b),m.extend(h);this._setSelection(m,!0,!0);return!0},_setFullSelection:function(a,c){this._fullSelection=a;e.isWebkit&&(this._fullSelection=!0);var b=this._clipDiv||this._rootDiv;if(b)if(this._fullSelection){if(!this._selDiv1&&this._fullSelection&&!e.isIOS){var h=b.ownerDocument;this._highlightRGB=
e.isWebkit?"transparent":"Highlight";var n=e.createElement(h,"div");this._selDiv1=n;n.style.position="absolute";n.style.borderWidth="0px";n.style.margin="0px";n.style.padding="0px";n.style.outline="none";n.style.background=this._highlightRGB;n.style.width="0px";n.style.height="0px";n.style.zIndex="0";b.appendChild(n);var m=e.createElement(h,"div");this._selDiv2=m;m.style.position="absolute";m.style.borderWidth="0px";m.style.margin="0px";m.style.padding="0px";m.style.outline="none";m.style.background=
this._highlightRGB;m.style.width="0px";m.style.height="0px";m.style.zIndex="0";b.appendChild(m);this._selDiv3=h=e.createElement(h,"div");h.style.position="absolute";h.style.borderWidth="0px";h.style.margin="0px";h.style.padding="0px";h.style.outline="none";h.style.background=this._highlightRGB;h.style.width="0px";h.style.height="0px";h.style.zIndex="0";b.appendChild(h);if(e.isFirefox&&e.isMac){b=this._getWindow().getComputedStyle(h,null).getPropertyValue("background-color");switch(b){case "rgb(119, 141, 168)":b=
"rgb(199, 208, 218)";break;case "rgb(127, 127, 127)":b="rgb(198, 198, 198)";break;case "rgb(255, 193, 31)":b="rgb(250, 236, 115)";break;case "rgb(243, 70, 72)":b="rgb(255, 176, 139)";break;case "rgb(255, 138, 34)":b="rgb(255, 209, 129)";break;case "rgb(102, 197, 71)":b="rgb(194, 249, 144)";break;case "rgb(140, 78, 184)":b="rgb(232, 184, 255)";break;default:b="rgb(180, 213, 255)"}this._highlightRGB=b;n.style.background=b;m.style.background=b;h.style.background=b}c||this._updateDOMSelection()}}else this._selDiv1&&
(b.removeChild(this._selDiv1),this._selDiv1=null),this._selDiv2&&(b.removeChild(this._selDiv2),this._selDiv2=null),this._selDiv3&&(b.removeChild(this._selDiv3),this._selDiv3=null)},_setBlockCursor:function(a){this._blockCursorVisible=a;this._updateBlockCursorVisible()},_setOverwriteMode:function(a){this._overwriteMode=a;this._updateBlockCursorVisible()},_updateBlockCursorVisible:function(){if(this._blockCursorVisible||this._overwriteMode){if(!this._cursorDiv){var a=this._viewDiv,c=e.createElement(a.ownerDocument,
"div");c.className="textviewBlockCursor";this._cursorDiv=c;c.tabIndex=-1;c.style.zIndex="2";c.style.color="transparent";c.style.position="absolute";c.style.pointerEvents="none";c.innerHTML="\x26nbsp;";a.appendChild(c);this._updateDOMSelection()}}else this._cursorDiv&&(this._cursorDiv.parentNode.removeChild(this._cursorDiv),this._cursorDiv=null)},_setMarginOffset:function(a,c){this._marginOffset=a;this._marginDiv.style.display=a?"block":"none";c||(this._metrics=this._calculateMetrics(),this._queueUpdate())},
_setWrapOffset:function(a,c){this._wrapOffset=a;c||(this._metrics=this._calculateMetrics(),this._queueUpdate())},_setReadOnly:function(a){this._readonly=a;this._clientDiv.setAttribute("aria-readonly",a?"true":"false")},_setSingleMode:function(a,c){this._singleMode=a;this._updateOverflow();this._updateStyle(c)},_setNoScroll:function(a,c){this._noScroll=a;this._updateOverflow();this._updateStyle(c)},_setTabSize:function(a,c){this._tabSize=a;this._customTabSize=void 0;var b=this._clientDiv;e.isOpera?
b&&(b.style.OTabSize=this._tabSize+""):537.1<=e.isWebkit?b&&(b.style.tabSize=this._tabSize+""):4<=e.isFirefox?b&&(b.style.MozTabSize=this._tabSize+""):8!==this._tabSize&&(this._customTabSize=this._tabSize);c||(this.redrawLines(),this._resetLineWidth())},_setTheme:function(a){this._theme&&this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);(this._theme=a)&&this._theme.addEventListener("ThemeChanged",this._themeListener.onChanged);this._setThemeClass(this._themeClass)},_setThemeClass:function(a,
c){this._themeClass=a;var b="textview",h=this._theme.getThemeClass();h&&(b+=" "+h);this._themeClass&&h!==this._themeClass&&(b+=" "+this._themeClass);this._rootDiv.className=b;this._updateStyle(c)},_setWrapMode:function(a,c){this._wrapMode=a&&this._wrappable;var b=this._clientDiv;this._wrapMode?(b.style.whiteSpace="pre-wrap",b.style.wordWrap="break-word"):(b.style.whiteSpace="pre",b.style.wordWrap="normal");this._updateOverflow();c||(this.redraw(),this._resetLineWidth());this._resetLineHeight()},_showCaret:function(a,
c,b,h){if(this._clientDiv&&!(0<this._redrawCount)&&!this._ignoreDOMSelection){var n=this._model,m=this._getSelection(),d=this._getScroll(),s=m.getCaret(),e=m.start,f=m.end,g=n.getLineAtOffset(e),v=n.getLineAtOffset(f),q=Math.max(Math.max(e,n.getLineStart(v)),f-1),n=this._getClientWidth(),k=this._getClientHeight(),x=n/4,w=this._getBoundsAtOffset(s===e?e:q),p=w.left,y=w.right,r=w.top,z=w.bottom,t=0,C="object"===typeof b;if((a||C)&&!m.isEmpty())w=this._getBoundsAtOffset(s===f?e:q),t=(w.bottom>z?w.bottom:
z)-(w.top<r?w.top:r),a&&(w.top===r?s===e?y=p+Math.min(w.right-p,n):p=y-Math.min(y-w.left,n):s===e?z=r+Math.min(w.bottom-r,k):r=z-Math.min(z-w.top,k));a=0;p<d.x&&(a=Math.min(p-d.x,-x));y>d.x+n&&(a=Math.max(y-d.x-n,x));m=0;r<d.y?m=r-d.y:z>d.y+k&&(m=z-d.y-k);h&&(0<h?0<m&&(m=Math.max(m,h)):0>m&&(m=Math.min(m,h)));h=C&&"always"===b.scrollPolicy;if(0!==a||0!==m||h)return C?(h=0<m,0===m&&(m=r-d.y),d=b.viewAnchor,r=b.selectionAnchor,b=Math.min(Math.max(0,b.viewAnchorOffset||0)),m="top"===d?m+Math.floor(h?
(1-b)*k:-b*k):"bottom"===d?m+Math.floor(h?b*k:-(1-b)*k):"center"===d?m+Math.floor(h?k/2+b*k:k/2-(1-b)*k):m+Math.floor(h?b*k:-b*k),g!==v&&("top"===r&&s!==e?m+=Math.floor(-t):"bottom"===r&&s!==f?m+=Math.floor(t):"center"===r&&(m+=Math.floor(t/2)))):0!==m&&"number"===typeof b&&(0>b&&(b=0),1<b&&(b=1),m+=Math.floor(0<m?b*k:-b*k)),this._scrollViewAnimated(a,m,c),k!==this._getClientHeight()||n!==this._getClientWidth()?this._showCaret():this._ensureCaretVisible=!0,!0;c&&c();return!1}},_startIME:function(){if(-1===
this._imeOffset){var a=this._getSelection();a.isEmpty()||this._modifyContent({text:"",start:a.start,end:a.end},!0);this._imeOffset=a.start}},_unhookEvents:function(){this._model.removeEventListener("preChanging",this._modelListener.onChanging);this._model.removeEventListener("postChanged",this._modelListener.onChanged);this._theme.removeEventListener("ThemeChanged",this._themeListener.onChanged);this._modelListener=null;for(var a=0;a<this._handlers.length;a++){var c=this._handlers[a];z(c.target,c.type,
c.handler)}this._handlers=null;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null)},_updateDOMSelection:function(){if(!(0<this._redrawCount)&&!this._ignoreDOMSelection&&this._clientDiv){var a=this._getSelection(),c=this._model,b=c.getLineAtOffset(a.start),h=c.getLineAtOffset(a.end),n=this._getLineNext();if(n){var m=this._getLinePrevious(),d;b<n.lineIndex?(b=n,d=c.getLineStart(n.lineIndex)):b>m.lineIndex?(b=m,d=c.getLineStart(m.lineIndex)):(b=this._getLineNode(b),
d=a.start);h<n.lineIndex?(h=n,c=c.getLineStart(n.lineIndex)):h>m.lineIndex?(h=m,c=c.getLineStart(m.lineIndex)):(h=this._getLineNode(h),c=a.end);this._setDOMSelection(b,d,h,c,a.caret)}}},_update:function(a){if(!(0<this._redrawCount)){this._updateTimer&&(this._getWindow().clearTimeout(this._updateTimer),this._updateTimer=null,a=!1);var c=this._clientDiv,b=this._viewDiv;if(c){this._metrics.invalid&&(this._ignoreQueueUpdate=!0,this._updateStyle(),this._ignoreQueueUpdate=!1);var h=this._model,n=this._getScroll(!1),
m=this._getViewPadding(),d=h.getLineCount(),s=this._getLineHeight(),f=!1,g=!1,v=!1,q=this._metrics.scrollWidth;this._wrapMode&&(c.style.width=(this._metrics.wrapWidth||this._getClientWidth())+"px");var k,w,p,y,r=0,z=0,t;if(this._lineHeight){for(;z<d;){t=this._getLineHeight(z);if(r+t>n.y)break;r+=t;z++}k=z;w=Math.max(0,k-1);p=h=n.y-r;0<k&&(h+=this._getLineHeight(k-1))}else y=Math.max(0,n.y)/s,k=Math.floor(y),w=Math.max(0,k-1),h=Math.round((y-w)*s),p=Math.round((y-k)*s);this._topIndexY=p;y=this._rootDiv;
var C=y.clientWidth,J=y.clientHeight;if(a){s=0;this._leftDiv&&(k=this._leftDiv.getBoundingClientRect(),s=k.right-k.left);k=this._getClientWidth();y=this._getClientHeight();g=k;this._wrapMode?this._metrics.wrapWidth&&(g=this._metrics.wrapWidth):g=Math.max(this._maxLineWidth,g);for(;z<d;)t=this._getLineHeight(z,!1),r+=t,z++;d=r}else{y=this._getClientHeight();p=Math.min(k+Math.floor((y+p)/s),d-1);var n=Math.min(p+1,d-1),E;for(t=c.firstChild;t;){E=t.lineIndex;var F=t.nextSibling;if(!(w<=E&&E<=n)||t.lineRemoved||
-1===t.lineIndex)this._mouseWheelLine===t?(t.style.display="none",t.lineIndex=-1):c.removeChild(t);t=F}t=this._getLineNext();var F=b.ownerDocument,I=F.createDocumentFragment();for(E=w;E<=n;E++)!t||t.lineIndex>E?(new x(this,E)).create(I,null):(I.firstChild&&(c.insertBefore(I,t),I=F.createDocumentFragment()),t&&t.lineChanged&&(t=(new x(this,E)).create(I,t),t.lineChanged=!1),t=this._getLineNext(t));I.firstChild&&c.insertBefore(I,t);e.isWebkit&&!this._wrapMode&&(c.style.width="0x7fffffffpx");t=this._getLineNext();
E=y+h;for(I=!1;t;)w=t.lineWidth,void 0===w&&(F=t._line.getBoundingClientRect(),w=t.lineWidth=Math.ceil(F.right-F.left),F=F.bottom-F.top,this._lineHeight?this._lineHeight[t.lineIndex]=F:0!==s&&(0!==F&&Math.ceil(s)!==Math.ceil(F))&&(this._variableLineHeight=!0,this._lineHeight=[],this._lineHeight[t.lineIndex]=F)),this._lineHeight&&!I&&(E-=this._lineHeight[t.lineIndex],0>E&&(p=t.lineIndex,I=!0)),this._wrapMode||(w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=t.lineIndex),this._checkMaxLineIndex===
t.lineIndex&&(this._checkMaxLineIndex=-1)),t.lineIndex===k&&(this._topChild=t),t.lineIndex===p&&(this._bottomChild=t),t=this._getLineNext(t);-1!==this._checkMaxLineIndex&&(E=this._checkMaxLineIndex,this._checkMaxLineIndex=-1,0<=E&&E<d&&(s=new x(this,E),F=s.getBoundingClientRect(),w=F.right-F.left,w>=this._maxLineWidth&&(this._maxLineWidth=w,this._maxLineIndex=E),s.destroy()));for(;z<d;)t=this._getLineHeight(z,z<=p),r+=t,z++;d=r;this._updateRuler(this._leftDiv,k,n,J);this._updateRuler(this._rightDiv,
k,n,J);this._updateRuler(this._innerRightDiv,k,n,J);this._updateRuler(this._marginDiv,k,n,J);s=0;this._leftDiv&&(k=this._leftDiv.getBoundingClientRect(),s=k.right-k.left);r=0;this._rightDiv&&(n=this._rightDiv.getBoundingClientRect(),r=n.right-n.left);b.style.left=s+"px";b.style.right=r+"px";n=this._scrollDiv;n.style.height=d+"px";k=this._getClientWidth();!this._singleMode&&(!this._wrapMode&&!this._noScroll)&&(z=f=y,(p="scroll"===b.style.overflowX)?f+=q:z-=q,w=t=k,(E="scroll"===b.style.overflowY)?
t+=q:w-=q,y=f,k=t,d>y&&(v=!0,k=w),this._maxLineWidth>k&&(g=!0,y=z,d>y&&(v=!0,k=w)),p!==g&&(b.style.overflowX=g?"scroll":"hidden"),E!==v&&(b.style.overflowY=v?"scroll":"hidden"),f=p!==g||E!==v);v=k;this._wrapMode?this._metrics.wrapWidth&&(v=this._metrics.wrapWidth):v=Math.max(this._maxLineWidth+this._getInnerRightWidth(),v);g=v;if((!e.isIE||9<=e.isIE)&&this._maxLineWidth>k)v+=m.right+m.left;n.style.width=v+"px";this._clipScrollDiv&&(this._clipScrollDiv.style.width=v+"px");n=this._getScroll(!1);if(v=
this._innerRightDiv)v.style.right=r+("scroll"===b.style.overflowY?this._metrics.scrollWidth:0)+"px",v.style.bottom=("scroll"===b.style.overflowX?q:0)+"px"}this._scrollHeight=d;this._vScrollDiv&&(v=y-8,r=Math.max(15,Math.ceil(Math.min(1,v/(d+m.top+m.bottom))*v)),this._vScrollDiv.style.left=s+k-8+"px",this._vScrollDiv.style.top=Math.floor(Math.max(0,n.y*v/d))+"px",this._vScrollDiv.style.height=r+"px");!this._wrapMode&&this._hScrollDiv&&(v=k-8,r=Math.max(15,Math.ceil(Math.min(1,v/(this._maxLineWidth+
m.left+m.right))*v)),this._hScrollDiv.style.left=s+Math.floor(Math.max(0,Math.floor(n.x*v/this._maxLineWidth)))+"px",this._hScrollDiv.style.top=y-9+"px",this._hScrollDiv.style.width=r+"px");z=n.x;r=this._clipDiv;v=this._overlayDiv;if(p=this._marginDiv)p.style.left=-z+s+this._metrics.marginWidth+m.left+"px",p.style.bottom=("scroll"===b.style.overflowX?q:0)+"px";r?(r.scrollLeft=z,r.scrollTop=0,b=s+m.left,q=m.top,a=k,s=y,z=0,p=-h,0===n.x&&(b-=m.left,a+=m.left,z=m.left),n.x+k===g&&(a+=m.right),0===n.y&&
(q-=m.top,s+=m.top,p+=m.top),n.y+y===d&&(s+=m.bottom),r.style.left=b+"px",r.style.top=q+"px",r.style.right=C-a-b+"px",r.style.bottom=J-s-q+"px",c.style.left=z+"px",c.style.top=p+"px",c.style.width=g+"px",c.style.height=y+h+"px",v&&(v.style.left=c.style.left,v.style.top=c.style.top,v.style.width=c.style.width,v.style.height=c.style.height)):(b=z,q=h,C=z+k,J=h+y,0===b&&(b-=m.left),0===q&&(q-=m.top),C===g&&(C+=m.right),n.y+y===d&&(J+=m.bottom),c.style.clip="rect("+q+"px,"+C+"px,"+J+"px,"+b+"px)",c.style.left=
-z+s+m.left+"px",c.style.width=(this._wrapMode||e.isWebkit?g:k+z)+"px",a||(c.style.top=-h+m.top+"px",c.style.height=y+h+"px"),v&&(v.style.clip=c.style.clip,v.style.left=c.style.left,v.style.width=c.style.width,a||(v.style.top=c.style.top,v.style.height=c.style.height)));this._updateDOMSelection();f&&(c=this._ensureCaretVisible,this._ensureCaretVisible=!1,c&&this._showCaret(),this._queueUpdate())}}},_updateOverflow:function(){var a=this._viewDiv;this._noScroll?a.style.overflow="hidden":this._wrapMode?
(a.style.overflowX="hidden",a.style.overflowY="scroll"):a.style.overflow="hidden"},_updateRuler:function(a,c,b,h){if(a)for(var n=this._parent.ownerDocument,m=this._getLineHeight(),d=this._getViewPadding(),s=a.firstChild;s;){var f=s._ruler,g=f.getOverview();s.rulerChanged&&(q(f.getRulerStyle(),s),a.rulerWidth=void 0);if("fixed"!==g){var v=m;"page"===g&&(v+=this._topIndexY);s.style.top=-v+"px";s.style.height=h+v+"px";var k,x=s.firstChild;x?(k=x,x=x.nextSibling):(k=e.createElement(n,"div"),k.style.visibility=
"hidden",s.appendChild(k));var w;if(s.rulerChanged&&k){v=-1;if(w=f.getWidestAnnotation())q(w.style,k),w.html&&(k.innerHTML=w.html);k.lineIndex=v;k.style.height=m+d.top+"px"}var p;if("page"===g){for(f=f.getAnnotations(c,b+1);x;)v=x.lineIndex,w=x.nextSibling,(!(c<=v&&v<=b)||x.lineChanged)&&s.removeChild(x),x=w;x=s.firstChild.nextSibling;p=n.createDocumentFragment();for(v=c;v<=b;v++)if(!x||x.lineIndex>v){k=e.createElement(n,"div");if(w=f[v])q(w.style,k),w.html&&(k.innerHTML=w.html),k.annotation=w;k.lineIndex=
v;k.style.height=this._getLineHeight(v)+"px";p.appendChild(k)}else p.firstChild&&(s.insertBefore(p,x),p=n.createDocumentFragment()),x&&(x=x.nextSibling);p.firstChild&&s.insertBefore(p,x)}else{w=this._getClientHeight();v=this._model.getLineCount();x=w+d.top+d.bottom-2*this._metrics.scrollWidth;g=m*v<x?m:x/v;if(s.rulerChanged){for(w=s.childNodes.length;1<w;)s.removeChild(s.lastChild),w--;f=f.getAnnotations(0,v);p=n.createDocumentFragment();for(var y in f)v=y>>>0,0>v||(k=e.createElement(n,"div"),w=f[y],
q(w.style,k),k.style.position="absolute",k.style.top=this._metrics.scrollWidth+m+Math.floor(v*g)+"px",w.html&&(k.innerHTML=w.html),k.annotation=w,k.lineIndex=v,p.appendChild(k));s.appendChild(p)}else if(s._oldTrackHeight!==x)for(k=s.firstChild?s.firstChild.nextSibling:null;k;)k.style.top=this._metrics.scrollWidth+m+Math.floor(k.lineIndex*g)+"px",k=k.nextSibling;s._oldTrackHeight=x}}s.rulerChanged=!1;s=s.nextSibling}},_updateStyleSheet:function(){var a="";e.isWebkit&&0<this._metrics.scrollWidth&&(a+=
"\n.textview ::-webkit-scrollbar-corner {background: #eeeeee;}");e.isFirefox&&(e.isMac&&this._highlightRGB&&"Highlight"!==this._highlightRGB)&&(a+="\n.textview ::-moz-selection {background: "+this._highlightRGB+";}");if(a){var c=this._clientDiv.ownerDocument,b=c.getElementById("_textviewStyle");if(b)b.removeChild(b.firstChild),b.appendChild(c.createTextNode(a));else{b=e.createElement(c,"style");b.id="_textviewStyle";var h=c.getElementsByTagName("head")[0]||c.documentElement;b.appendChild(c.createTextNode(a));
h.insertBefore(b,h.firstChild)}}},_updateStyle:function(a){!a&&e.isIE&&(this._rootDiv.style.lineHeight="normal");var c=this._metrics=this._calculateMetrics();this._variableLineHeight&&(this._variableLineHeight=!1,this._resetLineHeight());this._rootDiv.style.lineHeight=e.isIE?c.lineHeight-(c.lineTrim.top+c.lineTrim.bottom)+"px":"normal";this._updateStyleSheet();if(e.isMac&&e.isWebkit){var b=this._viewDiv;!c.invalid&&0===c.scrollWidth?(b.style.pointerEvents="none",b.style.zIndex="2"):(b.style.pointerEvents=
"",b.style.zIndex="")}a||(this.redraw(),this._resetLineWidth())}};k.EventTarget.addMixin(w.prototype);return{TextView:w}});
define("orion/editor/projectionTextModel",["orion/editor/textModel","orion/editor/eventTarget"],function(p,t){function r(k){this._model=k;this._projections=[];var f=this;this._listener={onChanged:function(g){f._onChanged(g)},onChanging:function(g){f._onChanging(g)}};k.addEventListener("postChanged",this._listener.onChanged);k.addEventListener("preChanging",this._listener.onChanging)}r.prototype={destroy:function(){this._model&&(this._model.removeEventListener("postChanged",this._listener.onChanged),
this._model.removeEventListener("preChanging",this._listener.onChanging),this._model=null)},addProjection:function(k){if(k){var f=this._model,g=this._projections;k._lineIndex=f.getLineAtOffset(k.start);k._lineCount=f.getLineAtOffset(k.end)-k._lineIndex;var e=k.text;e||(e="");k._model="string"===typeof e?new p.TextModel(e,f.getLineDelimiter()):e;var f=this.mapOffset(k.start,!0),e=k.end-k.start,q=k._lineCount,d=k._model.getCharCount(),b=k._model.getLineCount()-1,a={type:"Changing",text:k._model.getText(),
start:f,removedCharCount:e,addedCharCount:d,removedLineCount:q,addedLineCount:b};this.onChanging(a);a=this._binarySearch(g,k.start);g.splice(a,0,k);this.onChanged({type:"Changed",start:f,removedCharCount:e,addedCharCount:d,removedLineCount:q,addedLineCount:b})}},getProjections:function(){return this._projections.slice(0)},getBaseModel:function(){return this._model},mapOffset:function(k,f){var g=this._projections,e=0,q,d;if(f){for(q=0;q<g.length;q++){d=g[q];if(d.start>k)break;if(d.end>k)return-1;e+=
d._model.getCharCount()-(d.end-d.start)}return k+e}for(q=0;q<g.length;q++){d=g[q];if(d.start>k-e)break;var b=d._model.getCharCount();if(d.start+b>k-e)return-1;e+=b-(d.end-d.start)}return k-e},removeProjection:function(k){this._removeProjection(k)},_removeProjection:function(k,f){var g,e=0;for(g=0;g<this._projections.length;g++){var q=this._projections[g];if(q===k){k=q;break}e+=q._model.getCharCount()-(q.end-q.start)}if(g<this._projections.length){var q=this._model,e=k.start+e,d=k.end-k.start,b=k._lineCount,
a=k._model.getCharCount(),c=k._model.getLineCount()-1;f||(q={type:"Changing",text:q.getText(k.start,k.end),start:e,removedCharCount:a,addedCharCount:d,removedLineCount:c,addedLineCount:b},this.onChanging(q));this._projections.splice(g,1);if(!f)this.onChanged({type:"Changed",start:e,removedCharCount:a,addedCharCount:d,removedLineCount:c,addedLineCount:b})}},_binarySearch:function(k,f){for(var g=k.length,e=-1,q;1<g-e;)q=Math.floor((g+e)/2),f<=k[q].start?g=q:e=q;return g},getCharCount:function(){for(var k=
this._model.getCharCount(),f=this._projections,g=0;g<f.length;g++)var e=f[g],k=k+(e._model.getCharCount()-(e.end-e.start));return k},getLine:function(k,f){if(0>k)return null;var g=this._model,e=this._projections,q=0,d=[],b=0,a,c,m;for(a=0;a<e.length;a++){m=e[a];if(m._lineIndex>=k-q)break;c=m._model.getLineCount()-1;if(m._lineIndex+c>=k-q){b=k-(m._lineIndex+q);if(b<c)return m._model.getLine(b,f);d.push(m._model.getLine(c))}b=m.end;q+=c-m._lineCount}for(b=Math.max(b,g.getLineStart(k-q));a<e.length;a++){m=
e[a];if(m._lineIndex>k-q)break;d.push(g.getText(b,m.start));c=m._model.getLineCount()-1;if(m._lineIndex+c>k-q)return d.push(m._model.getLine(0,f)),d.join("");d.push(m._model.getText());b=m.end;q+=c-m._lineCount}e=g.getLineEnd(k-q,f);b<e&&d.push(g.getText(b,e));return d.join("")},getLineAtOffset:function(k){for(var f=this._model,g=this._projections,e=0,q=0,d=0;d<g.length;d++){var b=g[d];if(b.start>k-e)break;var a=b._model.getCharCount();if(b.start+a>k-e){g=k-(b.start+e);q+=b._model.getLineAtOffset(g);
e+=g;break}q+=b._model.getLineCount()-1-b._lineCount;e+=a-(b.end-b.start)}return f.getLineAtOffset(k-e)+q},getLineCount:function(){for(var k=this._projections,f=this._model.getLineCount(),g=0;g<k.length;g++)var e=k[g],f=f+(e._model.getLineCount()-1-e._lineCount);return f},getLineDelimiter:function(){return this._model.getLineDelimiter()},getLineEnd:function(k,f){if(0>k)return-1;for(var g=this._model,e=this._projections,q=0,d=0,b=0;b<e.length;b++){var a=e[b];if(a._lineIndex>k-q)break;var c=a._model.getLineCount()-
1;if(a._lineIndex+c>k-q)return a._model.getLineEnd(k-(a._lineIndex+q),f)+a.start+d;d+=a._model.getCharCount()-(a.end-a.start);q+=c-a._lineCount}return g.getLineEnd(k-q,f)+d},getLineStart:function(k){if(0>k)return-1;for(var f=this._model,g=this._projections,e=0,q=0,d=0;d<g.length;d++){var b=g[d];if(b._lineIndex>=k-e)break;var a=b._model.getLineCount()-1;if(b._lineIndex+a>=k-e)return b._model.getLineStart(k-(b._lineIndex+e))+b.start+q;q+=b._model.getCharCount()-(b.end-b.start);e+=a-b._lineCount}return f.getLineStart(k-
e)+q},getText:function(k,f){void 0===k&&(k=0);var g=this._model,e=this._projections,q=0,d=[],b,a,c;for(b=0;b<e.length;b++){a=e[b];if(a.start>k-q)break;c=a._model.getCharCount();if(a.start+c>k-q){if(void 0!==f&&a.start+c>f-q)return a._model.getText(k-(a.start+q),f-(a.start+q));d.push(a._model.getText(k-(a.start+q)));k=a.end+q+c-(a.end-a.start)}q+=c-(a.end-a.start)}var m=k-q;if(void 0!==f){for(;b<e.length;b++){a=e[b];if(a.start>f-q)break;d.push(g.getText(m,a.start));c=a._model.getCharCount();if(a.start+
c>f-q)return d.push(a._model.getText(0,f-(a.start+q))),d.join("");d.push(a._model.getText());m=a.end;q+=c-(a.end-a.start)}d.push(g.getText(m,f-q))}else{for(;b<e.length;b++)a=e[b],d.push(g.getText(m,a.start)),d.push(a._model.getText()),m=a.end;d.push(g.getText(m))}return d.join("")},_onChanged:function(k){k=this._change;var f=k.baseStart,g=k.baseEnd,e,q,d=this._projections;for(e=0;e<d.length&&!(q=d[e],q.end>f);e++);var b=e;for(e=0;e<d.length&&!(q=d[e],q.start>=g);e++);var a=e,c=this._model,f=k.baseText.length-
(g-f);for(e=a;e<d.length;e++)q=d[e],q.start+=f,q.end+=f,q._lineIndex=c.getLineAtOffset(q.start);q=d.splice(b,a-b);for(e=0;e<q.length;e++)q[e].annotation&&q[e].annotation._expand();this.onChanged({type:"Changed",start:k.start,removedCharCount:k.removedCharCount,addedCharCount:k.addedCharCount,removedLineCount:k.removedLineCount,addedLineCount:k.addedLineCount});this._change=void 0},_onChanging:function(k){var f=!!this._change,g=this._change||{},e=k.start,q=e+k.removedCharCount;g.baseStart=e;g.baseEnd=
q;g.baseText=k.text;g.addedLineCount=k.addedLineCount;if(!f){this._change=g;g.text=k.text;var d=this._projections,b,a,c;k=function(m){for(b=a=0;a<d.length;a++){c=d[a];if(c.start>m)break;if(c.end>m)return-1;b+=c._model.getCharCount()-(c.end-c.start)}return m+b};g.start=k(e);-1===g.start&&(g.text=this._model.getText(c.start,e)+g.text,g.addedLineCount+=this._model.getLineAtOffset(e)-this._model.getLineAtOffset(c.start),g.start=c.start+b);g.end=k(q);-1===g.end&&(g.text+=this._model.getText(q,c.end),g.addedLineCount+=
this._model.getLineAtOffset(c.end)-this._model.getLineAtOffset(q),g.end=c.start+b)}g.addedCharCount=g.text.length;g.removedCharCount=g.end-g.start;g.removedLineCount=this.getLineAtOffset(g.end)-this.getLineAtOffset(g.start);this.onChanging({type:"Changing",text:g.text,start:g.start,removedCharCount:g.removedCharCount,addedCharCount:g.addedCharCount,removedLineCount:g.removedLineCount,addedLineCount:g.addedLineCount})},onChanging:function(k){return this.dispatchEvent(k)},onChanged:function(k){return this.dispatchEvent(k)},
setLineDelimiter:function(k){this._model.setLineDelimiter(k)},setText:function(k,f,g){function e(c){for(d=b=0;b<q.length;b++){a=q[b];if(a.start>c-d)break;var h=a._model.getCharCount();if(a.start+h>c-d)return-1;d+=h-(a.end-a.start)}return c-d}this._change={text:k||"",start:f||0,end:void 0===g?this.getCharCount():g};var q=this._projections,d,b,a,c,m;k=e(this._change.start);-1===k&&(c={projection:a,start:this._change.start-(a.start+d)},k=a.end);f=e(this._change.end);-1===f&&(m={projection:a,end:this._change.end-
(a.start+d)},f=a.start);c&&m&&c.projection===m.projection?a._model.setText(this._change.text,c.start,m.end):(this._model.setText(this._change.text,k,f),c&&(a=c.projection,a._model.setText("",c.start)),m&&(a=m.projection,a._model.setText("",0,m.end),a.start=a.end,a._lineCount=0));this._change=void 0}};t.EventTarget.addMixin(r.prototype);return{ProjectionTextModel:r}});
define("orion/editor/annotations",["i18n!orion/editor/nls/messages","orion/editor/eventTarget"],function(p,t){function r(){}function k(a,c,b){this.start=a;this.end=c;this._projectionModel=b;this.html=this._expandedHTML;this.style=this._expandedStyle;this.expanded=!0}function f(a,c){var b=a.lastIndexOf("."),b=a.substring(b+1),n={title:p[b],style:{styleClass:"annotation "+b},html:"\x3cdiv class\x3d'annotationHTML "+b+"'\x3e\x3c/div\x3e",overviewStyle:{styleClass:"annotationOverview "+b}};c?n.lineStyle=
{styleClass:"annotationLine "+b}:n.rangeStyle={styleClass:"annotationRange "+b};r.registerType(a,n)}function g(){}function e(a,c,b,n,h){var s;void 0===n&&(n=-1);void 0===h&&(h=a.length);for(;1<h-n;)if(s=Math.floor((h+n)/2),c<=a[s].start)h=s;else if(b&&c<a[s].end){h=s;break}else n=s;return h}function q(a){this._annotations=[];var c=this;this._listener={onChanged:function(a){c._onChanged(a)}};this.setTextModel(a)}function d(a,c){this._view=a;this._annotationModel=c;var b=this;this._listener={onDestroy:function(a){b._onDestroy(a)},
onLineStyle:function(a){b._onLineStyle(a)},onChanged:function(a){b._onAnnotationModelChanged(a)}};a.addEventListener("Destroy",this._listener.onDestroy);a.addEventListener("postLineStyle",this._listener.onLineStyle);c.addEventListener("Changed",this._listener.onChanged)}k.prototype={_expandedHTML:"\x3cdiv class\x3d'annotationHTML expanded'\x3e\x3c/div\x3e",_expandedStyle:{styleClass:"annotation expanded"},_collapsedHTML:"\x3cdiv class\x3d'annotationHTML collapsed'\x3e\x3c/div\x3e",_collapsedStyle:{styleClass:"annotation collapsed"},
_collapse:function(){if(!this.expanded)return!1;this.expanded=!1;this.html=this._collapsedHTML;this.style=this._collapsedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_expand:function(){if(this.expanded)return!1;this.expanded=!0;this.html=this._expandedHTML;this.style=this._expandedStyle;this._annotationModel&&this._annotationModel.modifyAnnotation(this);return!0},_collapseImpl:function(a){if(this._collapse()){a&&this._forEachOverlaping(function(a){a.expanded||
(a._expandImpl(!1),a._recollapse=!0)});a=this._projectionModel;var c=a.getBaseModel();this._projection={annotation:this,start:c.getLineStart(c.getLineAtOffset(this.start)+1),end:c.getLineEnd(c.getLineAtOffset(this.end),!0)};a.addProjection(this._projection)}},_expandImpl:function(a){this._expand()&&(this._projectionModel._removeProjection(this._projection,!this._annotationModel),a&&this._forEachOverlaping(function(a){a._recollapse&&(a._collapseImpl(!1),a._recollapse=!1)}))},_forEachOverlaping:function(a){if(this._annotationModel)for(var c=
this._annotationModel.getAnnotations(this.start,this.end);c.hasNext();){var b=c.next();b!==this&&b.type===r.ANNOTATION_FOLDING&&a.call(this,b)}},collapse:function(){this._recollapse=!1;this._collapseImpl(!0)},expand:function(){this._recollapse=!1;this._expandImpl(!0)}};r.ANNOTATION_ERROR="orion.annotation.error";r.ANNOTATION_WARNING="orion.annotation.warning";r.ANNOTATION_TASK="orion.annotation.task";r.ANNOTATION_BREAKPOINT="orion.annotation.breakpoint";r.ANNOTATION_BOOKMARK="orion.annotation.bookmark";
r.ANNOTATION_FOLDING="orion.annotation.folding";r.ANNOTATION_CURRENT_BRACKET="orion.annotation.currentBracket";r.ANNOTATION_MATCHING_BRACKET="orion.annotation.matchingBracket";r.ANNOTATION_CURRENT_LINE="orion.annotation.currentLine";r.ANNOTATION_CURRENT_SEARCH="orion.annotation.currentSearch";r.ANNOTATION_MATCHING_SEARCH="orion.annotation.matchingSearch";r.ANNOTATION_READ_OCCURRENCE="orion.annotation.readOccurrence";r.ANNOTATION_WRITE_OCCURRENCE="orion.annotation.writeOccurrence";r.ANNOTATION_SELECTED_LINKED_GROUP=
"orion.annotation.selectedLinkedGroup";r.ANNOTATION_CURRENT_LINKED_GROUP="orion.annotation.currentLinkedGroup";r.ANNOTATION_LINKED_GROUP="orion.annotation.linkedGroup";r.ANNOTATION_BLAME="orion.annotation.blame";r.ANNOTATION_CURRENT_BLAME="orion.annotation.currentBlame";var b={};r.registerType=function(a,c){var m=c;"function"!==typeof m&&(m=function(a,c,b){this.start=a;this.end=c;void 0!==b&&(this.title=b)},m.prototype=c);m.prototype.type=a;b[a]=m;return a};r.createAnnotation=function(a,c,b,n){return new (this.getType(a))(c,
b,n)};r.getType=function(a){return b[a]};f(r.ANNOTATION_ERROR);f(r.ANNOTATION_WARNING);f(r.ANNOTATION_TASK);f(r.ANNOTATION_BREAKPOINT);f(r.ANNOTATION_BOOKMARK);f(r.ANNOTATION_CURRENT_BRACKET);f(r.ANNOTATION_MATCHING_BRACKET);f(r.ANNOTATION_CURRENT_SEARCH);f(r.ANNOTATION_MATCHING_SEARCH);f(r.ANNOTATION_READ_OCCURRENCE);f(r.ANNOTATION_WRITE_OCCURRENCE);f(r.ANNOTATION_SELECTED_LINKED_GROUP);f(r.ANNOTATION_CURRENT_LINKED_GROUP);f(r.ANNOTATION_LINKED_GROUP);f(r.ANNOTATION_CURRENT_LINE,!0);f(r.ANNOTATION_BLAME,
!0);f(r.ANNOTATION_CURRENT_BLAME,!0);r.registerType(r.ANNOTATION_FOLDING,k);g.addMixin=function(a){var c=g.prototype,b;for(b in c)c.hasOwnProperty(b)&&(a[b]=c[b])};g.prototype={addAnnotationType:function(a,c){this._annotationTypes||(this._annotationTypes=[]);var b=c-1;void 0==c||!(0<=b&&b<this._annotationTypes.length)?this._annotationTypes.push(a):this._annotationTypes.splice(b,0,a)},getAnnotationTypePriority:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===
a)return c+1;return 0},getAnnotationsByType:function(a,c,b){a=a.getAnnotations(c,b);for(b=[];a.hasNext();)c=a.next(),0!==this.getAnnotationTypePriority(c.type)&&b.push(c);var n=this;b.sort(function(a,c){return n.getAnnotationTypePriority(a.type)-n.getAnnotationTypePriority(c.type)});return b},isAnnotationTypeVisible:function(a){return 0!==this.getAnnotationTypePriority(a)},removeAnnotationType:function(a){if(this._annotationTypes)for(var c=0;c<this._annotationTypes.length;c++)if(this._annotationTypes[c]===
a){this._annotationTypes.splice(c,1);break}}};q.prototype={addAnnotation:function(a){if(a){var c=this._annotations,b=e(c,a.start);c.splice(b,0,a);a._annotationModel=this;this.onChanged({type:"Changed",added:[a],removed:[],changed:[]})}},getTextModel:function(){return this._model},getAnnotations:function(a,c){var b=this._annotations,n,h=0,s;s=void 0===a&&void 0===c?function(){return h<b.length?b[h++]:null}:function(){for(;h<b.length;){var n=b[h++];if(a===n.start||(a>n.start?a<n.end:n.start<c))return n;
if(n.start>=c)break}return null};n=s();return{next:function(){var a=n;a&&(n=s());return a},hasNext:function(){return null!==n}}},modifyAnnotation:function(a){if(a&&!(0>this._getAnnotationIndex(a)))this.onChanged({type:"Changed",added:[],removed:[],changed:[a]})},onChanged:function(a){return this.dispatchEvent(a)},removeAnnotations:function(a){var c=this._annotations,b,n;if(a){b=[];for(n=c.length-1;0<=n;n--){var h=c[n];h.type===a&&(c.splice(n,1),b.splice(0,0,h),h._annotationModel=null)}}else b=c;this.onChanged({type:"Changed",
removed:b,added:[],changed:[]})},removeAnnotation:function(a){if(a){var c=this._getAnnotationIndex(a);0>c||(a._annotationModel=null,a={type:"Changed",removed:this._annotations.splice(c,1),added:[],changed:[]},this.onChanged(a))}},replaceAnnotations:function(a,c){var b=this._annotations,n,h,s,d=[];if(a)for(n=a.length-1;0<=n;n--)s=a[n],h=this._getAnnotationIndex(s),0>h||(s._annotationModel=null,b.splice(h,1),d.splice(0,0,s));c||(c=[]);for(n=0;n<c.length;n++)s=c[n],h=e(b,s.start),s._annotationModel=
this,b.splice(h,0,s);this.onChanged({type:"Changed",removed:d,added:c,changed:[]})},setTextModel:function(a){this._model&&this._model.removeEventListener("Changed",this._listener.onChanged);(this._model=a)&&this._model.addEventListener("Changed",this._listener.onChanged)},_getAnnotationIndex:function(a){for(var c=this._annotations,b=e(c,a.start);b<c.length&&c[b].start===a.start;){if(c[b]===a)return b;b++}return-1},_onChanged:function(a){var c=a.start,b=a.addedCharCount,n=a.removedCharCount,h=this._annotations,
s=c+n;if(0<h.length){a={type:"Changed",added:[],removed:[],changed:[],textModelChangedEvent:a};b-=n;for(n=0;n<h.length;n++){var d=h[n];d.start>=s?(d._oldStart=d.start,d._oldEnd=d.end,d.start+=b,d.end+=b,a.changed.push(d)):d.end<=c||(d.start<c&&s<d.end?(d._oldStart=d.start,d._oldEnd=d.end,d.end+=b,a.changed.push(d)):(h.splice(n,1),a.removed.push(d),d._annotationModel=null,d.expand&&d.expand(),n--))}if(0<a.added.length||0<a.removed.length||0<a.changed.length)this.onChanged(a)}}};t.EventTarget.addMixin(q.prototype);
d.prototype={destroy:function(){var a=this._view;a&&(a.removeEventListener("Destroy",this._listener.onDestroy),a.removeEventListener("LineStyle",this._listener.onLineStyle),this.view=null);(a=this._annotationModel)&&a.removeEventListener("Changed",this._listener.onChanged)},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass=a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+(" "+c.styleClass):c.styleClass;var b;c.tagName&&!a.tagName&&(a.tagName=c.tagName);if(c.style)for(b in a.style||
(a.style={}),c.style)a.style[b]||(a.style[b]=c.style[b]);if(c.attributes)for(b in a.attributes||(a.attributes={}),c.attributes)a.attributes[b]||(a.attributes[b]=c.attributes[b])}return a},_mergeStyleRanges:function(a,c){a||(a=[]);for(var b,n=e(a,c.start,!0);n<a.length&&c;n++){var h=a[n];if(c.end<=h.start)break;if(!(c.start>=h.end)){b=this._mergeStyle({},h.style);b=this._mergeStyle(b,c.style);var d=[];d.push(n,1);c.start<h.start&&d.push({start:c.start,end:h.start,style:c.style});c.start>h.start&&d.push({start:h.start,
end:c.start,style:h.style});d.push({start:Math.max(h.start,c.start),end:Math.min(h.end,c.end),style:b});c.end<h.end&&d.push({start:c.end,end:h.end,style:h.style});c=c.end>h.end?{start:h.end,end:c.end,style:c.style}:null;Array.prototype.splice.apply(a,d)}}c&&(b=this._mergeStyle({},c.style),a.splice(n,0,{start:c.start,end:c.end,style:b}));return a},_onAnnotationModelChanged:function(a){function c(a,c){d.getBaseModel&&(a=d.mapOffset(a,!0),c=d.mapOffset(c,!0));-1!==a&&-1!==c&&n.redrawRange(a,c)}function b(a,
n){for(var m=0;m<a.length;m++)if(h.isAnnotationTypeVisible(a[m].type)){var d=a[m];c(d.start,d.end);n&&(void 0!==d._oldStart&&d._oldEnd)&&c(d._oldStart,d._oldEnd)}}var n=this._view;if(n){var h=this,d=n.getModel();b(a.added);b(a.removed);b(a.changed,!0)}},_onDestroy:function(a){this.destroy()},_onLineStyle:function(a){var c=this._annotationModel,b=a.textView.getModel(),n=c.getTextModel(),h=a.lineStart,d=a.lineStart+a.lineText.length;n!==b&&(h=b.mapOffset(h),d=b.mapOffset(d));for(c=c.getAnnotations(h,
d);c.hasNext();)if(h=c.next(),this.isAnnotationTypeVisible(h.type)){if(h.rangeStyle){var d=h.start,e=h.end;n!==b&&(d=b.mapOffset(d,!0),e=b.mapOffset(e,!0));a.ranges=this._mergeStyleRanges(a.ranges,{start:d,end:e,style:h.rangeStyle})}h.lineStyle&&(a.style=this._mergeStyle({},a.style),a.style=this._mergeStyle(a.style,h.lineStyle))}}};g.addMixin(d.prototype);return{FoldingAnnotation:k,AnnotationType:r,AnnotationTypeList:g,AnnotationModel:q,AnnotationStyler:d}});
define("orion/editor/tooltip",["i18n!orion/editor/nls/messages","orion/editor/textView","orion/editor/projectionTextModel","orion/editor/util","orion/util"],function(p,t,r,k,f){function g(e){this._view=e;this._fadeDelay=500;this._hideDelay=200;this._showDelay=500;this._autoHideDelay=5E3;this._create(e.getOptions("parent").ownerDocument)}g.getTooltip=function(e){e._tooltip||(e._tooltip=new g(e));return e._tooltip};g.prototype={_create:function(e){if(!this._tooltipDiv){var g=this._tooltipDiv=f.createElement(e,
"div");g.tabIndex=0;g.className="textviewTooltip";g.setAttribute("aria-live","assertive");g.setAttribute("aria-atomic","true");var d=this._tooltipContents=f.createElement(e,"div");g.appendChild(d);e.body.appendChild(g);var b=this;k.addEventListener(g,"mouseover",function(a){b._hideDelay&&(a=b._getWindow(),b._delayedHideTimeout&&(a.clearTimeout(b._delayedHideTimeout),b._delayedHideTimeout=null),b._hideTimeout&&(a.clearTimeout(b._hideTimeout),b._hideTimeout=null),b._nextTarget=null)},!1);k.addEventListener(g,
"mouseout",function(a){a=a.relatedTarget||a.toElement;!(a===g||b._hasFocus())&&(!a||!k.contains(g,a))&&b._hide()},!1);k.addEventListener(g,"keydown",function(a){27===a.keyCode&&b._hide()},!1);k.addEventListener(e,"mousedown",this._mouseDownHandler=function(a){b.isVisible()&&(k.contains(g,a.target||a.srcElement)||b._hide())},!0);this._view.addEventListener("Destroy",function(){b.destroy()});this._hide()}},_getWindow:function(){var e=this._tooltipDiv.ownerDocument;return e.defaultView||e.parentWindow},
destroy:function(){if(this._tooltipDiv){this._hide();var e=this._tooltipDiv.parentNode;e&&e.removeChild(this._tooltipDiv);k.removeEventListener(this._tooltipDiv.ownerDocument,"mousedown",this._mouseDownHandler,!0);this._tooltipDiv=null}},_hasFocus:function(){var e=this._tooltipDiv;return!e?!1:k.contains(e,e.ownerDocument.activeElement)},hide:function(e){void 0===e&&(e=this._hideDelay);var f=this._getWindow();this._delayedHideTimeout&&(f.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=
null);var d=this;e?d._delayedHideTimeout=f.setTimeout(function(){d._delayedHideTimeout=null;d._hide();d.setTarget(d._nextTarget,0)},e):(d._hide(),d.setTarget(d._nextTarget,0))},_hide:function(){var e=this._tooltipDiv;e&&(this._hasFocus()&&this._view.focus(),this._contentsView&&(this._contentsView.destroy(),this._contentsView=null),this._tooltipContents&&(this._tooltipContents.innerHTML=""),e.style.visibility="hidden",e=this._getWindow(),this._showTimeout&&(e.clearTimeout(this._showTimeout),this._showTimeout=
null),this._delayedHideTimeout&&(e.clearTimeout(this._delayedHideTimeout),this._delayedHideTimeout=null),this._hideTimeout&&(e.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._fadeTimeout&&(e.clearInterval(this._fadeTimeout),this._fadeTimeout=null))},isVisible:function(){return this._tooltipDiv&&"visible"===this._tooltipDiv.style.visibility},setTarget:function(e,f,d){if(this.isVisible())this._hasFocus()||(this._nextTarget=e,this.hide(d));else if(this._target=e){var b=this;e=b._getWindow();
b._showTimeout&&(e.clearTimeout(b._showTimeout),b._showTimeout=null);0===f?b.show(!0):b._showTimeout=e.setTimeout(function(){b._showTimeout=null;b.show(!0)},f?f:b._showDelay)}},show:function(e){if(this._target){var f=this._target.getTooltipInfo();if(f){var d=this._tooltipDiv,b=this._tooltipContents;d.style.left=d.style.right=d.style.width=d.style.height=b.style.width=b.style.height="auto";var a=d.ownerDocument,c=a.documentElement,m=f.contents;m instanceof Array&&(m=this._getAnnotationContents(m));
if("string"===typeof m)b.innerHTML=m;else if(this._isNode(m))b.appendChild(m);else if(m instanceof r.ProjectionTextModel){var n=this._view,h=n.getOptions();h.wrapMode=!1;h.parent=b;var s=h.themeClass;s?((s=s.replace("tooltipTheme",""))&&(s=" "+s),s="tooltipTheme"+s):s="tooltipTheme";h.themeClass=s;h=this._contentsView=new t.TextView(h);h.addEventListener("LineStyle",function(a){n.onLineStyle(a)});h.setModel(m);s=h.computeSize();b.style.width=s.width+"px";b.style.height=s.height+"px";h.resize()}else if(!f.deferredInfo)return;
if(h=f.deferredInfo){var g=this;h.forEach(function(c){c.promise.then(function(h){h&&(h.content&&g._renderContent(a,b,h,c),d.style.visibility="visible")},function(a){console.error("Problem computing hover tooltip",a)})})}"right"===f.anchor?(h=c.clientWidth-f.x,d.style.right=h+"px"):(h=parseInt(this._getNodeStyle(d,"padding-left","0"),10),h+=parseInt(this._getNodeStyle(d,"border-left-width","0"),10),h=f.x-h,d.style.left=h+"px");d.style.maxWidth=c.clientWidth-h-10+"px";h=parseInt(this._getNodeStyle(d,
"padding-top","0"),10);h+=parseInt(this._getNodeStyle(d,"border-top-width","0"),10);h=f.y-h;d.style.top=h+"px";d.style.maxHeight=c.clientHeight-h-10+"px";d.style.opacity="1";m&&(d.style.visibility="visible");if(e){var g=this,k=this._getWindow();g._hideTimeout=k.setTimeout(function(){g._hideTimeout=null;var a=parseFloat(g._getNodeStyle(d,"opacity","1"));g._fadeTimeout=k.setInterval(function(){"visible"===d.style.visibility&&0<a?(a-=0.1,d.style.opacity=a):g._hide()},g._fadeDelay/10)},g._autoHideDelay)}}}},
_renderContent:function(e,g,d,b){var a=null,c=null;d.title&&(a=f.createElement(e,"div"),a.innerHTML=b.renderMarkDown(d.title),g.appendChild(a));switch(d.type){case "markdown":d.content&&(c=f.createElement(e,"div"),c.innerHTML=b.renderMarkDown(d.content),a.appendChild(c));break;case "proposal":var m=d.content,a=f.createElement(e,"button");a.textContent=m.label;g.appendChild(a);var n=this;a.addEventListener("click",function(){n._view.setText(m.text,m.start,m.end);n._hide()});break;default:d.title&&
(a=f.createElement(e,"div"),a.textContent=d.title),d.content&&(g.appendChild(a),c=f.createElement(e,"div"),c.appendChild(e.createTextNode(d.content)),a.appendChild(c))}},_getAnnotationContents:function(e){function g(a,c){var b=v.getLineStart(v.getLineAtOffset(a)),h=v.getLineEnd(v.getLineAtOffset(c),!0);return v.getText(b,h)}function d(a){var c=a.title,b=f.createElement(n,"div");b.className="tooltipRow";a.html&&(b.innerHTML=a.html,b.lastChild&&k.addEventListener(b.lastChild,"click",function(c){c=a.start;
var b=a.end;s.getBaseModel&&(c=s.mapOffset(c,!0),b=s.mapOffset(b,!0));h.setSelection(c,b,1/3,function(){m._hide()})},!1),b.appendChild(n.createTextNode("\u00a0")));c||(c=g(a.start,a.end));"function"===typeof c&&(c=a.title());if("string"===typeof c){var d=f.createElement(n,"span");d.appendChild(n.createTextNode(c));c=d}b.appendChild(c);return b}for(var b,a=[],c=0;c<e.length;c++)b=e[c],""!==b.title&&!b.groupAnnotation&&a.push(b);e=a;if(0===e.length)return null;var m=this,n=this._tooltipDiv.ownerDocument,
h=this._view,s=h.getModel(),v=s.getBaseModel?s.getBaseModel():s;if(1===e.length){b=e[0];if(void 0!==b.title)return b=d(b),b.firstChild&&((e=b.firstChild.className)&&(e+=" "),b.firstChild.className=e+"single"),b;e=new r.ProjectionTextModel(v);a=v.getLineStart(v.getLineAtOffset(b.start));c=v.getCharCount();b.end!==c&&e.addProjection({start:b.end,end:c});0<a&&e.addProjection({start:0,end:a});return e}a=f.createElement(n,"div");b=f.createElement(n,"em");b.appendChild(n.createTextNode(p.multipleAnnotations));
a.appendChild(b);for(c=0;c<e.length;c++)b=e[c],(b=d(b))&&a.appendChild(b);return a},_getNodeStyle:function(e,f,d){return k.getNodeStyle(e,f,d)},_isNode:function(e){return"object"===typeof Node?e instanceof Node:e&&"object"===typeof e&&"number"===typeof e.nodeType&&"string"===typeof e.nodeName}};return{Tooltip:g}});
define("orion/objects",[],function(){function p(p){for(var r=Object.prototype.hasOwnProperty,k=1,f=arguments.length;k<f;k++){var g=arguments[k],e;for(e in g)r.call(g,e)&&(p[e]=g[e])}return p}return{clone:function(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var r=Object.create(Object.getPrototypeOf(t));p(r,t);return r},mixin:p,toArray:function(p){return Array.isArray(p)?p:[p]}}});
define("orion/editor/rulers","i18n!orion/editor/nls/messages orion/editor/textView orion/editor/annotations orion/editor/tooltip orion/objects orion/editor/util orion/util".split(" "),function(p,t,r,k,f,g,e){function q(a,c,b){this._location=a||"left";this._overview=c||"page";this._rulerStyle=b;this._view=null}function d(a,c,b,m){q.call(this,c,b,m);var d=this;this._listener={onTextModelChanged:function(a){d._onTextModelChanged(a)},onAnnotationModelChanged:function(a){d._onAnnotationModelChanged(a)}};
this.setAnnotationModel(a)}function b(a,c,b,m,e){d.call(this,a,c,"page",b);this._oddStyle=m||{style:{backgroundColor:"white"}};this._evenStyle=e||{style:{backgroundColor:"white"}};this._numOfDigits=0;this._firstLine=1}function a(a,c,b){d.call(this,a,c,"page",b)}function c(a,c,b){d.call(this,a,c,"document",b)}function m(c,b,m){a.call(this,c,b,m)}q.prototype={getLocation:function(){return this._location},getOverview:function(){return this._overview},getRulerStyle:function(){return this._rulerStyle},
getView:function(){return this._view},setView:function(a){this._onTextModelChanged&&this._view&&this._view.removeEventListener("ModelChanged",this._listener.onTextModelChanged);this._view=a;this._onTextModelChanged&&this._view&&this._view.addEventListener("ModelChanged",this._listener.onTextModelChanged)}};d.prototype=f.mixin(new q,{getAnnotations:function(a,c){var b=this._annotationModel;if(!b)return[];var m=this._view.getModel(),d=m.getLineStart(a),e=m.getLineEnd(c-1),f=m;m.getBaseModel&&(f=m.getBaseModel(),
d=m.mapOffset(d),e=m.mapOffset(e));for(var g=[],b=this.getAnnotationsByType(b,d,e),d=0;d<b.length;d++)for(var e=b[d],k=f.getLineAtOffset(e.start),l=f.getLineAtOffset(Math.max(e.start,e.end-1)),q=k;q<=l;q++){var p=q;if(m!==f){p=f.getLineStart(q);p=m.mapOffset(p,!0);if(-1===p)continue;p=m.getLineAtOffset(p)}if(a<=p&&p<c){var r=this._mergeAnnotation(g[p],e,q-k,l-k+1);r&&(g[p]=r)}}if(!this._multiAnnotation&&this._multiAnnotationOverlay)for(var t in g)g[t]._multiple&&(g[t].html+=this._multiAnnotationOverlay.html);
return g},getAnnotationModel:function(){return this._annotationModel},getWidestAnnotation:function(){return null},setAnnotationModel:function(a){this._annotationModel&&this._annotationModel.removEventListener("Changed",this._listener.onAnnotationModelChanged);(this._annotationModel=a)&&this._annotationModel.addEventListener("Changed",this._listener.onAnnotationModelChanged)},setMultiAnnotation:function(a){this._multiAnnotation=a},setMultiAnnotationOverlay:function(a){this._multiAnnotationOverlay=
a},onClick:function(a,c){if(void 0!==a){var b=this._view,m=b.getModel(),d=m,e=m.getLineStart(a),f=e,g=e,q=this._annotationModel;if(q){b=b.getSelection();g=m.getLineEnd(a,!0);e<=b.start&&b.start<g&&(e=b.start);m.getBaseModel&&(e=m.mapOffset(e),g=m.mapOffset(g),d=m.getBaseModel());for(var l,g=q.getAnnotations(e,g),q=null;!l&&g.hasNext();)b=g.next(),this.isAnnotationTypeVisible(b.type)&&(q=b,b.start<=e||(l=b));q&&void 0!==q.groupId&&(this._currentClickGroup=this._currentClickGroup===q.groupId?null:q.groupId,
this._setCurrentGroup(a));l&&d.getLineAtOffset(l.start)===d.getLineAtOffset(e)?(e=l.start,g=l.end):g=e=f;m.getBaseModel&&(e=m.mapOffset(e,!0),g=m.mapOffset(g,!0))}(m=k.Tooltip.getTooltip(this._view))&&m.setTarget(null);this._view.setSelection(g,e,1/3,function(){})}},onDblClick:function(a,c){},onMouseMove:function(a,c){var b=k.Tooltip.getTooltip(this._view);if(b&&!(b.isVisible()&&this._tooltipLineIndex===a)){this._tooltipLineIndex=a;var m=this;b.setTarget({y:c.clientY,getTooltipInfo:function(){return m._getTooltipInfo(m._tooltipLineIndex,
this.y)}})}},onMouseOver:function(a,c){this.onMouseMove(a,c);this._currentClickGroup||this._setCurrentGroup(a)},onMouseOut:function(a,c){this._currentClickGroup||this._setCurrentGroup(-1);var b=k.Tooltip.getTooltip(this._view);b&&b.setTarget(null)},_getTooltipInfo:function(a,c){if(void 0!==a){var b=this._view,m=b.getModel(),d=this._annotationModel,e=[];if(d){var e=m.getLineStart(a),f=m.getLineEnd(a);m.getBaseModel&&(e=m.mapOffset(e),f=m.mapOffset(f));e=this.getAnnotationsByType(d,e,f)}d=this._getTooltipContents(a,
e);if(!d)return null;d={contents:d,anchor:this.getLocation()};e=b.getClientArea();"document"===this.getOverview()?e.y=b.convert({y:c},"view","document").y:e.y=b.getLocationAtOffset(m.getLineStart(a)).y;b.convert(e,"document","page");d.x=e.x;d.y=e.y;"right"===d.anchor&&(d.x+=e.width);return d}},_getTooltipContents:function(a,c){return c},_onAnnotationModelChanged:function(a){function c(a){for(var h=0;h<a.length;h++)if(d.isAnnotationTypeVisible(a[h].type)){var n=a[h].start,e=a[h].end;m.getBaseModel&&
(n=m.mapOffset(n,!0),e=m.mapOffset(e,!0));-1!==n&&-1!==e&&b.redrawLines(m.getLineAtOffset(n),m.getLineAtOffset(Math.max(n,e-1))+1,d)}}var b=this._view;if(b){var m=b.getModel(),d=this,e=m.getLineCount();a.textModelChangedEvent?(a=a.textModelChangedEvent.start,m.getBaseModel&&(a=m.mapOffset(a,!0)),a=m.getLineAtOffset(a),b.redrawLines(a,e,d)):(c(a.added),c(a.removed),c(a.changed))}},_mergeAnnotation:function(a,c,b,m){a||(a={});0===b&&(a.html&&c.html?(c.html!==a.html&&(!a._multiple&&this._multiAnnotation)&&
(a.html=this._multiAnnotation.html),a._multiple=!0):a.html=c.html);a.style=this._mergeStyle(a.style,c.style);return a},_mergeStyle:function(a,c){if(c){a||(a={});a.styleClass=a.styleClass&&c.styleClass&&a.styleClass!==c.styleClass?a.styleClass+(" "+c.styleClass):c.styleClass;var b;if(c.style)for(b in a.style||(a.style={}),c.style)void 0===a.style[b]&&(a.style[b]=c.style[b]);if(c.attributes)for(b in a.attributes||(a.attributes={}),c.attributes)void 0===a.attributes[b]&&(a.attributes[b]=c.attributes[b])}return a},
_setCurrentGroup:function(a){var c=this._annotationModel,b=null,m=c.getTextModel(),d,e=this._currentGroupAnnotation;if(-1!==a){var f=m.getLineStart(a),g=m.getLineEnd(a);m.getBaseModel&&(f=m.mapOffset(f),g=m.mapOffset(g));for(d=c.getAnnotations(f,g);d.hasNext();)if(m=d.next(),this.isAnnotationTypeVisible(m.type)&&m.start<=f&&m.end>=g&&void 0!==m.groupId){b=m;break}if(e&&b&&e.groupId===b.groupId)return}this._currentGroupAnnotation=null;e&&c.removeAnnotations(e.groupType);if(b&&-1!==a){this._currentGroupAnnotation=
b;d=c.getAnnotations();for(a=[];d.hasNext();)m=d.next(),delete m.groupAnnotation,m.groupId===b.groupId&&(m=m.createGroupAnnotation(),a.push(m));c.replaceAnnotations(null,a)}}});r.AnnotationTypeList.addMixin(d.prototype);b.prototype=new d;b.prototype.getAnnotations=function(a,c){for(var b=d.prototype.getAnnotations.call(this,a,c),m=this._view.getModel(),e=a;e<c;e++){var f=e-this._firstLine&1?this._oddStyle:this._evenStyle,g=e;m.getBaseModel&&(g=m.getLineStart(g),g=m.getBaseModel().getLineAtOffset(m.mapOffset(g)));
b[e]||(b[e]={});b[e].html=this._firstLine+g+"";b[e].style||(b[e].style=f)}return b};b.prototype.getWidestAnnotation=function(){var a=this._view.getModel().getLineCount();return this.getAnnotations(a-1,a)[a-1]};b.prototype.setFirstLine=function(a){this._firstLine=void 0!==a?a:1};b.prototype._onTextModelChanged=function(a){var c=a.start;a=this._view.getModel();var b=a.getBaseModel?a.getBaseModel().getLineCount():a.getLineCount(),b=(this._firstLine+b-1+"").length;this._numOfDigits!==b&&(this._numOfDigits=
b,c=a.getLineAtOffset(c),this._view.redrawLines(c,a.getLineCount(),this))};a.prototype=new d;c.prototype=new d;c.prototype.getRulerStyle=function(){var a={style:{lineHeight:"1px",fontSize:"1px"}};return a=this._mergeStyle(a,this._rulerStyle)};c.prototype._getTooltipContents=function(a,c){if(0===c.length){var b=this._view.getModel(),m=a;b.getBaseModel&&(m=b.getLineStart(m),m=b.getBaseModel().getLineAtOffset(b.mapOffset(m)));return e.formatMessage(p.line,m+1)}return d.prototype._getTooltipContents.call(this,
a,c)};c.prototype._mergeAnnotation=function(a,c,b,m){if(0===b)return a||(a={html:"\x26nbsp;",style:{style:{height:3*m+"px"}}},a.style=this._mergeStyle(a.style,c.overviewStyle)),a};m.prototype=new a;m.prototype.onClick=function(a,c){if(void 0!==a){var b=this._annotationModel;if(b){var m=this._view.getModel(),d=m.getLineStart(a),e=m.getLineEnd(a,!0);m.getBaseModel&&(d=m.mapOffset(d),e=m.mapOffset(e),m=m.getBaseModel());for(var f,b=b.getAnnotations(d,e);!f&&b.hasNext();)e=b.next(),this.isAnnotationTypeVisible(e.type)&&
m.getLineAtOffset(e.start)===m.getLineAtOffset(d)&&(f=e);f&&((m=k.Tooltip.getTooltip(this._view))&&m.setTarget(null),f.expanded?f.collapse():f.expand())}}};m.prototype._getTooltipContents=function(c,b){if(0<b.length){var m=this._view.getModel(),d=m.getLineStart(c);m.getBaseModel&&(d=m.mapOffset(d),m=m.getBaseModel());for(var d=m.getLineAtOffset(d),e=0;e<b.length;e++){var f=b[e];if(this.isAnnotationTypeVisible(f.type)&&m.getLineAtOffset(f.start)===d){if(b[e].expanded)break;return a.prototype._getTooltipContents.call(this,
c,[f])}}}return null};m.prototype._onAnnotationModelChanged=function(c){function b(a){for(f=0;f<a.length;f++)if(e.isAnnotationTypeVisible(a[f].type)){var c=a[f].start;d.getBaseModel&&(c=d.mapOffset(c,!0));-1!==c&&(k=Math.min(k,d.getLineAtOffset(c)))}}if(c.textModelChangedEvent)a.prototype._onAnnotationModelChanged.call(this,c);else{var m=this._view;if(m){var d=m.getModel(),e=this,f,g=d.getLineCount(),k=g;b(c.added);b(c.removed);b(c.changed);c=m.getRulers();for(f=0;f<c.length;f++)m.redrawLines(k,g,
c[f])}}};r=function(a,c){q.call(this,a,"fixed",c)};r.prototype=f.mixin(new q,{setView:function(a){this._destroy();q.prototype.setView.call(this,a);this._create()},_create:function(){function a(c){var b=c.themeClass;b?((b=b.replace("textviewZoom",""))&&(b=" "+b),b="textviewZoom"+b):b="textviewZoom";c.themeClass=b;c.noScroll=!0;c.readonly=!0;return c}function c(){var a=k._metrics.viewPadding,b=k._metrics.viewPadding,h=k.getLineHeight(),m=p.getLineHeight(),n=k.getModel().getLineCount(),h=k._lineHeight?
k._scrollHeight:n*h,m=p._lineHeight?p._scrollHeight:n*m,n=m/h,d=k.getClientArea().height+a.top+a.bottom,b=p.getClientArea().height+b.top+b.bottom;return{zoomFactor:n,documentHeight:h,zoomDocumentHeight:m,clientHeight:d,zoomClientHeight:b,scrollWidth:k._metrics.scrollWidth,windowHeight:d*n,padding:a}}function b(a){a=a||{y:k.getTopPixel()};var m=c();p.setTopPixel(a.y*(m.zoomFactor+(m.windowHeight-m.clientHeight-m.scrollWidth)/m.documentHeight));a=a.y*m.zoomFactor;m=m.clientHeight*m.zoomFactor;A.top=
a;A.bottom=a+m;a=p.convert({y:a},"document","page").y;a-=A.node.getBoundingClientRect().top;r.style.top=a+"px";r.style.height=m-B+"px"}function m(a){a.wrapMode&&!a.wrapOffset&&k._metrics.charWidth?(a=e.createElement(l,"div"),a.style.position="fixed",a.style.left="-1000px",p._clientDiv.appendChild(a),a.innerHTML=Array(Math.ceil(k.getClientArea().width/k._metrics.charWidth)+1).join("a"),a=a.getBoundingClientRect(),a=Math.min(150,Math.ceil(a.right-a.left))+"px"):a="";var c=A.node.style.width;A.node.style.width=
a;return c!==a}function d(a,c,b){b||A.top<=a.y&&a.y<=A.bottom?(A.mouseDown=!0,A.delta=c-r.getBoundingClientRect().top+A.node.getBoundingClientRect().top):(a=p.getOffsetAtLocation(a.x,a.y),k.setSelection(a,a,0.5,function(){}))}function f(a){if(A.mouseDown){var b=c();a=Math.min(b.zoomClientHeight-b.windowHeight,Math.max(0,a-A.delta));k.setTopPixel(a*(b.documentHeight-b.clientHeight)/Math.min(b.zoomDocumentHeight,b.zoomClientHeight-b.windowHeight))}}var k=this.getView();if(k){var q=a(k.getOptions());
q.parent=this.node;var p=this._zoomView=new t.TextView(q);p._clientDiv.contentEditable=!1;p.setModel(k.getModel());var l=k.getOptions("parent").ownerDocument,r=this._windowDiv=e.createElement(l,"div");r.className="rulerZoomWindow";this.node.appendChild(r);var B=parseInt(g.getNodeStyle(r,"border-top-width",0))+parseInt(g.getNodeStyle(r,"border-bottom-width",0)),A=this;k.addEventListener("Scroll",this._scrollListener=function(a){b(a.newValue)});k.addEventListener("Resize",this._resizeListener=function(){m(p.getOptions());
b()});k.addEventListener("Redraw",this._redrawListener=function(a){a.ruler||p.redrawLines(a.startLine,a.endLine)});k.addEventListener("Options",this._optionsListener=function(c){c=a(c.options);p.setOptions(c);m(p.getOptions())});p.addEventListener("LineStyle",this._lineListener=function(a){k.onLineStyle(a)});e.isIOS||e.isAndroid?(r.addEventListener("touchstart",function(a){1===a.touches.length&&(d(a,a.touches[0].clientY,!0),a.preventDefault())}),r.addEventListener("touchend",function(a){0===a.touches.length&&
(A.mouseDown=!1)}),r.addEventListener("touchmove",function(a){1===a.touches.length&&f(a.touches[0].clientY)}),p.addEventListener("TouchStart",function(a){1===a.touchCount&&(d(a,a.event.touches[0].clientY),a.preventDefault())})):(r.style.pointerEvents="none",p.addEventListener("MouseDown",function(a){var c=a.event;(c.which?0===c.button:1===c.button)&&d(a,c.clientY);a.preventDefault()}),p.addEventListener("MouseUp",function(a){A.mouseDown=!1;a.preventDefault()}),p.addEventListener("MouseMove",function(a){f(a.event.clientY);
a.preventDefault()}));(l.defaultView||l.parentWindow).setTimeout(function(){b()},0)}},_destroy:function(){var a=this.getView();a&&(a.removeEventListener("Scroll",this._scrollListener),this._scrollListener=null,a.removeEventListener("Resize",this._resizeListener),this._resizeListener=null,a.removeEventListener("Redraw",this._redrawListener),this._redrawListener=null,a.removeEventListener("Options",this._optionsListener),this._optionsListener=null);if(a=this._zoomView)a.removeEventListener("LineStyle",
this._lineListener),a.setModel(null),a.destroy(),this._zoomView=null}});return{BaseRuler:q,Ruler:d,AnnotationRuler:a,LineNumberRuler:b,OverviewRuler:c,FoldingRuler:m,ZoomRuler:r}});
define("orion/editor/undoStack",[],function(){function p(k,f,g,e,q){this.model=k;this.offset=f;this.text=g;this.previousText=e;this.type=q}function t(k){this.owner=k;this.changes=[]}function r(k,f){this.size=void 0!==f?f:100;this.reset();var g=this;this._listener={onChanging:function(e){g._onChanging(e)},onDestroy:function(e){g._onDestroy(e)}};if(k.getModel){var e=k.getModel();e.getBaseModel&&(e=e.getBaseModel());this.model=e;this.setView(k)}else this.shared=!0,this.model=k;this.model.addEventListener("Changing",
this._listener.onChanging)}p.prototype={getRedoChanges:function(){return[{start:this.offset,end:this.offset+this.previousText.length,text:this.text}]},getUndoChanges:function(){return[{start:this.offset,end:this.offset+this.text.length,text:this.previousText}]},undo:function(k,f){this._doUndoRedo(this.offset,this.previousText,this.text,k,f);return!0},redo:function(k,f){this._doUndoRedo(this.offset,this.text,this.previousText,k,f);return!0},merge:function(k,f,g,e,q){if(e===this.type){if(1===e&&k===
this.offset+this.text.length)return this.text+=f,!0;if(-1===e&&q===this.offset)return this.offset=k,this.previousText=g+this.previousText,!0;if(-1===e&&k===this.offset)return this.previousText+=g,!0}return!1},_doUndoRedo:function(k,f,g,e,q){this.model.setText(f,k,k+g.length);q&&e&&(g=e.getModel(),g!==this.model&&(k=g.mapOffset(k,!0)),e.setSelection(k,k+f.length))}};t.prototype={getRedoChanges:function(){for(var k=[],f=0;f<this.changes.length;f++)k=k.concat(this.changes[f].getRedoChanges());return k},
getUndoChanges:function(){for(var k=[],f=this.changes.length-1;0<=f;f--)k=k.concat(this.changes[f].getUndoChanges());return k},add:function(k){this.changes.push(k)},end:function(k){k&&(this.endSelection=k.getSelection(),this.endCaret=k.getCaretOffset());(k=this.owner)&&k.end&&k.end()},undo:function(k,f){1<this.changes.length&&k&&k.setRedraw(!1);for(var g=this.changes.length-1;0<=g;g--)this.changes[g].undo(k,!1);if(f&&k){var g=this.startSelection.start,e=this.startSelection.end;k.setSelection(this.startCaret?
g:e,this.startCaret?e:g)}1<this.changes.length&&k&&k.setRedraw(!0);(g=this.owner)&&g.undo&&g.undo();return 0<this.changes.length},redo:function(k,f){1<this.changes.length&&k&&k.setRedraw(!1);for(var g=0;g<this.changes.length;g++)this.changes[g].redo(k,!1);(1<this.changes.length,k)&&k.setRedraw(!0);if(f&&k){var g=this.endSelection.start,e=this.endSelection.end;k.setSelection(this.endCaret?g:e,this.endCaret?e:g)}(g=this.owner)&&g.redo&&g.redo();return 0<this.changes.length},merge:function(k,f,g,e,q){var d=
this.changes.length;return 0<d?this.changes[d-1].merge(k,f,g,e,q):!1},start:function(k){k&&(this.startSelection=k.getSelection(),this.startCaret=k.getCaretOffset());(k=this.owner)&&k.start&&k.start()}};r.prototype={destroy:function(){this._onDestroy()},add:function(k){this.compoundChange?this.compoundChange.add(k):(this.stack.splice(this.index,this.stack.length-this.index,k),this.index++,this.stack.length>this.size&&(this.stack.shift(),this.index--))},markClean:function(){this._commitUndo();if(this.cleanChange=
this.stack[this.index-1])this.cleanChange.type=2},isClean:function(){return this.cleanChange===this.stack[this.index-1]},canUndo:function(){return 0<this.index},canRedo:function(){return 0<this.stack.length-this.index},endCompoundChange:function(){this.compoundChange&&this.compoundChange.end(this.view);this.compoundChange=void 0},getSize:function(){return{undo:this.index,redo:this.stack.length-this.index}},getRedoChanges:function(){this._commitUndo();for(var k=[],f=this.index;f<this.stack.length;f++)k=
k.concat(this.stack[f].getRedoChanges());return k},getUndoChanges:function(){this._commitUndo();for(var k=[],f=this.index;0<=f;f--)k=k.concat(this.stack[f].getUndoChanges());return k},undo:function(){this._commitUndo();var k;k=!1;this._ignoreUndo=!0;do{if(0>=this.index)break;k=this.stack[--this.index]}while(!(k=k.undo(this.view,!0)));this._ignoreUndo=!1;return k},redo:function(){this._commitUndo();var k;this._ignoreUndo=!0;do{if(this.index>=this.stack.length)break;k=this.stack[this.index++]}while(!k.redo(this.view,
!0));this._ignoreUndo=!1;return!0},reset:function(){this.index=0;this.cleanChange=void 0;this.stack=[];this._ignoreUndo=!1;this._compoundChange=void 0},setView:function(k){this.view!==k&&(this.view&&k.removeEventListener("Destroy",this._listener.onDestroy),(this.view=k)&&k.addEventListener("Destroy",this._listener.onDestroy))},startCompoundChange:function(k){this._commitUndo();k=new t(k);this.add(k);this.compoundChange=k;this.compoundChange.start(this.view);return this.compoundChange},_commitUndo:function(){this.endCompoundChange()},
_onDestroy:function(k){(!k||!this.shared)&&this.model.removeEventListener("Changing",this._listener.onChanging);this.view&&(this.view.removeEventListener("Destroy",this._listener.onDestroy),this.view=null)},_onChanging:function(k){if(!this._ignoreUndo){var f=k.text,g=k.start,e=k.addedCharCount,q=k.removedCharCount;k=g+q;var d=0;0===e&&1===q?d=-1:1===e&&0===q&&(d=1);e=this.stack.length;q=this.model.getText(g,k);(!(0<e&&this.index===e)||!this.stack[e-1].merge(g,f,q,d,k))&&this.add(new p(this.model,
g,f,q,d))}}};return{UndoStack:r}});
define("orion/editor/textDND",["orion/util"],function(p){function t(p,k){this._view=p;this._undoStack=k;this._dragSelection=null;this._dropOffset=-1;this._dropText=null;var f=this;this._listener={onDragStart:function(g){f._onDragStart(g)},onDragEnd:function(g){f._onDragEnd(g)},onDragEnter:function(g){f._onDragEnter(g)},onDragOver:function(g){f._onDragOver(g)},onDrop:function(g){f._onDrop(g)},onDestroy:function(g){f._onDestroy(g)}};p.addEventListener("DragStart",this._listener.onDragStart);p.addEventListener("DragEnd",
this._listener.onDragEnd);p.addEventListener("DragEnter",this._listener.onDragEnter);p.addEventListener("DragOver",this._listener.onDragOver);p.addEventListener("Drop",this._listener.onDrop);p.addEventListener("Destroy",this._listener.onDestroy)}t.prototype={destroy:function(){var p=this._view;p&&(p.removeEventListener("DragStart",this._listener.onDragStart),p.removeEventListener("DragEnd",this._listener.onDragEnd),p.removeEventListener("DragEnter",this._listener.onDragEnter),p.removeEventListener("DragOver",
this._listener.onDragOver),p.removeEventListener("Drop",this._listener.onDrop),p.removeEventListener("Destroy",this._listener.onDestroy),this._view=null)},_onDestroy:function(p){this.destroy()},_onDragStart:function(p){var k=this._view,f=k.getSelection(),k=k.getModel();k.getBaseModel&&(f.start=k.mapOffset(f.start),f.end=k.mapOffset(f.end),k=k.getBaseModel());if(k=k.getText(f.start,f.end))this._dragSelection=f,p.event.dataTransfer.effectAllowed="copyMove",p.event.dataTransfer.setData("Text",k)},_onDragEnd:function(r){if(this._dragSelection){var k=
this._view,f=r.event.dataTransfer.dropEffect;if(!p.isFirefox&&("none"!==f||this._dropText))f=r.event.dataTransfer.dropEffect=this._dropEffect;this._undoStack&&this._undoStack.startCompoundChange();(r="move"===f)&&k.setText("",this._dragSelection.start,this._dragSelection.end);if(this._dropText){var f=this._dropText,g=this._dropOffset;r&&(g>=this._dragSelection.end?g-=this._dragSelection.end-this._dragSelection.start:g>=this._dragSelection.start&&(g=this._dragSelection.start));k.setText(f,g,g);k.setSelection(g,
g+f.length);this._dropText=null;this._dropOffset=-1}this._undoStack&&this._undoStack.endCompoundChange()}this._dragSelection=null},_onDragEnter:function(p){this._onDragOver(p)},_onDragOver:function(r){var k=r.event.dataTransfer.types,f=!this._view.getOptions("readonly");f&&k&&(f=k.contains?k.contains("text/plain")||k.contains("Text"):-1!==k.indexOf("text/plain")||-1!==k.indexOf("Text"));f?p.isFirefox||(this._dropEffect=r.event.dataTransfer.dropEffect=(p.isMac?r.event.altKey:r.event.ctrlKey)?"copy":
"move"):r.event.dataTransfer.dropEffect="none"},_onDrop:function(r){var k=this._view,f=r.event.dataTransfer.getData("Text");f&&(p.isFirefox||(r.event.dataTransfer.dropEffect=this._dropEffect),r=k.getOffsetAtLocation(r.x,r.y),this._dragSelection?(this._dropOffset=r,this._dropText=f):(k.setText(f,r,r),k.setSelection(r,r+f.length)))}};return{TextDND:t}});
define("orion/editor/editor","i18n!orion/editor/nls/messages orion/editor/eventTarget orion/editor/tooltip orion/editor/annotations orion/objects orion/util".split(" "),function(p,t,r,k,f,g){function e(b){b=b||{};this._domNode=b.domNode;this._model=b.model;this._undoStack=b.undoStack;this._statusReporter=b.statusReporter;this._title=null;var a=this;this._listener={onChanged:function(c){a.onChanged(c)}};this._model&&this._model.addEventListener("Changed",this._listener.onChanged);this.checkDirty()}
function q(b){b=b||{};e.call(this,b);this._textViewFactory=b.textViewFactory;this._undoStackFactory=b.undoStackFactory;this._textDNDFactory=b.textDNDFactory;this._annotationFactory=b.annotationFactory;this._zoomRulerFactory=b.zoomRulerFactory;this._foldingRulerFactory=b.foldingRulerFactory;this._lineNumberRulerFactory=b.lineNumberRulerFactory;this._contentAssistFactory=b.contentAssistFactory;this._keyBindingFactory=b.keyBindingFactory;this._hoverFactory=b.hoverFactory;this._contentAssist=this._foldingRuler=
this._zoomRuler=this._overviewRuler=this._lineNumberRuler=this._annotationRuler=this._annotationModel=this._annotationStyler=null}var d=k.AnnotationType;e.prototype={destroy:function(){this.uninstall();this._statusReporter=this._domNode=null;this._model&&this._model.removeEventListener("Changed",this._listener.onChanged)},checkDirty:function(){this.setDirty(this._undoStack&&!this._undoStack.isClean())},focus:function(){},getModel:function(){return this._model},getText:function(b,a){return this.getModel().getText(b,
a)},getTitle:function(){return this._title},getUndoStack:function(){return this._undoStack},install:function(){this.installed=!0},isDirty:function(){return this._dirty},markClean:function(){this.getUndoStack().markClean();this.setDirty(!1)},onDirtyChanged:function(b){return this.dispatchEvent(b)},onInputChanged:function(b){return this.dispatchEvent(b)},onChanged:function(b){this.checkDirty()},reportStatus:function(b,a,c){this._statusReporter&&this._statusReporter(b,a,c)},resize:function(){},setDirty:function(b){this._dirty!==
b&&(this._dirty=b,this.onDirtyChanged({type:"DirtyChanged"}))},_setModelText:function(b){this._model&&this._model.setText(b)},setInput:function(b,a,c,m){this._title=b;m||(a?this.reportStatus(a,"error"):null!==c&&(void 0!==c&&"string"===typeof c)&&this._setModelText(c),this._undoStack&&this._undoStack.reset());this.checkDirty();this.onInputChanged({type:"InputChanged",title:b,message:a,contents:c,contentsSaved:m})},setText:function(b,a,c){this.getModel().setText(b,a,c)},uninstall:function(){this.installed=
!1}};t.EventTarget.addMixin(e.prototype);q.prototype=new e;f.mixin(q.prototype,{destroy:function(){e.prototype.destroy.call(this);this._textViewFactory=this._undoStackFactory=this._textDNDFactory=this._annotationFactory=this._foldingRulerFactory=this._lineNumberRulerFactory=this._contentAssistFactory=this._keyBindingFactory=this._hoverFactory=this._zoomRulerFactory=null},getAnnotationModel:function(){return this._annotationModel},getAnnotationRuler:function(){return this._annotationRuler},getAnnotationStyler:function(){return this._annotationStyler},
getContentAssist:function(){return this._contentAssist},getFoldingRuler:function(){return this._foldingRuler},getLineNumberRuler:function(){return this._lineNumberRuler},getZoomRuler:function(){return this._zoomRuler},getModel:function(){if(!this._textView)return null;var b=this._textView.getModel();b.getBaseModel&&(b=b.getBaseModel());return b},getOverviewRuler:function(){return this._overviewRuler},getTextView:function(){return this._textView},getKeyModes:function(){return this._textView.getKeyModes()},
getSourceCodeActions:function(){return this._sourceCodeActions},getLinkedMode:function(){return this._linkedMode},getTextActions:function(){return this._textActions},focus:function(){this._textView&&this._textView.focus()},resize:function(){this._textView&&this._textView.resize()},setAnnotationRulerVisible:function(b,a){if(this._annotationRulerVisible!==b||a)if(this._annotationRulerVisible=b,this._annotationRuler){var c=this._textView;b?c.addRuler(this._annotationRuler,0):c.removeRuler(this._annotationRuler)}},
setFoldingRulerVisible:function(b,a){if(this._foldingRulerVisible!==b||a)if(this._foldingRulerVisible=b,this._foldingRuler){var c=this._textView;c.getModel().getBaseModel&&(b?c.addRuler(this._foldingRuler):c.removeRuler(this._foldingRuler))}},setLineNumberRulerVisible:function(b,a){if(this._lineNumberRulerVisible!==b||a)if(this._lineNumberRulerVisible=b,this._lineNumberRuler){var c=this._textView;b?c.addRuler(this._lineNumberRuler,!this._annotationRulerVisible?0:1):c.removeRuler(this._lineNumberRuler)}},
setOverviewRulerVisible:function(b,a){if(this._overviewRulerVisible!==b||a)if(this._overviewRulerVisible=b,this._overviewRuler){var c=this._textView;b?c.addRuler(this._overviewRuler):c.removeRuler(this._overviewRuler)}},setZoomRulerVisible:function(b,a){if(this._zoomRulerVisible!==b||a)if(this._zoomRulerVisible=b,this._zoomRuler){var c=this._textView;b?c.addRuler(this._zoomRuler):c.removeRuler(this._zoomRuler)}},mapOffset:function(b,a){var c=this._textView.getModel();c.getBaseModel&&(b=c.mapOffset(b,
a));return b},getLineAtOffset:function(b){return this.getModel().getLineAtOffset(this.mapOffset(b))},getLineStart:function(b){return this.getModel().getLineStart(b)},getCaretOffset:function(){return this.mapOffset(this._textView.getCaretOffset())},getSelection:function(){var b=this._textView,a=b.getSelection(),b=b.getModel();b.getBaseModel&&(a.start=b.mapOffset(a.start),a.end=b.mapOffset(a.end));return a},_expandOffset:function(b){var a=this._textView.getModel(),c=this._annotationModel;if(c&&a.getBaseModel)for(b=
c.getAnnotations(b,b+1);b.hasNext();)a=b.next(),a.type===d.ANNOTATION_FOLDING&&a.expand&&a.expand()},setCaretOffset:function(b,a,c){var m=this._textView,n=m.getModel();n.getBaseModel&&(this._expandOffset(b),b=n.mapOffset(b,!0));m.setCaretOffset(b,a,c)},setText:function(b,a,c){var m=this._textView,n=m.getModel();n.getBaseModel&&(void 0!==a&&(this._expandOffset(a),a=n.mapOffset(a,!0)),void 0!==c&&(this._expandOffset(c),c=n.mapOffset(c,!0)));m.setText(b,a,c)},setSelection:function(b,a,c,m){var n=this._textView,
h=n.getModel();h.getBaseModel&&(this._expandOffset(b),this._expandOffset(a),b=h.mapOffset(b,!0),a=h.mapOffset(a,!0));n.setSelection(b,a,c,m)},moveSelection:function(b,a,c,m){var n=this._textView;this.setSelection(b,a||b,1/3,function(){(void 0===m||m)&&n.focus();c&&c()})},_getTooltipInfo:function(b,a){var c=this._textView,m=this.getAnnotationModel();if(!m)return null;var n=this._annotationStyler;if(!n)return null;var h=c.getOffsetAtLocation(b,a);if(-1===h)return null;for(var h=this.mapOffset(h),d=
n.getAnnotationsByType(m,h,h+1),m=[],n=[],e=0;e<d.length;e++)d[e].rangeStyle&&(m.push(d[e]),n.push(d[e].title));d=[];this._hover&&(d=this._hover.computeHoverInfo({offset:h,annotations:n}));if(0===m.length&&0===d.length)return null;c=c.convert({x:b,y:a},"document","page");return{deferredInfo:d,contents:m,anchor:"left",x:c.x+10,y:c.y+20}},_highlightCurrentLine:function(b,a){var c=this._annotationModel;if(c){var m=this._textView;if(!m.getOptions("singleMode")){var n=m.getModel(),h=a?n.getLineAtOffset(a.start):
-1,e=n.getLineAtOffset(b.start),m=b.start===b.end,f=!a||a.start===a.end,g=n.getLineStart(e),k=n.getLineEnd(e);n.getBaseModel&&(g=n.mapOffset(g),k=n.mapOffset(k));n=this._currentLineAnnotation;if(!(h===e&&f&&m&&n&&n.start===g&&n.end===k)){var h=n?[n]:null,q;m&&(n=d.createAnnotation(d.ANNOTATION_CURRENT_LINE,g,k),q=[n]);this._currentLineAnnotation=n;c.replaceAnnotations(h,q)}}}},installTextView:function(){this.install()},install:function(){if(!this._textView){this._textView=this._textViewFactory();
this._undoStackFactory&&(this._undoStack=this._undoStackFactory.createUndoStack(this),this.checkDirty());this._textDNDFactory&&(this._textDND=this._textDNDFactory.createTextDND(this,this._undoStack));this._contentAssistFactory&&(this._contentAssist=this._contentAssistFactory.createContentAssistMode(this).getContentAssist());this._hoverFactory&&(this._hover=this._hoverFactory.createHover(this));var b=this,a=this._textView,c=this;this._listener={onModelChanged:function(a){c.checkDirty()},onMouseOver:function(a){c._listener.onMouseMove(a)},
onMouseMove:function(b){var h=r.Tooltip.getTooltip(a);h&&!(c._listener.lastMouseX===b.event.clientX&&c._listener.lastMouseY===b.event.clientY)&&(c._listener.lastMouseX=b.event.clientX,c._listener.lastMouseY=b.event.clientY,h.setTarget({x:b.x,y:b.y,getTooltipInfo:function(){return c._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(b){var h=r.Tooltip.getTooltip(a);h&&!(c._listener.lastMouseX===b.event.clientX&&c._listener.lastMouseY===b.event.clientY)&&(c._listener.lastMouseX=b.event.clientX,
c._listener.lastMouseY=b.event.clientY,h.setTarget(null))},onScroll:function(c){(c=r.Tooltip.getTooltip(a))&&c.setTarget(null,0,0)},onSelection:function(a){c._updateCursorStatus();c._highlightCurrentLine(a.newValue,a.oldValue)}};a.addEventListener("ModelChanged",this._listener.onModelChanged);a.addEventListener("Selection",this._listener.onSelection);a.addEventListener("MouseOver",this._listener.onMouseOver);a.addEventListener("MouseOut",this._listener.onMouseOut);a.addEventListener("MouseMove",this._listener.onMouseMove);
a.addEventListener("Scroll",this._listener.onScroll);if(this._keyBindingFactory){var m;if(m="function"===typeof this._keyBindingFactory?this._keyBindingFactory(this,this.getKeyModes(),this._undoStack,this._contentAssist):this._keyBindingFactory.createKeyBindings(b,this._undoStack,this._contentAssist))this._textActions=m.textActions,this._linkedMode=m.linkedMode,this._sourceCodeActions=m.sourceCodeActions}m=function(a,c){if(void 0!==a&&-1!==a){for(var h=this.getView().getModel(),m=this.getAnnotationModel(),
n=b.mapOffset(h.getLineStart(a)),h=b.mapOffset(h.getLineEnd(a)),e=m.getAnnotations(n,h),f=null;e.hasNext();){var g=e.next();if(g.type===d.ANNOTATION_BOOKMARK){f=g;break}}f?m.removeAnnotation(f):(f=d.createAnnotation(d.ANNOTATION_BOOKMARK,n,h),f.title=void 0,m.addAnnotation(f))}};if(this._annotationFactory){var n=a.getModel();n.getBaseModel&&(n=n.getBaseModel());if(this._annotationModel=this._annotationFactory.createAnnotationModel(n))if(n=this._annotationStyler=this._annotationFactory.createAnnotationStyler(a,
this._annotationModel))n.addAnnotationType(d.ANNOTATION_CURRENT_SEARCH),n.addAnnotationType(d.ANNOTATION_MATCHING_SEARCH),n.addAnnotationType(d.ANNOTATION_ERROR),n.addAnnotationType(d.ANNOTATION_WARNING),n.addAnnotationType(d.ANNOTATION_MATCHING_BRACKET),n.addAnnotationType(d.ANNOTATION_CURRENT_BRACKET),n.addAnnotationType(d.ANNOTATION_CURRENT_LINE),n.addAnnotationType(d.ANNOTATION_READ_OCCURRENCE),n.addAnnotationType(d.ANNOTATION_WRITE_OCCURRENCE),n.addAnnotationType(d.ANNOTATION_SELECTED_LINKED_GROUP),
n.addAnnotationType(d.ANNOTATION_CURRENT_LINKED_GROUP),n.addAnnotationType(d.ANNOTATION_LINKED_GROUP),n.addAnnotationType("orion.annotation.highlightError");var n=this._annotationFactory.createAnnotationRulers(this._annotationModel),h=this._annotationRuler=n.annotationRuler;h&&(h.onDblClick=m,h.setMultiAnnotationOverlay({html:"\x3cdiv class\x3d'annotationHTML overlay'\x3e\x3c/div\x3e"}),h.addAnnotationType(d.ANNOTATION_ERROR),h.addAnnotationType(d.ANNOTATION_WARNING),h.addAnnotationType(d.ANNOTATION_TASK),
h.addAnnotationType(d.ANNOTATION_BOOKMARK));this.setAnnotationRulerVisible(this._annotationRulerVisible||void 0===this._annotationRulerVisible,!0);if(h=this._overviewRuler=n.overviewRuler)h.addAnnotationType(d.ANNOTATION_CURRENT_SEARCH),h.addAnnotationType(d.ANNOTATION_MATCHING_SEARCH),h.addAnnotationType(d.ANNOTATION_READ_OCCURRENCE),h.addAnnotationType(d.ANNOTATION_WRITE_OCCURRENCE),h.addAnnotationType(d.ANNOTATION_CURRENT_BLAME),h.addAnnotationType(d.ANNOTATION_ERROR),h.addAnnotationType(d.ANNOTATION_WARNING),
h.addAnnotationType(d.ANNOTATION_TASK),h.addAnnotationType(d.ANNOTATION_BOOKMARK),h.addAnnotationType(d.ANNOTATION_MATCHING_BRACKET),h.addAnnotationType(d.ANNOTATION_CURRENT_BRACKET),h.addAnnotationType(d.ANNOTATION_CURRENT_LINE);this.setOverviewRulerVisible(this._overviewRulerVisible||void 0===this._overviewRulerVisible,!0)}this._zoomRulerFactory&&(this._zoomRuler=this._zoomRulerFactory.createZoomRuler(this._annotationModel),this.setZoomRulerVisible(this._zoomRulerVisible||void 0===this._zoomRulerVisible,
!0));this._lineNumberRulerFactory&&(this._lineNumberRuler=this._lineNumberRulerFactory.createLineNumberRuler(this._annotationModel),this._lineNumberRuler.addAnnotationType(d.ANNOTATION_CURRENT_BLAME),this._lineNumberRuler.addAnnotationType(d.ANNOTATION_BLAME),this._lineNumberRuler.onDblClick=m,this.setLineNumberRulerVisible(this._lineNumberRulerVisible||void 0===this._lineNumberRulerVisible,!0));this._foldingRulerFactory&&(this._foldingRuler=this._foldingRulerFactory.createFoldingRuler(this._annotationModel),
this._foldingRuler.addAnnotationType(d.ANNOTATION_FOLDING),this.setFoldingRulerVisible(this._foldingRulerVisible||void 0===this._foldingRulerVisible,!0));this.dispatchEvent({type:"TextViewInstalled",textView:a});e.prototype.install.call(this)}},uninstallTextView:function(){this.uninstall()},uninstall:function(){var b=this._textView;b&&(b.destroy(),this._annotationModel&&this._annotationModel.setTextModel(null),this._textView=this._undoStack=this._textDND=this._contentAssist=this._listener=this._annotationModel=
this._annotationStyler=this._annotationRuler=this._overviewRuler=this._zoomRuler=this._lineNumberRuler=this._foldingRuler=this._currentLineAnnotation=this._title=null,this._dirty=!1,this._foldingRulerVisible=this._overviewRulerVisible=this._zoomRulerVisible=this._lineNumberRulerVisible=this._annotationRulerVisible=void 0,this.dispatchEvent({type:"TextViewUninstalled",textView:b}),e.prototype.uninstall.call(this))},_updateCursorStatus:function(){for(var b=this.getModel(),a=this.getCaretOffset(),c=
b.getLineAtOffset(a),b=b.getLineStart(c),a=a-b,b=this.getKeyModes(),m=0;m<b.length;m++){var d=b[m];if(d.isActive()&&d.isStatusActive&&d.isStatusActive())return}this.reportStatus(g.formatMessage(p.lineColumn,c+1,a+1))},showAnnotations:function(b,a,c,m){var n=this._annotationModel;if(n){for(var h=[],e=[],f=n.getTextModel(),g=n.getAnnotations(),k;g.hasNext();)k=g.next(),-1!==a.indexOf(k.type)&&k.creatorID===this&&h.push(k);if(b)for(a=0;a<b.length;a++)if(k=b[a]){if(c)k=c(k);else{var q;"number"===typeof k.line?
(q=f.getLineStart(k.line-1),g=q+k.start-1,q=q+k.end-1):(g=k.start,q=k.end);var p=m(k);if(!p)continue;k=d.createAnnotation(p,g,q,k.description)}k.creatorID=this;e.push(k)}n.replaceAnnotations(h,e)}},showProblems:function(b){this.showAnnotations(b,[d.ANNOTATION_ERROR,d.ANNOTATION_WARNING,d.ANNOTATION_TASK],null,function(a){switch(a.severity){case "error":return d.ANNOTATION_ERROR;case "warning":return d.ANNOTATION_WARNING;case "task":return d.ANNOTATION_TASK}return null})},showOccurrences:function(b){this.showAnnotations(b,
[d.ANNOTATION_READ_OCCURRENCE,d.ANNOTATION_WRITE_OCCURRENCE],null,function(a){return a.readAccess?d.ANNOTATION_READ_OCCURRENCE:d.ANNOTATION_WRITE_OCCURRENCE})},showBlame:function(b){var a=this._blameRGB,c=this.getTextView().getOptions("parent").ownerDocument;if(!a){var m=g.createElement(c,"div");m.className="annotation blame";c.body.appendChild(m);var n=(c.defaultView||c.parentWindow).getComputedStyle(m).getPropertyValue("background-color");m.parentNode.removeChild(m);var m=n.indexOf("("),h=n.indexOf(")"),
n=n.substring(m+1,h);this._blameRGB=a=n.split(",").slice(0,3)}var e=function(){var a=k.AnnotationType.createAnnotation(this.groupType,this.start,this.end,this.title);a.style=f.mixin({},a.style);a.style.style=f.mixin({},a.style.style);a.style.style.backgroundColor="";this.groupAnnotation=a;a.blame=this.blame;a.html=this.html;a.creatorID=this.creatorID;return a},q=function(){var a=g.createElement(c,"div");a.className="tooltipTitle";var b=this.blame.Message.indexOf("\n");-1===b&&(b=this.blame.Message.length);
var h=g.createElement(c,"a");h.href=this.blame.CommitLink;h.appendChild(c.createTextNode(this.blame.Message.substring(0,b)));a.appendChild(h);a.appendChild(g.createElement(c,"br"));a.appendChild(c.createTextNode(g.formatMessage(p.committerOnTime,this.blame.AuthorName,this.blame.Time)));return a},x=this.getModel();this.showAnnotations(b,[d.ANNOTATION_BLAME,d.ANNOTATION_CURRENT_BLAME],function(c){var b=x.getLineStart(c.Start-1),h=x.getLineEnd(c.End-1,!0),b=k.AnnotationType.createAnnotation(d.ANNOTATION_BLAME,
b,h,q),h=a.slice(0);h.push(c.Shade);b.style=f.mixin({},b.style);b.style.style=f.mixin({},b.style.style);b.style.style.backgroundColor="rgba("+h.join()+")";b.groupId=c.Name;b.groupType=d.ANNOTATION_CURRENT_BLAME;b.createGroupAnnotation=e;b.html='\x3cimg class\x3d"annotationHTML blame" src\x3d"'+c.AuthorImage+'"/\x3e';b.blame=c;return b})},showSelection:function(b,a,c,m,d){"number"===typeof b?("number"!==typeof a&&(a=b),this.moveSelection(b,a)):"number"===typeof c&&(b=this.getModel().getLineStart(c-
1),"number"===typeof m&&(b+=m),"number"!==typeof d&&(d=0),this.moveSelection(b,b+d))},_setModelText:function(b){this._textView&&(this._textView.setText(b),this._textView.getModel().setLineDelimiter("auto"),this._highlightCurrentLine(this._textView.getSelection()))},setInput:function(b,a,c,m,d){e.prototype.setInput.call(this,b,a,c,m);this._textView&&(!m&&!d)&&this._textView.focus()},onGotoLine:function(b,a,c,m){if(this._textView){var d=this.getModel();b=Math.max(0,Math.min(b,d.getLineCount()-1));var h=
d.getLineStart(b),e=0;void 0===c&&(c=0);"string"===typeof a?(b=d.getLine(b).indexOf(a),-1!==b&&(e=b,c=e+a.length)):(e=a,a=d.getLineEnd(b)-h,e=Math.min(e,a),c=Math.min(c,a));this.moveSelection(h+e,h+c,m)}}});return{BaseEditor:e,Editor:q}});
define("orion/editor/find","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/regex orion/objects orion/util".split(" "),function(p,t,r,k,f,g,e){function q(a){var c=a.getTextView();r.KeyMode.call(this,c);this.editor=a;this._active=!1;this._success=!0;this._ignoreSelection=!1;this._prefix="";c.setAction("incrementalFindCancel",function(){this.setActive(!1);return!0}.bind(this));c.setAction("incrementalFindBackspace",function(){return this._backspace()}.bind(this));
var b=this;this._listener={onVerify:function(a){var c=b.editor,d=c.getModel(),e=c.mapOffset(a.start),c=c.mapOffset(a.end),d=d.getText(e,c);if((d=b._prefix.match(RegExp("^"+f.escape(d),"i")))&&0<d.length)b._prefix+=a.text,b._success=!0,b._status(),b.find(b._forward,!0),a.text=null},onSelection:function(){b._ignoreSelection||b.setActive(!1)}}}function d(a,c,b){if(a){this._editor=a;this._undoStack=c;this._showAll=!0;this._visible=!1;this._wrap=this._caseInsensitive=!0;this._wholeWord=!1;this._incremental=
!0;this._regex=!1;this._findAfterReplace=!0;this._reverse=this._hideAfterFind=!1;this._timer=this._end=this._start=void 0;this._lastString="";var d=this;this._listeners={onEditorFocus:function(a){d._removeCurrentAnnotation(a)}};this.setOptions(b)}}var b={};q.prototype=new r.KeyMode;g.mixin(q.prototype,{createKeyBindings:function(){var a=t.KeyBinding,c=[];c.push({actionID:"incrementalFindBackspace",keyBinding:new a(8)});c.push({actionID:"incrementalFindCancel",keyBinding:new a(13)});c.push({actionID:"incrementalFindCancel",
keyBinding:new a(27)});c.push({actionID:"incrementalFindReverse",keyBinding:new a(38)});c.push({actionID:"incrementalFind",keyBinding:new a(40)});c.push({actionID:"incrementalFindReverse",keyBinding:new a("k",!0,!0)});c.push({actionID:"incrementalFind",keyBinding:new a("k",!0)});return c},find:function(a,c){this._forward=a;if(!this.isActive())return this.setActive(!0),!1;var b=this._prefix;if(0===b.length)return!1;var d=this.editor,h=d.getModel(),h=a?this._success?c?this._start:d.getCaretOffset()+
1:0:this._success?c?this._start:d.getCaretOffset():h.getCharCount()-1;(b=d.getModel().find({string:b,start:h,reverse:!a,caseInsensitive:b.toLowerCase()===b}).next())?(c||(this._start=h),this._ignoreSelection=this._success=!0,d.moveSelection(a?b.start:b.end,a?b.end:b.start),this._ignoreSelection=!1):this._success=!1;this._status();return!0},isActive:function(){return this._active},isStatusActive:function(){return this.isActive()},setActive:function(a){this._active!==a&&(this._active=a,this._prefix=
"",this._success=!0,a=this.editor.getTextView(),this._start=this.editor.getCaretOffset(),this.editor.setCaretOffset(this._start),this._active?(a.addEventListener("Verify",this._listener.onVerify),a.addEventListener("Selection",this._listener.onSelection),a.addKeyMode(this)):(a.removeEventListener("Verify",this._listener.onVerify),a.removeEventListener("Selection",this._listener.onSelection),a.removeKeyMode(this)),this._status())},_backspace:function(){var a=this._prefix,a=this._prefix=a.substring(0,
a.length-1);return 0===a.length?(this._ignoreSelection=this._success=!0,this.editor.setCaretOffset(this.editor.getSelection().start),this._ignoreSelection=!1,this._status(),!0):this.find(this._forward,!0)},_status:function(){if(this.isActive()){var a;a=this._forward?this._success?p.incrementalFindStr:p.incrementalFindStrNotFound:this._success?p.incrementalFindReverseStr:p.incrementalFindReverseStrNotFound;a=e.formatMessage(a,this._prefix);this.editor.reportStatus(a,this._success?"":"error")}else this.editor.reportStatus("")}});
b.IncrementalFind=q;d.prototype={find:function(a,c,b){this.setOptions({reverse:!a});var d=this.getFindString(),h;c&&(d=c.findString||d,h=c.count);a=this.getOptions();this.setOptions(c);c=b?this._startOffset:this.getStartOffset();if((h=this._doFind(d,c,h))&&!b)this._startOffset=h.start;this.setOptions(a);this._hideAfterFind&&this.hide();return h},getStartOffset:function(){return void 0!==this._start?this._start:this._reverse?this._editor.getSelection().start-1:this._editor.getCaretOffset()},getFindString:function(){var a=
this._editor.getSelection(),a=this._editor.getText(a.start,a.end);this._regex&&(a=f.escape(a));return a||this._lastString},getOptions:function(){return{showAll:this._showAll,caseInsensitive:this._caseInsensitive,wrap:this._wrap,wholeWord:this._wholeWord,incremental:this._incremental,regex:this._regex,findAfterReplace:this._findAfterReplace,hideAfterFind:this._hideAfterFind,reverse:this._reverse,findCallback:this._findCallback,start:this._start,end:this._end}},getReplaceString:function(){return""},
hide:function(){this._visible=!1;this._savedOptions&&(this.setOptions(this._savedOptions.pop()),0===this._savedOptions.length&&(this._savedOptions=null));this._removeAllAnnotations();var a=this._editor.getTextView();a&&(a.removeEventListener("Focus",this._listeners.onEditorFocus),a.focus())},_processReplaceString:function(a){var c=a;if(this._regex){for(var c="",b=!1,d=this._editor.getModel().getLineDelimiter(),h=0;h<a.length;h++){var e=a.substring(h,h+1);if(b){switch(e){case "R":c+=d;break;case "r":c+=
"\r";break;case "n":c+="\n";break;case "t":c+="\t";break;case "\\":c+="\\";break;default:c+="\\"+e}b=!1}else"\\"===e?b=!0:c+=e}b&&(c+="\\")}return c},isVisible:function(){return this._visible},replace:function(){var a=this.getFindString();if(a){var c=this._editor,b=this._processReplaceString(this.getReplaceString()),d=c.getSelection().start;if(c=c.getModel().find({string:a,start:d,reverse:!1,wrap:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive}).next())this.startUndo(),
this._doReplace(c.start,c.end,a,b),this.endUndo()}this._findAfterReplace&&a&&this._doFind(a,this.getStartOffset())},replaceAll:function(){var a=this.getFindString();if(a){this._replacingAll=!0;var c=this._editor,b=c.getTextView();c.reportStatus(p.replacingAll);var d=this._processReplaceString(this.getReplaceString()),h=this;window.setTimeout(function(){for(var f=0,g=0;;){var k=h._doFind(a,f,null,!0);if(!k)break;g++;1===g&&(b.setRedraw(!1),h.startUndo());h._doReplace(k.start,k.end,a,d);f=h.getStartOffset()}0<
g&&(h.endUndo(),b.setRedraw(!0));0<f?c.reportStatus(e.formatMessage(p.replacedMatches,g)):c.reportStatus(p.nothingReplaced,"error");h._replacingAll=!1},100)}},setOptions:function(a){if(a){if((!0===a.showAll||!1===a.showAll)&&this._showAll!==a.showAll)if(this._showAll=a.showAll,this.isVisible())if(this._showAll)this._markAllOccurrences();else{var c=this._editor.getAnnotationModel();c&&c.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH)}if(!0===a.caseInsensitive||!1===a.caseInsensitive)this._caseInsensitive=
a.caseInsensitive;if(!0===a.wrap||!1===a.wrap)this._wrap=a.wrap;if(!0===a.wholeWord||!1===a.wholeWord)this._wholeWord=a.wholeWord;if(!0===a.incremental||!1===a.incremental)this._incremental=a.incremental;if(!0===a.regex||!1===a.regex)this._regex=a.regex;if(!0===a.findAfterReplace||!1===a.findAfterReplace)this._findAfterReplace=a.findAfterReplace;if(!0===a.hideAfterFind||!1===a.hideAfterFind)this._hideAfterFind=a.hideAfterFind;if(!0===a.reverse||!1===a.reverse)this._reverse=a.reverse;a.hasOwnProperty("findCallback")&&
(this._findCallback=a.findCallback);a.hasOwnProperty("start")&&(this._start=a.start);a.hasOwnProperty("end")&&(this._end=a.end)}},show:function(a){this._visible=!0;a&&(this._savedOptions||(this._savedOptions=[]),this._savedOptions.push(this.getOptions()),this.setOptions(a));this._startOffset=this._editor.getSelection().start;this._editor.getTextView().addEventListener("Focus",this._listeners.onEditorFocus);var c=this;window.setTimeout(function(){c._incremental&&c.find(!0,null,!0)},0)},startUndo:function(){this._undoStack&&
this._undoStack.startCompoundChange()},endUndo:function(){this._undoStack&&this._undoStack.endCompoundChange()},_find:function(a,c,b){return this._editor.getModel().find({string:a,start:c,end:this._end,reverse:this._reverse,wrap:b?!1:this._wrap,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive})},_doFind:function(a,c,b,d){b=b||1;var h=this._editor;if(!a)return this._removeAllAnnotations(),null;this._lastString=a;var e,f;if(this._regex)try{f=this._find(a,c,d)}catch(g){h.reportStatus(g.message,
"error");return}else f=this._find(a,c,d);for(a=0;a<b&&f.hasNext();a++)e=f.next();if(!this._replacingAll){e?this._editor.reportStatus(""):this._editor.reportStatus(p.notFound,"error");if(this.isVisible()){b=k.AnnotationType.ANNOTATION_CURRENT_SEARCH;if(f=h.getAnnotationModel())f.removeAnnotations(b),e&&f.addAnnotation(k.AnnotationType.createAnnotation(b,e.start,e.end));if(this._showAll){this._timer&&window.clearTimeout(this._timer);var q=this;this._timer=window.setTimeout(function(){q._markAllOccurrences();
q._timer=null},500)}}this._findCallback?this._findCallback(e):e&&h.moveSelection(e.start,e.end,null,!1)}return e},_doReplace:function(a,c,b,d){var h=this._editor;this._regex&&(d=h.getText(a,c).replace(RegExp(b,this._caseInsensitive?"i":""),d));h.setText(d,a,c);h.setSelection(a,a+d.length,!0)},_markAllOccurrences:function(){var a=this._editor.getAnnotationModel();if(a){for(var c=k.AnnotationType.ANNOTATION_MATCHING_SEARCH,b=a.getAnnotations(),d=[],h;b.hasNext();){var e=b.next();e.type===c&&d.push(e)}if(this.isVisible()){b=
this.getFindString();b=this._editor.getModel().find({string:b,regex:this._regex,wholeWord:this._wholeWord,caseInsensitive:this._caseInsensitive});for(h=[];b.hasNext();)e=b.next(),h.push(k.AnnotationType.createAnnotation(c,e.start,e.end))}a.replaceAnnotations(d,h)}},_removeAllAnnotations:function(){var a=this._editor.getAnnotationModel();a&&(a.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH),a.removeAnnotations(k.AnnotationType.ANNOTATION_MATCHING_SEARCH))},_removeCurrentAnnotation:function(a){(a=
this._editor.getAnnotationModel())&&a.removeAnnotations(k.AnnotationType.ANNOTATION_CURRENT_SEARCH)}};b.Find=d;return b});
define("orion/editor/findUI",["i18n!orion/editor/nls/messages","orion/editor/find","orion/objects","orion/editor/util","orion/util"],function(p,t,r,k,f){function g(e,f,d){t.Find.call(this,e,f,d)}g.prototype=new t.Find;r.mixin(g.prototype,{getFindString:function(){var e=this._findInput;return!e?t.Find.prototype.getFindString.call(this):e.value},getReplaceString:function(){var e=this._replaceInput;return!e?t.Find.prototype.getReplaceString(this):e.value},hide:function(){var e=this.isVisible();t.Find.prototype.hide.call(this);
e&&(this._rootDiv.className="textViewFind")},show:function(e){t.Find.prototype.show.call(this,e);var f=e.findString;e=e.replaceString;var d=this._findInput;d||(this._create(),d=this._findInput);f&&(d.value=f);e&&(this._replaceInput.value=e);var b=this;window.setTimeout(function(){b._rootDiv.className="textViewFind show";d.select();d.focus()},0)},_create:function(){var e=this,g=this._editor.getTextView(),d=g.getOptions("parent").ownerDocument,b=f.createElement(d,"div");b.className="textViewFind";k.addEventListener(b,
"keydown",function(a){e._handleKeyDown(a)});this._rootDiv=b;this._createContents(d,b);g._rootDiv.insertBefore(b,g._rootDiv.firstChild)},_createContents:function(e,g){var d=this,b=f.createElement(e,"input");b.className="textViewFindInput";this._findInput=b;b.type="text";b.placeholder=p.findWith;k.addEventListener(b,"input",function(a){return d._handleInput(a)});g.appendChild(b);b=f.createElement(e,"span");d._createButton(e,b,p.next,function(){d.find(!0)});d._createButton(e,b,p.previous,function(){d.find(!1)});
g.appendChild(b);d._editor.getTextView().getOptions("readonly")||(b=f.createElement(e,"input"),b.className="textViewReplaceInput",this._replaceInput=b,b.type="text",b.placeholder=p.replaceWith,g.appendChild(b),b=f.createElement(e,"span"),d._createButton(e,b,p.replace,function(){d.replace()}),d._createButton(e,b,p.replaceAll,function(){d.replaceAll()}),g.appendChild(b));b=f.createElement(e,"span");d._createButton(e,b,p.regex,function(a){d._toggle("regex",a.target)},this._regex,p.regexTooltip);d._createButton(e,
b,p.caseInsensitive,function(a){d._toggle("caseInsensitive",a.target)},this._caseInsensitive,p.caseInsensitiveTooltip);d._createButton(e,b,p.wholeWord,function(a){d._toggle("wholeWord",a.target)},this._wholeWord,p.wholeWordTooltip);g.appendChild(b);b=d._createButton(e,g,"",function(){d.hide()});b.className="textViewFindCloseButton";b.title=p.closeTooltip},_createButton:function(e,f,d,b,a,c){var m=e.createElement("button");this._checked(a,m);c&&(m.title=c);k.addEventListener(m,"click",function(a){b.call(this,
a)},!1);d&&m.appendChild(e.createTextNode(d));f.appendChild(m);return m},_toggle:function(e,f){var d={};d[e]=!this["_"+e];this.setOptions(d);this._checked(d[e],f)},_checked:function(e,f){f.className="textViewFindButton";e&&(f.className+=" checked")},_handleInput:function(){this._incremental&&this.find(!0,null,!0);return!0},_handleKeyDown:function(e){var g,d=(f.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&!e.shiftKey;d&&70===e.keyCode&&(g=!0);if((f.isMac?e.metaKey:e.ctrlKey)&&!e.altKey&&75===e.keyCode||
13===e.keyCode)13===e.keyCode?this.find(this._reverse?e.shiftKey:!e.shiftKey):this.find(!e.shiftKey),g=!0;d&&82===e.keyCode&&(this.replace(),g=!0);27===e.keyCode&&(this.hide(),g=!0);return g?(e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):!0}});return{FindUI:g}});
define("orion/editor/actions","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/annotations orion/editor/tooltip orion/editor/find orion/editor/findUI orion/util".split(" "),function(p,t,r,k,f,g,e){function q(a,b,d){this.editor=a;this.undoStack=b;this._incrementalFind=new f.IncrementalFind(a);this._find=d?d:new g.FindUI(a,b);this._lastEditLocation=null;this.init()}function d(a,b,d,h){this.editor=a;this.undoStack=b;this.contentAssist=d;this.linkedMode=h;this.contentAssist&&this.contentAssist.addEventListener("ProposalApplied",
this.contentAssistProposalApplied.bind(this));this.init()}var b=r.AnnotationType,a={};q.prototype={init:function(){var a=this.editor.getTextView();this._lastEditListener={onModelChanged:function(a){this.editor.isDirty()&&(this._lastEditLocation=a.start+a.addedCharCount)}.bind(this)};a.addEventListener("ModelChanged",this._lastEditListener.onModelChanged);a.setAction("undo",function(a){if(this.undoStack){var c=1;a&&a.count&&(c=a.count);for(;0<c;)this.undoStack.undo(),--c;return!0}return!1}.bind(this),
{name:p.undo});a.setAction("redo",function(a){if(this.undoStack){var c=1;a&&a.count&&(c=a.count);for(;0<c;)this.undoStack.redo(),--c;return!0}return!1}.bind(this),{name:p.redo});a.setKeyBinding(new t.KeyBinding("f",!0),"find");a.setAction("find",function(){if(this._find){var a=this.editor.getSelection();this._find.show({findString:this.editor.getText(a.start,a.end)});return!0}return!1}.bind(this),{name:p.find});a.setKeyBinding(new t.KeyBinding("k",!0),"findNext");a.setAction("findNext",function(a){return this._find?
(this._find.find(!0,a),!0):!1}.bind(this),{name:p.findNext});a.setKeyBinding(new t.KeyBinding("k",!0,!0),"findPrevious");a.setAction("findPrevious",function(a){return this._find?(this._find.find(!1,a),!0):!1}.bind(this),{name:p.findPrevious});a.setKeyBinding(new t.KeyBinding("j",!0),"incrementalFind");a.setAction("incrementalFind",function(){this._incrementalFind&&this._incrementalFind.find(!0);return!0}.bind(this),{name:p.incrementalFind});a.setKeyBinding(new t.KeyBinding("j",!0,!0),"incrementalFindReverse");
a.setAction("incrementalFindReverse",function(){this._incrementalFind&&this._incrementalFind.find(!1);return!0}.bind(this),{name:p.incrementalFindReverse});a.setAction("tab",function(){return this.indentLines()}.bind(this));a.setAction("shiftTab",function(){return this.unindentLines()}.bind(this),{name:p.unindentLines});a.setKeyBinding(new t.KeyBinding(38,!1,!1,!0),"moveLinesUp");a.setAction("moveLinesUp",function(){return this.moveLinesUp()}.bind(this),{name:p.moveLinesUp});a.setKeyBinding(new t.KeyBinding(40,
!1,!1,!0),"moveLinesDown");a.setAction("moveLinesDown",function(){return this.moveLinesDown()}.bind(this),{name:p.moveLinesDown});a.setKeyBinding(new t.KeyBinding(38,!0,!1,!0),"copyLinesUp");a.setAction("copyLinesUp",function(){return this.copyLinesUp()}.bind(this),{name:p.copyLinesUp});a.setKeyBinding(new t.KeyBinding(40,!0,!1,!0),"copyLinesDown");a.setAction("copyLinesDown",function(){return this.copyLinesDown()}.bind(this),{name:p.copyLinesDown});a.setKeyBinding(new t.KeyBinding("d",!0,!1,!1),
"deleteLines");a.setAction("deleteLines",function(a){return this.deleteLines(a)}.bind(this),{name:p.deleteLines});a.setKeyBinding(new t.KeyBinding("l",!e.isMac,!1,!1,e.isMac),"gotoLine");a.setAction("gotoLine",function(){return this.gotoLine()}.bind(this),{name:p.gotoLine});a.setKeyBinding(new t.KeyBinding(190,!0),"nextAnnotation");a.setAction("nextAnnotation",function(){return this.nextAnnotation(!0)}.bind(this),{name:p.nextAnnotation});a.setKeyBinding(new t.KeyBinding(188,!0),"previousAnnotation");
a.setAction("previousAnnotation",function(){return this.nextAnnotation(!1)}.bind(this),{name:p.prevAnnotation});a.setKeyBinding(new t.KeyBinding("e",!0,!1,!0,!1),"expand");a.setAction("expand",function(){return this.expandAnnotation(!0)}.bind(this),{name:p.expand});a.setKeyBinding(new t.KeyBinding("c",!0,!1,!0,!1),"collapse");a.setAction("collapse",function(){return this.expandAnnotation(!1)}.bind(this),{name:p.collapse});a.setKeyBinding(new t.KeyBinding("e",!0,!0,!0,!1),"expandAll");a.setAction("expandAll",
function(){return this.expandAnnotations(!0)}.bind(this),{name:p.expandAll});a.setKeyBinding(new t.KeyBinding("c",!0,!0,!0,!1),"collapseAll");a.setAction("collapseAll",function(){return this.expandAnnotations(!1)}.bind(this),{name:p.collapseAll});a.setKeyBinding(new t.KeyBinding("q",!e.isMac,!1,!1,e.isMac),"lastEdit");a.setAction("lastEdit",function(){return this.gotoLastEdit()}.bind(this),{name:p.lastEdit})},copyLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;
var b=a.getModel(),d=a.getSelection(),h=b.getLineAtOffset(d.start),d=b.getLineAtOffset(d.end>d.start?d.end-1:d.end),e=b.getLineStart(h),h=b.getLineEnd(d,!0),f=b.getLineCount(),g="",e=b.getText(e,h);d===f-1&&(e=(g=b.getLineDelimiter())+e);a.setText(e,h,h);a.setSelection(h+g.length,h+e.length);return!0},copyLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=a.getSelection(),h=b.getLineAtOffset(d.start),d=b.getLineAtOffset(d.end>d.start?d.end-
1:d.end),h=b.getLineStart(h),e=b.getLineEnd(d,!0),f=b.getLineCount(),g="",e=b.getText(h,e);d===f-1&&(e+=g=b.getLineDelimiter());a.setText(e,h,h);a.setSelection(h,h+e.length-g.length);return!0},deleteLines:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=1;a&&a.count&&(d=a.count);var h=b.getSelection(),e=b.getModel(),f=e.getLineAtOffset(h.start);a=e.getLineStart(f);d=h.start!==h.end||1===d?e.getLineAtOffset(h.end>h.start?h.end-1:h.end):Math.min(f+d-1,e.getLineCount()-
1);d=e.getLineEnd(d,!0);b.setText("",a,d);return!0},expandAnnotation:function(a){var b=this.editor,d=b.getAnnotationModel();if(!d)return!0;var h=b.getModel(),e=b.getCaretOffset(),f=h.getLineAtOffset(e),e=h.getLineStart(f),f=h.getLineEnd(f,!0);h.getBaseModel&&(e=h.mapOffset(e),f=h.mapOffset(f),h.getBaseModel());for(var g,d=d.getAnnotations(e,f);!g&&d.hasNext();)h=d.next(),h.type===r.AnnotationType.ANNOTATION_FOLDING&&(g=h);g&&a!==g.expanded&&(a?g.expand():(b.setCaretOffset(g.start),g.collapse()));
return!0},expandAnnotations:function(a){var b=this.editor,d=b.getTextView(),b=b.getAnnotationModel();if(!b)return!0;var h=b.getAnnotations();for(d.setRedraw(!1);h.hasNext();)b=h.next(),b.type===r.AnnotationType.ANNOTATION_FOLDING&&a!==b.expanded&&(a?b.expand():b.collapse());d.setRedraw(!0);return!0},indentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){var d=a.getModel(),h=a.getSelection(),e=d.getLineAtOffset(h.start),f=d.getLineAtOffset(h.end>
h.start?h.end-1:h.end);if(e!==f){var g=[];g.push("");for(var k=e;k<=f;k++)g.push(d.getLine(k,!0));k=d.getLineStart(e);d=d.getLineEnd(f,!0);b=b.getOptions("tabSize","expandTab");b=b.expandTab?Array(b.tabSize+1).join(" "):"\t";a.setText(g.join(b),k,d);a.setSelection(k===h.start?h.start:h.start+b.length,h.end+(f-e+1)*b.length);return!0}return!1}},gotoLastEdit:function(){"number"===typeof this._lastEditLocation&&this.editor.showSelection(this._lastEditLocation);return!0},gotoLine:function(){var a=this.editor,
b=a.getModel().getLineAtOffset(a.getCaretOffset());if(b=prompt(p.gotoLinePrompty,b+1))b=parseInt(b,10),a.onGotoLine(b-1,0);return!0},moveLinesDown:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=a.getSelection(),h=b.getLineAtOffset(d.start),e=b.getLineAtOffset(d.end>d.start?d.end-1:d.end),f=b.getLineCount();if(e===f-1)return!0;var h=b.getLineStart(h),d=b.getLineEnd(e,!0),g=b.getLineEnd(e+1,!0)-(d-h),k=0;e!==f-2?b=b.getText(h,d):(e=b.getLineEnd(e),
b=b.getText(e,d)+b.getText(h,e),k+=d-e);this.startUndo();a.setText("",h,d);a.setText(b,g,g);a.setSelection(g+k,g+k+b.length);this.endUndo();return!0},moveLinesUp:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=a.getSelection(),h=b.getLineAtOffset(d.start);if(0===h)return!0;var e=b.getLineAtOffset(d.end>d.start?d.end-1:d.end),f=b.getLineCount(),d=b.getLineStart(h-1),g=b.getLineStart(h),k=b.getLineEnd(e,!0),q=b.getText(g,k),p=0;e===f-1&&(e=b.getLineEnd(h-
1),h=b.getLineEnd(h-1,!0),q+=b.getText(e,h),g=e,p=h-e);this.startUndo();a.setText("",g,k);a.setText(q,d,d);a.setSelection(d,d+q.length-p);this.endUndo();return!0},nextAnnotation:function(a){function d(a){return!!a.lineStyle||a.type===b.ANNOTATION_MATCHING_BRACKET||a.type===b.ANNOTATION_CURRENT_BRACKET||!f.isAnnotationTypeVisible(a.type)}var e=this.editor,h=e.getAnnotationModel();if(!h)return!0;var f=e.getOverviewRuler()||e.getAnnotationStyler();if(!f)return!0;for(var g=e.getModel(),q=e.getCaretOffset(),
p=h.getAnnotations(a?q:0,a?g.getCharCount():q),r=null;p.hasNext();){var t=p.next();if(a){if(t.start<=q)continue}else if(t.start>=q)continue;if(!d(t)&&(r=t,a))break}if(r){for(var C=[r],p=h.getAnnotations(r.start,r.start);p.hasNext();)t=p.next(),t!==r&&!d(t)&&C.push(t);var l=e.getTextView(),u=g.getLineAtOffset(r.start),B=k.Tooltip.getTooltip(l);if(!B)return e.moveSelection(r.start),!0;e.moveSelection(r.start,r.start,function(){B.setTarget({getTooltipInfo:function(){var a=l.convert({x:l.getLocationAtOffset(r.start).x,
y:l.getLocationAtOffset(g.getLineStart(u)).y},"document","page");return{contents:C,x:a.x,y:a.y+Math.floor(1.33*l.getLineHeight(u))}}},0)})}return!0},unindentLines:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;if(b.getOptions("tabMode")){for(var d=a.getModel(),h=a.getSelection(),e=d.getLineAtOffset(h.start),f=d.getLineAtOffset(h.end>h.start?h.end-1:h.end),g=b.getOptions("tabSize"),k=Array(g+1).join(" "),q=[],p=b=0,r=e;r<=f;r++){var l=d.getLine(r,!0);if(d.getLineStart(r)!==
d.getLineEnd(r))if(0===l.indexOf("\t"))l=l.substring(1),b++;else if(0===l.indexOf(k))l=l.substring(g),b+=g;else return!0;r===e&&(p=b);q.push(l)}e=d.getLineStart(e);g=d.getLineEnd(f,!0);d=d.getLineStart(f);a.setText(q.join(""),e,g);f=e===h.start?h.start:h.start-p;h=Math.max(f,h.end-b+(h.end===d+1&&h.start!==h.end?1:0));a.setSelection(f,h);return!0}},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()}};a.TextActions=
q;d.prototype={init:function(){var a=this.editor.getTextView();a.setAction("lineStart",function(){return this.lineStart()}.bind(this));a.setAction("enter",function(){return this.autoIndent()}.bind(this));a.setKeyBinding(new t.KeyBinding("t",!0,!1,!0),"trimTrailingWhitespaces");a.setAction("trimTrailingWhitespaces",function(){return this.trimTrailingWhitespaces()}.bind(this),{name:p.trimTrailingWhitespaces});a.setKeyBinding(new t.KeyBinding(191,!0),"toggleLineComment");a.setAction("toggleLineComment",
function(){return this.toggleLineComment()}.bind(this),{name:p.toggleLineComment});a.setKeyBinding(new t.KeyBinding(191,!0,!e.isMac,!1,e.isMac),"addBlockComment");a.setAction("addBlockComment",function(){return this.addBlockComment()}.bind(this),{name:p.addBlockComment});a.setKeyBinding(new t.KeyBinding(220,!0,!e.isMac,!1,e.isMac),"removeBlockComment");a.setAction("removeBlockComment",function(){return this.removeBlockComment()}.bind(this),{name:p.removeBlockComment});a.setKeyBinding(new t.KeyBinding("[",
!1,!1,!1,!1,"keypress"),"autoPairSquareBracket");a.setAction("autoPairSquareBracket",function(){return this.autoPairBrackets("[","]")}.bind(this));a.setKeyBinding(new t.KeyBinding("]",!1,!1,!1,!1,"keypress"),"skipClosingSquareBracket");a.setAction("skipClosingSquareBracket",function(){return this.skipClosingBracket("]")}.bind(this));a.setKeyBinding(new t.KeyBinding("\x3c",!1,!1,!1,!1,"keypress"),"autoPairAngleBracket");a.setAction("autoPairAngleBracket",function(){return this.autoPairBrackets("\x3c",
"\x3e")}.bind(this));a.setKeyBinding(new t.KeyBinding("\x3e",!1,!1,!1,!1,"keypress"),"skipClosingAngleBracket");a.setAction("skipClosingAngleBracket",function(){return this.skipClosingBracket("\x3e")}.bind(this));a.setKeyBinding(new t.KeyBinding("(",!1,!1,!1,!1,"keypress"),"autoPairParentheses");a.setAction("autoPairParentheses",function(){return this.autoPairBrackets("(",")")}.bind(this));a.setKeyBinding(new t.KeyBinding(")",!1,!1,!1,!1,"keypress"),"skipClosingParenthesis");a.setAction("skipClosingParenthesis",
function(){return this.skipClosingBracket(")")}.bind(this));a.setKeyBinding(new t.KeyBinding("{",!1,!1,!1,!1,"keypress"),"autoPairBraces");a.setAction("autoPairBraces",function(){return this.autoPairBrackets("{","}")}.bind(this));a.setKeyBinding(new t.KeyBinding("}",!1,!1,!1,!1,"keypress"),"skipClosingBrace");a.setAction("skipClosingBrace",function(){return this.skipClosingBracket("}")}.bind(this));a.setKeyBinding(new t.KeyBinding("'",!1,!1,!1,!1,"keypress"),"autoPairSingleQuotation");a.setAction("autoPairSingleQuotation",
function(){return this.autoPairQuotations("'")}.bind(this));a.setKeyBinding(new t.KeyBinding('"',!1,!1,!1,!1,"keypress"),"autoPairDblQuotation");a.setAction("autoPairDblQuotation",function(){return this.autoPairQuotations('"')}.bind(this));a.setAction("deletePrevious",function(){return this.deletePrevious()}.bind(this))},autoIndent:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly")||b.getOptions("singleMode"))return!1;var d=a.getSelection();if(d.start===d.end){for(var h=a.getModel(),
e=h.getLineAtOffset(d.start),f=h.getLine(e,!1),g=h.getLineStart(e),k=0,q=d.start-g,p;k<q&&(32===(p=f.charCodeAt(k))||9===p);)k++;var g=f.substring(0,k),b=b.getOptions("tabSize","expandTab"),r=b.expandTab?Array(b.tabSize+1).join(" "):"\t",b=h.getLineDelimiter(),l=/^[\s]*\/\*[\*]*[\s]*$/,t=/^[\s]*\*/,B=/\*\/[\s]*$/,A=f.substring(0,q),D=f.substring(q),H;if(this.smartIndentation&&123===f.charCodeAt(H=A.trimRight().length-1))return h=q-H-1,D=D.length-D.trimLeft().length,f=125===f.charCodeAt(q+D)?b+g+r+
b+g:b+g+r,a.setText(f,d.start-h,d.end+D),a.setCaretOffset(d.start+b.length+g.length+r.length-h),!0;if(this.autoCompleteComments&&!B.test(A)&&(l.test(A)||t.test(A))){if(k=l.exec(A)){f=b+g+" * ";f=B.test(D)?f+D.substring(0,D.length-2).trim():f+D.trim();if(h.getLineCount()===e+1||!t.test(h.getLine(e+1)))f+=b+g+" */";a.setText(f,d.start,d.end+D.length);a.setCaretOffset(d.start+b.length+g.length+3);return!0}if(k=t.exec(A))for(e-=1;0<=e;e--){k=h.getLine(e,!1);if(l.test(k))return B.test(D)||47===f.charCodeAt(q)?
(f=b+g+"*"+D,g=d.start+b.length+g.length+1):(f=b+g+"* "+D,g=d.start+b.length+g.length+2),a.setText(f,d.start,d.end+D.length),a.setCaretOffset(g),!0;if(!t.test(k))break}}else{if(B.test(A)&&32===g.charCodeAt(g.length-1))return f=b+g.substring(0,g.length-1),a.setText(f,d.start,d.end),a.setCaretOffset(d.start+f.length),!0;if(0<k){for(k=q;k<f.length&&(32===(p=f.charCodeAt(k++))||9===p);)d.end++;a.setText(h.getLineDelimiter()+g,d.start,d.end);return!0}}}return!1},addBlockComment:function(){var a=this.editor;
if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=a.getSelection(),h=this._findEnclosingComment(b,d.start,d.end);if(void 0!==h.commentStart&&void 0!==h.commentEnd)return!0;b=b.getText(d.start,d.end);if(0===b.length)return!0;var h=b.length,b=b.replace(/\/\*|\*\//g,""),e=b.length;a.setText("/*"+b+"*/",d.start,d.end);a.setSelection(d.start+2,d.end+2+(e-h));return!0},autoPairBrackets:function(a,b){if("["===a&&!this.autoPairSquareBrackets||"{"===a&&!this.autoPairBraces||"("===a&&
!this.autoPairParentheses||"\x3c"===a&&!this.autoPairAngleBrackets)return!1;var d=this.editor;if(d.getTextView().getOptions("readonly"))return!1;var h=d.getSelection(),e=d.getModel(),f=d.getCaretOffset()===e.getCharCount()?"":e.getText(h.start,h.start+1).trim(),g=/^$|[)}\]>]/;return h.start===h.end&&g.test(f)?(d.setText(a+b,h.start,h.start),d.setCaretOffset(h.start+1),!0):h.start!==h.end?(e=e.getText(h.start,h.end),d.setText(a+e+b,h.start,h.end),d.setSelection(h.start+1,h.end+1),!0):!1},autoPairQuotations:function(a){if(!this.autoPairQuotation)return!1;
var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=b.getSelection(),h=b.getModel(),e=b.getCaretOffset(),f=0===e?"":h.getText(d.start-1,d.start).trim(),g=e===h.getCharCount()?"":h.getText(d.start,d.start+1).trim(),e=/^"$|^'$/,k=/\w/,q=/^$|[)}\]>]/;if(d.start!==d.end){h=h.getText(d.start,d.end);if(e.test(h))return!1;b.setText(a+h+a,d.start,d.end);b.setSelection(d.start+1,d.end+1)}else{if(g!==a){if(f===a||e.test(g)||k.test(f)||!q.test(g))return!1;b.setText(a+a,d.start,d.start)}b.setCaretOffset(d.start+
1)}return!0},contentAssistProposalApplied:function(a){function b(){return"number"===typeof d.escapePosition?d.escapePosition:a.data.start+d.proposal.length}var d=a.data.proposal;if(d.positions&&0<d.positions.length&&this.linkedMode){for(var h=[],e=0;e<d.positions.length;++e)h[e]={positions:[{offset:d.positions[e].offset,length:d.positions[e].length}]};this.linkedMode.enterLinkedMode({groups:h,escapePosition:b()})}else d.groups&&0<d.groups.length&&this.linkedMode?this.linkedMode.enterLinkedMode({groups:d.groups,
escapePosition:b()}):"number"===typeof d.escapePosition&&this.editor.getTextView().setCaretOffset(d.escapePosition);return!0},deletePrevious:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getSelection();if(b.start!==b.end)return!1;var d=a.getModel(),h=a.getCaretOffset(),e=0===h?"":d.getText(b.start-1,b.start),d=h===d.getCharCount()?"":d.getText(b.start,b.start+1);("("===e&&")"===d||"["===e&&"]"===d||"{"===e&&"}"===d||"\x3c"===e&&"\x3e"===d||'"'===e&&'"'===
d||"'"===e&&"'"===d)&&a.setText("",b.start,b.start+1);return!1},_findEnclosingComment:function(a,b,d){var h=a.getLineAtOffset(b),e=a.getLineAtOffset(d),f,g,k,q,p,r;for(f=h;0<=f&&!(g=a.getLine(f),k=f===h?b-a.getLineStart(h):g.length,q=g.lastIndexOf("/*",k),g=g.lastIndexOf("*/",k),g>q);f--)if(-1!==q){p=a.getLineStart(f)+q;break}for(f=e;f<a.getLineCount()&&!(g=a.getLine(f),k=f===e?d-a.getLineStart(e):0,q=g.indexOf("/*",k),g=g.indexOf("*/",k),-1!==q&&q<g);f++)if(-1!==g){r=a.getLineStart(f)+g;break}return{commentStart:p,
commentEnd:r}},lineStart:function(){for(var a=this.editor,b=a.getModel(),d=a.getCaretOffset(),h=b.getLineAtOffset(d),e=b.getLineStart(h),b=b.getLine(h),h=0;h<b.length;h++){var f=b.charCodeAt(h);if(!(32===f||9===f))break}h+=e;return d!==h?(a.setSelection(h,h),!0):!1},removeBlockComment:function(){var a=this.editor;if(a.getTextView().getOptions("readonly"))return!1;var b=a.getModel(),d=a.getSelection(),h=b.getText(d.start,d.end),e,f,g;for(g=0;g<h.length;g++)if("/*"===h.substring(g,g+2)){e=d.start+g;
break}for(;g<h.length;g++)if("*/"===h.substring(g,g+2)){f=d.start+g;break}if(void 0!==e&&void 0!==f)a.setText(b.getText(e+2,f),e,f+2),a.setSelection(e,f);else{h=this._findEnclosingComment(b,d.start,d.end);if(void 0===h.commentStart||void 0===h.commentEnd)return!0;b=b.getText(h.commentStart+2,h.commentEnd);a.setText(b,h.commentStart,h.commentEnd+2);a.setSelection(d.start-2,d.end-2)}return!0},toggleLineComment:function(){var a=this.editor,b=a.getTextView();if(b.getOptions("readonly"))return!1;for(var d=
this.lineComment||"//",h=a.getModel(),e=a.getSelection(),f=h.getLineAtOffset(e.start),g=h.getLineAtOffset(e.end>e.start?e.end-1:e.end),k=!0,q=[],p,r=f;r<=g;r++){var l=h.getLine(r,!0);p=l.indexOf(d);q.push(p);if(!k||-1===p)k=!1;else if(0!==p){for(k=0;k<p;k++){var t=l.charCodeAt(k);if(!(32===t||9===t))break}k=k===p}}r=d.length;l=h.getLineStart(f);b.setRedraw(!1);this.startUndo();if(k){for(k=q.length-1;0<=k;k--)p=q[k]+h.getLineStart(f+k),a.setText("",p,p+r);h=h.getLineStart(g);d=l===e.start?e.start:
e.start-r;e=e.end-r*(g-f+1)+(e.end===h+1?r:0)}else{for(k=q.length-1;0<=k;k--)p=h.getLineStart(f+k),a.setText(d,p,p);d=l===e.start?e.start:e.start+r;e=e.end+r*(g-f+1)}this.endUndo();a.setSelection(d,e);b.setRedraw(!0);return!0},trimTrailingWhitespaces:function(){var a=this.editor,b=a.getModel(),d=a.getSelection();a.getTextView().setRedraw(!1);a.getUndoStack().startCompoundChange();for(var h=/(\s+$)/,e=b.getLineCount(),f=0;f<e;f++){var g=b.getLine(f),k=h.exec(g);if(k){var q=b.getLineStart(f),g=k[0].length,
k=q+k.index;b.setText("",k,k+g);d.start>k&&(d.start=Math.max(k,d.start-g));d.start!==d.end&&d.end>k&&(d.end=Math.max(k,d.end-g))}}a.getUndoStack().endCompoundChange();a.setSelection(d.start,d.end,!1);a.getTextView().setRedraw(!0)},startUndo:function(){this.undoStack&&this.undoStack.startCompoundChange()},skipClosingBracket:function(a){var b=this.editor;if(b.getTextView().getOptions("readonly"))return!1;var d=b.getSelection(),h=b.getModel();return(b.getCaretOffset()===h.getCharCount()?"":h.getText(d.start,
d.start+1))===a?(b.setCaretOffset(d.start+1),!0):!1},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},setAutoPairParentheses:function(a){this.autoPairParentheses=a},setAutoPairBraces:function(a){this.autoPairBraces=a},setAutoPairSquareBrackets:function(a){this.autoPairSquareBrackets=a},setAutoPairAngleBrackets:function(a){this.autoPairAngleBrackets=a},setAutoPairQuotations:function(a){this.autoPairQuotation=a},setAutoCompleteComments:function(a){this.autoCompleteComments=a},
setLineComment:function(a){this.lineComment=a},setSmartIndentation:function(a){this.smartIndentation=a}};a.SourceCodeActions=d;String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/g,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/g,"")});return a});
define("orion/editor/templates",[],function(){function p(p,k,f,g){this.prefix=p;this.description=k;this.template=f;this.name=g;this._parse()}function t(p,k){this._keywords=p||[];this._templates=[];this.addTemplates(k||[])}p.prototype={getProposal:function(p,k,f){p=k-p.length;k={};var g,e=void 0!==f.delimiter?f.delimiter:"\n";f.indentation&&(e+=f.indentation);var q=void 0!==f.tab?f.tab:"\t",d=0,b=this.variables,a=this.segments;f=[];for(var c=0;c<a.length;c++){var m=a[c],n=b[m];if(void 0!==n)switch(m){case "${tab}":m=
q;break;case "${delimiter}":m=e;break;case "${cursor}":m="";g=d;break;default:var h=k[m];h||(h=k[m]={data:n.data,positions:[]});m=n.substitution;h.data&&h.data.values&&(m=h.data.values[0]);h.positions.push({offset:p+d,length:m.length})}f.push(m);d+=m.length}var e=[],s;for(s in k)k.hasOwnProperty(s)&&e.push(k[s]);f=f.join("");void 0===g&&(g=f.length);return{proposal:f,name:this.name,description:this.description,groups:e,escapePosition:p+g,style:"noemphasis"}},match:function(p){return 0===this.prefix.indexOf(p)},
_parse:function(){var p=this.template,k=[],f={},g,e=0,p=p.replace(/\n/g,"${delimiter}"),p=p.replace(/\t/g,"${tab}");p.replace(/\$\{((?:[^\\}]+|\\.))*\}/g,function(q,d,b){var a=q.substring(2,q.length-1);d=q;var c=a,m=null,n=c.indexOf(":");-1!==n&&(c=c.substring(0,n),d="${"+c+"}",m=JSON.parse(a.substring(n+1).replace("\\}","}").trim()));(a=f[d])||(a=f[d]={});a.substitution=c;m&&(a.data=m);(g=p.substring(e,b))&&k.push(g);k.push(d);e=b+q.length;return c});(g=p.substring(e,p.length))&&k.push(g);this.segments=
k;this.variables=f}};t.prototype={addTemplates:function(r){for(var k=this.getTemplates(),f=0;f<r.length;f++)k.push(new p(r[f].prefix,r[f].description,r[f].template,r[f].name))},initialize:function(){},computeProposals:function(p,k,f){var g=this.getPrefix(p,k,f),e=[];this.isValid(g,p,k,f)&&(e=e.concat(this.getTemplateProposals(g,k,f)),e=e.concat(this.getKeywordProposals(g)));return e},getKeywords:function(){return this._keywords},getKeywordProposals:function(p){var k=[],f=this.getKeywords();if(f){for(var g=
0;g<f.length;g++)0===f[g].indexOf(p)&&k.push({proposal:f[g].substring(p.length),description:f[g],style:"noemphasis_keyword"});0<k.length&&k.splice(0,0,{proposal:"",description:"Keywords",style:"noemphasis_title_keywords",unselectable:!0})}return k},getPrefix:function(p,k,f){return f.prefix},getTemplates:function(){return this._templates},getTemplateProposals:function(p,k,f){for(var g=[],e=this.getTemplates(),q=0;q<e.length;q++){var d=e[q];d.match(p)&&(d=d.getProposal(p,k,f),this.removePrefix(p,d),
g.push(d))}0<g.length&&(g.sort(function(b,a){return b.name<a.name?-1:b.name>a.name?1:0}),g.splice(0,0,{proposal:"",description:"Templates",style:"noemphasis_title",unselectable:!0}));return g},removePrefix:function(p,k){if(!(k.overwrite=k.proposal.substring(0,p.length)!==p))k.proposal=k.proposal.substring(p.length)},isValid:function(p,k,f,g){return!0}};return{Template:p,TemplateContentAssist:t}});
define("orion/editor/linkedMode","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/annotations orion/editor/templates orion/objects orion/util".split(" "),function(p,t,r,k,f,g){function e(d,b,a){var c=d.getTextView();r.KeyMode.call(this,c);this.editor=d;this.undoStack=b;this.contentAssist=a;this.linkedModeModel=null;c.setAction("linkedModeEnter",function(){this.exitLinkedMode(!0);return!0}.bind(this));c.setAction("linkedModeCancel",function(){this.exitLinkedMode(!1);
return!0}.bind(this));c.setAction("linkedModeNextGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup((a.selectedGroupIndex+1)%a.groups.length);return!0}.bind(this));c.setAction("linkedModePreviousGroup",function(){var a=this.linkedModeModel;this.selectLinkedGroup(0<a.selectedGroupIndex?a.selectedGroupIndex-1:a.groups.length-1);return!0}.bind(this));this.linkedModeListener={onActivating:function(a){this._groupContentAssistProvider&&(this.contentAssist.setProviders([this._groupContentAssistProvider]),
this.contentAssist.setProgress(null))}.bind(this),onModelChanged:function(a){if(!this.ignoreVerify){for(var b=this.editor.mapOffset(a.start),c=this.linkedModeModel,d,e;c;)if(d=this._getPositionChanged(c,b,b+a.removedCharCount),e=d.position,void 0===e||e.model!==c)this.exitLinkedMode(!1),c=this.linkedModeModel;else break;if(c){c=0;a=a.addedCharCount-a.removedCharCount;d=d.positions;for(var f,g=0;g<d.length;++g){f=d[g];e=f.position;var k=e.offset<=b&&b<=e.offset+e.length;k&&!f.ansestor?(e.offset+=c,
e.length+=a,c+=a):(e.offset+=c,f.ansestor&&k&&(e.length+=a));f.escape&&(f.model.escapePosition=e.offset)}this._updateAnnotations(d)}}}.bind(this),onVerify:function(a){if(!this.ignoreVerify){for(var b=this.editor,c=b.mapOffset(a.start),d=this.editor.mapOffset(a.end),e=this.linkedModeModel,f,g;e;)if(f=this._getPositionChanged(e,c,d),g=f.position,void 0===g||g.model!==e)this.exitLinkedMode(!1),e=this.linkedModeModel;else break;if(e){var k=this._compoundChange;k?k.owner.model===e&&k.owner.group===g.group||
(this.endUndo(),this.startUndo()):this.startUndo();e.selectedGroupIndex=g.group;var k=0,q=a.text.length-(d-c);f=f.positions;for(var p,c=c-g.position.offset,l=d-g.position.offset,r=0;r<f.length;++r)p=f[r],d=p.position,p.oldOffset=d.offset,p.model===e&&p.group===g.group?(d.offset+=k,d.length+=q,k+=q):(d.offset+=k,p.ansestor&&(d.length+=g.count*q)),p.escape&&(p.model.escapePosition=d.offset);this.ignoreVerify=!0;for(r=f.length-1;0<=r;r--)p=f[r],p.model===e&&p.group===g.group&&b.setText(a.text,p.oldOffset+
c,p.oldOffset+l);this.ignoreVerify=!1;a.text=null;this._updateAnnotations(f)}}}.bind(this)}}var q={};e.prototype=new r.KeyMode;g.mixin(e.prototype,{createKeyBindings:function(){var d=t.KeyBinding,b=[];b.push({actionID:"linkedModeEnter",keyBinding:new d(13)});b.push({actionID:"linkedModeCancel",keyBinding:new d(27)});b.push({actionID:"linkedModeNextGroup",keyBinding:new d(9)});b.push({actionID:"linkedModePreviousGroup",keyBinding:new d(9,!1,!0)});return b},enterLinkedMode:function(d){if(!this.linkedModeModel){var b=
this.editor.getTextView();b.addKeyMode(this);b.addEventListener("Verify",this.linkedModeListener.onVerify);b.addEventListener("ModelChanged",this.linkedModeListener.onModelChanged);this.contentAssist.addEventListener("Activating",this.linkedModeListener.onActivating);this.editor.reportStatus(p.linkedModeEntered,null,!0)}this._sortedPositions=null;this.linkedModeModel&&(d.previousModel=this.linkedModeModel,d.parentGroup=this.linkedModeModel.selectedGroupIndex,this.linkedModeModel.nextModel=d);this.linkedModeModel=
d;this.selectLinkedGroup(0)},exitLinkedMode:function(d){if(this.isActive()){this._compoundChange&&(this.endUndo(),this._compoundChange=null);this._sortedPositions=null;var b=this.linkedModeModel;this.linkedModeModel=b.previousModel;b.parentGroup=b.previousModel=void 0;this.linkedModeModel&&(this.linkedModeModel.nextModel=void 0);if(!this.linkedModeModel){var a=this.editor,c=a.getTextView();c.removeKeyMode(this);c.removeEventListener("Verify",this.linkedModeListener.onVerify);c.removeEventListener("ModelChanged",
this.linkedModeListener.onModelChanged);c=this.contentAssist;c.removeEventListener("Activating",this.linkedModeListener.onActivating);c.offset=void 0;this.editor.reportStatus(p.linkedModeExited,null,!0);d&&"number"===typeof b.escapePosition&&a.setCaretOffset(b.escapePosition,!1)}this.selectLinkedGroup(0)}},startUndo:function(){if(this.undoStack){var d=this,b=this.linkedModeModel;this._compoundChange=this.undoStack.startCompoundChange({model:b,group:b.selectedGroupIndex,end:function(){d._compoundChange=
null}})}},endUndo:function(){this.undoStack&&this.undoStack.endCompoundChange()},isActive:function(){return!!this.linkedModeModel},isStatusActive:function(){return!!this.linkedModeModel},selectLinkedGroup:function(d){var b=this.linkedModeModel;if(b){b.selectedGroupIndex=d;d=b.groups[d];var a=d.positions[0],c=this.editor;c.setSelection(a.offset,a.offset+a.length);if(b=this.contentAssist)b.offset=void 0,d.data&&"link"===d.data.type&&d.data.values?((this._groupContentAssistProvider=new f.TemplateContentAssist(d.data.values)).getPrefix=
function(){var b=c.getSelection();return b.start===b.end&&(b=c.getCaretOffset(),a.offset<=b&&b<=a.offset+a.length)?c.getText(a.offset,b):""},b.offset=a.offset,b.deactivate(),b.activate()):this._groupContentAssistProvider&&(this._groupContentAssistProvider=null,b.deactivate())}this._updateAnnotations()},_getModelPositions:function(d,b,a){for(var c=b.groups,e=0;e<c.length;e++)for(var f=c[e].positions,h=0;h<f.length;h++){var g=f[h];a&&(g={offset:g.offset+a,length:g.length});g={index:h,group:e,count:f.length,
model:b,position:g};d.push(g);b.nextModel&&b.nextModel.parentGroup===e&&(g.ansestor=!0,this._getModelPositions(d,b.nextModel,(a||0)+f[h].offset-f[0].offset))}},_getSortedPositions:function(d){var b=this._sortedPositions;if(!b){for(b=[];d.previousModel;)d=d.previousModel;for(this._getModelPositions(b,d);d;)"number"===typeof d.escapePosition&&b.push({escape:!0,model:d,position:{offset:d.escapePosition,length:0}}),d=d.nextModel;b.sort(function(a,b){return a.position.offset-b.position.offset});this._sortedPositions=
b}return b},_getPositionChanged:function(d,b,a){var c;d=this._getSortedPositions(d);for(var e=d.length-1;0<=e;e--){var f=d[e].position;if(f.offset<=b&&a<=f.offset+f.length){c=d[e];break}}return{position:c,positions:d}},_updateAnnotations:function(d){var b=this.editor.getAnnotationModel();if(b){for(var a=[],c=[],e=b.getAnnotations(),f;e.hasNext();)switch(f=e.next(),f.type){case k.AnnotationType.ANNOTATION_LINKED_GROUP:case k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP:case k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:a.push(f)}if(e=
this.linkedModeModel){d=d||this._getSortedPositions(e);for(var h=0;h<d.length;h++)if(f=d[h],f.model===e&&!f.escape){var g=k.AnnotationType.ANNOTATION_LINKED_GROUP;f.group===e.selectedGroupIndex&&(g=0===f.index?k.AnnotationType.ANNOTATION_SELECTED_LINKED_GROUP:k.AnnotationType.ANNOTATION_CURRENT_LINKED_GROUP);f=f.position;f=k.AnnotationType.createAnnotation(g,f.offset,f.offset+f.length,"");c.push(f)}}b.replaceAnnotations(a,c)}}});q.LinkedMode=e;return q});
define("orion/editor/factories","orion/editor/actions orion/editor/undoStack orion/editor/rulers orion/editor/annotations orion/editor/textDND orion/editor/linkedMode orion/util".split(" "),function(p,t,r,k,f,g,e){function q(){}function d(){}function b(){}function a(){}function c(){}function m(){}function n(){}var h={};q.prototype={createKeyBindings:function(a,b,c,d){d=new p.TextActions(a,b,d);var h=new g.LinkedMode(a,b,c);a=new p.SourceCodeActions(a,b,c,h);return{textActions:d,linkedMode:h,sourceCodeActions:a}}};
h.KeyBindingsFactory=q;d.prototype={createUndoStack:function(a){a=a.getTextView();return new t.UndoStack(a,200)}};h.UndoFactory=d;b.prototype={createLineNumberRuler:function(a){return new r.LineNumberRuler(a,"left",{styleClass:"ruler lines"},{styleClass:"rulerLines odd"},{styleClass:"rulerLines even"})}};h.LineNumberRulerFactory=b;a.prototype={createFoldingRuler:function(a){return new r.FoldingRuler(a,"left",{styleClass:"ruler folding"})}};h.FoldingRulerFactory=a;c.prototype={createZoomRuler:function(a){return new r.ZoomRuler(e.isIOS||
e.isAndroid?"right":"innerRight",{styleClass:"ruler zoom"})}};h.ZoomRulerFactory=c;m.prototype={createAnnotationModel:function(a){return new k.AnnotationModel(a)},createAnnotationStyler:function(a,b){return new k.AnnotationStyler(a,b)},createAnnotationRulers:function(a){var b=new r.AnnotationRuler(a,"left",{styleClass:"ruler annotations"});a=new r.OverviewRuler(a,"right",{styleClass:"ruler overview"});return{annotationRuler:b,overviewRuler:a}}};h.AnnotationFactory=m;n.prototype={createTextDND:function(a,
b){return new f.TextDND(a.getTextView(),b)}};h.TextDNDFactory=n;return h});define("orion/editor/editorFeatures",["orion/editor/factories","orion/editor/actions","orion/editor/linkedMode","orion/objects"],function(p,t,r,k){return k.mixin({},p,t,r)});
(function(p,t){"function"===typeof define&&define.amd?define("orion/Deferred",t):"object"===typeof exports?module.exports=t():(p.orion=p.orion||{},p.orion.Deferred=t())})(this,function(){function p(){for(var e;e=f.shift();)e();g=!1}function t(k){f.push(k);g||(g=!0,e())}function r(e){return function(d){e(d)}}function k(){function e(){for(var a;a=g.shift();){var b=a.deferred,d="fulfilled"===f?"resolve":"reject";a=a[d];if("function"===typeof a)try{var h=a(c),k=h&&("object"===typeof h||"function"===typeof h)&&
h.then;if("function"===typeof k)if(h===b.promise)b.reject(new TypeError);else{var q=h.cancel;"function"===typeof q?b._parentCancel=q.bind(h):delete b._parentCancel;k.call(h,r(b.resolve),r(b.reject),r(b.progress))}else b.resolve(h)}catch(p){b.reject(p)}else b[d](c)}}function d(a){delete h._parentCancel;f="rejected";c=a;g.length&&t(e)}function b(a){function p(a){return function(b){(!f||"assumed"===f)&&a(b)}}delete h._parentCancel;try{var x=a&&("object"===typeof a||"function"===typeof a)&&a.then;if("function"===
typeof x)if(a===h)d(new TypeError);else{f="assumed";var r=a&&a.cancel;if("function"!==typeof r){var y=new k;a=y.promise;try{x(y.resolve,y.reject,y.progress)}catch(z){y.reject(z)}r=a.cancel;x=a.then}c=a;x.call(a,p(b),p(d));h._parentCancel=r.bind(a)}else f="fulfilled",c=a,g.length&&t(e)}catch(C){p(d)(C)}}function a(){var a=h._parentCancel;a?(delete h._parentCancel,a()):f||(a=Error("Cancel"),a.name="Cancel",d(a))}var c,f,g=[],h=this;this.resolve=function(a){f||b(a);return h};this.reject=function(a){f||
d(a);return h};this.progress=function(a){f||g.forEach(function(b){if(b.progress)try{b.progress(a)}catch(c){}});return h.promise};this.cancel=function(){h._parentCancel?setTimeout(a,0):a();return h};this.then=function(a,b,c){var d=new k;d._parentCancel=h.promise.cancel;g.push({resolve:a,reject:b,progress:c,deferred:d});("fulfilled"===f||"rejected"===f)&&t(e);return d.promise};this.promise={then:h.then,cancel:h.cancel}}var f=[],g=!1,e=function(){if("undefined"!==typeof process&&"function"===typeof process.nextTick){var e=
process.nextTick;return function(){e(p)}}if("function"===typeof MutationObserver){var d=document.createElement("div");(new MutationObserver(p)).observe(d,{attributes:!0});return function(){d.setAttribute("class","_tick")}}return function(){setTimeout(p,0)}}();k.all=function(e,d){function b(a,b){g||(f[a]=b,0===--c&&h.resolve(f))}function a(a,c){if(!g){if(d)try{b(a,d(c));return}catch(e){c=e}h.reject(c)}}var c=e.length,f=[],g=!1,h=new k;h.then(void 0,function(){g=!0;e.forEach(function(a){a.cancel&&a.cancel()})});
0===c?h.resolve(f):e.forEach(function(c,d){c.then(b.bind(void 0,d),a.bind(void 0,d))});return h.promise};k.when=function(e,d,b,a){var c;e&&"function"===typeof e.then||(c=new k,c.resolve(e),e=c.promise);return e.then(d,b,a)};return k});
define("orion/webui/littlelib",["orion/util"],function(p){function t(a,b){b||(b=document);return b.querySelectorAll(a)}function r(a){var b=a.tabIndex;0===b&&p.isIE&&!{a:!0,body:!0,button:!0,frame:!0,iframe:!0,img:!0,input:!0,isindex:!0,object:!0,select:!0,textarea:!0}[a.nodeName.toLowerCase()]&&!a.attributes.tabIndex&&(b=-1);return b}function k(a){if(0<=r(a))return a;if(a.hasChildNodes())for(var b=0;b<a.childNodes.length;b++){var d=k(a.childNodes[b]);if(d)return d}return null}function f(a){if(0<=
r(a))return a;if(a.hasChildNodes())for(var b=a.childNodes.length-1;0<=b;b--){var d=f(a.childNodes[b]);if(d)return d}return null}function g(a,b){if(3===a.nodeType){var d=e.exec(a.nodeValue);d&&1<d.length&&b(a,d)}if(a.hasChildNodes())for(d=0;d<a.childNodes.length;d++)g(a.childNodes[d],b)}var e=/\$\{([^\}]+)\}/,q=null,d={BKSPC:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DEL:46},b=Object.create(null);Object.keys(d).forEach(function(a){b[d[a]]=
a});return{$:function(a,b){b||(b=document);return b.querySelector(a)},$$:t,$$array:function(a,b){return Array.prototype.slice.call(t(a,b))},node:function(a){var b=a;"string"===typeof a&&(b=document.getElementById(a));return b},contains:function(a,b){if(!a||!b)return!1;if(a===b)return!0;var d=a.compareDocumentPosition(b);return Boolean(d&16)},bounds:function(a){a=a.getBoundingClientRect();return{left:a.left+document.documentElement.scrollLeft,top:a.top+document.documentElement.scrollTop,width:a.width,
height:a.height}},empty:function(a){for(;a.hasChildNodes();)a.removeChild(a.firstChild)},firstTabbable:k,lastTabbable:f,stop:function(a){window.document.all&&(a.keyCode=0);a.preventDefault&&(a.preventDefault(),a.stopPropagation())},processTextNodes:function(a,b){g(a,function(a,d){a.parentNode.replaceChild(document.createTextNode(b[d[1]]||d[1]),a)})},processDOMNodes:function(a,b){g(a,function(a,d){var h=b[d[1]];if(h){var e=document.createRange(),f=d.index;e.setStart(a,f);e.setEnd(a,f+d[0].length);
e.deleteContents();e.insertNode(h)}})},addAutoDismiss:function(a,b){function d(a){q.forEach(function(b){var c=!1,d=b.excludeNodes.some(function(b){return document.body.contains(b)?(c=!0,b.contains(a.target)):!1});if(c&&!d)try{b.dismiss(a)}catch(e){"undefined"!==typeof console&&console&&console.error(e&&e.message)}});q=q.filter(function(a){return a.excludeNodes.some(function(a){return document.body.contains(a)})})}null===q&&(q=[],document.addEventListener("click",d,!0),p.isIOS&&document.addEventListener("touchend",
function(a){function b(){a.target.removeEventListener("click",b)}0===a.touches.length&&a.target.addEventListener("click",b)},!1));q.push({excludeNodes:a,dismiss:b})},setFramesEnabled:function(a){for(var b=document.getElementsByTagName("iframe"),d=0;d<b.length;d++)b[d].parentNode.style.pointerEvents=a?"":"none"},removeAutoDismiss:function(a){q=q.filter(function(b){return a!==b.dismiss})},keyName:function(a){return b[a]||null},KEY:d}});
define("orion/editor/contentAssist","i18n!orion/editor/nls/messages orion/keyBinding orion/editor/keyModes orion/editor/eventTarget orion/Deferred orion/objects orion/editor/util orion/util orion/webui/littlelib".split(" "),function(p,t,r,k,f,g,e,q,d){function b(a){this.textView=a;this.state=m.INACTIVE;this.clearProviders();var b=this;this._textViewListeners={onModelChanging:function(a){(this._latestModelChangingEvent=a)&&this._updateFilterText(a)}.bind(this),onSelection:function(a){this.isDeactivatingChange(this._latestModelChangingEvent,
a)?this.setState(m.INACTIVE):this.isActive()&&(this.state===m.ACTIVE&&this.setState(m.FILTERING),this.filterProposals());this._latestModelChangingEvent=null}.bind(this),onScroll:function(a){this.setState(m.INACTIVE)}.bind(this)};a.setKeyBinding(q.isMac?new t.KeyBinding(" ",!1,!1,!1,!0):new t.KeyBinding(" ",!0),"contentAssist");a.setKeyBinding(q.isMac?new t.KeyBinding(" ",!1,!1,!0,!0):new t.KeyBinding(" ",!0,!1,!0),"contentAssist");a.setAction("contentAssist",function(){a.getOptions("readonly")||b.activate();
return!0},{name:p.contentAssist})}function a(a,b){var c=a.textView;r.KeyMode.call(this,c);this.contentAssist=a;this.widget=b;this.proposals=[];var d=this;this.contentAssist.addEventListener("ProposalsComputed",function(a){d.proposals=a.data.proposals;if(0===d.proposals.length)d.selectedIndex=-1,d.cancel();else{for(d.selectedIndex=0;d.proposals[d.selectedIndex]&&d.proposals[d.selectedIndex].unselectable;)d.selectedIndex++;if(d.proposals[d.selectedIndex]){if(d.widget){var b=!0;if(a.autoApply){for(a=
d.selectedIndex+1;d.proposals[a]&&d.proposals[a].unselectable;)a++;d.proposals[a]||(b=!1,d.contentAssist.apply(d.proposals[d.selectedIndex]))}b&&(d.widget.show(),d.widget.selectNode(d.selectedIndex))}}else d.selectedIndex=-1,d.cancel()}});c.setAction("contentAssistApply",function(){return this.enter()}.bind(this));c.setAction("contentAssistCancel",function(){return this.cancel()}.bind(this));c.setAction("contentAssistNextProposal",function(){return this.lineDown()}.bind(this));c.setAction("contentAssistPreviousProposal",
function(){return this.lineUp()}.bind(this));c.setAction("contentAssistNextPage",function(){return this.pageDown()}.bind(this));c.setAction("contentAssistPreviousPage",function(){return this.pageUp()}.bind(this));c.setAction("contentAssistHome",function(){this.widget&&this.widget.scrollIndex(0,!0);return this.lineDown(0)}.bind(this));c.setAction("contentAssistEnd",function(){return this.lineUp(this.proposals.length-1)}.bind(this));c.setAction("contentAssistTab",function(){return this.tab()}.bind(this));
this.widget&&(this.widget.setContentAssistMode(this),this.widget.createAccessible())}function c(a,b){this.contentAssist=a;this.textView=this.contentAssist.getTextView();this.isShowing=this.textViewListenerAdded=!1;var c=this.textView.getOptions("parent").ownerDocument;this.parentNode="string"===typeof b?c.getElementById(b):b;if(!this.parentNode){this.parentNode=q.createElement(c,"div");this.parentNode.className="contentassist";var d=c.getElementsByTagName("body")[0];if(d)d.appendChild(this.parentNode);
else throw Error("parentNode is required");}e.addEventListener(this.parentNode,"scroll",this.onScroll.bind(this));var f=this;this.textViewListener={onMouseDown:function(a){(a.event.target||a.event.srcElement).parentElement!==f.parentNode&&f.contentAssist.deactivate()}};this.contentAssist.addEventListener("Deactivating",function(a){f.hide()});this.scrollListener=function(a){f.isShowing&&f.position()};e.addEventListener(c,"scroll",this.scrollListener)}var m={INACTIVE:1,ACTIVE:2,FILTERING:3},n={selected:"selected",
hr:"proposal-hr",emphasis:"proposal-emphasis",noemphasis:"proposal-noemphasis",noemphasis_keyword:"proposal-noemphasis-keyword",noemphasis_title:"proposal-noemphasis-title",noemphasis_title_keywords:"proposal-noemphasis-title-keywords",dfault:"proposal-default"};b.prototype={apply:function(a){if(!a)return!1;var b=this.textView,c=b.getSelection(),d=this._initialCaretOffset,e=d,f=c=Math.max(c.start,c.end),g=b.getModel();g.getBaseModel&&(e=g.mapOffset(e),f=g.mapOffset(f),g=g.getBaseModel());a.overwrite&&
(d="string"===typeof a.prefix?e-a.prefix.length:this.getPrefixStart(g,e));e={proposal:a,start:e,end:f};this.setState(m.INACTIVE);b.setText("string"===typeof a?a:a.proposal,d,c);this.dispatchEvent({type:"ProposalApplied",data:e});return!0},activate:function(a,b){this.state===m.INACTIVE&&(this._autoTriggered=b?!0:!1,this.setState(m.ACTIVE,a))},deactivate:function(){this.setState(m.INACTIVE)},getTextView:function(){return this.textView},isActive:function(){return this.state===m.ACTIVE||this.state===
m.FILTERING},isDeactivatingChange:function(a,b){var c=!1;b.newValue.start<this._initialCaretOffset||!a?c=!0:a&&(c=0<a.removedLineCount||0<a.addedLineCount);return c},setState:function(a,b){var c;a===m.ACTIVE?(c="Activating",this._mode&&this._mode.setActive(!0)):a===m.INACTIVE&&(c="Deactivating",this._mode&&this._mode.setActive(!1));c&&this.dispatchEvent({type:c,providers:b});this.state=a;this.onStateChange(a)},setMode:function(a){this._mode=a},onStateChange:function(a){a===m.INACTIVE?(this._removeTextViewListeners(),
this._filterText="",this._initialCaretOffset=-1,this._computedProposals=null):a===m.ACTIVE&&(this._filterText="",this._addTextViewListeners(),this.computeProposals())},computeProposals:function(){var a=this.textView.getCaretOffset(),b=this.textView.getSelection(),b=Math.min(b.start,b.end);this._initialCaretOffset=Math.min(a,b);this._computedProposals=null;this._computeProposals(this._initialCaretOffset).then(function(a){if(this.isActive()){var b=this._flatten(a);b&&(Array.isArray(b)&&0<b.length)&&
(this._computedProposals=a);this.dispatchEvent({type:"ProposalsComputed",data:{proposals:b},autoApply:!this._autoTriggered});this._computedProposals&&this._filterText&&this.filterProposals(!0)}}.bind(this))},getPrefixStart:function(a,b){for(var c=b;0<c&&/[A-Za-z0-9_]/.test(a.getText(c-1,c));)c--;return c},handleError:function(a){"undefined"!==typeof console&&(console.log("Error retrieving content assist proposals"),console.log(a&&a.stack))},initialize:function(){this._providers.forEach(function(a){a=
a.provider;"function"===typeof a.initialize&&a.initialize()})},_computeProposals:function(a){var b=this._providers,c=this.textView,d=c.getSelection(),e=c.getModel(),m=a;e.getBaseModel&&(m=e.mapOffset(m),d.start=e.mapOffset(d.start),d.end=e.mapOffset(d.end),e=e.getBaseModel());a=e.getLine(e.getLineAtOffset(m));for(var n=0;n<a.length&&/\s/.test(a.charAt(n));)n++;var n=a.substring(0,n),c=c.getOptions("tabSize","expandTab"),c=c.expandTab?Array(c.tabSize+1).join(" "):"\t",k={line:a,offset:m,prefix:e.getText(this.getPrefixStart(e,
m),m),selection:d,delimiter:e.getLineDelimiter(),tab:c,indentation:n},l=this,b=b.map(function(a){a=a.provider;var b;try{var c,d;if(c=a.computeContentAssist){var h=l.editorContextProvider,n=h.getEditorContext();k=g.mixin(k,h.getOptions());d=c.apply(a,[n,k])}else if(c=a.getProposals||a.computeProposals)d=c.apply(a,[e.getText(),m,k]);b=l.progress?l.progress.progress(d,"Generating content assist proposal"):d}catch(s){return(new f).reject(s)}return f.when(b)});return f.all(b,this.handleError)},filterProposals:function(a){if(this._computedProposals&&
(this._latestModelChangingEvent||a)){a=this.textView.getModel();a.getBaseModel&&(a=a.getBaseModel());a=this.getPrefixStart(a,this._initialCaretOffset);var b=this.textView.getText(a,this._initialCaretOffset),c=b,d=[];this._computedProposals.forEach(function(a){a&&Array.isArray(a)&&(a=a.filter(function(a){if(!a)return!1;c="string"===typeof a.prefix?a.prefix:b;if(n[a.style]===n.hr||n[a.style]===n.noemphasis_title)return!0;var d="";if(a.overwrite){if(a.name)d=a.name;else if(a.proposal)d=a.proposal;else return!1;
return 0===d.indexOf(c+this._filterText)}return a.name||a.proposal?(d=!1,a.name&&(d=0===a.name.indexOf(c+this._filterText)),!d&&a.proposal&&(d=0===a.proposal.indexOf(this._filterText)),d):"string"===typeof a?0===a.indexOf(this._filterText):!1},this),0<a.length&&d.push(a))},this);a=[];d&&(d=this._removeExtraUnselectableElements(d),a=this._flatten(d));this.dispatchEvent({type:"ProposalsComputed",data:{proposals:a},autoApply:!1})}},_removeExtraUnselectableElements:function(a){return a.map(function(a){return a.filter(function(b,
c){var d=!0;if(n[b.style]===n.hr)0===c||a.length-1===c?d=!1:n.hr===n[a[c-1].style]&&(d=!1);else if(n[b.style]===n.noemphasis_title){var h=a[c+1];h?n[h.style]===n.noemphasis_title&&(d=!1):d=!1}return d})})},setEditorContextProvider:function(a){this.editorContextProvider=a},_generateProviderId:function(){this._idcount?this._idcount++:this._idcount=0;return"ContentAssistGeneratedID_"+this._idcount},setAutoTriggerEnabled:function(a){this._autoTriggerEnabled=a;this._updateAutoTriggerListenerState()},setProviders:function(a){var b=
this;this.setProviderInfoArray(a.map(function(a){return a.id?a:{provider:a,id:b._generateProviderId()}}))},setProviderInfoArray:function(a){this.clearProviders();this._providers=a;this._charTriggersInstalled=a.some(function(a){return a.charTriggers});this._updateAutoTriggerListenerState()},getProviders:function(){return this._providers.slice()},clearProviders:function(){this._providers=[];this._charTriggersInstalled=!1;this._updateAutoTriggerListenerState()},setProgress:function(a){this.progress=
a},setStyleAccessor:function(a){this._styleAccessor=a},_flatten:function(a){return a.reduce(function(a,b){var c=a,d=null;b&&Array.isArray(b)&&(d=b.filter(function(a){return a}));if(d&&Array.isArray(d)&&0<d.length){var c=d,h=a,e=d[0].style;e&&0===n[e].indexOf(n.noemphasis)&&(c=a,h=d);0<c.length&&(d=c[c.length-1].style)&&n.hr!==n[d]&&(c=c.concat({proposal:"",name:"",description:"---------------------------------",style:"hr",unselectable:!0}));c=c.concat(h)}return c},[])},_triggerListener:function(){var a=
this.textView.getCaretOffset(),b=null,c=[];if(this._charTriggersInstalled){var d=this.textView.getText(a-1,a);this._providers.forEach(function(e){var f=e.charTriggers;if(f&&f.test(d)){var f=!1,m=e.excludedStyles;this._styleAccessor&&m&&(b||(b=this._styleAccessor.getStyles(a-1)),f=b.some(function(a){return m.test(a.style)}));f||c.push(e)}},this);0<c.length&&this.activate(c,!0)}},_updateAutoTriggerListenerState:function(){this._boundTriggerListener||(this._boundTriggerListener=this._triggerListener.bind(this));
if(this._triggerListenerInstalled){if(!this._autoTriggerEnabled||!this._charTriggersInstalled)this.textView.removeEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!1}else this._autoTriggerEnabled&&this._charTriggersInstalled&&(this.textView.addEventListener("Modify",this._boundTriggerListener),this._triggerListenerInstalled=!0)},_addTextViewListeners:function(){this._textViewListenersAdded||(this.textView.addEventListener("ModelChanging",this._textViewListeners.onModelChanging),
this.textView.addEventListener("Scroll",this._textViewListeners.onScroll),this.textView.addEventListener("Selection",this._textViewListeners.onSelection),this._textViewListenersAdded=!0)},_removeTextViewListeners:function(){this._textViewListenersAdded&&(this._latestModelChangingEvent=null,this.textView.removeEventListener("ModelChanging",this._textViewListeners.onModelChanging),this.textView.removeEventListener("Scroll",this._textViewListeners.onScroll),this.textView.removeEventListener("Selection",
this._textViewListeners.onSelection),this._textViewListenersAdded=!1)},_updateFilterText:function(a){var b=a.removedCharCount;b&&(this._filterText=this._filterText.substring(0,this._filterText.length-b));if(a=a.text)this._filterText=this._filterText.concat(a)}};k.EventTarget.addMixin(b.prototype);a.prototype=new r.KeyMode;g.mixin(a.prototype,{createKeyBindings:function(){var a=t.KeyBinding,b=[];b.push({actionID:"contentAssistApply",keyBinding:new a(13)});b.push({actionID:"contentAssistCancel",keyBinding:new a(27)});
b.push({actionID:"contentAssistNextProposal",keyBinding:new a(40)});b.push({actionID:"contentAssistPreviousProposal",keyBinding:new a(38)});b.push({actionID:"contentAssistNextPage",keyBinding:new a(34)});b.push({actionID:"contentAssistPreviousPage",keyBinding:new a(33)});b.push({actionID:"contentAssistHome",keyBinding:new a(d.KEY.HOME)});b.push({actionID:"contentAssistEnd",keyBinding:new a(d.KEY.END)});b.push({actionID:"contentAssistTab",keyBinding:new a(9)});return b},cancel:function(){this.getContentAssist().deactivate()},
getContentAssist:function(){return this.contentAssist},getProposals:function(){return this.proposals},isActive:function(){return this.getContentAssist().isActive()},setActive:function(a){a?this.contentAssist.textView.addKeyMode(this):this.contentAssist.textView.removeKeyMode(this)},lineUp:function(a,b){return this.selectNew(a,b,!1)},lineDown:function(a,b){return this.selectNew(a,b,!0)},selectNew:function(a,b,c){if(c){if(void 0===a&&(a=this.selectedIndex+1),a>=this.proposals.length){if(b)return!0;
a=0}}else if(void 0===a&&(a=this.selectedIndex-1),0>a){if(b)return!0;a=this.proposals.length-1}for(var d=a;this.proposals[a]&&this.proposals[a].unselectable;){if(c){if(a++,a>=this.proposals.length){if(b)return!0;a=0}}else if(a--,0>a){if(b)return!0;a=this.proposals.length-1}if(a===d){a=-1;break}}this.selectedIndex=a;this.widget&&this.widget.selectNode(a);return!0},pageUp:function(){if(this.widget){var a=this.widget.getTopIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!1),a=this.widget.getTopIndex());
return 0===a?this.lineDown(a,!0):this.lineUp(a,!0)}return this.lineUp()},pageDown:function(){if(this.widget){var a=this.widget.getBottomIndex();a===this.selectedIndex&&(this.widget.scrollIndex(a,!0),a=this.widget.getBottomIndex());return this.lineDown(a,!0)}return this.lineDown()},enter:function(){return this.contentAssist.apply(this.proposals[this.selectedIndex]||null)},tab:function(){return this.widget?(this.widget.parentNode.focus(),!0):!1}});c.prototype={onClick:function(a){a||(a=window.event);
this.contentAssist.apply(this.getProposal(a.target||a.srcElement));this.textView.focus()},onScroll:function(a){this.previousCloneNode&&!this.preserveCloneThroughScroll&&(this._removeCloneNode(),this.previousSelectedNode.classList.add(n.selected));this.preserveCloneThroughScroll=!1},createDiv:function(a,b,c){var d=b.ownerDocument,e=q.createElement(d,"div");e.id="contentoption"+c;e.setAttribute("role","option");e.className=n[a.style]?n[a.style]:n.dfault;"hr"===a.style?a=q.createElement(d,"hr"):(a=this._createDisplayNode(e,
a,c),e.contentAssistProposalIndex=c);e.appendChild(a);b.appendChild(e)},createAccessible:function(){var a=this._contentAssistMode,b=this;e.addEventListener(this.parentNode,"keydown",function(c){c||(c=window.event);c.preventDefault&&c.preventDefault();return c.keyCode===d.KEY.ESCAPE?a.cancel():c.keyCode===d.KEY.UP?a.lineUp():c.keyCode===d.KEY.DOWN?a.lineDown():c.keyCode===d.KEY.ENTER?a.enter():c.keyCode===d.KEY.PAGEDOWN?a.pageDown():c.keyCode===d.KEY.PAGEUP?a.pageUp():c.keyCode===d.KEY.HOME?(b.scrollIndex(0,
!0),a.lineDown(0)):c.keyCode===d.KEY.END?a.lineUp(a.getProposals().length-1):!1})},_createDisplayNode:function(a,b,c){var d=null,e=null;if("string"===typeof b)e=b;else if(b.description&&"string"===typeof b.description)if(b.name&&"string"===typeof b.name){var f=this._createNameNode(b.name);f.contentAssistProposalIndex=c;d=document.createElement("span");d.appendChild(f);f=document.createTextNode(b.description);d.appendChild(f);a.setAttribute("title",b.name+b.description)}else e=b.description;else e=
b.proposal;e&&(d=this._createNameNode(e),a.setAttribute("title",e));d.contentAssistProposalIndex=c;return d},_createNameNode:function(a){var b=document.createElement("span");b.classList.add("proposal-name");b.appendChild(document.createTextNode(a));return b},getProposal:function(a){var b=null;a=a.contentAssistProposalIndex;void 0!==a&&(b=this._contentAssistMode.getProposals()[a]||null);return b},getTopIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++)if(a[b].offsetTop>=this.parentNode.scrollTop)return b;
return 0},getBottomIndex:function(){for(var a=this.parentNode.childNodes,b=0;b<a.length;b++){var c=a[b];if(c.offsetTop+c.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight)return Math.max(0,b-1)}return a.length-1},scrollIndex:function(a,b){this.parentNode.childNodes[a].scrollIntoView(b);this.preserveCloneThroughScroll=!0},selectNode:function(a){var b=null;this.previousSelectedNode&&(this.previousSelectedNode.classList.remove(n.selected),this.previousSelectedNode=null,this.previousCloneNode&&
this._removeCloneNode());if(-1!==a){b=this.parentNode.childNodes[a];b.classList.add(n.selected);this.parentNode.setAttribute("aria-activedescendant",b.id);b.focus();b.offsetTop<this.parentNode.scrollTop?(b.scrollIntoView(!0),this.preserveCloneThroughScroll=!0):b.offsetTop+b.offsetHeight>this.parentNode.scrollTop+this.parentNode.clientHeight&&(b.scrollIntoView(!1),this.preserveCloneThroughScroll=!0);var c=d.bounds(b.firstChild||b),e=d.bounds(this.parentNode);a=window.getComputedStyle(this.parentNode);
var f=window.getComputedStyle(b),f=parseInt(a.paddingLeft)+parseInt(a.paddingRight)+parseInt(f.paddingLeft)+parseInt(f.paddingRight);if(c.width>=e.width-f){f=parseInt(a.top);e=b.cloneNode(!0);e.classList.add("cloneProposal");e.style.top=f+b.offsetTop-this.parentNode.scrollTop+"px";e.style.left=a.left;e.setAttribute("id",e.id+"_clone");c=c.left+c.width-parseInt(document.documentElement.clientWidth);0<c&&(a=parseInt(a.left)-c,0>a&&(a=0),e.style.left=a+"px");a=document.createElement("div");a.id="clone_contentassist";
a.classList.add("contentassist");a.classList.add("cloneWrapper");a.appendChild(e);a.onclick=this.parentNode.onclick;this.parentNode.parentNode.insertBefore(a,this.parentNode);var m=function(a){a.contentAssistProposalIndex=b.contentAssistProposalIndex;if(a.hasChildNodes())for(var c=0;c<a.childNodes.length;c++)m(a.childNodes[c])};m(a);b.classList.remove(n.selected);this.previousCloneNode=a}}this.previousSelectedNode=b},setContentAssistMode:function(a){this._contentAssistMode=a},show:function(){var a=
this._contentAssistMode.getProposals();if(0===a.length)this.hide();else{this.parentNode.innerHTML="";for(var b=0;b<a.length;b++)this.createDiv(a[b],this.parentNode,b);this.position();this.parentNode.onclick=this.onClick.bind(this);this.isShowing=!0;this.textViewListenerAdded||(this.textView.addEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!0)}},hide:function(){this.parentNode.ownerDocument.activeElement===this.parentNode&&this.textView.focus();this.parentNode.style.display=
"none";this.parentNode.onclick=null;this.isShowing=!1;this.textViewListenerAdded&&(this.textView.removeEventListener("MouseDown",this.textViewListener.onMouseDown),this.textViewListenerAdded=!1);this.previousSelectedNode&&(this.previousSelectedNode=null,this.previousCloneNode&&this._removeCloneNode())},position:function(){var a=this.contentAssist,b=this.textView;if(void 0!==a.offset){var a=a.offset,c=b.getModel();c.getBaseModel&&(a=c.mapOffset(a,!0))}else a=this.textView.getCaretOffset();a=b.getLocationAtOffset(a);
a.y+=b.getLineHeight();this.textView.convert(a,"document","page");this.parentNode.style.position="fixed";this.parentNode.style.left=a.x+"px";this.parentNode.style.top=a.y+"px";this.parentNode.style.display="block";this.parentNode.scrollTop=0;c=this.parentNode.ownerDocument;b=c.documentElement.clientWidth;c=c.documentElement.clientHeight-a.y;if(this.parentNode.offsetHeight>c){var d=a.y-this.textView.getLineHeight();this.parentNode.offsetHeight>d?c>d?this.parentNode.style.maxHeight=c+"px":(this.parentNode.style.maxHeight=
d+"px",this.parentNode.style.top="0"):(this.parentNode.style.top=a.y-this.parentNode.offsetHeight-this.textView.getLineHeight()+"px",this.parentNode.style.maxHeight=d+"px")}else this.parentNode.style.maxHeight=c+"px";a.x+this.parentNode.offsetWidth>b?(a=b-this.parentNode.offsetWidth,0>a&&(a=0),this.parentNode.style.left=a+"px",this.parentNode.style.maxWidth=b-a):this.parentNode.style.maxWidth=b+a.x+"px"},_removeCloneNode:function(){this.parentNode.parentNode.contains(this.previousCloneNode)&&this.parentNode.parentNode.removeChild(this.previousCloneNode);
this.previousCloneNode=null}};return{ContentAssist:b,ContentAssistMode:a,ContentAssistWidget:c}});
define("orion/editor/stylers/lib/syntax",[],function(){return{id:"orion.lib",grammars:[{id:"orion.lib",repository:{brace_open:{match:"{",name:"punctuation.section.block.begin"},brace_close:{match:"}",name:"punctuation.section.block.end"},bracket_open:{match:"\\[",name:"punctuation.section.bracket.begin"},bracket_close:{match:"\\]",name:"punctuation.section.bracket.end"},parenthesis_open:{match:"\\(",name:"punctuation.section.parens.begin"},parenthesis_close:{match:"\\)",name:"punctuation.section.parens.end"},
doc_block:{begin:{match:"/\\*\\*",literal:"/**"},end:{match:"\\*/",literal:"*/"},name:"comment.block.documentation",patterns:[{match:"@(?:(?!\\*/)\\S)*",name:"meta.documentation.annotation"},{match:"\\\x3c\\S*\\\x3e",name:"meta.documentation.tag"},{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]},number_decimal:{match:"\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:[eE][+-]?\\d+)?\\b",name:"constant.numeric.number"},
number_hex:{match:"\\b0[xX][0-9A-Fa-f]+\\b",name:"constant.numeric.hex"},string_doubleQuote:{match:'"(?:\\\\.|[^"])*"?',name:"string.quoted.double"},string_singleQuote:{match:"'(?:\\\\.|[^'])*'?",name:"string.quoted.single"},todo_comment_singleLine:{match:"(\\b)(TODO)(\\b)(.*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}}},{id:"orion.c-like",repository:{comment_singleLine:{match:{match:"//.*",literal:"//"},name:"comment.line.double-slash",
patterns:[{include:"orion.lib#todo_comment_singleLine"}]},comment_block:{begin:{match:"/\\*",literal:"/*"},end:{match:"\\*/",literal:"*/"},name:"comment.block",patterns:[{match:"(\\b)(TODO)(\\b)(((?!\\*/).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.block"}}}]}}}],keywords:[]}});
define("orion/editor/stylers/text_css/syntax",["orion/editor/stylers/lib/syntax"],function(p){var t="alignment-adjust alignment-baseline animation-delay animation-direction animation-duration animation-iteration-count animation-name animation-play-state animation-timing-function animation appearance azimuth backface-visibility background-attachment background-clip background-color background-image background-origin background-position background-repeat background-size background baseline-shift binding bleed bookmark-label bookmark-level bookmark-state bookmark-target border-bottom-color border-bottom-left-radius border-bottom-right-radius border-bottom-style border-bottom-width border-bottom border-collapse border-color border-image-outset border-image-repeat border-image-slice border-image-source border-image-width border-image border-left-color border-left-style border-left-width border-left border-radius border-right-color border-right-style border-right-width border-right border-spacing border-style border-top-color border-top-left-radius border-top-right-radius border-top-style border-top-width border-top border-width border bottom box-align box-decoration-break box-direction box-flex-group box-flex box-lines box-ordinal-group box-orient box-pack box-shadow box-sizing break-after break-before break-inside caption-side clear clip color-profile color column-count column-fill column-gap column-rule-color column-rule-style column-rule-width column-rule column-span column-width columns content counter-increment counter-reset crop cue-after cue-before cue cursor direction display dominant-baseline drop-initial-after-adjust drop-initial-after-align drop-initial-before-adjust drop-initial-before-align drop-initial-size drop-initial-value elevation empty-cells fit-position fit flex-align flex-flow flex-inline-pack flex-order flex-pack float-offset float font-family font-size font-size-adjust font-stretch font-style font-variant font-weight font grid-columns grid-rows hanging-punctuation height hyphenate-after hyphenate-before hyphenate-character hyphenate-lines hyphenate-resource hyphens icon image-orientation image-rendering image-resolution inline-box-align left letter-spacing line-height line-stacking-ruby line-stacking-shift line-stacking-strategy line-stacking list-style-image list-style-position list-style-type list-style margin-bottom margin-left margin-right margin-top margin mark-after mark-before mark marker-offset marks marquee-direction marquee-loop marquee-play-count marquee-speed marquee-style max-height max-width min-height min-width move-to nav-down nav-index nav-left nav-right nav-up opacity orphans outline-color outline-offset outline-style outline-width outline overflow-style overflow-x overflow-y overflow padding-bottom padding-left padding-right padding-top padding page-break-after page-break-before page-break-inside page-policy page pause-after pause-before pause perspective-origin perspective phonemes pitch-range pitch play-during position presentation-level punctuation-trim quotes rendering-intent resize rest-after rest-before rest richness right rotation-point rotation ruby-align ruby-overhang ruby-position ruby-span size speak-header speak-numeral speak-punctuation speak speech-rate stress string-set table-layout target-name target-new target-position target text-align-last text-align text-decoration text-emphasis text-height text-indent text-justify text-outline text-shadow text-transform text-wrap top transform-origin transform-style transform transition-delay transition-duration transition-property transition-timing-function transition unicode-bidi vertical-align visibility voice-balance voice-duration voice-family voice-pitch-range voice-pitch voice-rate voice-stress voice-volume volume white-space-collapse white-space widows width word-break word-spacing word-wrap z-index".split(" ");p=
p.grammars;p.push({id:"orion.css",contentTypes:["text/css"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.css"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.css"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_block"},{include:"orion.lib#brace_open"},{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},
{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"#number_hex"},{match:"(?i)\\b-?(?:\\.\\d+|\\d+\\.?\\d*)(?:%|em|ex|ch|rem|vw|vh|vmin|vmax|in|cm|mm|pt|pc|px|deg|grad|rad|turn|s|ms|Hz|kHz|dpi|dpcm|dppx)?\\b",name:"constant.numeric.value.css"},{match:"(?:-webkit-|-moz-|-ms-|-o-|\\b)(?:"+t.join("|")+")\\b",name:"support.type.propertyName.css"}],repository:{number_hex:{match:"#[0-9A-Fa-f]+\\b",
name:"constant.numeric.hex.css"}}});return{id:p[p.length-1].id,grammars:p,keywords:t}});
define("webtools/cssContentAssist",["orion/editor/templates","orion/editor/stylers/text_css/syntax"],function(p,t){function r(a){return JSON.stringify(a).replace("}","\\}")}function k(){}for(var f={type:"link",values:"visible hidden scroll auto no-display no-content".split(" ")},g={type:"link",values:"solid dashed dotted double groove ridge inset outset".split(" ")},e={type:"link",values:[]},q=0;10>q;q++)e.values.push(q.toString());for(var d={type:"link",values:"black white red green blue magenta yellow cyan grey darkred darkgreen darkblue darkmagenta darkcyan darkyellow darkgray lightgray".split(" ")},
b=[{prefix:"rule",description:"rule - class selector rule",template:".${class} {\n\t${cursor}\n}"},{prefix:"rule",description:"rule - id selector rule",template:"#${id} {\n\t${cursor}\n}"},{prefix:"outline",description:"outline - outline style",template:"outline: ${color:"+r(d)+"} ${style:"+r(g)+"} ${width:"+r(e)+"}px;"},{prefix:"background-image",description:"background-image - image style",template:'background-image: url("${uri}");'},{prefix:"url",description:"url - url image",template:'url("${uri}");'},
{prefix:"rgb",description:"rgb - rgb color",template:"rgb(${red},${green},${blue});"},{prefix:"@import",description:"import - import style sheet",template:'@import "${uri}";'},{prefix:"csslint",description:"csslint - add embedded rule severity",template:"/*csslint ${:"+r({type:"link",values:"adjoining-classes box-model box-sizing bulletproof-font-face compatible-vendor-prefixes display-property-grouping duplicate-background-images duplicate-properties empty-rules fallback-colors floats font-faces font-sizes gradients ids import important known-properties outline-none overqualified-elements qualified-headings regex-selectors rules-count selector-max-approaching selector-max shorthand star-property-hack text-indent underscore-property-hack unique-headings universal-selector unqualified-attributes vendor-prefix zero-units".split(" ")})+
"}: ${a:"+r({type:"link",values:["false","true","0","1","2"]})+"} */"}],a=[{prop:"display",values:{type:"link",values:"none block box flex inline inline-block inline-flex inline-table list-item table table-caption table-cell table-column table-column-group table-footer-group table-header-group table-row table-row-group inherit".split(" ")}},{prop:"overflow",values:f},{prop:"overflow-x",values:f},{prop:"overflow-y",values:f},{prop:"float",values:{type:"link",values:["left","right","none","inherit"]}},
{prop:"position",values:{type:"link",values:["absolute","fixed","relative","static","inherit"]}},{prop:"cursor",values:{type:"link",values:"auto crosshair default e-resize help move n-resize ne-resize nw-resize pointer progress s-resize se-resize sw-resize text w-resize wait inherit".split(" ")}},{prop:"color",values:d},{prop:"border-top-color",values:d},{prop:"border-bottom-color",values:d},{prop:"border-right-color",values:d},{prop:"border-left-color",values:d},{prop:"background-color",values:d},
{prop:"font-style",values:{type:"link",values:["italic","normal","oblique","inherit"]}},{prop:"font-weight",values:{type:"link",values:"bold normal bolder lighter 100 200 300 400 500 600 700 800 900 inherit".split(" ")}},{prop:"white-space",values:{type:"link",values:"pre pre-line pre-wrap nowrap normal inherit".split(" ")}},{prop:"word-wrap",values:{type:"link",values:["normal","break-word"]}},{prop:"visibility",values:{type:"link",values:["hidden","visible","collapse","inherit"]}}],q=0;q<a.length;q++)f=
a[q],b.push({prefix:f.prop,description:f.prop+" - "+f.prop+" style",template:f.prop+": ${value:"+r(f.values)+"};"});a="width height top bottom left right min-width min-height max-width max-height margin padding padding-left padding-right padding-top padding-bottom margin-left margin-top margin-bottom margin-right".split(" ");for(q=0;q<a.length;q++)f=a[q],b.push({prefix:f,description:f+" - "+f+" pixel style",template:f+": ${value}px;"});a=["padding","margin"];for(q=0;q<a.length;q++)f=a[q],b.push({prefix:f,
description:f+" - "+f+" top right bottom left style",template:f+": ${top}px ${left}px ${bottom}px ${right}px;"}),b.push({prefix:f,description:f+" - "+f+" top right,left bottom style",template:f+": ${top}px ${right_left}px ${bottom}px;"}),b.push({prefix:f,description:f+" - "+f+" top,bottom right,left style",template:f+": ${top_bottom}px ${right_left}px"});a=["border","border-top","border-bottom","border-left","border-right"];for(q=0;q<a.length;q++)f=a[q],b.push({prefix:f,description:f+" - "+f+" style",
template:f+": ${width:"+r(e)+"}px ${style:"+r(g)+"} ${color:"+r(d)+"};"});k.prototype=new p.TemplateContentAssist(t.keywords,b);k.prototype.getPrefix=function(a,b,d){for(d=b;d&&/[A-Za-z\-\@]/.test(a.charAt(d-1));)d--;return 0<=d?a.substring(d,b):""};return{CssContentAssistProvider:k}});
define("webtools/htmlContentAssist",["orion/editor/templates"],function(p){function t(){}var r=new p.Template("","Simple HTML document",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n\t\x3chead\x3e\n\t\t\x3cmeta charset\x3dutf-8\x3e\n\t\t\x3ctitle\x3e${title}\x3c/title\x3e\n\t\x3c/head\x3e\n\t\x3cbody\x3e\n\t\t\x3ch1\x3e${header}\x3c/h1\x3e\n\t\t\x3cp\x3e\n\t\t\t${cursor}\n\t\t\x3c/p\x3e\n\t\x3c/body\x3e\n\x3c/html\x3e'),k=[{prefix:"\x3cimg",name:"\x3cimg\x3e",description:" - HTML image element",
template:'\x3cimg src\x3d"${URI}" alt\x3d"${Image}"/\x3e'},{prefix:"\x3ca",name:"\x3ca\x3e",description:" - HTML anchor element",template:'\x3ca href\x3d"${cursor}"\x3e\x3c/a\x3e'},{prefix:"\x3cul",name:"\x3cul\x3e",description:" - HTML unordered list",template:"\x3cul\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ul\x3e"},{prefix:"\x3col",name:"\x3col\x3e",description:" - HTML ordered list",template:"\x3col\x3e\n\t\x3cli\x3e${cursor}\x3c/li\x3e\n\x3c/ol\x3e"},{prefix:"\x3cdl",name:"\x3cdl\x3e",description:" - HTML definition list",
template:"\x3cdl\x3e\n\t\x3cdt\x3e${cursor}\x3c/dt\x3e\n\t\x3cdd\x3e\x3c/dd\x3e\n\x3c/dl\x3e"},{prefix:"\x3ctable",name:"\x3ctable\x3e",description:" - basic HTML table",template:"\x3ctable\x3e\n\t\x3ctr\x3e\n\t\t\x3ctd\x3e${cursor}\x3c/td\x3e\n\t\x3c/tr\x3e\n\x3c/table\x3e"},{prefix:"\x3c!--",name:"\x3c!-- --\x3e",description:" - HTML comment",template:"\x3c!-- ${cursor} --\x3e"}],f,g,e,q,d="abbr b button canvas cite command dd del dfn dt em embed font h1 h2 h3 h4 h5 h6 i ins kbd label li mark meter object option output progress q rp rt samp small strong sub sup td time title tt u var".split(" ");
for(q=0;q<d.length;q++)f=d[q],e="\x3c"+f+"\x3e\x3c/"+f+"\x3e",g="\x3c"+f+"\x3e${cursor}\x3c/"+f+"\x3e",k.push({prefix:"\x3c"+f,description:e,template:g});d="address article aside audio bdo blockquote body caption code colgroup datalist details div fieldset figure footer form head header hgroup iframe legend map menu nav noframes noscript optgroup p pre ruby script section select span style tbody textarea tfoot th thead tr video".split(" ");for(q=0;q<d.length;q++)f=d[q],e="\x3c"+f+"\x3e\x3c/"+f+"\x3e",
g="\x3c"+f+"\x3e\n\t${cursor}\n\x3c/"+f+"\x3e",k.push({prefix:"\x3c"+f,description:e,template:g});d="area base br col hr input link meta param keygen source".split(" ");for(q=0;q<d.length;q++)f=d[q],g=e="\x3c"+f+"/\x3e",k.push({prefix:"\x3c"+f,description:e,template:g});t.prototype=new p.TemplateContentAssist([],k);t.prototype.getPrefix=function(b,a,c){c="";for(var d=a;d&&/[A-Za-z0-9<!-]/.test(b.charAt(d-1));)if(d--,"\x3c"===b.charAt(d)){c=b.substring(d,a);break}return c};t.prototype.computeProposals=
function(b,a,c){return 0===b.length?[r.getProposal("",a,c)]:p.TemplateContentAssist.prototype.computeProposals.call(this,b,a,c).sort(function(a,b){var c=a.prefix||a.proposal,d=b.prefix||b.proposal;if(c){if(!d)return 1}else return-1;return c.toLowerCase().localeCompare(d.toLowerCase())})};return{HTMLContentAssistProvider:t}});
define("orion/editor/AsyncStyler",["i18n!orion/editor/nls/messages","orion/editor/annotations"],function(p,t){function r(e){return-1!==e.getProperty("objectClass").indexOf(f)&&"highlighter"===e.getProperty("type")}function k(e,f,d){this.initialize(e,f,d);this.lineStyles=[]}var f="orion.edit.highlighter",g=f+" service must be an event emitter";t.AnnotationType.registerType("orion.annotation.highlightError",{title:p.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});
k.prototype={initialize:function(e,g,d){this.textView=e;this.serviceRegistry=g;this.annotationModel=d;this.services=[];var b=this;this.listener={onModelChanging:function(a){b.onModelChanging(a)},onModelChanged:function(a){b.onModelChanged(a)},onDestroy:function(a){b.onDestroy(a)},onLineStyle:function(a){b.onLineStyle(a)},onStyleReady:function(a){b.onStyleReady(a)},onServiceAdded:function(a){b.onServiceAdded(a.serviceReference,b.serviceRegistry.getService(a.serviceReference))},onServiceRemoved:function(a){b.onServiceRemoved(a.serviceReference,
b.serviceRegistry.getService(a.serviceReference))}};e.addEventListener("ModelChanging",this.listener.onModelChanging);e.addEventListener("ModelChanged",this.listener.onModelChanged);e.addEventListener("Destroy",this.listener.onDestroy);e.addEventListener("LineStyle",this.listener.onLineStyle);g.addEventListener("registered",this.listener.onServiceAdded);g.addEventListener("unregistering",this.listener.onServiceRemoved);e=g.getServiceReferences(f);for(d=0;d<e.length;d++){var a=e[d];r(a)&&this.addServiceListener(g.getService(a))}},
onDestroy:function(e){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanging",this.listener.onModelChanging),this.textView.removeEventListener("ModelChanged",this.listener.onModelChanged),this.textView.removeEventListener("Destroy",this.listener.onDestroy),this.textView.removeEventListener("LineStyle",this.listener.onLineStyle),this.textView=null);if(this.services){for(var e=0;e<this.services.length;e++)this.removeServiceListener(this.services[e]);this.services=
null}this.serviceRegistry&&(this.serviceRegistry.removeEventListener("registered",this.listener.onServiceAdded),this.serviceRegistry.removeEventListener("unregistering",this.listener.onServiceRemoved),this.serviceRegistry=null);this.lineStyles=this.listener=null},onModelChanging:function(e){this.startLine=this.textView.getModel().getLineAtOffset(e.start)},onModelChanged:function(e){var f=this.startLine;(e.addedLineCount||e.removedLineCount)&&Array.prototype.splice.apply(this.lineStyles,[f,e.removedLineCount].concat(this._getEmptyStyle(e.addedLineCount)))},
onStyleReady:function(e){var f=e.lineStyles||e.style;e=Number.MAX_VALUE;var d=-1,b=this.textView.getModel(),a;for(a in f)Object.prototype.hasOwnProperty.call(f,a)&&(this.lineStyles[a]=f[a],e=Math.min(e,a),d=Math.max(d,a));e=Math.max(e,0);d=Math.min(d,b.getLineCount());if(f=this.annotationModel){for(var c=f.getAnnotations(b.getLineStart(e),b.getLineEnd(d)),m=[];c.hasNext();){var g=c.next();"orion.annotation.highlightError"===g.type&&m.push(g)}c=[];for(g=e;g<=d;g++){a=g;var h=this.lineStyles[a],h=h&&
h.errors;a=b.getLineStart(a);if(h)for(var k=0;k<h.length;k++){var p=h[k];c.push(t.AnnotationType.createAnnotation("orion.annotation.highlightError",p.start+a,p.end+a))}}f.replaceAnnotations(m,c)}this.textView.redrawLines(e,d+1)},onLineStyle:function(e){var f=this.lineStyles[e.lineIndex];if(f)if(f.ranges){for(var f=f.ranges,d=e.lineStart,b=f.length,a=[],c=0;c<b;c++){var m=f[c];a.push({start:m.start+d,end:m.end+d,style:m.style})}e.ranges=a}else f.style&&(e.style=f.style)},_getEmptyStyle:function(e){for(var f=
[],d=0;d<e;d++)f.push(null);return f},setContentType:function(e){this.contentType=e;if(this.services)for(e=0;e<this.services.length;e++){var f=this.services[e];if(f.setContentType){var d=this.serviceRegistry.getService("orion.page.progress");d?d.progress(f.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):f.setContentType(this.contentType)}}},onServiceAdded:function(e,f){r(e)&&this.addServiceListener(f)},onServiceRemoved:function(e,
f){-1!==this.services.indexOf(f)&&this.removeServiceListener(f)},addServiceListener:function(e){if("function"===typeof e.addEventListener){if(e.addEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),this.services.push(e),e.setContentType&&this.contentType){var f=this.serviceRegistry.getService("orion.page.progress");f?f.progress(e.setContentType(this.contentType),"Styling content type: "+this.contentType.id?this.contentType.id:this.contentType):e.setContentType(this.contentType)}}else"undefined"!==
typeof console&&console.log(Error(g))},removeServiceListener:function(e){"function"===typeof e.removeEventListener?(e.removeEventListener("orion.edit.highlighter.styleReady",this.listener.onStyleReady),e=this.services.indexOf(e),-1!==e&&this.services.splice(e,1)):"undefined"!==typeof console&&console.log(Error(g))}};return k});
define("orion/editor/mirror",["i18n!orion/editor/nls/messages","orion/editor/eventTarget","orion/editor/annotations"],function(p,t,r){function k(b){this.string=b;this.tokenStart=this.pos=0}function f(b,a){return{token:function(a,b){return a.skipToEnd()}}}function g(b){this._modes={};this.mimeModes={};this.options={};this.StringStream=k;this.defineMode("null",f);this.defineMIME("text/plain","null")}function e(b){var a=[],c;for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&a.push(c);return a}function q(b,
a,c){c=c||{};this.model=b;this.codeMirror=a;this.isWhitespaceVisible="undefined"===typeof c.whitespacesVisible?!1:c.whitespacesVisible;this.mode=null;this.isModeLoaded=!1;this.lines=[];this.dirtyLines=[];this.startLine=Number.MAX_VALUE;this.endLine=-1;this.timer=null;this.initialize(b)}function d(b,a,c){this.init(b,a,c)}k.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string[this.pos]},next:function(){return this.string[this.pos++]},
eat:function(b){var a=this.string[this.pos];return"string"===typeof a&&(a===b||b.test&&b.test(a)||"function"===typeof b&&b(a))?this.string[this.pos++]:void 0},eatWhile:function(b){for(var a=!1;void 0!==this.eat(b);)a=!0;return a},eatSpace:function(){return this.eatWhile(/\s/)},skipToEnd:function(){this.pos=this.string.length},skipTo:function(b){b=this.string.indexOf(b,this.pos);return-1!==b?(this.pos=b,!0):!1},match:function(b,a,c){a=!0===a||"undefined"===typeof a;if("string"===typeof b){var d=c?
this.string.toLowerCase():this.string;b=c?b.toLowerCase():b;c=d.indexOf(b,this.pos);-1!==c&&a&&(this.pos=c+b.length);return-1!==c}if((b=this.string.substring(this.pos).match(b))&&a&&"string"===typeof b[0])this.pos+=b.index+b[0].length;return b},backUp:function(b){this.pos-=b},column:function(){for(var b=0,a=0;a<this.tokenStart;)b+="\t"===this.string[a++]?4:1;return b},indentation:function(){for(var b=this.string.search(/\S/),a=0,c=0;c<b;)a+="\t"===this.string[c++]?4:1;return a},current:function(){return this.string.substring(this.tokenStart,
this.pos)},advance:function(){this.tokenStart=this.pos}};g.prototype={options:{},setOption:function(b,a){this.options[b]=a},getOption:function(b){return this.options[b]},copyState:function(b,a){if("function"===typeof b.copyState)return b.copyState(a);var c={},d;for(d in a){var e=a[d];c[d]=e instanceof Array?e.slice():e}return c},startState:function(b,a){return b.startState(a)},defineMode:function(b,a){this._modes[b]=a},defineMIME:function(b,a){this.mimeModes[b]=a},getMode:function(b,a){var c={},d;
"string"===typeof a&&this.mimeModes[a]&&(a=this.mimeModes[a]);"object"===typeof a&&(c=a,d=this._modes[a.name]);d=d||this._modes[a];return"function"!==typeof d?("undefined"!==typeof console&&console&&console.log("Mode not found: "+a),this.getMode(b,"null")):d(b,c)},listModes:function(){return e(this._modes)},listMIMEs:function(){return e(this.mimeModes)},_getModeName:function(b){b=this.mimeModes[b];"object"===typeof b&&(b=b.name);return b}};q.prototype={initialize:function(b){var a=this;this.listener=
{onModelChanging:function(b){a._onModelChanging(b)},onModelChanged:function(b){a._onModelChanged(b)},onDestroy:function(b){a._onDestroy(b)}};this.model.addEventListener("Changing",this.listener.onModelChanging);this.model.addEventListener("Changed",this.listener.onModelChanged);this.model.addEventListener("Destroy",this.listener.onDestroy)},destroy:function(){this.model&&(this.model.removeEventListener("Changing",this.listener.onModelChanging),this.model.removeEventListener("Changed",this.listener.onModelChanged),
this.model.removeEventListener("Destroy",this.listener.onDestroy));this.dirtyLines=this.lines=this.mode=this.codeMirror=this.model=null;clearTimeout(this.timer);this.timer=null},_onModelChanging:function(b){this.startLine=this.model.getLineAtOffset(b.start)},_onModelChanged:function(b){this._dbgEvent(b);var a=this.startLine;(b.removedLineCount||b.addedLineCount)&&Array.prototype.splice.apply(this.lines,[a+1,b.removedLineCount].concat(this._newLines(b.addedLineCount)));this.mode&&(b=Math.max(b.addedLineCount,
b.removedLineCount),b=a+Math.min(b,500),this.highlight(a,b),this.highlightLater(b+1))},_onDestroy:function(b){this.destroy()},setViewportIndex:function(b){this.viewportIndex=b},_dbgEvent:function(b){},_dbgStyle:function(){},_newLines:function(b,a){for(var c=[],d=0;d<b;d++)c.push({style:null,eolState:null});return c},setMode:function(b,a){b&&(this.mode=this.codeMirror.getMode(this.codeMirror.options,b),this.lines=this._newLines(this.model.getLineCount()),a&&this.highlight())},highlight:function(b,
a,c){if(this.mode){var d=this.model.getLineCount();b="undefined"===typeof b?0:b;a="undefined"===typeof a?d-1:Math.min(a,d-1);for(var d=this.mode,e=this.getState(b),f=b;f<=a;f++){var g=this.lines[f];this.highlightLine(f,g,e);g.eolState=this.codeMirror.copyState(d,e)}this._expandRange(b,a);if(!c)this.onHighlightDone()}},highlightLater:function(b){this.dirtyLines.push(b);var a=this;this.timer=setTimeout(function(){a._highlightJob()},50)},_highlightJob:function(){for(var b=+new Date+30,a=this.mode.compareStates,
c=this.model.getLineCount();this.dirtyLines.length;){var d=this.viewportIndex,e=this.lines[d],d=e&&!e.eolState?d:this.dirtyLines.pop();if(d>=c)break;this._expandRange(d,d);for(var e=this._getResumeLineIndex(d),d=e+1,e=(e=0<=e&&this.lines[e].eolState)?this.codeMirror.copyState(this.mode,e):this.mode.startState(),f=0,g=d;g<c;g++){var k=this.lines[g],q=k.eolState,p=this.highlightLine(g,k,e);k.eolState=this.codeMirror.copyState(this.mode,e);p&&this._expandRange(d,g+1);var k=a&&q&&a(q,k.eolState),r=!a&&
!p&&3<f++;if(k||r)break;else if(!q||p)f=0;q=g<c||this.dirtyLines.length;if(+new Date>b&&q){this.highlightLater(g+1);this.onHighlightDone();return}}}this.onHighlightDone()},onHighlightDone:function(){this.startLine!==Number.MAX_VALUE&&-1!==this.endLine&&this.dispatchEvent({type:"Highlight",start:this.startLine,end:this.endLine});this.startLine=Number.MAX_VALUE;this.endLine=-1},_getResumeLineIndex:function(b){for(var a=this.lines,c=b-1;0<=c;c--)if(a[c].eolState||40<b-c)return c;return-1},getState:function(b){var a=
this.mode,c=this.lines,d,e;for(d=b-1;0<=d&&!(e=c[d],e.eolState||40<b-d);d--);var f=0<=d&&c[d].eolState;if(f){f=this.codeMirror.copyState(a,f);for(d=Math.max(0,d);d<b-1;d++)e=c[d],this.highlightLine(d,e,f),e.eolState=this.codeMirror.copyState(a,f);return f}return a.startState()},highlightLine:function(b,a,c){if(this.mode){var d=this.model;d.getLineStart(b)===d.getLineEnd(b)&&this.mode.blankLine&&this.mode.blankLine(c);var e=a.style||[];b=d.getLine(b);b=new k(b);for(var d=!a.style,f=[],g=0;!b.eol();g++){var q=
this.mode.token(b,c)||null,p=b.current();this._whitespaceStyle(q,p,b.tokenStart);q=[b.tokenStart,b.pos,q];p=e[g];f.push(q);d=d||!p||p[0]!==q[0]||p[1]!==q[1]||p[2]!==q[2];b.advance()}if(d=d||f.length!==e.length)a.style=f.length?f:null;return d}},_whitespaceStyle:function(b,a,c){if(!b&&this.isWhitespaceVisible&&/\s+/.test(a)){b=[];for(var d,e,f=0;f<a.length;f++){var g=a[f];g!==e&&(e&&b.push([c+d,c+f,"\t"===e?"punctuation separator tab":"punctuation separator space"]),d=f,e=g)}b.push([c+d,c+f,"\t"===
e?"punctuation separator tab":"punctuation separator space"]);return b}return null},_expandRange:function(b,a){this.startLine=Math.min(this.startLine,b);this.endLine=Math.max(this.endLine,a)},toStyleRangesAndErrors:function(b,a){var c=b.style;if(!c)return null;for(var d=[],e=[],f="undefined"===typeof a?0:this.model.getLineStart(a),g=0;g<c.length;g++){var k=c[g],q;q=(q=k[2])?"punctuation separator tab"===q||"punctuation separator space"===q?q:"cm-"+q:null;q&&(k={start:f+k[0],end:f+k[1],style:{styleClass:q}},
d.push(k),"cm-error"===q&&e.push(k))}return[d,e]},getLineStyle:function(b){return this.lines[b]},getLineStyles:function(){return this.lines}};t.EventTarget.addMixin(q.prototype);r.AnnotationType.registerType("orion.annotation.highlightError",{title:p.syntaxError,html:"\x3cdiv class\x3d'annotationHTML error'\x3e\x3c/div\x3e",rangeStyle:{styleClass:"annotationRange error"}});d.prototype={init:function(b,a,c){this.textView=b;this.annotationModel=c;this.modeApplier=new q(b.getModel(),a);var d=this;this.listener=
{onLineStyle:function(a){d.onLineStyle(a)},onDestroy:function(a){d.onDestroy(a)},onHighlight:function(a){d.onHighlight(a)}};b.addEventListener("LineStyle",this.listener.onLineStyle);b.addEventListener("Destroy",this.listener.onDestroy);this.modeApplier.addEventListener("Highlight",this.listener.onHighlight)},destroy:function(){this.modeApplier&&(this.modeApplier.removeEventListener("Highlight",this.listener.onHighlight),this.modeApplier.destroy());this.textView&&(this.textView.removeEventListener("LineStyle",
this.listener.onLineStyle),this.textView.removeEventListener("Destroy",this.listener.onDestroy));this.listener=this.modeApplier=this.annotationModel=this.textView=null},setMode:function(b){this.modeApplier.setMode(b)},onLineStyle:function(b){var a=b.lineIndex,c=this.modeApplier,d=c.getLineStyle(a);if(!d||!d.eolState){var e=this.textView.getModel().getLineCount();c.highlight(a,Math.min(a+20,e-1),!0);d=c.getLineStyle(a)}e=this.textView.getModel();if(d){var f=c.toStyleRangesAndErrors(d,a);if(f&&(b.ranges=
f[0],b=this.annotationModel)){c=[];d=[];if(f=f[1])for(var g=0;g<f.length;g++){var k=f[g];"cm-error"===k.style.styleClass&&d.push(r.AnnotationType.createAnnotation("orion.annotation.highlightError",k.start,k.end))}for(a=b.getAnnotations(e.getLineStart(a),e.getLineEnd(a));a.hasNext();)e=a.next(),"orion.annotation.highlightError"===e.type&&c.push(e);b.replaceAnnotations(c,d)}}},onHighlight:function(b){this.textView.redrawLines(b.start,b.end)},onDestroy:function(b){this.destroy()}};return{Mirror:g,ModeApplier:q,
CodeMirrorStyler:d}});
define("orion/editor/textMateStyler",["orion/regex"],function(p){function t(f){var g;if(f instanceof Array){g=Array(f.length);for(var e=0;e<f.length;e++)g[e]=t(f[e])}else for(e in g={},f)if(Object.prototype.hasOwnProperty.call(f,e)){var k=f[e];g[e]="object"===typeof k&&null!==k?t(k):k}return g}function r(f,g,e){this.initialize(f);this.grammar=t(g);this.externalGrammars=e?t(e):[];this._styles={};this._tree=null;this._allGrammars={};this.preprocess(this.grammar)}var k={unsupported:[{regex:/\(\?[ims\-]:/,func:function(f){return"option on/off for subexp"}},
{regex:/\(\?<([=!])/,func:function(f){return"\x3d"===f[1]?"lookbehind":"negative lookbehind"}},{regex:/\(\?>/,func:function(f){return"atomic group"}}],toRegExp:function(f){function g(b,a){throw Error('Unsupported regex feature "'+b+'": "'+a[0]+'" at index: '+a.index+" in "+a.input);}var e="",q;f=k.processGlobalFlag("x",f,function(b){for(var a="",c=!1,d=b.length,e=0;e<d;){var f=b.charAt(e);if(!c&&"#"===f)for(;e<d&&"\r"!==f&&"\n"!==f;)f=b.charAt(++e);else if(!c&&/\s/.test(f))for(;e<d&&/\s/.test(f);)f=
b.charAt(++e);else"\\"===f?(a+=f,/\s/.test(b.charAt(e+1))||(a+=b.charAt(e+1),e+=1)):("["===f?c=!0:"]"===f&&(c=!1),a+=f),e+=1}return a});f=k.processGlobalFlag("i",f,function(b){e+="i";return b});for(q=0;q<this.unsupported.length;q++){var d;(d=this.unsupported[q].regex.exec(f))&&g(this.unsupported[q].func(d),d)}return RegExp(f,e)},processGlobalFlag:function(f,g,e){var k="(?"+f+")";f="(?"+f+":";if(g.substring(0,k.length)===k)return e(g.substring(k.length));if(g.substring(0,f.length)===f){for(var k=0,
d=g.length,b=-1,a=0;a<d&&-1===b;a++)switch(g.charAt(a)){case "\\":a++;break;case "(":k++;break;case ")":k--,0===k&&(b=a)}k=b;if(k<g.length-1)throw Error("Only a "+f+") group that encloses the entire regex is supported in: "+g);return e(g.substring(f.length,k))}return g},hasBackReference:function(f){return/\\\d+/.test(f.source)},getSubstitutedRegex:function(f,g,e){e="undefined"===typeof e?!0:!1;f=f.source.split(/(\\\d+)/g);for(var k=[],d=0;d<f.length;d++){var b=f[d],a=/\\(\d+)/.exec(b);a?(b=g[a[1]]||
"",k.push(e?p.escape(b):b)):k.push(b)}return RegExp(k.join(""))},groupify:function(f,g){for(var e=f.source,k=e.length,d=[],b=0,a=[],c=1,m=1,n=[],h={},p={},r=0;r<k;r++){var t=d[d.length-1],w=e.charAt(r);switch(w){case "(":4===t&&(d.pop(),n.push(")"),a[a.length-1].end=r);var y=r+2<k?e.charAt(r+1)+""+e.charAt(r+2):null;if("?:"===y||"?\x3d"===y||"?!"===y){var z;"?:"===y?z=1:(z=3,b++);d.push(z);a.push({start:r,end:-1,type:z});n.push(w);n.push(y);r+=y.length}else d.push(2),a.push({start:r,end:-1,type:2,
oldNum:c,num:m}),n.push(w),0===b&&(p[m]=null),h[c]=m,c++,m++;break;case ")":t=d.pop();3===t&&b--;a[a.length-1].end=r;n.push(w);break;case "*":case "+":case "?":case "}":var C=w,l=e.charAt(r-1),y=r-1;if("}"===w){for(z=r-1;"{"!==e.charAt(z)&&0<=z;z--);l=e.charAt(z-1);y=z-1;C=e.substring(z,r+1)}z=a[a.length-1];if(")"===l&&(2===z.type||4===z.type)){n.splice(z.start,0,"(");n.push(C);n.push(")");w={start:z.start,end:n.length-1,type:4,num:z.num};for(l=0;l<a.length;l++)if(t=a[l],(2===t.type||4===t.type)&&
t.start>=z.start&&t.end<=y)t.start+=1,t.end+=1,t.num+=1,2===t.type&&(h[t.oldNum]=t.num);a.push(w);m++;break}default:"|"!==w&&(2!==t&&4!==t)&&0===b&&(d.push(4),a.push({start:r,end:-1,type:4,num:m}),n.push("("),p[m]=null,m++),n.push(w),"\\"===w&&(w=e.charAt(r+1),n.push(w),r+=1)}}for(;d.length;)d.pop(),n.push(")");e=RegExp(n.join(""));k={};g=g||h;for(var u in g)g.hasOwnProperty(u)&&(k[u]="\\"+g[u]);e=this.getSubstitutedRegex(e,k,!1);return[e,h,p]},complexCaptures:function(f){if(!f)return!1;for(var g in f)if(f.hasOwnProperty(g)&&
"0"!==g)return!0;return!1}};r.prototype={initialize:function(f){this.textView=f;this.textView.stylerOptions=this;var g=this;this._listener={onModelChanged:function(e){g.onModelChanged(e)},onDestroy:function(e){g.onDestroy(e)},onLineStyle:function(e){g.onLineStyle(e)},onStorage:function(e){g.onStorage(e)}};f.addEventListener("ModelChanged",this._listener.onModelChanged);f.addEventListener("Destroy",this._listener.onDestroy);f.addEventListener("LineStyle",this._listener.onLineStyle);f.redrawLines()},
onDestroy:function(f){this.destroy()},destroy:function(){this.textView&&(this.textView.removeEventListener("ModelChanged",this._listener.onModelChanged),this.textView.removeEventListener("Destroy",this._listener.onDestroy),this.textView.removeEventListener("LineStyle",this._listener.onLineStyle),this.textView=null);this._listener=this._tree=this._styles=this.grammar=null},preprocess:function(f){for(f=[f];0!==f.length;){var g=f.pop();if(!g._resolvedRule||!g._typedRule)if(g._resolvedRule=this._resolve(g),
g._typedRule=this._createTypedRule(g),this.addStyles(g.name),this.addStyles(g.contentName),this.addStylesForCaptures(g.captures),this.addStylesForCaptures(g.beginCaptures),this.addStylesForCaptures(g.endCaptures),g._resolvedRule!==g&&f.push(g._resolvedRule),g.patterns)for(var e=0;e<g.patterns.length;e++)f.push(g.patterns[e])}},addStyles:function(f){if(f&&!this._styles[f]){this._styles[f]=[];for(var g=f.split("."),e=0;e<g.length;e++)this._styles[f].push(g.slice(0,e+1).join("-"))}},addStylesForCaptures:function(f){for(var g in f)f.hasOwnProperty(g)&&
this.addStyles(f[g].name)},ContainerRule:function(){function f(f){this.rule=f;this.subrules=f.patterns}f.prototype.valueOf=function(){return"aa"};return f}(),BeginEndRule:function(){function f(f){this.rule=f;this.beginRegex=k.toRegExp(f.begin);this.endRegex=k.toRegExp(f.end);this.subrules=f.patterns||[];this.endRegexHasBackRef=k.hasBackReference(this.endRegex);var e=k.complexCaptures(f.captures);f=k.complexCaptures(f.beginCaptures)||k.complexCaptures(f.endCaptures);if(this.isComplex=e||f)e=k.groupify(this.beginRegex),
this.beginRegex=e[0],this.beginOld2New=e[1],this.beginConsuming=e[2],e=k.groupify(this.endRegex,this.beginOld2New),this.endRegex=e[0],this.endOld2New=e[1],this.endConsuming=e[2]}f.prototype.valueOf=function(){return this.beginRegex};return f}(),MatchRule:function(){function f(f){this.rule=f;this.matchRegex=k.toRegExp(f.match);if(this.isComplex=k.complexCaptures(f.captures))f=k.groupify(this.matchRegex),this.matchRegex=f[0],this.matchOld2New=f[1],this.matchConsuming=f[2]}f.prototype.valueOf=function(){return this.matchRegex};
return f}(),_createTypedRule:function(f){return f.match?new this.MatchRule(f):f.begin?new this.BeginEndRule(f):new this.ContainerRule(f)},_resolve:function(f){var g=f;if(f.include){if(f.begin||f.end||f.match)throw Error('Unexpected regex pattern in "include" rule '+f.include);f=f.include;if("#"===f.charAt(0)){if(g=this.grammar.repository&&this.grammar.repository[f.substring(1)],!g)throw Error("Couldn't find included rule "+f+" in grammar repository");}else if("$self"===f)g=this.grammar;else{if("$base"===
f)throw Error('Include "$base" is not supported');g=this._allGrammars[f];if(!g)for(var e=0;e<this.externalGrammars.length;e++){var k=this.externalGrammars[e];if(k.scopeName===f){this.preprocess(k);g=this._allGrammars[f]=k;break}}}}return g},ContainerNode:function(){function f(f,e){this.parent=f;this.rule=e;this.children=[];this.end=this.start=null}f.prototype.addChild=function(f){this.children.push(f)};f.prototype.valueOf=function(){var f=this.rule;return"ContainerNode { "+(f.include||"")+" "+(f.name||
"")+(f.comment||"")+"}"};return f}(),BeginEndNode:function(){function f(f,e,q){this.parent=f;this.rule=e;this.children=[];this.setStart(q);this.endMatch=this.end=null;this.endRegexSubstituted=e.endRegexHasBackRef?k.getSubstitutedRegex(e.endRegex,q):null}f.prototype.addChild=function(f){this.children.push(f)};f.prototype.getIndexInParent=function(f){return this.parent?this.parent.children.indexOf(this):-1};f.prototype.setStart=function(f){this.start=f.index;this.beginMatch=f};f.prototype.setEnd=function(f){f&&
"object"===typeof f?(this.endMatch=f,this.end=f.index+f[0].length):(this.endMatch=null,this.end=f)};f.prototype.shiftStart=function(f){this.start+=f;this.beginMatch.index+=f};f.prototype.shiftEnd=function(f){this.end+=f;this.endMatch&&(this.endMatch.index+=f)};f.prototype.valueOf=function(){return"{"+this.rule.beginRegex+" range\x3d"+this.start+".."+this.end+"}"};return f}(),push:function(f,g){if(g)for(var e=g.length;0<e;)f.push(g[--e])},exec:function(f,g,e){if(g=f.exec(g))g.index+=e;f.lastIndex=
0;return g},afterMatch:function(f){return f.index+f[0].length},getEndMatch:function(f,g,e){if(f instanceof this.BeginEndNode){var k=f.rule;f=f.endRegexSubstituted||k.endRegex;return!f?null:this.exec(f,g,e)}return null},initialParse:function(){this.textView.getModel().getCharCount();this._tree=new this.ContainerNode(null,this.grammar._typedRule);this.parse(this._tree,!1,0)},onModelChanged:function(f){var g=f.addedCharCount,e=f.removedCharCount;f=f.start;if(this._tree){var k=this.textView.getModel(),
d=k.getCharCount(),k=k.getLineEnd(k.getLineAtOffset(f)-1),b=this.getFirstDamaged(k,k),k=-1===k?0:k,g=b?this.parse(b,!0,k,f,g,e):d;this.textView.redrawRange(k,g)}else this.initialParse()},getFirstDamaged:function(f,g){if(0>f)return this._tree;for(var e=[this._tree],k=null;e.length;){var d=e.pop();if(!d.parent||this.isDamaged(d,f,g)){d instanceof this.BeginEndNode&&(k=d);for(var b=0;b<d.children.length;b++)e.push(d.children[b])}}return k||this._tree},isDamaged:function(f,g,e){return f.start<=e&&f.end>
g},parse:function(f,g,e,k,d,b){var a=this.textView.getModel(),c=a.getLineStart(a.getLineCount()-1),m=a.getCharCount(),n=this.getInitialExpected(f,e),h=-1;g&&(f.repaired=!0,f.endNeedsUpdate=!0,h=(h=f.children[f.children.length-1])?a.getLineEnd(a.getLineAtOffset(h.end+(d-b))):-1,k=a.getLineEnd(a.getLineAtOffset(k+b)),h=Math.max(h,k));h=-1===h?m:h;k=n;for(var p=f,r=!1,t=e,w=-1;p&&(!g||t<h);){var y=this.getNextMatch(a,p,t);y||(t=t>=c?m:a.getLineStart(a.getLineAtOffset(t)+1));var z=y&&y.match,C=y&&y.rule,
l=y&&y.isEnd;if(y&&y.isSub)t=this.afterMatch(z),C instanceof this.BeginEndRule&&(r=!0,g&&C===k.rule&&p===k.parent?(p=k,p.setStart(z),p.repaired=!0,p.endNeedsUpdate=!0,k=this.getNextExpected(k,"begin")):(g&&(this.prune(p,k),g=!1),z=new this.BeginEndNode(p,C,z),p.addChild(z),p=z));else if(l||t===m)p instanceof this.BeginEndNode&&(z?(r=!0,w=Math.max(w,p.end),p.setEnd(z),t=this.afterMatch(z),g&&p===k&&p.parent===k.parent?(p.repaired=!0,delete p.endNeedsUpdate,k=this.getNextExpected(k,"end")):g&&(this.prune(p,
k),g=!1)):(p.setEnd(m),delete p.endNeedsUpdate)),p=p.parent;g&&(t>=h&&!r)&&(this.prune(f,n),g=!1)}this.removeUnrepairedChildren(f,g,e);this.cleanup(g,f,e,h,m,d,b);return g?Math.max(w,t):t},removeUnrepairedChildren:function(f,g,e){if(g){g=f.children;for(var k=-1,d=0;d<g.length;d++){var b=g[d];if(!b.repaired&&this.isDamaged(b,e,Number.MAX_VALUE)){k=d;break}}-1!==k&&(f.children.length=k)}},cleanup:function(f,g,e,k,d,b,a){if(f){f=b-a;d=this.getIntersecting(k-f+1,d);g=this.getIntersecting(e,k);for(e=0;e<
d.length;e++)k=d[e],!k.repaired&&k instanceof this.BeginEndNode&&(k.shiftEnd(f),k.shiftStart(f));for(e=0;e<g.length;e++)k=g[e],k.repaired&&k.endNeedsUpdate&&k.shiftEnd(f),delete k.endNeedsUpdate,delete k.repaired}else{g=this.getIntersecting(e,k);for(e=0;e<g.length;e++)delete g[e].repaired}},getNextMatch:function(f,g,e,k){var d=f.getLineAtOffset(e),d=f.getLineEnd(d),b=f.getText(e,d),a=[],c=[];f=[];d=[];for(this.push(a,g.rule.subrules);a.length;){var m=a.length?a.pop():null,m=m&&m._resolvedRule._typedRule;
if(m instanceof this.ContainerRule&&-1===c.indexOf(m))c.push(m),this.push(a,m.subrules);else if(!m||!k||m.matchRegex){var n=m&&this.exec(m.matchRegex||m.beginRegex,b,e);n&&(f.push(n),d.push(m))}}a=Number.MAX_VALUE;c=-1;for(m=0;m<f.length;m++)n=f[m],n.index<a&&(a=n.index,c=m);if(!k&&(e=this.getEndMatch(g,b,e)))if(k=g.rule.applyEndPatternLast,-1===c||e.index<a||!k&&e.index===a)return{isEnd:!0,rule:g.rule,match:e};return-1===c?null:{isSub:!0,rule:d[c],match:f[c]}},getInitialExpected:function(f,g){var e,
k;if(f===this._tree)for(e=0;e<f.children.length;e++){if(k=f.children[e],k.start>=g)return k}else if(f instanceof this.BeginEndNode&&f.endMatch){var d=f.endMatch.index;for(e=0;e<f.children.length&&!(k=f.children[e],k.start>=g);e++);if(k&&k.start<d)return k}return f},getNextExpected:function(f,g){if("begin"===g){var e=f.children[0];return e?e:f}if("end"===g&&(e=f.parent)){var k=e.children[e.children.indexOf(f)+1];return k?k:e}return null},prune:function(f,g){g.parent===f?f.children.length=g.getIndexInParent():
f instanceof this.BeginEndNode&&(f.endMatch=null,f.end=null);f.parent&&(f.parent.children.length=f.getIndexInParent()+1)},onLineStyle:function(f){this._tree||this.initialParse();var g=f.lineStart,e=this.textView.getModel(),k=e.getLineEnd(f.lineIndex),d=e.getLineEnd(e.getLineAtOffset(g)-1),d=this.getFirstDamaged(d,d),g=this.getLineScope(e,d,g,k);f.ranges=this.toStyleRanges(g);f.ranges.sort(function(b,a){return b.start-a.start})},getLineScope:function(f,g,e,k){for(var d=e,b=this.getInitialExpected(g,
e),a=[],c=[];g&&d<k;){var m=this.getNextMatch(f,g,d);if(!m)break;var n=m&&m.match,h=m&&m.rule,p=m&&m.isSub,m=m&&m.isEnd;n.index!==d&&c.push({start:d,end:n.index,node:g});p?(d=this.afterMatch(n),h instanceof this.BeginEndRule?(this.addBeginScope(a,n,h),g=b,b=this.getNextExpected(b,"begin")):this.addMatchScope(a,n,h)):m&&(d=this.afterMatch(n),this.addEndScope(a,n,h),b=this.getNextExpected(b,"end"),g=g.parent)}d<k&&c.push({start:d,end:k,node:g});f=this.getInheritedLineScope(c,e,k);return a.concat(f)},
getInheritedLineScope:function(f,g,e){g=[];for(e=0;e<f.length;e++)for(var k=f[e],d=k.node;d;){var b=d.rule.rule,a=b.name;if(b=b.contentName||a){this.addScopeRange(g,k.start,k.end,b);break}d=d.parent}return g},addBeginScope:function(f,g,e){var k=e.rule;this.addCapturesScope(f,g,k.beginCaptures||k.captures,e.isComplex,e.beginOld2New,e.beginConsuming)},addEndScope:function(f,g,e){var k=e.rule;this.addCapturesScope(f,g,k.endCaptures||k.captures,e.isComplex,e.endOld2New,e.endConsuming)},addMatchScope:function(f,
g,e){var k=e.rule,d=k.name;(k=k.captures)?this.addCapturesScope(f,g,k,e.isComplex,e.matchOld2New,e.matchConsuming):this.addScope(f,g,d)},addScope:function(f,g,e){e&&f.push({start:g.index,end:this.afterMatch(g),scope:e})},addScopeRange:function(f,g,e,k){k&&f.push({start:g,end:e,scope:k})},addCapturesScope:function(f,g,e,k,d,b){if(e)if(k){k={1:0};for(var a=0,c=1;void 0!==g[c];c++)void 0!==b[c]&&(a+=g[c].length),void 0!==g[c+1]&&(k[c+1]=a);b=g.index;for(a=1;e[a];a++){var c=e[a].name,m=d[a],n=b+k[m];
"undefined"!==typeof g[m]&&this.addScopeRange(f,n,n+g[m].length,c)}}else this.addScope(f,g,e[0]&&e[0].name)},getIntersecting:function(f,g){for(var e=[],k=this._tree?[this._tree]:[];k.length;){var d=k.pop(),b=!1;d instanceof this.ContainerNode?b=!0:this.isDamaged(d,f,g)&&(b=!0,e.push(d));if(b)for(var b=d.children.length,a=0;a<b;a++)k.push(d.children[a])}return e.reverse()},toStyleRanges:function(f){for(var g=[],e=0;e<f.length;e++){var k=f[e],d=this._styles[k.scope];if(!d)throw Error("styles not found for "+
k.scope);d=d.join(" ");g.push({start:k.start,end:k.end,style:{styleClass:d}})}return g}};return{RegexUtil:k,TextMateStyler:r}});
define("orion/editor/htmlGrammar",[],function(){return{HtmlGrammar:function(){return{scopeName:"source.html",uuid:"3B5C76FB-EBB5-D930-F40C-047D082CE99B",patterns:[{begin:"\x3c!(doctype|DOCTYPE)",end:"\x3e",contentName:"entity.name.tag.doctype.html",beginCaptures:{0:{name:"entity.name.tag.doctype.html"}},endCaptures:{0:{name:"entity.name.tag.doctype.html"}}},{begin:"\x3c!--",end:"--\x3e",beginCaptures:{0:{name:"punctuation.definition.comment.html"}},endCaptures:{0:{name:"punctuation.definition.comment.html"}},
patterns:[{match:"--",name:"invalid.illegal.badcomment.html"}],contentName:"comment.block.html"},{match:"\x3c[A-Za-z0-9_\\-:]+(?\x3d ?)",name:"entity.name.tag.html"},{include:"#attrName"},{include:"#qString"},{include:"#qqString"},{include:"#entity"},{match:"\x3c/[A-Za-z0-9_\\-:]+\x3e",name:"entity.name.tag.html"},{match:"\x3e",name:"entity.name.tag.html"}],repository:{attrName:{match:"[A-Za-z\\-:]+(?\x3d\\s*\x3d\\s*['\"])",name:"entity.other.attribute.name.html"},qqString:{match:'(")[^"]+(")',name:"string.quoted.double.html"},
qString:{match:"(')[^']+(')",name:"string.quoted.single.html"},entity:{match:"\x26[A-Za-z0-9]+;",name:"constant.character.entity.html"}}}}}});
define("orion/editor/textStyler",["orion/editor/annotations","orion/editor/eventTarget"],function(p,t){function r(d,b){this._patternManager=new k(d,b)}function k(d,b){this._unnamedCounter=0;this._patterns=[];this._rootId=b;d.forEach(function(a){this._addRepositoryPatterns(a.repository||{},a.id);this._addPatterns(a.patterns||[],a.id)}.bind(this))}function f(d,b,a,c,e,f,h){this.start=d.start;this.end=d.end;this.contentStart=d.contentStart;this.contentEnd=d.contentEnd;this.name=b;this.typeId=a;this.styler=
c;this.parent=f;h&&h(this);this._subBlocks=c.computeBlocks(e,e.getText(this.contentStart,this.end),this,this.contentStart,null,null,null)}function g(d){this._styler=d}function e(d,b,a){this._highlightCaretLine=this._whitespacesVisible=!1;this._detectTasks=this._foldingEnabled=!0;this._view=d;this._annotationModel=b;this._stylerAdapter=a;this._stylerAdapter.setStyler(this);this._accessor=new g(this);this._bracketAnnotations;var c=this;this._listener={onChanged:function(a){c._onModelChanged(a)},onDestroy:function(a){c._onDestroy(a)},
onLineStyle:function(a){c._onLineStyle(a)},onMouseDown:function(a){c._onMouseDown(a)},onSelection:function(a){c._onSelection(a)}};a=d.getModel();a.getBaseModel&&(a=a.getBaseModel());a.addEventListener("Changed",this._listener.onChanged);d.addEventListener("MouseDown",this._listener.onMouseDown);d.addEventListener("Selection",this._listener.onSelection);d.addEventListener("Destroy",this._listener.onDestroy);d.addEventListener("LineStyle",this._listener.onLineStyle);var e=a.getCharCount();this._rootBlock=
this._stylerAdapter.createBlock({start:0,contentStart:0,end:e,contentEnd:e},this,a,null);b&&(e=[],b.removeAnnotations(p.AnnotationType.ANNOTATION_FOLDING),this._computeFolding(this._rootBlock.getBlocks(),d.getModel(),e),this._detectTasks&&(b.removeAnnotations(p.AnnotationType.ANNOTATION_TASK),this._computeTasks(this._rootBlock,a,e)),b.replaceAnnotations([],e));d.redrawLines()}var q=function(d,b,a,c,e){var f;void 0===c&&(c=-1);void 0===e&&(e=d.length);for(;1<e-c;)if(f=Math.floor((e+c)/2),b<=d[f].start)e=
f;else if(a&&b<d[f].end){e=f;break}else c=f;return e};r.prototype={blockSpansBeyondEnd:function(d){return d.pattern.regexEnd===this._eolRegex},computeBlocks:function(d,b,a,c,e,f,h){if(!b)return[];var g=[],k=[];e=e||0;f=f||Infinity;h=h||Infinity;a.blockPatterns.forEach(function(a){var c=this._findMatch(a.regexBegin||a.regex,b,e);c&&k.push({result:c,pattern:a})}.bind(this));if(!k.length)return g;k.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<
b.pattern.pattern.index?-1:1});for(var p=0;0<k.length;){var q=k[0];k.splice(0,1);if(f<q.result.index)break;if(!(q.result.index<p)){var p=c+q.result.index,r=q.result.index,t=null,C=q.pattern.regexEnd;if(C){var r=r+q.result[0].length,l=q.pattern,u=this._substituteCaptureValues(C,q.result);u!==C&&(l={pattern:l.pattern,regexBegin:l.regexBegin,regexEnd:u},C=u);for(u=r;!t;){u=this._findMatch(C,b,u);u||(this._eolRegex.lastIndex=0,u=this._eolRegex.exec(b),l={pattern:l.pattern,regexBegin:l.regexBegin,regexEnd:this._eolRegex});
var B=this.createBlock({start:p,end:c+u.index+u[0].length,contentStart:c+r,contentEnd:c+u.index},a.styler,d,a,l),A=B.getBlocks();if(!A.length||A[A.length-1].end<=u.index+c)t=B;u=u.index+u[0].length}}else t=this.createBlock({start:p,end:p+q.result[0].length,contentStart:p,contentEnd:p+q.result[0].length},a.styler,d,a,q.pattern);g.push(t);if(g.length===h||f<=t.end)break;p=t.end-c}this._updateMatch(q,b,k,p,f)}return g},computeStyle:function(d,b,a){if(!d.pattern)return null;var c={start:d.start,end:d.end,
style:d.pattern.pattern.name};if(d.contentStart<=a&&a<d.contentEnd)return d.pattern.pattern.contentName?{start:d.contentStart,end:d.contentEnd,style:d.pattern.pattern.contentName}:c;var e,f;if(a<d.contentStart){f=d.pattern.pattern.beginCaptures||d.pattern.pattern.captures;if(!f)return c;e=d.pattern.regexBegin;b=b.getText(d.start,d.contentStart);d=d.start}else{f=d.pattern.pattern.endCaptures||d.pattern.pattern.captures;if(!f)return c;e=d.pattern.regexEnd;b=b.getText(d.contentEnd,d.end);d=d.contentEnd}e.lastIndex=
0;if(e=e.exec(b))if(b=[],this._getCaptureStyles(e,f,d,b),(f=b[q(b,a,!0)])&&f.start<=a&&a<f.end)return f;return c},createBlock:function(d,b,a,c,e){return new f(d,e?e.pattern.name:null,e?e.pattern.id:null,b,a,c,function(a){a.pattern=e;a.linePatterns=[];a.blockPatterns=[];a.enclosurePatterns={};this._initPatterns(this._patternManager,a)}.bind(this))},getBlockContentStyleName:function(d){return d.pattern.pattern.contentName||d.pattern.pattern.name},getBlockEndStyle:function(d,b,a,c){var e;if(d.pattern.regexEnd&&
(e=this._findMatch(d.pattern.regexEnd,b,0)))(b=d.pattern.pattern.endCaptures||d.pattern.pattern.captures)?this._getCaptureStyles(e,b,a-e[0].length,c):d.pattern.pattern.name&&c.push({start:a-e[0].length,end:a,style:d.pattern.pattern.name});return e?e[0]:null},getBlockStartStyle:function(d,b,a,c){var e;if(d.pattern.regexBegin&&(e=this._findMatch(d.pattern.regexBegin,b,0)))(b=d.pattern.pattern.beginCaptures||d.pattern.pattern.captures)?this._getCaptureStyles(e,b,a,c):c.push({start:a,end:a+e[0].length,
style:d.pattern.pattern.name});return e?e[0]:null},getBracketMatch:function(d,b){for(var a,c=Object.keys(d.enclosurePatterns),e=0;e<c.length;e++){var f=d.enclosurePatterns[c[e]],h=this._findMatch(f.regex,b,0);if(h&&0===h.index){a=f;break}}if(!a)return null;e=!1;-1!==a.pattern.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)?(e=!0,c=a.pattern.name.replace(this._PUNCTUATION_SECTION_BEGIN,this._PUNCTUATION_SECTION_END)):c=a.pattern.name.replace(this._PUNCTUATION_SECTION_END,this._PUNCTUATION_SECTION_BEGIN);
return!d.enclosurePatterns[c]?null:{beginName:a.pattern.name,endName:c,atStart:e}},parse:function(d,b,a,c,e){if(d&&(a=a.linePatterns)){var f=[];a.forEach(function(a){var b=a.regex||a.regexBegin;b.oldLastIndex=b.lastIndex;(b=this._findMatch(b,d,0))&&f.push({result:b,pattern:a})}.bind(this));f.sort(function(a,b){return a.result.index<b.result.index?-1:a.result.index>b.result.index?1:a.pattern.pattern.index<b.pattern.pattern.index?-1:1});for(var h=0;0<f.length;){var g=f[0];f.splice(0,1);if(!(g.result.index<
h)){var k=g.result.index,p,q=[];if(g.pattern.regex){h=g.result;p=k+h[0].length;p={start:b+k,end:b+p,style:g.pattern.pattern.name};if(!e){g.pattern.pattern.captures&&this._getCaptureStyles(h,g.pattern.pattern.captures,b+k,q);q.sort(function(a,b){return a.start<b.start?-1:a.start>b.start?1:0});for(k=0;k<q.length-1;k++)if(q[k+1].start<q[k].end){var r={start:q[k+1].end,end:q[k].end,style:q[k].style};q[k].end=q[k+1].start;q.splice(k+2,0,r)}}this._mergeStyles(p,q,c)}else h=g.pattern.regexEnd,h=this._substituteCaptureValues(h,
g.result),h=this._findMatch(h,d,g.result.index+g.result[0].length),h||(this._eolRegex.lastIndex=0,h=this._eolRegex.exec(d)),p=h.index+h[0].length,c.push({start:b+k,end:b+p,style:g.pattern.pattern.name});h=h.index+h[0].length}this._updateMatch(g,d,f,h)}a.forEach(function(a){a=a.regex||a.regexBegin;a.lastIndex=a.oldLastIndex})}},setStyler:function(){},verifyBlock:function(d,b,a,c){var e=null,f=[];a.parent.blockPatterns.forEach(function(a){var c=this._findMatch(a.regexBegin||a.regex,b,0);c&&f.push({result:c,
pattern:a})}.bind(this));f.sort(function(a,b){return!a.result.index&&b.result.index?-1:a.result.index&&!b.result.index?1:!a.result.index&&!b.result.index?a.pattern.pattern.index<b.pattern.pattern.index?-1:1:0});if(!f.length||0!==f[0].result.index||f[0].pattern.pattern.id!==a.pattern.pattern.id)e=!1;else{var h=f[0],g=h.pattern.regexEnd;if(g){for(var g=this._substituteCaptureValues(g,h.result),h=h.result[0].length,k=this._findMatch(g,b,h);null===e&&k&&a.start+k.index!==a.contentEnd+c;){var p=this.computeBlocks(d,
b,a,a.start,h,k.index+1,null);!p.length||p[p.length-1].end<=a.start+k.index?e=!1:p.length?(h=p[p.length-1].end-a.start,k=this._findMatch(g,b,h)):k=null}k||(this._eolRegex.lastIndex=0,k=this._eolRegex.exec(b),e=a.start+k.index===a.end+c)}else e=a.start+h.result[0].length===a.end+c}return null!==e?e:!0},_findMatch:function(d,b,a,c){var e=a,f=d.lastIndex;this._linebreakRegex.lastIndex=a;a=this._linebreakRegex.exec(b);var h,g;d.lastIndex=0;if(a){for(g=a.index;0<=--g&&!(h=b.charAt(g),h===this._NEWLINE||
h===this._CR););h=b.substring(g+1,a.index+a[1].length);d.lastIndex=g=a.index-g-1}for(;a&&a.index<b.length;){var k;if(c){var p=d.lastIndex;d.test(h)&&(d.lastIndex=p,k=d.exec(h))}else k=d.exec(h);if(k)return k.index+=e,k.index-=g,d.lastIndex=f,k;g=0;e+=a[0].length;if(a=this._linebreakRegex.exec(b))h=a[1],d.lastIndex=0}d.lastIndex=f;return null},_getCaptureStyles:function(d,b,a,c){if(b[0])c.push({start:a,end:a+d[0].length,style:b[0].name});else for(var e=0,f=1;f<d.length;f++)if(d[f]){var h=b[f];if(h){var g=
a+e;c.push({start:g,end:g+d[f].length,style:h.name})}e+=d[f].length}},_initPatterns:function(d,b){if(b.pattern&&b.pattern.pattern.linePatterns)b.linePatterns=b.pattern.pattern.linePatterns,b.blockPatterns=b.pattern.pattern.blockPatterns,b.enclosurePatterns=b.pattern.pattern.enclosurePatterns;else{var a=d.getPatterns(b.pattern?b.pattern.pattern:null),c=function(a){a="string"===typeof a?a:a.match;var b=this._ignoreCaseRegex.exec(a),c=this._FLAGS;b&&(a=a.substring(b[0].length),c+="i");return RegExp(a,
c)}.bind(this),e=-1,f=0;a.forEach(function(a){var d;if(a.match&&!a.begin&&!a.end){if(d={regex:c(a.match),pattern:a},b.linePatterns.push(d),a.name&&0===a.name.indexOf("punctuation.section")&&(-1!==a.name.indexOf(this._PUNCTUATION_SECTION_BEGIN)||-1!==a.name.indexOf(this._PUNCTUATION_SECTION_END)))b.enclosurePatterns[a.name]=d}else!a.match&&(a.begin&&a.end)&&(e=f,d={regexBegin:c(a.begin),regexEnd:c(a.end),pattern:a},b.linePatterns.push(d));f++}.bind(this));b.blockPatterns=b.linePatterns.slice(0,e+1);
b.pattern&&(b.pattern.pattern.enclosurePatterns=b.enclosurePatterns,b.pattern.pattern.linePatterns=b.linePatterns,b.pattern.pattern.blockPatterns=b.blockPatterns)}},_mergeStyles:function(d,b,a){var c=d.start;b.forEach(function(b){c<=b.start&&a.push({start:c,end:b.start,style:d.style});a.push(b);c=b.end});c<d.end&&a.push({start:c,end:d.end,style:d.style})},_substituteCaptureValues:function(d,b){var a=d.toString();this._captureReferenceRegex.lastIndex=0;if(!this._captureReferenceRegex.test(a))return d;
this._captureReferenceRegex.lastIndex=0;for(var c=this._captureReferenceRegex.exec(a);c;)a=a.replace(c[0],b[c[1]]||""),this._captureReferenceRegex.lastIndex=0,c=this._captureReferenceRegex.exec(a);return RegExp(a.substring(1,a.length-1-this._FLAGS.length),this._FLAGS)},_updateMatch:function(d,b,a,c,e){var f=d.pattern.regex?d.pattern.regex:d.pattern.regexBegin;e=e||Infinity;if((b=this._findMatch(f,b,c,!0))&&b.index<e){d.result=b;for(e=0;e<a.length;e++)if(b.index<a[e].result.index||b.index===a[e].result.index&&
d.pattern.pattern.index<a[e].pattern.pattern.index){a.splice(e,0,d);return}a.push(d)}},_captureReferenceRegex:/\\(\d)/g,_eolRegex:/$/,_ignoreCaseRegex:/^\(\?i\)\s*/,_linebreakRegex:/(.*)(?:[\r\n]|$)/g,_CR:"\r",_FLAGS:"g",_NEWLINE:"\n",_PUNCTUATION_SECTION_BEGIN:".begin",_PUNCTUATION_SECTION_END:".end"};k.prototype={getPatterns:function(d){d?(d="string"===typeof d?d:d.qualifiedId,d+="#"):d=this._rootId+"#"+this._NO_ID;var b=[0],a={},c=RegExp("^"+d+"[^#]+$");this._patterns.forEach(function(d){c.test(d.qualifiedId)&&
(d.include?this._processInclude(d,b,a):(d.index=b[0]++,a[d.id]=d))}.bind(this));var e=[];Object.keys(a).forEach(function(b){e.push(a[b])});return e},_addPattern:function(d,b,a){d.parentId=a;d.id=b;d.qualifiedId=d.parentId+"#"+d.id;this._patterns.push(d);d.patterns&&!d.include&&this._addPatterns(d.patterns,d.qualifiedId)},_addPatterns:function(d,b){d.forEach(function(a){this._addPattern(a,this._NO_ID+this._unnamedCounter++,b)}.bind(this))},_addRepositoryPatterns:function(d,b){Object.keys(d).forEach(function(a){this._addPattern(d[a],
a,b)}.bind(this))},_processInclude:function(d,b,a){var c,e=d.include.indexOf("#");c=0===e?RegExp("^"+d.qualifiedId.substring(0,d.qualifiedId.indexOf("#"))+d.include+"$"):-1===e?RegExp("^"+d.include+"#"+this._NO_ID+"[^#]+$"):RegExp("^"+d.include+"$");this._patterns.forEach(function(d){c.test(d.qualifiedId)&&(d.include?this._processInclude(d,b,a):a[d.id]||(d.index=b[0]++,a[d.id]=d))}.bind(this))},_NO_ID:"NoID"};f.prototype={adjustBounds:function(d,b){d<this.start&&(this.start+=b);d<this.contentStart&&
(this.contentStart+=b);d<=this.end&&(this.end+=b);d<=this.contentEnd&&(this.contentEnd+=b);this._subBlocks.forEach(function(a){d<=a.end&&a.adjustBounds(d,b)})},getBlocks:function(){return this._subBlocks},getBlockAtIndex:function(d){return q(this.getBlocks(),d,!0)},isRenderingWhitespace:function(){return this.styler._isRenderingWhitespace()}};g.prototype={getStyles:function(d){return this._styler.getStyles(d)}};e.prototype={addAnnotationProvider:function(d){"function"===typeof d&&this._annotationProviders.push(d)},
computeBlocks:function(d,b,a,c,e,f,h){return this._stylerAdapter.computeBlocks(d,b,a,c,e,f,h)},destroy:function(){if(this._view){var d=this._view.getModel();d.getBaseModel&&(d=d.getBaseModel());d.removeEventListener("Changed",this._listener.onChanged);this._view.removeEventListener("MouseDown",this._listener.onMouseDown);this._view.removeEventListener("Selection",this._listener.onSelection);this._view.removeEventListener("Destroy",this._listener.onDestroy);this._view.removeEventListener("LineStyle",
this._listener.onLineStyle);this._view=null}},getBlockAtIndex:function(d){return this._findBlock(this._rootBlock,d)},getRootBlock:function(){return this._rootBlock},getStyleAccessor:function(){return this._accessor},getStyles:function(d){var b=[],a=this._view.getModel();a.getBaseModel&&(a=a.getBaseModel());var c=this._findBlock(this._rootBlock,d),e=a.getLineAtOffset(d),f=a.getLine(e),h=[];this._stylerAdapter.parse(f,a.getLineStart(e),c,h);for((e=h[q(h,d,!0)])&&(e.start<=d&&d<e.end)&&b.push(e);c;)(e=
this._stylerAdapter.computeStyle(c,a,d))&&b.splice(0,0,e),c=c.parent;return b},removeAnnotationProvider:function(d){"function"===typeof d&&(d=this._annotationProviders.indexOf(d),-1!==d&&this._annotationProviders.splice(d,1))},setDetectHyperlinks:function(){},setDetectTasks:function(d){this._detectTasks=d},setFoldingEnabled:function(d){this._foldingEnabled=d},setHighlightCaretLine:function(d){this._highlightCaretLine=d},setWhitespacesVisible:function(d,b){this._whitespacesVisible!==d&&(this._whitespacesVisible=
d,b&&this._view.redraw())},_computeFolding:function(d,b,a){if(b.getBaseModel){var c=b.getBaseModel();d.forEach(function(d){var e=this._createFoldingAnnotation(b,c,d.start,d.end);e&&a.push(e);this._computeFolding(d.getBlocks(),b,a)}.bind(this))}},_computeTasks:function(d,b,a,c,e){c=c||d.start;e=e||d.end;if(d.start<=e&&c<=d.end&&this._annotationModel){var f=p.AnnotationType.ANNOTATION_TASK;if(d.name&&0===d.name.indexOf("comment")){var h=[];this._stylerAdapter.parse(b.getText(d.contentStart,d.end),d.contentStart,
d,h,!0);for(var g=0;g<h.length;g++)"meta.annotation.task.todo"===h[g].style&&(c<=h[g].start&&h[g].end<=e)&&a.push(p.AnnotationType.createAnnotation(f,h[g].start,h[g].end,b.getText(h[g].start,h[g].end)))}d.getBlocks().forEach(function(d){this._computeTasks(d,b,a,c,e)}.bind(this))}},_createFoldingAnnotation:function(d,b,a,c){var e=b.getLineAtOffset(a),f=b.getLineAtOffset(c);return e===f||e+1===f&&b.getLineStart(f)===b.getLineEnd(f)?null:new (p.AnnotationType.getType(p.AnnotationType.ANNOTATION_FOLDING))(a,
c,d)},_findBlock:function(d,b){var a=d.getBlocks();if(!a.length)return d;var c=q(a,b,!0);return c<a.length&&a[c].start<=b&&b<a[c].end?this._findBlock(a[c],b):d},_findBrackets:function(d,b,a,c,e){for(var f=[],h=[],g=c,k=b.getBlocks(),p=q(k,c,!0);p<k.length&&!(k[p].start>=e);p++){var r=k[p].start,t=k[p].end;g<r&&(this._stylerAdapter.parse(a.substring(g-c,r-c),g,b,h),h.forEach(function(a){a.style&&(0===a.style.indexOf(d.beginName)?f.push(a.start+1):0===a.style.indexOf(d.endName)&&f.push(-(a.start+1)))}),
h=[]);g=t}g<e&&(this._stylerAdapter.parse(a.substring(g-c,e-c),g,b,h),h.forEach(function(a){a.style&&(0===a.style.indexOf(d.beginName)?f.push(a.start+1):0===a.style.indexOf(d.endName)&&f.push(-(a.start+1)))}));return f},_findMatchingBracket:function(d,b,a){var c=d.getLineAtOffset(a),e=d.getLineEnd(c),f=d.getText(a,e),f=this._stylerAdapter.getBracketMatch(b,f);if(!f)return-1;for(var h=d.getLine(c),g=d.getLineStart(c),e=this._findBrackets(f,b,h,g,e),k=0;k<e.length;k++)if(h=0<=e[k]?1:-1,e[k]*h-1===a){a=
1;if(f.atStart){for(k++;k<e.length;k++)if(h=0<=e[k]?1:-1,a+=h,0===a)return e[k]*h-1;c+=1;for(k=d.getLineCount();c<k;){h=d.getLine(c);g=d.getLineStart(c);e=d.getLineEnd(c);e=this._findBrackets(f,b,h,g,e);for(g=0;g<e.length;g++)if(h=0<=e[g]?1:-1,a+=h,0===a)return e[g]*h-1;c++}}else{for(k--;0<=k;k--)if(h=0<=e[k]?1:-1,a+=h,0===a)return e[k]*h-1;for(c-=1;0<=c;){h=d.getLine(c);g=d.getLineStart(c);e=d.getLineEnd(c);e=this._findBrackets(f,b,h,g,e);for(k=e.length-1;0<=k;k--)if(h=0<=e[k]?1:-1,a+=h,0===a)return e[k]*
h-1;c--}}break}return-1},_getLineStyle:function(d){if(this._highlightCaretLine){var b=this._view.getModel(),a=this._view.getSelection();if(a.start===a.end&&b.getLineAtOffset(a.start)===d)return this._caretLineStyle}return null},_getStyles:function(d,b,a,c){b.getBaseModel&&(c=b.mapOffset(c));for(var e=c+a.length,f=[],h=c,g=d.getBlocks(),k=q(g,c,!0);k<g.length&&!(g[k].start>=e);k++){var p=g[k].start,r=g[k].end;h<p&&this._stylerAdapter.parse(a.substring(h-c,p-c),h,d,f);var t=Math.max(h,p);t===p&&(p=
this._stylerAdapter.getBlockStartStyle(g[k],a.substring(t-c),t,f))&&(t+=p.length);var p=Math.min(e,r),z=[];p===r&&(h=a.substring(p-h-(g[k].end-g[k].contentEnd)),(h=this._stylerAdapter.getBlockEndStyle(g[k],h,p,z))&&(p-=h.length));var h=this._getStyles(g[k],b,a.substring(t-c,p-c),t),C=this._stylerAdapter.getBlockContentStyleName(g[k]);if(C){var l=t;h.forEach(function(a){a.start-l&&f.push({start:l,end:a.start,style:C});a.mergeable&&(a.style+=","+C);f.push(a);l=a.end});p-l&&f.push({start:l,end:p,style:C})}else f=
f.concat(h);f=f.concat(z);h=r}h<e&&this._stylerAdapter.parse(a.substring(h-c,e-c),h,d,f);if(b.getBaseModel)for(d=0;d<f.length;d++)a=f[d].end-f[d].start,f[d].start=b.mapOffset(f[d].start,!0),f[d].end=f[d].start+a;return f},_isRenderingWhitespace:function(){return this._whitespacesVisible},_onDestroy:function(){this.destroy()},_onLineStyle:function(d){d.textView===this._view&&(d.style=this._getLineStyle(d.lineIndex));d.ranges=this._getStyles(this._rootBlock,d.textView.getModel(),d.lineText,d.lineStart);
d.ranges.forEach(function(b){b.style&&(b.style={styleClass:b.style.replace(/\./g," ")})});this._isRenderingWhitespace()&&(this._spliceStyles(this._spacePattern,d.ranges,d.lineText,d.lineStart),this._spliceStyles(this._tabPattern,d.ranges,d.lineText,d.lineStart))},_onModelChanged:function(d){var b=d.start,a=d.removedCharCount;d=d.addedCharCount-a;var c=this._view.getModel(),e=c.getBaseModel?c.getBaseModel():c,a=b+a,f=e.getCharCount(),h=e.getLineStart(e.getLineAtOffset(b)),g=this._findBlock(this._rootBlock,
b),k,r,t,y,z,C,l;do{t=g.parent;if(!k&&t){if(0>d&&g.end-b<=-d){g=t;continue}z=e.getText(g.start,Math.min(f,g.end+d+1));if(!this._stylerAdapter.verifyBlock(e,z,g,d)){g=t;continue}}r=g.getBlocks();var u=r.length,B=q(r,h,!0),A=q(r,a,!1,B-1,u);k=!1;if(B&&r.length&&r[B-1].end===b){z=e.getText(r[B-1].start,Math.min(f,b+1));var D=this.computeBlocks(e,z,g,r[B-1].start,null,null,null);D.length&&D[0].end!==r[B-1].end&&(B--,k=!0)}B<u&&r[B].start<=h&&(h<r[B].end||k)?(l=r[B].start,l>b&&(l+=d)):B===u&&0<u&&g.end-
d===r[u-1].end?(l=r[--B].start,l>b&&(l+=d)):l=Math.max(h,g.contentStart);C=A<u?r[A].end:g.contentEnd;b<=C&&(C+=d);C=Math.min(C,f-1);z=e.getText(l,C+1);D=this.computeBlocks(e,z,g,l,null,null,null);if(A<u){if(D.length&&D[D.length-1].end===C&&D[D.length-1].typeId===r[A].typeId)break;if(D.length&&this._stylerAdapter.blockSpansBeyondEnd(D[D.length-1])){A++;for(var H=D[D.length-1].getBlocks(),H=(H.length?H[H.length-1]:D[D.length-1]).typeId;A<u;){if(r[A].typeId===H){var M=r[A].end+d,M=Math.min(M,f-1);z=
e.getText(l,M+1);z=this.computeBlocks(e,z,g,l,null,null,null);if(z.length&&z[z.length-1].end===M){C=M;D=z;break}}A++}if(A<u)break}}else if(!D.length||D[D.length-1].end<=g.contentEnd+d)break;if(!t){C=f;A=u;z=e.getText(l,C);D=this.computeBlocks(e,z,g,l,null,null,null);break}g=t;y=!0}while(1);this._rootBlock.adjustBounds(b,d);A=Math.min(A+1,u);y||(y=A-B!==D.length);if(!y)for(u=0;u<D.length;u++)if(k=r[B+u],f=D[u],k.start!==f.start||k.end!==f.end||k.typeId!==f.typeId){y=!0;break}!r.length&&!D.length?this.dispatchEvent({type:"BlocksChanged",
oldBlocks:[g],newBlocks:[g]}):this.dispatchEvent({type:"BlocksChanged",oldBlocks:r.slice(B,A),newBlocks:D});B=[B,A-B].concat(D);Array.prototype.splice.apply(r,B);y&&(r=l,y=C,c!==e&&(r=c.mapOffset(r,!0),y=c.mapOffset(y,!0)),this._view.redrawRange(r,y));if(this._annotationModel){var K=[],G=[],P=[];r=this._annotationModel.getAnnotations(l,C);y=this._foldingEnabled&&e!==c;for(B=g.parent||g;r.hasNext();)A=r.next(),y&&A.type===p.AnnotationType.ANNOTATION_FOLDING?(P.push(A),k=this._findBlock(B,A.start),
!k||!(A.start===k.start&&A.end===k.end)?(K.push(A),A.expand()):(D=A.start,k=A.end,D>b&&(D-=d),k>b&&(k-=d),D<=b&&(b<k&&D<=a&&a<k)&&(D=e.getLineAtOffset(A.start),k=e.getLineAtOffset(A.end),D!==k?A.expanded||A.expand():K.push(A)))):A.type===p.AnnotationType.ANNOTATION_TASK&&g.start<=A.start&&A.end<=g.end&&K.push(A);y&&B.getBlocks().forEach(function(a){this._updateFolding(a,e,c,P,G,l,C)}.bind(this));this._detectTasks&&this._computeTasks(g,e,G,l,C);this._annotationProviders.forEach(function(a){var b=[],
c=[];a(this._annotationModel,e,g,l,C,b,c);K=K.concat(b);G=G.concat(c)}.bind(this));this._annotationModel.replaceAnnotations(K,G)}},_onMouseDown:function(d){if(2===d.clickCount){var b=this._view.getModel(),a=this._view.getOffsetAtLocation(d.x,d.y);if(0<a){var c=a-1,e=b;b.getBaseModel&&(c=b.mapOffset(c),e=b.getBaseModel());var f=this._findBlock(this._rootBlock,c),c=this._findMatchingBracket(e,f,c);-1!==c&&(d.preventDefault(),d=c,b.getBaseModel&&(d=b.mapOffset(d,!0)),a>d&&(a--,d++),this._view.setSelection(d,
a))}}},_onSelection:function(d){var b=d.oldValue,a=d.newValue;d=this._view.getModel();var c;if(this._highlightCaretLine){var e=d.getLineAtOffset(b.start);c=d.getLineAtOffset(a.start);var f=a.start===a.end,b=b.start===b.end;e===c&&b&&f||(b&&this._view.redrawLines(e,e+1),(e!==c||!b)&&f&&this._view.redrawLines(c,c+1))}if(this._annotationModel){var b=this._bracketAnnotations,h,g;if(a.start===a.end&&0<(g=this._view.getCaretOffset()))g-=1,d.getBaseModel&&(g=d.mapOffset(g),d=d.getBaseModel()),a=this._findBlock(this._rootBlock,
g),d=this._findMatchingBracket(d,a,g),-1!==d&&(h=[p.AnnotationType.createAnnotation(p.AnnotationType.ANNOTATION_MATCHING_BRACKET,d,d+1),p.AnnotationType.createAnnotation(p.AnnotationType.ANNOTATION_CURRENT_BRACKET,g,g+1)]);this._bracketAnnotations=h;this._annotationModel.replaceAnnotations(b,h)}},_spliceStyles:function(d,b,a,c){for(var e=d.regex,f=e.lastIndex=0,g=e.exec(a);g;){for(g=c+g.index;f<b.length&&!(g<b[f].end);)f++;var k={start:g,end:g+1,style:d.style};if(f<b.length&&b[f].start<=g){var p=
{start:g+1,end:b[f].end,style:b[f].style};b[f].end=g;b.splice(f+1,0,p);b.splice(f+1,0,k);f+=2}else b.splice(f,0,k),f++;g=e.exec(a)}},_updateFolding:function(d,b,a,c,e,f,g){f=f||d.start;g=g||d.end;if(!d.doNotFold&&d.start<=g&&f<=d.end){var k=q(c,d.start,!0);k<c.length&&c[k].start===d.start&&c[k].end===d.end||(k=this._createFoldingAnnotation(a,b,d.start,d.end))&&e.push(k);d.getBlocks().forEach(function(d){this._updateFolding(d,b,a,c,e,f,g)}.bind(this))}},_annotationProviders:[],_caretLineStyle:{styleClass:"meta annotation currentLine"},
_spacePattern:{regex:/[ ]/g,style:{styleClass:"punctuation separator space",unmergeable:!0}},_tabPattern:{regex:/\t/g,style:{styleClass:"punctuation separator tab",unmergeable:!0}}};t.EventTarget.addMixin(e.prototype);return{TextStyler:e,Block:f,createPatternBasedAdapter:function(d,b){return new r(d,b)}}});
define("orion/editor/stylers/application_javascript/syntax",["orion/editor/stylers/lib/syntax"],function(p){var t="class const debugger delete enum export extends function implements import in instanceof interface let new package private protected public static super typeof var void with".split(" "),r="break case catch continue default do else finally for if return switch throw try while yield".split(" ");p=p.grammars;p.push({id:"orion.js",contentTypes:["application/javascript"],patterns:[{begin:"'(?:\\\\.|[^\\\\'])*\\\\$",
end:"^(?:$|(?:\\\\.|[^\\\\'])*('|[^\\\\]$))",name:"string.quoted.single.js"},{begin:'"(?:\\\\.|[^\\\\"])*\\\\$',end:'^(?:$|(?:\\\\.|[^\\\\"])*("|[^\\\\]$))',name:"string.quoted.double.js"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"},{include:"orion.c-like#comment_singleLine"},{match:"/(?![\\s\\*])(?:\\\\.|[^/])+/(?:[gim]{0,3})",name:"string.regexp.js"},{include:"orion.lib#doc_block"},{include:"orion.c-like#comment_block"},{include:"#jsFunctionDef"},{include:"orion.lib#brace_open"},
{include:"orion.lib#brace_close"},{include:"orion.lib#bracket_open"},{include:"orion.lib#bracket_close"},{include:"orion.lib#parenthesis_open"},{include:"orion.lib#parenthesis_close"},{include:"orion.lib#number_decimal"},{include:"orion.lib#number_hex"},{match:"\\b(?:"+t.join("|")+")\\b",name:"keyword.operator.js"},{match:"\\b(?:"+r.join("|")+")\\b",name:"keyword.control.js"},{match:"\\b(?:false|null|true|undefined)\\b",name:"constant.language.js"},{match:"\\bthis\\b",name:"variable.language.js"}],
repository:{jsFunctionDef:{begin:"(function)(\\s+[_$a-zA-Z\\xA0-\\uFFFF][_$a-zA-Z0-9\\xA0-\\uFFFF]*)?\\s*\\(",end:"\\)",captures:{1:{name:"keyword.operator.js"},2:{name:"entity.name.function.js"}},patterns:[{include:"orion.c-like#comment_singleLine"},{include:"orion.c-like#comment_block"},{match:"[^\\s,]+",name:"variable.parameter.js"}]}}});return{id:p[p.length-1].id,grammars:p,keywords:t.concat(r)}});
define("orion/editor/stylers/application_xml/syntax",["orion/editor/stylers/lib/syntax"],function(p){p=p.grammars;p.push({id:"orion.xml",contentTypes:["application/xml","application/xhtml+xml"],patterns:[{include:"#comment"},{include:"#doctype"},{include:"#xmlDeclaration"},{include:"#tag"},{include:"#ampersandEscape"}],repository:{ampersandEscape:{match:"\x26lt;|\x26gt;|\x26amp;",name:"constant.character"},comment:{begin:{match:"\x3c!--",literal:"\x3c!--"},end:{match:"--\x3e",literal:"--\x3e"},name:"comment.block.xml",
patterns:[{match:"(\\b)(TODO)(\\b)(((?!--\x3e).)*)",name:"meta.annotation.task.todo",captures:{2:{name:"keyword.other.documentation.task"},4:{name:"comment.line"}}}]},doctype:{begin:"\x3c!(?:doctype|DOCTYPE)",end:"\x3e",name:"meta.tag.doctype.xml",captures:{0:{name:"meta.tag.doctype.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},tag:{begin:"\x3c/?[A-Za-z0-9]+",end:"/?\x3e",captures:{0:{name:"meta.tag.xml"}},name:"meta.tag.xml",
patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}]},xmlDeclaration:{begin:"\x3c\\?xml",end:"\\?\x3e",captures:{0:{name:"meta.tag.declaration.xml"}},patterns:[{include:"#comment"},{include:"orion.lib#string_doubleQuote"},{include:"orion.lib#string_singleQuote"}],name:"meta.tag.declaration.xml"}}});return{id:p[p.length-1].id,grammars:p,keywords:[]}});
define("orion/editor/stylers/text_html/syntax",["orion/editor/stylers/lib/syntax","orion/editor/stylers/application_javascript/syntax","orion/editor/stylers/text_css/syntax","orion/editor/stylers/application_xml/syntax"],function(p,t,r,k){p=p.grammars.concat(t.grammars).concat(r.grammars).concat(k.grammars);p.push({id:"orion.html",contentTypes:["text/html"],patterns:[{begin:"(?i)(\x3cstyle)([^\x3e]*)(\x3e)",end:"(?i)(\x3c/style\x3e)",captures:{1:{name:"meta.tag.html"},3:{name:"meta.tag.html"}},contentName:"source.css.embedded.html",
patterns:[{include:"orion.css"}]},{begin:"(?i)\x3cscript\\s*\x3e|\x3cscript\\s.*?(?:language\\s*\x3d\\s*(['\"])javascript\\1|type\\s*\x3d\\s*(['\"])(?:text|application)/(?:javascript|ecmascript)\\2).*?\x3e",end:"(?i)\x3c/script\x3e",captures:{0:{name:"meta.tag.html"}},contentName:"source.js.embedded.html",patterns:[{include:"orion.js"}]},{include:"orion.xml#comment"},{include:"orion.xml#doctype"},{include:"orion.xml#tag"},{include:"orion.xml#ampersandEscape"}]});return{id:p[p.length-1].id,grammars:p,
keywords:[]}});
define("orion/editor/edit","require orion/editor/config orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist webtools/cssContentAssist webtools/htmlContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(p,
t,r,k,f,g,e,q,d,b,a,c,m,n,h,s,v,x,w,y,z,C,l,u,B,A,D){function H(a,b,c){for(var d;c&&c!==b&&"none"!==d;)d=a.getComputedStyle?a.getComputedStyle(c,null).getPropertyValue("display"):c.currentStyle.display,c=c.parentNode;return!c||!d?"none":d}function M(a){var b=a.firstChild;if(b&&"TEXTAREA"===b.tagName)return b.value;var c=a.ownerDocument,d=c.defaultView||c.parentWindow;if(!d.getSelection||1===a.childNodes.length&&b.nodeType===Node.TEXT_NODE||"none"===H(d,c,a))return a.innerText||a.textContent;b=c.createRange();
b.selectNode(a);a=d.getSelection();d=[];for(c=0;c<a.rangeCount;c++)d.push(a.getRangeAt(c));a.removeAllRanges();a.addRange(b);b=a.toString();a.removeAllRanges();for(c=0;c<d.length;c++)a.addRange(d[c]);return b}function K(a){if("data-editor-"===a.substring(0,12))return a=a.substring(12),a=a.replace(/-([a-z])/ig,function(a,b){return b.toUpperCase()})}function G(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function P(a,b){var c={};G(c,b);for(var d,e=0,f=a.attributes,g=f.length;e<g;e++){d=f.item(e);
var h=K(d.nodeName);if(h){d=d.nodeValue;if("true"===d||"false"===d)d="true"===d;c[h]=d}}return c}function S(a,b){if(a.getElementsByClassName)return a.getElementsByClassName(b);b=b.replace(/ *$/,"");return a.querySelectorAll?a.querySelectorAll((" "+b).replace(/ +/g,".")):null}function Q(a){var b=a.document||document,c=a.parent;c||(c="editor");"string"===typeof c&&(c=b.getElementById(c));if(!c&&a.className){var d=S(b,a.className);if(d){a.className=void 0;1<d.length&&void 0===a.noFocus&&(a.noFocus=!0);
for(var b=[],l=d.length-1;0<=l;l--)a.parent=d[l],b.push(Q(a));return b}}if(!c)throw"no parent";a=P(c,a);if("string"===typeof a.theme){var d=g.TextTheme.getTheme(a.theme),m=a.theme.lastIndexOf("/"),n=a.theme;-1!==m&&(n=n.substring(m+1));".css"===n.substring(n.length-4)&&(n=n.substring(0,n.length-4));d.setThemeClass(n,{href:a.theme});a.theme=d}var q;a.readonly||(l={createContentAssistMode:function(a){q=new v.ContentAssist(a.getTextView());a=new v.ContentAssistWidget(q);a=new v.ContentAssistMode(q,a);
q.setMode(a);return a}});var r=new h.Editor({textViewFactory:function(){return new k.TextView({parent:c,model:new e.ProjectionTextModel(a.model?a.model:new f.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readonly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable})},undoStackFactory:new s.UndoFactory,annotationFactory:new s.AnnotationFactory,lineNumberRulerFactory:new s.LineNumberRulerFactory,
foldingRulerFactory:new s.FoldingRulerFactory,textDNDFactory:new s.TextDNDFactory,contentAssistFactory:l,keyBindingFactory:new s.KeyBindingsFactory,statusReporter:a.statusReporter,domNode:c});r.addEventListener("TextViewInstalled",function(){var b=r.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=r.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),
b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});l=a.contents;void 0===l&&(l=M(c));l||(l="");r.installTextView();r.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);r.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);r.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);r.setZoomRulerVisible(void 0===
a.showZoomRuler||a.showZoomRuler);r.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler);r.setInput(a.title,null,l,!1,a.noFocus);({styler:null,highlight:function(b,c){this.styler&&this.styler.destroy&&this.styler.destroy();this.styler=null;"js"===b?b="application/javascript":"css"===b?b="text/css":"html"===b?b="text/html":"java"===b&&(b="text/x-java-source");var d=c.getTextView(),e=c.getAnnotationModel();b&&(b=b.replace(/[*|:/".<>?+]/g,"_"),p(["./stylers/"+b+"/syntax"],function(a){a=
new u.createPatternBasedAdapter(a.grammars,a.id);this.styler=new u.TextStyler(d,e,a)},function(a){}));"text/css"===b&&c.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler)}}).highlight(a.contentType||a.lang,r);if(q){var t=new x.CssContentAssistProvider,y=new w.HTMLContentAssistProvider;q.addEventListener("Activating",function(){/css$/.test(a.lang)?q.setProviders([t]):/html$/.test(a.lang)&&q.setProviders([y])})}l=b.defaultView||b.parentWindow;!a.noComputeSize&&("none"!==H(l,b,c)&&
50>=c.clientHeight)&&(b=r.getTextView().computeSize().height,c.style.height=b+"px");return r}var L=this.orion?this.orion.editor:void 0;if(L){for(var N=0;N<arguments.length;N++)G(L,arguments[N]);L.edit=Q}return Q});define(["orion/editor/edit"],function(p){return p});